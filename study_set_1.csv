8,"How to change an IP address for outgoing emails in Plesk for Linux with Postfix mail server
Applicable to: Plesk for Linux Question
How to change an IP address for outgoing emails in Plesk for Linux with Postfix mail server?
Answer Log in to Plesk. Go to Tools & Settings > Mail Server Settings. Set outgoing mail mode to one of the following options: Send from domain IP addresses Send from domain IP addresses and use domain names in SMTP greeting Send from the specified IP addresses Apply the changes.
Note: The changes will be made in Postfix transport map file /var/spool/postfix/plesk/sdd_transport_maps.db. Command-line instructions Connect to a Plesk server via SSH. Run the command:
# plesk bin site -u example.com -mail-service-ip 203.0.113.2
where example.com - domain name 203.0.113.2 - IP address that will be used for mail of a domain "
0,"Does Plesk have a bounty policy?
Applicable to: Plesk Onyx Question
Does Plesk have a bounty policy?
Answer
Currently Plesk bounty policy is applied on a ""case-by-case"" basis. Please, send a security report to: security@plesk.com."
3,"After creating a customer/domain/subdomain, Plesk shows the error: Add Protected Directory failed: columns siteId, path are not unique
Applicable to: Plesk for Windows Symptoms A domain/subdomain is created without hosting and the following error message is shown in Plesk:
PLESK_ERROR: Error: ProtDir_IIS::update() failed: Add Protected Directory failed: columns siteId, path are not unique at execute console command --add-protected-url(vconsoleapp::start line 122) at execute ""C:\Program Files (x86)\Plesk\admin\bin64\websrvmng.exe"" --add-protected-url ""--vhost-name=example.com"" ""--path=plesk-stat"" ""--realm=Domain statistics""(vconsoleapp::run line 139) (Error code 1) When trying to add a new customer and a protected directory in Plesk, the protected directory cannot be enabled:
PLESK_ERROR: Error message : ProtDir_IIS::update() failed: Add Protected Directory failed: columns siteId, path are not unique (Error code 1)
OR
PLESK_ERROR: Error: ProtDir_IIS::update() failed: Add Protected Directory failed: Filename: Error: Cannot add duplicate collection entry of type 'add' with unique key attribute 'path' set to '/plesk-stat' Migration fails with the following error in the Plesk > Extensions > My Extensions > Plesk Migrator > 203.0.113.2 > Logs > debug.log:
CONFIG_TEXT: - Subscription 'example.com' | `- error: Failed to create subscription 'example.com' in target panel Migration for that subscription is considered completely failed. No further actions are performed for it. Migration tools tried to perform operation in 2 attempts. ---------------------------------------------------------------------------- Attempt #1 failed with the following error: u'Command LANG=en_US.UTF-8 ALLOW_WEAK_PASSWORDS=1 PLESK_RESTORE_MODE=1 ""subscription"" ""--create"" ""example.com"" ""-hosting"" ""true"" ""-hst_type"" ""phys"" ""-login"" ""john.doe"" ""-passwd"" ""password"" ""-ip"" ""203.0.113.2"" ""-mail-service-ip"" ""203.0.113.2"" ""-do-not-apply-skeleton"" ""-notify"" ""false"" failed with exit code 1: stdout: stderr: An error occurred during domain creation: An error occurred during changing of hosting settings: ProtDir_IIS::update() failed: Add Protected Directory failed: columns siteId, path are not unique at execute console command --add-protected-url(vconsoleapp::start line 100) at execute ""C:\\Program Files (x86)\\Parallels\\Plesk\\admin\\bin64\\websrvmng.exe"" --add-protected-url ""--vhost-name=example.com"" ""--path=plesk-stat"" ""--realm=Domain statistics"" The following error can be found in Event Viewer > Applications and Services > Plesk:
CONFIG_TEXT: columns siteId, path are not unique at execute console command --add-protected-url(vconsoleapp::start line 122) at execute ""C:\Program Files (x86)\Plesk\admin\bin64\websrvmng.exe"" --add-protected-url ""--vhost-name=example.com"" ""--path=plesk-stat"" ""--realm=Domain statistics""(vconsoleapp::run line 139) Execute file name: C:\Program Files (x86)\Plesk\admin\bin64\websrvmng.exe Cause
The database of protected directories has not been synchronized properly with Plesk.
Resolution Remove the failed domain via Plesk > Domains > example.com > Remove. Connect to the server via RDP. Synchronize the database of protected directories by executing the following command in cmd.exe:
C:\> ""%plesk_cli%\\repair.exe"" --synchronize-protected-directories-storage Go to Windows Start > All Programs and open Internet Information Service (IIS) Manager: Go to the IIS > Sites tab and remove the example.com website. Go to the IIS > Application Pools tab and remove the application pool of example.com, if it exists. Go to Windows Start > All Programs and open MailEnable: Go to MailEnable > Messaging Manager > Post Offices and remove example.com, if it exists. Create a domain/subdomain in Plesk or rerun the failed domain/subdomain migartion.
Note: If the error message about existing DNS records appears, apply the solution from the following article:
Unable to create a new domain/subdomain or migrate an existing domain/subdomain: DNS record already exists "
7,"Plesk installation or upgrade failed: The following services require a system restart
Applicable to: Plesk 12.5 for Windows
Plesk Onyx for Windows Symptoms
Following warning is shown by Plesk installer during an upgrade:
CONFIG_TEXT: System checking...The following services require a system restart:Component-Based Servicing pending restartWindows Update requires restartRestart the system before continuing installation.
Cause
The operating system has updates that require a reboot to be implemented.
Resolution Connect to the server via RDP. Install all latest Windows updates in Control Panel > System And Security > Windows Updates: Reboot the server.
Run plesk-installer.exe to install/upgrade Plesk.
"
3," How to secure a Plesk hostname on port 8443 with an SSL certificate (Let's Encrypt / other certificate authorities) Applicable to: Plesk for Linux Plesk for Windows Question
How to secure a Plesk hostname on port 8443 with an SSL certificate (Let's Encrypt / other certificate authorities)?
Answer Securing Plesk interface with a free Let's Encrypt certificate (Plesk Onyx and Obsidian) In Plesk, go to Extensions and search for Let's Encrypt. Click on Let's Encrypt and then click Get it free (or Install). Once installed, go to Tools & Settings > SSL/TLS Certificates (under Security). Click Let's Encrypt. Make sure the Domain name and Email address fields contain a valid information: Domain name can be a server hostname (preferable) or any other (sub)domain name hosted on the server. It will be used as an entry point to Plesk over port 8443 (for example, https://server.example.com:8443 ) for all Plesk users (customers, resellers, etc.) who have access to Plesk.
Note: The hostname/domain name must be resolved to a public IP address of the Plesk server from the Internet. If in doubt, check your hostname/domain name availability using DNS Lookup by MxToolBox. If a domain, e.g. example.com, is using permanent www redirection, specify www.example.com as Domain name. Email address will be used to receive important notifications and warnings. Click Install. At this stage, an SSL certificate from Let’s Encrypt is generated and set to secure Plesk on port 8443. This certificate will be auto-renewed every 90 days. Here is the final look: Now, access Plesk over https://server.example.com:8443. Known issues Unable to obtain a Let's Encrypt certificate: Error creating new authz :: Policy forbids issuing for name
Unable to issue Let's Encrypt certificate for securing Plesk page if wildcard subdomain is present on the server Securing Plesk interface with an SSL certificate from other certificate authorities In Plesk, go to Tools & Settings and click SSL/TLS Certificates. On the SSL/TLS Certificates page, add your certificate:
Note: If you are experiencing issues with a certificate installation, contact your certificate seller and ask for instruction for Plesk. If an SSL certificate is stored in a single *.crt file:
Click Browse... to select a certificate file. Then click Upload Certificate. If an SSL certificate is stored in the form of *.key and *.crt files:
Click Add under List of certificates in server pool and scroll down to the Upload the certificate files section and upload these files. If both the certificate and the private key parts of your certificate are contained in a *.pem file (you can check it by opening the *.pem file in any text editor), just upload it twice, both as the private key and the certificate. Click Upload Certificate once finished. If an SSL certificate is stored as a text:
Click Add under List of certificates in server pool and scroll down to the Upload the certificate as text section. There, paste the certificate and the private key parts into the corresponding fields. Click Upload Certificate when you have finished. Click [Change] next to Certificate for securing Plesk > select an uploaded certificate > click OK. Now Plesk interface is secured with an SSL certificate. Additional Information
Plesk Onyx 17.8 secures its hostname with a free Let's Encrypt certificate automatically, if the Let's Encrypt extension is installed and the hostname is a fully qualified domain name (FQDN) and is resolved from the Internet.
Related Articles How to secure a Plesk mail server with an SSL certificate (Let's Encrypt / other certificate authorities)
Is it possible to secure a Plesk IP address with an SSL certificate (Let's Encrypt / other certificate authorities)
Setting up Plesk server certificate via XML API
"
2,"How to retrieve/reset password of Plesk Administrator (admin) user in Plesk for Windows
Applicable to: Plesk for Windows Question
The password for the Plesk ""admin"" user is lost.
How to retrieve or reset it?
Answer
Note: in case logging in for the first time, use Build-in Windows Administrator credentials (the same that used for accessing the server via RDP). For Plesk Obsidian and Plesk Onyx 17.8 Retrieving the password
Starting from Plesk Onyx 17.8, it is not possible to get admin password in Plain text. However, it is possible to generate one time login link to get into Plesk with the following command after logging into the server using RDP:
C:\> plesk login
Resetting the password Connect to a Plesk server using RDP. Start a command prompt as an Administrator and run the command:
C:\> plesk bin admin --set-admin-password -passwd ""your_new_password""
where your_new_password - desired password for Plesk ""admin"" account. For Plesk Onyx 17.5 Retrieving the password Connect to a Plesk server using RDP. Start a command prompt as an Administrator and run the command below. The password will be copied to clipboard.
C:\> ""%plesk_bin%\plesksrvclient"" -get Resetting the password Connect to a Plesk server using RDP. Start a command prompt as an Administrator and run the command:
C:\> plesk bin admin --set-admin-password -passwd ""your_new_password""
where your_new_password - desired password for Plesk ""admin"" account. Note: in case it is not configured otherwise, it is possible to log into Plesk with Administrator username using password for RDP.
Additional information How to retrieve/reset a password of the ""admin"" user in Plesk for Linux? How to retrieve administrator's Plesk database password on Plesk 17.8 for Windows? "
0,"[BUG] Schedule Task is not executed on time: Task Scheduler did not launch task because instance of the same task is already running
Applicable to: Plesk 12.0 for Windows
Plesk 12.5 for Windows Symptoms Scheduled task to run PHP script stops executing after some time. In Windows Task Scheduler this task is shown as Running . On History tab for this task will be shown something like:
CONFIG_TEXT: Task Scheduler did not launch task ""\Plesk Scheduler Task #be23ba78c60597ea7122deea5a27313b"" because instance ""{fb4661d8-4be8-48bc-a5e2-5da81333dcac}"" of the same task is already running. %plesk_bin%\runtask.exe process returns Non-existent process in Process Explorer. Disk usage is not updated in Plesk. Cause
Internal issue with ID #PPPM-3855 . It has been fixed in Plesk 12.5.
Resolution
Consider upgrading to Plesk 12.5 .
Workaround
If upgrade is not possible: Connect to the server via RDP; Backup the file %plesk_bin%\plesksrv.exe; Stop Plesk Management Service (plesksrv) at Control Panel > Administrative Tools > Services; Download the archive from the attachment and unzip it; Copy the patched file plesksrv.exe to %plesk_bin% directory; Start Plesk Management Service (plesksrv). Start Plesk PopPass Service (PopPassD). Restart the scheduled task from Windows Task Scheduler if needed. "
5,"Cannot create Plesk subscription or update hosting settings: f2bmng failed with error UnknownJailException
Applicable to: Plesk Onyx for Linux Symptoms Unable to migrate data to Plesk or create a domain/subscription.
Domain is migrated without hosting, data is not migrated.
Error in /var/log/fail2ban.log:
CONFIG_TEXT: hosting update is failed: f2bmng failed: ERROR:f2bmng:Command ['set', 'plesk-apache-badbot', 'addlogpath', '/var/www/vhosts/system/example.com/logs/error_log'] failed with error UnknownJailException('plesk-apache-badbot',)Step failed 'applyCreateSubscription'. hosting update is failed: f2bmng failed: ERROR:f2bmng:Command ['set', 'plesk-apache-badbot', 'addlogpath', '/var/www/vhosts/system/example.com/logs/error_log'] failed with error UnknownJailException('plesk-apache-badbot',) Cause
Fail2ban rules prevent hosting creation.
Resolution
1. Login to Plesk
2. Find Plesk server IP addresses at Tools & Settings > IP addresses: 3. Add the IP addresses to Tools & Settings > IP Address banning (fail2ban) > Trusted IP Addresses:
"
2,"Unable to rename the domain: A virtual directory with the specified name already exists
Applicable to: Plesk 11.x for Linux
Plesk 11.x for Windows
Plesk 12.0 for Linux
Plesk 12.0 for Windows
Plesk 12.5 for Linux
Plesk 12.5 for Windows Symptoms
Domain renaming in Plesk fails with error:
PLESK_ERROR: Error: Unable to rename the domain: A virtual directory with the specified name already exists.
Cause
The directory chosen as a Docroot for the domain already exists.
Resolution Log into Plesk. Rename/remove the folder with the same name in vhosts directory in Subscriptions > example.com > File Manager:
Alternatively, set another unique name for document root of the new domain. Note: For Linux, the folder may be also located in /var/www/vhosts/system/ directory as it is used to store config and log files of the domains, and it should me renamed as well: Connect to the server via SSH. Rename the needed folder:
# mv /var/www/vhosts/system/rename.example.com/ /var/www/vhosts/system/rename.example.com_renamed/ "
6,"How to manage multiple databases with the same user via phpMyAdmin in Plesk?
Applicable to: Plesk 12.5 for Linux
Plesk 12.5 for Windows
Plesk Onyx for Linux
Plesk Onyx for Windows Question
How to manage multiple databases with a single user via phpMyAdmin or MyLittleAdmin in Plesk?
Answer
Click on a section to expand For phpMyAdmin (MySQL) Note: In phpMyAdmin is not possible to access all databases via Plesk Interface even though the user has permissions to access to all databases. To have access to all databases, it is required to log into phpMyAdmin manually. Log in to Plesk GUI Go to Domains > example.com > Databases > User Management and click Add Database User. Create a user with access to Any database: Configure access to phpMyAdmin without login to Plesk as described in the following article:
How to access phpMyAdmin shipped in Plesk without login to Plesk URL itself? Browse to https://<Plesk-server-host-name-or-IP>:8443/phpmyadmin and access using the user created on step 3: For MyLittleAdmin (MS SQL) Log in to Plesk GUI Go to Domains > example.com > Databases > User Management and click Add Database User. Create a user with access to Any database: Via Domains > example.com > Databases > Add Database create a sample empty_database without a user: Click myLittleAdmin button near the database created on step 4: "
3,"Unable to start Apache: Duplicated Listen entries in Apache configuration file
Applicable to: Plesk for Linux Symptoms Unable to start the Apache service with the error:
CONFIG_TEXT: httpd[18332]: (98)Address already in use: AH00072: make_sock: could not bind to address 0.0.0.0:80 httpd[18332]: no listening sockets available, shutting down httpd[18332]: AH00015: Unable to open logs The websites show the ""Web Server's Default"" page. In an attempt to rebuild the Apache configuration for domains, the process fails with the error below:
# /usr/local/psa/admin/bin/httpdmng --reconfigure-all Error occured while sending feedback. HTTP code returned: 502 Error occured while sending feedback. HTTP code returned: 502 Cause
Duplicated Listen entries in the Apache configuration file.
Resolution Log into the server via SSH. Find Apache configuration file which contains the duplicated Listen entries:
# grep -r Listen /etc/httpd/* /etc/httpd/conf/httpd.conf:Listen 80 /etc/httpd/conf/httpd.conf:Listen 80 Using the vi text editor open the found /etc/httpd/conf/httpd.conf file in step №2 and remove the second ""Listen 80"" directive.
Restart the Apache service to apply the changes: For RHEL based systems (CentOS/CloudLinux):
# service httpd restart For Debian based systems (Ubuntu/Debian):
# service apache2 restart Execute the command below to rebuild Apache configuration for domains:
# /usr/local/psa/admin/bin/httpdmng --reconfigure-all "
7,"How to perform dist-upgrade procedure on Linux server with Plesk?
Applicable to: Plesk Onyx for Linux How to perform dist-upgrade?
Note: dist-upgrade from Ubuntu 14 to Ubuntu 16 is supported by Plesk Onyx and Plesk Obsidian only.
Note: dist-upgrade from Debian 8 to Debian 9 is supported by Plesk Onyx (Plesk Onyx 17.8 only) and Plesk Obsidian.
Table of contents General information
Performing the dist-upgrade from Ubuntu 14 to Ubuntu 16 Performing the dist-upgrade from Debian 6,7,8 and Ubuntu 12 Preparing server for upgrade
Performing the dist-upgrade
Finalizing the upgrade General information
Warning: Dist-upgrade is not a simple process. Considerable experience in the system administration, the knowledge of the system and its components are required in order to fulfill this task.
Warning: if PHP by OS vendor was updated from third-party sources prior to dist-upgrade, it may break webmail functionality.
If you have never performed dist-upgrade before it is recommended to do the following first: Install the previous version of OS on a test server or inside a virtual machine. Upgrade it using instructions provided in the documentation by the OS vendor:
Debian 6 to Debian 7
Debian 7 to Debian 8
Debian 8 to Debian 9
Note: According to Debian dist-upgrade documentation it is not recommended to use aptitude during upgrade from Debian 7 to Debian 8. The preferred way to perform dist-upgrade on Ubuntu is using do-release-upgrade tool.
Ubuntu 12 to Ubuntu 14 Ubuntu 14 to Ubuntu 16 Solve all potential problems and make sure that Plesk is working after the upgrade. Only after that run the upgrade on the production server. Warning: Currently, Plesk does not support dist-upgrade from Ubuntu 16.04 to Ubuntu 18.04 or Debian 9 to Debian 10 yet. Vote for this functionality so that we can accurately assess its popularity relative to other features.Also, vote for the upgrade from Ubuntu 18.04 to 20.04 upgrade.
During an upgrade from Ubuntu 14 to Ubuntu 16, system PHP 5.x shipped by OS vendor will be upgraded to PHP 7.x. So to avoid any PHP compatibility issues, before an upgrade, it is highly recommended to switch all sites having PHP handler 5x by OS vendor to corresponding custom PHP handlers. Please refer to these KB articles for details: KB #213382129 KB #213933525 . Also, MySQL server upgrade can fail during the upgrade. The issue and its resolution are described in KB #115003430813.
Note: Most of APS application will not work with PHP 7.x
Performing the dist-upgrade from Ubuntu 14 to Ubuntu 16 Create a full server backup. Before the upgrade, make a full server backup. Also notify the customers about upcoming downtime of one to three hours. Run below script and follow the wizard:
# /opt/psa/bin/distupgrade.helper.ubt14-ubt16.x64.sh
The script logs all its actions in /var/log/plesk/install/plesk-distupgrade.log . During the script execution you will be asked to reboot the server. Reboot the server. After the server reboot, run the script once again. Performing the dist-upgrade from Debian 6,7,8 and Ubuntu 12:
Preparing server for upgrade Create a full server backup. Before the upgrade, make a full server backup. Also notify the customers about upcoming downtime of one to three hours. Consider to remove sources list backup files which might be left from previous dist-upgrade: /etc/apt/sources.list.saved_by_plesk_distupgrade
/etc/apt/sources.list.d/50sw_autoinstaller.list.saved_by_plesk_distupgrade` Run pre-upgrade helper script (in this case dist-upgrade from Debian 8 to Debian 9) and prepare Plesk and the system for the upgrade:
# /opt/psa/bin/distupgrade.helper.deb8-deb9_pre.x64.sh
The script logs all its actions in /var/log/plesk/install/plesk-distupgrade.log. For upgrade from Debian 6,7 disable switching to systemd during the dist-upgrade by creating the file /etc/apt/preferences.d/local-pin-init:
# echo -e ""Package: systemd-sysv\nPin: release o=Debian\nPin-Priority: -1"" > /etc/apt/preferences.d/local-pin-init Performing the dist-upgrade Update source.list file and configure repository for the OS release that is going to upgrade to. For example, for upgrade from Debian 8 to Debain 9:
# cat /etc/apt/sources.list deb http://deb.debian.org/debian stretch main contrib non-free deb http://security.debian.org/debian-security/ stretch/updates main contrib non-free deb http://deb.debian.org/debian stretch-updates main contrib non-free Update information about system packages:
# apt-get update Upgrade the system: On Debian:
If Plesk Onyx 17.8 is installed, dist-upgrade should be performed by the execution of the script below:
# /opt/psa/bin/distupgrade.helper.deb8-deb9.x64.sh On Ubuntu:
# do-release-upgrade This command will perform a complete upgrade of the system, install the newest available versions of all packages and resolve all possible dependency changes between packages in different releases. During the upgrade the system might produce prompts like: Configuration file /etc/mysql/my.cnf ==> Modified (by you or by a script) since installation. ==> Package distributor has shipped an updated version. What would you like to do about it ? Your options are: Y or I : install the package maintainer's version N or O : keep your currently-installed version D : show the differences between the versions Z : start a shell to examine the situation The default action is to keep your current version. *** my.cnf (Y/I/N/O/D/Z) [default=N] ? Choose to replace configuration files with a new one (answer Y). Finalizing the upgrade Run post-upgrade helper script:
# /opt/psa/bin/distupgrade.helper.deb8-deb9_post.x64.sh
The script logs all its actions in /var/log/plesk/install/plesk-distupgrade.log. For Debian 6 and Debian 7, remove file /etc/apt/preferences.d/local-pin-init and install systemd-sysv package:
# rm -f /etc/apt/preferences.d/local-pin-init # apt-get install systemd-sysv Reboot the server. Check that Plesk and all its services are working. "
2,"Unable to access Plesk: Internal error: Domain Service Web not exists
Applicable to: Plesk for Linux
Plesk for Windows Symptoms Plesk shows the following error after login:
PLESK_ERROR: Internal error: Domain Service Web not exists: domain=sub.example.com, id=41 Domain Service Web not exists: domain=sub.example.com, id=41 File DSWeb.php Line 76 Type PleskFatalException The following errors may be shown in the /var/log/plesk/panel.log file:
CONFIG_TEXT:[2015-11-23 22:23:48] ERR [panel] Failed to search for WordPress instances on subscription example.com: Domain with id=270 was not found [2015-11-23 22:23:52] ERR [panel] Attempt to change status of non-configured mail service. [domain_id = 270] [2015-11-23 22:23:52] ERR [panel] Unable to load object of type PhDomain with id=270: Turn off domain failed: Unable to find service node for web service on domain with id=270 [2015-11-23 22:23:52] ERR [panel] Some of the subscriptions selected were not suspended.<br>Unable to load object of type PhDomain with id=270: Turn off domain failed: Unable to find service node for web service on domain with id=270 [2015-11-23 22:23:59] ERR [panel] No data. [2015-11-23 22:24:09] ERR [panel] Failed to search for WordPress instances on subscription example.com: Resource with UID 'bd314c87-865a-46e6-b694-342e71899445' not found. Cause
The domain mentioned in the error messages has been deleted, but PSA database still contains an entry for this domain.
Plesk database was not properly upgraded. The ' psa.DomainServices ' table has no records of the ""web"" type.
Resolution
Note: This article may require additional administrative knowledge to apply. If any help required, contact server’s administrator or hosting support.
Warning: Please check that the domain physically exists before making changes. If it does, back up all the domain content from the corresponding directories /var/www/vhosts/<domain> and /var/qmail/mailnames/<domain> (in case of Linux) or from C:\Inetpub\vhosts and %plesk_dir\MailEnable\postoffices% (in case of Windows).
There are several possible scenarios: Scenario 1. Domain physically exists in Plesk Connect to the server via SSH (Plesk for Linux) or RDP (Plesk for Windows) Create Plesk database backup Access Plesk database Remove the domain mentioned in the error from the PSA database and recreate it from scratch, for example:
MYSQL_LIN: mysql> DELETE FROM domains WHERE id='41'; Query OK, 1 row affected (0.04 sec) Ensure that there are no orphaned records in the databases as follows: create databases backups:
MYSQL_LIN: MYSQL_PWD=cat /etc/psa/.psa.shadow mysqldump --skip-extended-insert --complete-insert -u admin psa > /root/psadate +%F_%H-%M.sql
MYSQL_LIN: MYSQL_PWD=cat /etc/psa/.psa.shadow mysqldump --skip-extended-insert --complete-insert -u admin apsc > /root/apscdate +%F_%H-%M.sql
# ls -lt /root/ | head -n3 total 31112 -rw-r--r-- 1 root root 224955 Nov 23 22:45 apsc2015-11-23_22-45.sql -rw-r--r-- 1 root root 14023153 Nov 23 22:44 psa2015-11-23_22-44.sql Search for the values mentioned in the error messages, for example:
# grep 'bd314c87-865a-46e6-b694-342e71899445' /root/apsc2015-11-23_22-45.sql grep 'bd314c87-865a-46e6-b694-342e71899445' /root/psa2015-11-23_22-44.sql grep 'example' /root/apsc2015-11-23_22-45.sql
# grep 'example' /root/psa2015-11-23_22-44.sql | grep -v -E 'log_components|exp_event' INSERT INTO Configurations (id, name, serviceNodeId, file, version, objectType, objectId, status, active, description, errorFile) VALUES (115,'nginxDomainWebmail',1,'/etc/nginx/plesk.conf.d/webmails/example.com_webmail.conf','14240541100.61180300','nginxDomain',28,'ok','true',NULL,''); INSERT INTO Configurations (id, name, serviceNodeId, file, version, objectType, objectId, status, active, description, errorFile) VALUES (117,'nginxDomainVhost',1,'/var/www/vhosts/system/example.com/conf/nginx.conf','14307435570.48796000','nginxDomain',28,'ok','true',NULL,''); INSERT INTO Configurations (id, name, serviceNodeId, file, version, objectType, objectId, status, active, description, errorFile) VALUES (896,'domainVhost',1,'/var/www/vhosts/system/example.com/conf/httpd.conf','14483138520.02185500','domain',270,'error','true','Template processing failed: file = /usr/local/psa/admin/conf/templates/default/domainVhost.php, error = Template_Exception: No data.\ Remove found orphaned records. For example:
MYSQL_LIN: MYSQL_PWD=cat /etc/psa/.psa.shadow mysql -u admin psa -e ""DELETE FROM Configurations WHERE id IN (115,117,896)"" MYSQL_PWD=cat /etc/psa/.psa.shadow mysql -u admin psa -e ""DELETE FROM dns_zone WHERE id=272"" MYSQL_PWD=cat /etc/psa/.psa.shadow mysql -u admin psa -e ""DELETE FROM hosting WHERE dom_id=270"" Scenario 2. Domain does not physically exist Connect to the server via SSH (Plesk for Linux) or RDP (Plesk for Windows) Create Plesk database backup Access Plesk database Change htype of incorrectly removed domain to none:
MYSQL_LIN: mysql> update domains set htype='none' where id=41; Domain will become visible in Plesk interface with ""No hosting"". Remove the domain through Plesk interface in Domains > select example.com > Click Remove Scenario 3. Applicable when domain exists or does not exists. Connect to the server via SSH (Plesk for Linux) or RDP (Plesk for Windows) Create Plesk database backup Access Plesk database Add the missing entries to the PSA database with MySQL query.
First, check that there is an entry in 'DomainServices' for this domain:
MYSQL_LIN: mysql> select * from DomainServices where dom_id = 41; +-----+--------+------+--------+---------------+----------------+ | id | dom_id | type | status | parameters_id | ipCollectionId | +-----+--------+------+--------+---------------+----------------+ | 322 | 41 | mail | 16 | 585 | 322 | +-----+--------+------+--------+---------------+----------------+ 1 row in set (0.00 sec) Add a similar ""web""-type entry, and add related records to 'IpAddressesCollections'
MYSQL_LIN: mysql> begin; mysql> select @dom_id := <missing_domain_id>; mysql> select @ip := (select dr.val from dns_recs dr, domains d where d.id = @dom_id and dr.dns_zone_id = d.dns_zone_id and dr.type = 'A' and dr.host = concat(d.name,'.')); mysql> select @ip_id := (select id from IP_Addresses where ip_address = @ip); mysql> INSERT INTO IpCollections VALUES (NULL); mysql> SELECT @ip_collection_id := LAST_INSERT_ID(); mysql> insert into IpAddressesCollections (ipCollectionId, ipAddressId) values (@ip_collection_id, @ip_id); mysql> insert into DomainServices (dom_id, type, status, parameters_id, ipCollectionId) values (@dom_id, 'web' , 0, 0, @ip_collection_id); mysql> commit; "
0,"How to convert SSL certificates in Plesk from .pfx to .pem format Applicable to: Plesk for Linux
Plesk for Windows Question
How to convert SSL certificates in Plesk from .pfx to .pem format?
Answer
Note: replace cert.pfx with the actual name of the certificate file.
Note: If it is required to convert .pfx certificate to .crt run the same commands replacing extension .pem </code>with .crt. Plesk for Windows Connect to the server via RDP;
Open Windows command prompt (CMD) as Administrator;
Run the following command:
C:\> ""%plesk_bin%\openssl.exe"" pkcs12 -in cert.pfx -out cert2.pem -nodes Plesk for Linux Connect to the server via SSH;
Run the following command:
# openssl pkcs12 -in cert.pfx -out cert2.pem -nodes "
8,"How to configure SpamAssassin for a specific mailbox? Applicable to: Plesk 12.5 for Linux Plesk 11.x for Windows Plesk 12.0 for Windows Plesk 12.0 for Linux Plesk 12.5 for Windows Question
How to configure SpamAssassin for a specific mailbox?
Answer
The SpamAssassin spam filter identifies spam messages among emails sent to mailboxes hosted on a Plesk server and allows setting it up to apply different actions to spam.
Spam filter cannot be configured at the server level: it is supported on a per-mailbox basis only.
For example, to automatically delete messages marked as spam by SpamAssassin for a mailbox, follow the instructions below: Make sure SpamAssassin is enabled on a mailbox: Domains > example.com > Mail > email address > Spam Filter > Switch on spam filtering for this email address; Specify to remove messages classified as spam: select the Delete all spam messages option: Additional detail
See more details about server-wide SpamAssassin configuration and mailbox SpamAssassin configuration."
0,"CVE-2016-2107: OpenSSL Padding Oracle vulnerability Applicable to: Plesk 12.0 for Linux
Plesk 12.5 for Linux
Plesk Onyx for Linux Information
OpenSSL project announced security update, which among the other fixes countains solution for CVE-2016-2107, CVE-2016-2108 and CVE-2016-2109 vulnerabilities. CVE-2016-2107 It was discovered that OpenSSL leaked timing information when decrypting TLS/SSL and DTLS protocol encrypted records when the connection used the AES CBC cipher suite and the server supported AES-NI. A remote attacker could possibly use this flaw to retrieve plain text from encrypted packets by using a TLS/SSL or DTLS server as a padding oracle. CVE-2016-2108 This issue affected versions of OpenSSL prior to April 2015. The bug causing the vulnerability was fixed on April 18th 2015, and released as part of the June 11th 2015 security releases. The security impact of the bug was not known at the time. In previous versions of OpenSSL, ASN.1 encoding the value zero represented as a negative integer can cause a buffer underflow with an out-of-bounds write in i2c_ASN1_INTEGER. CVE-2016-2109 When ASN.1 data is read from a BIO using functions such as d2i_CMS_bio() a short invalid encoding can casuse allocation of large amounts of memory potentially consuming excessive resources or exhausting memory.
Resolution Plesk 12.5 on RedHat 5 and CentOS 5 fixed by: Plesk 12.5.30 MU#37 update.
For Plesk 12.0 on RedHat 5 and CentOS 5 fix is expected in nearest micro-mpdate.
Plesk 11.0-11.5 on RedHat 5 and CentOS 5 the data with update relese is not decided yet. For all other Linux distrubutions but RedHat/CentOS 5 Plesk uses system OpenSSL library. If you have Plesk 11.x-12.5 installed over RedHat/CentOS 6 or Debian/Ubuntu server you should apply updates released by OS vendor and restart services: CentOS/RHEL Ubuntu Debian CentOS/RHEL-based distributions
# yum update openssl# service nginx restart# service httpd restart
Debian/Ubuntu-based distributions
# apt-get upgrade openssl# /etc/init.d/nginx restart# /etc/init.d/apache2 restart
Plesk takes the security of customers very seriously and encourages you to apply updates as soon as possible.
To check if the website is vulnerable, you can evaluate it using the SSLlabs online tool."
5,"Plesk migration/backup restoration finishes with the warning: Unable to fix restored Microsoft SQL Server user
Applicable to: Plesk for Windows Symptoms Plesk migration/backup restoration is completed with the following warning:
PLESK_WARN: Warning: Restore database ""example_db"" Unable to fix restored Microsoft SQL Server user john_doe ( System.Data.SqlClient.SqlException (0x80131904): An invalid parameter or option was specified for procedure 'sys.sp_change_users_login'. at System.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction) ... Cause
Unclear.
Resolution
This warning can be safely ignored. All objects should be restored/transferred properly.
Note: If a backup user was not transferred/created after migration/backup restoration, create it manually in Plesk at Domains > example.com > Databases > User Management and assign it to the database."
3,"Various actions fail in Plesk: The prefix '/var/www/vhosts/system/example.com' does not exist or is not a directory, FPM initialization failed
Applicable to: Plesk for Linux Symptoms Unable to switch PHP handler for a subscription or create a new domain in Plesk: PLESK_ERROR: Error: phpinimng failed: invoke-rc.d: initscript plesk-phpXX-fpm, action ""status"" failed. invoke-rc.d: initscript plesk-phpXX-fpm, action ""status"" failed. Service plesk-phpXX-fpm is down after attempt to start it The following error occurred when trying to rename the domain via Domains > example.com > Hosting settings:
PLESK_ERROR: Error: phpinimng failed: configuration test '/opt/plesk/php/x.x/sbin/php-fpm --test' failed with code 78, and message: ERROR: [pool example.com] the prefix '/var/www/vhosts/system/example.com' does not exist or is not a directory ERROR: failed to post process the configuration ERROR: FPM initialization failed The plesk-phpXX-fpm service is down and cannot be started. Error in /var/log/plesk-phpXX-fpm/error.log:
CONFIG_TEXT: ERROR: [pool example.com] the prefix '/var/www/vhosts/system/example.com' does not exist or is not a directory ERROR: failed to post process the configuration ERROR: FPM initialization failed Site fails to open with 502 Bad Gateway error or 503 Service Unavailable Migration fails:
PLESK_ERROR: ERR [util_exec] proc_close() failed ['/usr/local/psa/admin/bin/phpinimng' '--virtual-host' 'example.com' '--override' '/var/www/vhosts/system/example.com/conf/php.ini' '--type' 'fpm' '--cgi-bin' '/opt/plesk/php/XX/sbin/php-fpm' '--sysuser' 'johndoe' '--service' 'plesk-phpXX-fpm' '--poold' '/opt/plesk/php/XX/etc/php-fpm.d' '--no-reload'] with exit code [1] An error occurred during domain creation: An error occurred during changing of hosting settings: phpinimng failed: configuration test '/opt/plesk/php/XX/sbin/php-fpm --test' failed with code 78, and message: ERROR: [pool example.com] the prefix '/var/www/vhosts/system/example.com' does not exist or is not a directory ERROR: failed to post process the configuration ERROR: FPM initialization failed The PHP configuration file for the affected domain is present on the server:
# ls -la /opt/plesk/php/X.X/etc/php-fpm.d/example.com.conf -rw-r--r-- 1 root root 1294 May 3 19:54 /opt/plesk/php/X.X/etc/php-fpm.d/example.com.conf Cause
The domain was removed incompletely.
Resolution
Click on a section to expand To find and remove redundant files for the affected domain: Connect to the server via SSH
Note: in case of the migration, connect to the destination server. Check if the domain web content files and configuration file exist on the server, if the domain is registered in Plesk database:
# ls -al /var/www/vhosts/system/example.com
# httpd -D DUMP_VHOSTS | grep example.com
# plesk db ""select * from domains where name like '%example%'"" If domain web content files do not exist on the server and the domain is not registered in Plesk database, remove its configuration file and restart the affected PHP service:
# rm /opt/plesk/php/X.X/etc/php-fpm.d/example.com.conf # service plesk-phpXX-fpm restart If the files exist on the server and the domain is registered, re-create the /var/www/vhosts/system/example.com configuration directory, restart the plesk-phpXX-fpm service and reconfigure domain:
Note: change the ""plesk-phpXX-fpm"" to the required Plesk PHP service.
# mkdir -p /var/www/vhosts/system/subdomain.example.com # service plesk-phpXX-fpm restart # /usr/local/psa/admin/sbin/httpdmng --reconfigure-domain example.com To find and remove redundant files for all domains: Connect to the server via SSH Find all domains with PHP support disabled:
# plesk db -Ne ""select d.name from hosting h join domains d on h.dom_id=d.id where php='false'"" > /tmp/list Find redundant PHP-FPM files that exists still for domains without PHP:
# while read i; do find /opt/plesk/php/ /etc/php-fpm.d/ -name $i*; done < /tmp/list Remove all files found as a result of executing the command on step 3. "
8,"[FIXED BUG] Unable to login to email via IMAP despite the fact the limits are not exceeded: Connection to storage server failed: process_limit reached
Applicable to: Plesk 12.5 for Linux
Plesk Onyx for Linux
Plesk 11.x for Linux
Plesk 12.0 for Linux Symptoms Maximum number of connections (IMAP, POP3, IMAP over SSL/TLS, or POP3 over SSL/TLS) is set to a high value in Tools & Settings > Mail Server Settings, but login via IMAP still does not work with valid credentials:
CONFIG_TEXT: Roundcube Connection to storage server failed In the /var/log/maillog the following error message can be found:
CONFIG_TEXT: dovecot: master: Warning : service(imap-login): process_limit (100) reached, client connections are being dropped
OR
CONFIG_TEXT: hostname courier-imapd: Maximum connection limit reached for 203.0.113.2
OR
CONFIG_TEXT: dovecot: master: Warning: Sent SIGKILL to 99 imap-login processes When Maximum number of connections is changed in Tools & Settings > Mail Server Settings, only /etc/dovecot/conf.d/92-plesk-service-imap.confand /etc/dovecot/conf.d/92-plesk-service-pop.conffiles are updated, but no imap-login service found in /etc/dovecot/conf.d/:
# grep -r imap-login /etc/dovecot/conf.d/* # # grep -r process_limit /etc/dovecot/conf.d /etc/dovecot/conf.d/92-plesk-service-imap.conf:process_limit = 1024 /etc/dovecot/conf.d/92-plesk-service-pop.conf:process_limit = 1024 Cause Product issue: #PPPM-5559 ""Support issue #PPPM-5559""Fixed in:
Plesk Onyx 17.8 17 April 2018 Resolution
Please consider updating your server: How to install Plesk updates Workaround
If update is not possible for some reason you may try the following workaround Note: the bug is resolved for a fresh installation of Plesk 17.8 only. In case of the upgrade to Plesk 17.8, refer to the following article: /etc/dovecot/conf.d/92-plesk-service-imap-login.conf file is not created during the upgrade to Plesk 17.8
For Plesk versions lower than Plesk 17.8, the following workaround is available: Connect to the server using SSH. Create a file /etc/dovecot/conf.d/99-imap-login.conf:
# touch /etc/dovecot/conf.d/99-imap-login.conf Add the following content in it:
CONFIG_TEXT: service imap-login { process_limit = 1024 process_min_avail = 16 }
Tune process_limit value according to the server load. Restart dovecot service:
# service dovecot restart Additional information
Periodically unable to connect to mail box via IMAP/POP3: Maximum number of connections from user+IP exceeded
"
0,"How to get support directly from Plesk? Question
How to get support directly from Plesk?
Answer Plesk licenses purchased directly from Plesk include full free support. Note: free support from Plesk covers only Plesk-related questions and issues. The requests which fall out of that scope (for example, server health check, installing/integrating/upgrading 3rd party component compatible with Plesk (mail or database server), localizing spam source on the server etc.) should be performed on your own or on the paid basis by our Professional Services team. If you have purchased a Plesk license from one of Plesk partners, technical support should be provided by them. Plesk partners are fully trained and deliver best-in-the-industry support for Plesk products running on their infrastructure. However, if you would like to get support directly from Plesk, you may purchase the Plesk support subscription. Plesk support subscription terms Support subscription purchase is available for Plesk Obsidian 2 latest releases only, please refer to Change Log for Plesk Obsidian. Subscription has a free trial period for 1 month. If you order Plesk support subscription for a license for the first time, then you will be charged $0 for the first month and $10 for each next month.
Schedule of payments: Support is provided 24/7. The number of incidents is unlimited. How can I purchase it? Login to Plesk support ticket system. Submit a ticket in order to get a unique link for purchasing a support subscription. Go to the support contact form and enter your license key and other details.
If the license was purchased from one of Plesk partners, you will see the warning below. Click Try 30 days for free to purchase the support subscription: After you have purchased a subscription, go back to support contact form and enter your Plesk key again - now you will be able to create a ticket. It is possible to contact Plesk Support via email, phone, chat. If you face any issues with support subscriptions, contact Licensing and Purchase support.
Additional information
https://www.plesk.com/lifecycle-policy/"
5,"Cannot connect to FTP server on Plesk: 534-Protection level negotiation failed
Applicable to: Plesk for Windows
Plesk for Linux Symptoms Cannot connect to FTP server using FileZilla:
CONFIG_TEXT: Command: LIST Response: 534-Protection level negotiation failed. Response: Win32 error: Access is denied. Response: Error details: Protection negotiation failed. PROT command with recognized parameter must precede this command. Response: 534 End Error: Failed to retrieve directory listing Connections using other FTP client software and from Plesk server itself are possible. Cause
FTP client expects the certificate or secure connection, but FTP server does not offer it.
Resolution
Note: if you don't have Plesk administrator credentials, contact your hosting provider regarding the issue
Allow secure and non-secure FTP connections in Plesk: for all websites Log in to Plesk as admin
Go to Tools & Settings > Security policy > Secure FTP and select Allow both secure FTPS and non-secure FTP connections: for all websites on particular Plesk IP address (on Windows only) Determine IP address of the websites, for example:
# ping example.com Log in to Plesk as admin
Go to Tools & Settings > Security policy > Secure FTP and select Use custom FTPS policy per IP address: Go to Tools & Settings > IP addresses > ip_address and select Allow both secure FTPS and non-secure FTP connections: "
3,"Website hosted in Plesk does not work: Invalid command 'php_flag' or 'php_value' Applicable to: Plesk for Linux Symptoms A website/Plesk site preview is inaccessible with any of the following errors:
CONFIG_TEXT: 500 internal server error CONFIG_TEXT: 503 Invalid command 'php_flag', perhaps misspelled or defined by a module not included in the server configuration. Any of the following errors can be found in the domain error log in Domains > example.com > Logs:
CONFIG_TEXT: /var/www/vhosts/example.com/httpdocs/.htaccess: Invalid command 'php_value', perhaps misspelled or defined by a module not included in the server configuration CONFIG_TEXT: /var/www/vhosts/example.com/httpdocs/.htaccess: Invalid command 'php_flag', perhaps misspelled or defined by a module not included in the server configuration CONFIG_TEXT: /var/www/vhosts/example.com/httpdocs/.htaccess: RewriteRule: bad flag delimiters CONFIG_TEXT: /var/www/vhosts/example.com/public_html/.htaccess: Invalid command 'suPHP_ConfigPath', perhaps misspelled or defined by a module not included in the server configuration. The following error message is shown on the Home page in Plesk:
PLESK_ERROR: Unable to generate the web server configuration file on the host example.com because of the following errors: Template_Exception: AH00526: Syntax error on line 2 of /var/www/vhosts/system/example.com/conf/vhost.conf: Invalid command 'php_flag', perhaps misspelled or defined by a module not included in the server configuration Cause
Site code contains unsupported directives: PHP directives php_flag and php_value are not supported in modern PHP versions. They were supported in PHP as Apache module only (mod_php Apache module) that is now deprecated as it is considered outdated and insecure.
Resolution Login to Plesk Go to Domains > example.com > File Manager and open .htaccess file for editing.
Note: .htaccess file may be located in domain subdirectories. Comment out php_flag and php_value lines (put sign # at the beginning of the line) or remove completely: Click OK to apply the changes. Open Domain > example.com > PHP Settings and add directives from step #3 in predefined parameters (like, post_max_size) or in the Additional configuration directives field. Example of an additional directives:
CONFIG_TEXT: display_startup_error on max_input_vars = 2000 html_errors on allow_call_time_pass_reference 1 magic_quotes_gpc on Note: For PHP directives use php.ini syntax. Do not use php_flag and php_value prefix. "
6,"Database backup in Plesk fails because of missing MySQL user: The user specified as a definer does not exist
Applicable to: Plesk for Linux
Plesk for Windows Symptoms A backup creation fails with the following error in Plesk interface:
PLESK_ERROR: Warning: mysql ""dbname"" Not all the data was backed up into /var/lib/psa/dumps/domains/example.com/databases/dbname successfully. Total space: 18.00 GB; Available space: 11.00 GB; Mounted on: /. mysqldump: Got error: 1449: ""The user specified as a definer ('old-dbuser'@'%') does not exist"" when using LOCK TABLES Unable to export MySQL database dump going to Domains > Databases > dbname > Export Dump with the following error message:
PLESK_ERROR: Unable to export a dump of dbname: mysqldump: Got error: 1045: ""Access denied for user 'dbuser'@'%' (using password: YES)"" when using LOCK TABLES Going to Domains > Databases > dbname > PHPMyAdmin > Views > viewname, fails with one of the following error messages:
CONFIG_TEXT: #1449 - The user specified as a definer ('old-dbuser'@'localhost') does not exist
CONFIG_TEXT: #1045 - Access denied for user 'dbuser'@'%' (using password: YES) Migration of a subscription via Plesk Migrator fails with the following error:
PLESK_ERROR: Failed to copy content of database 'dbname' Migration tools tried to perform operation in 3 attempts: Command execution failed on the source server 'source' (203.0.113.2) with non-zero exit code. command: MYSQL_PWD=""$(cat)"" mysqldump --no-defaults -h localhost -P 3306 -uadmin --quick --quote-names --add-drop-table --default-character-set=utf8 --set-charset --routines --events database_name > /root/plesk_migrator/plesk_migrator-b1i6noaid74taessfxtzkzxsliabvk0z/db-dumps/dbname.sql exit code: 2 stdout: stderr: mysqldump: Got error: 1449: The user specified as a definer ('old-dbuser'@'%') does not exist when using LOCK TABLES Cause
The MySQL user set as a definer in the MySQL view is missing on the system.
Resolution
Consider one of the following solutions:
Click on a section to expand Remove VIEW table If the VIEW table is not required , remove it from database: Log in to Plesk GUI
Go to Domains > example.com > Databases > dbname > phpMyAdmin and click on SQL tab > Type in the following command > Click on Go to delete the MySQL view:
CONFIG_TEXT: DROP VIEW dbname.viewname;
* Where dbname is the database name and viewname is the MySQL view name Create the missing database user (Recommended) Log in to Plesk GUI Create a backup of the affected domain to find out the missing MySQL user going to Domains > example.com > Backup Manager > Back Up The backup will show a warning message, click on View the log option:
PLESK_WARN: The backup Aug 1, 2019 02:45 PM was created and can be restored, although some minor issues occurred. Download the log file View the log Close this message Get the missing MySQL user from the error message:
PLESK_WARN: Warning: mysql ""dbname"" Not all the data was backed up into /var/lib/psa/dumps/domains/example.com/databases/dbname successfully. Total space: 18.00 GB; Available space: 11.00 GB; Mounted on: /. mysqldump: Got error: 1449: ""The user specified as a definer ('old-dbuser'@'%') does not exist"" when using LOCK TABLES Go to Domains > example.com > Databases > User Management > Add Database User > Fill the form with the missing database user from the 4th step, in our example: old-dbuser > OK Recreate the MySQL view Warning: The following steps have to be applied at your own risk and will, it's recommended to ensure that the database or the server has a valid backup in case of failure. Log in to Plesk GUI Go to Domains > example.com > Databases > dbname > phpMyAdmin Click on SQL tab > Type in the following command > Click on Go:
Warning: It is very important to copy correctly the output from the command because it will be necessary to recreate the MySQL view.
CONFIG_TEXT: SELECT VIEW_DEFINITION FROM INFORMATION_SCHEMA.VIEWS WHERE TABLE_SCHEMA = 'dbname' AND TABLE_NAME = 'viewname';
* Where dbname is the database name and viewname the MySQL view name
The previous command provides a query that will be used to recreate the MySQL View. This is an example:
CONFIG_TEXT: select `dbname`.`hE8WGh_users`.`ID` AS `ID`,`dbname`.`hE8WGh_users`.`user_login` AS `user_login`,`dbname`.`hE8WGh_users`.`user_pass` AS `user_pass` from `dbname`.`hE8WGh_users` Click on SQL tab > Type in the following command > Click on Go to delete the MySQL view:
CONFIG_TEXT: DROP VIEW dbname.viewname;
* Where dbname is the database name and viewname is the MySQL view name Click on SQL tab > Type in the following command > Click on Go to create the new MySQL view:
CONFIG_TEXT: CREATE VIEW dbname.viewname AS select `dbname`.`hE8WGh_users`.`ID` AS `ID`,`dbname`.`hE8WGh_users`.`user_login` AS `user_login`,`dbname`.`hE8WGh_users`.`user_pass` AS `user_pass` from `dbname`.`hE8WGh_users`;
* Where dbname is the database name, viewname is the new MySQL view name and the SELECT query was obtained in the 3rd step "
6,"Unable to start MSSQL Server: Server TCP provider failed to listen on [ 'any' 1433]. Tcp port is already in use
Applicable to: Plesk for Windows Symptoms Unable to start MSSQL server, error in Event Viewer > Application:
CONFIG_TEXT: Server TCP provider failed to listen on [ 'any' <ipv6> 1433]. Tcp port is already in use. Several MS SQL Server instances have the same TCP port in Start > Microsoft SQL Server ** version > SQL Server Configuration Manager > SQL Server Network Configuration > Protocols for > TCP/IP > IP addresses > IPAll > TCP port. Cause
Another MSSQL server uses TCP port 1433.
Resolution
Connect to the server via RDP and customize TCP port for particular SQL Server version: Go to Start > Microsoft SQL Server < SQL_server_version> > SQL Server Configuration Manager. Go to SQL Server Network Configuration > Protocols for <SQL_server_version>.
Go to TCP/IP > IP addresses, scroll down to the IPAll settings group and change necessary TCP port to any other free port in the range 49152–65535: Open services.msc right-click SQL Server (<instance name>) and click Restart. Additional information
Configure a Server to Listen on a Specific TCP Port"
8,"Unable to send emails or create a mailbox: Error: mailmng-outgoing failed: ERROR:outgoing:mails.domain_id may not be NULL
Applicable to:
Plesk for Linux
Symptoms Unable to create a mail account for example.com or repair mail service for a domain. One of the following errors is displayed in Plesk interface:
PLESK_ERROR: Error: mailmng-outgoing failed: ERROR:outgoing:mails.domain_id may not be NULL
PLESK_ERROR: Error: mailmng-outgoing failed: ERROR:outgoing:domains.subscription_id may not be NULL
PLESK_ERROR: Error: mailmng-outgoing failed: ERROR:outgoing:mail_aliases.mail_id may not be NULL Outgoing mail control is enabled Unable to send emails, the following error might be found in the log file /var/log/maillog:
CONFIG_TEXT: There was an error sending your message: Server is not accepting SMTP connections. Error in mail clients can appear during sending emails: 554 5.7.0 The message could not be sent. You are not allowed to use sendmail utility. Errors can appear when emails are sent to one of the mailboxes of domain example.com: ""550 5.1.1 mailbox@example.com: Recipient address rejected: User unknown in virtual mailbox table"" Unable to send emails with PHP mail even though sendmail is enabled in Plesk, the following error is shown in the log file /var/log/maillog:
CONFIG_TEXT: plesk sendmail[7372]: handlers_stderr: ERROR:__main__:Rejecting message: system user uid='11088' is not allowed to send mail plesk sendmail[7372]: handlers_stderr: DATA REPLY:554:5.7.0 Your message could not be sent. The user sysuser is not allowed to send email.#012REJECT plesk sendmail[7372]: REJECT during call 'limit-out' handler Cause
There is an inconsistency in the internal database used for outgoing mail limits.
Resolution
Note: If root access to Plesk via SSH is not available, contact the service provider Connect to the server via SSH In case there is any customization in the Mail Server configuration files, back them up:
For Postfix:
# cp -rp /etc/postfix{,.old}
For Qmail:
# cp -rp /var/qmail/control{,.old} Run the following command:
# plesk repair mail If the issue persists, back up the outgoing mail limits database:
# mv /var/lib/plesk/mail/outgoing/data.db{,_bk} Repair outgoing limits configuration:
On RHEL/CentOS based systems:
# /usr/lib64/plesk-9.0/remote_mail_restore/mail_outgoing_restore
On Debian/Ubuntu based systems:
# /usr/lib/plesk-9.0/remote_mail_restore/mail_outgoing_restore "
8,"High CPU usage for ""sa-learn"" and ""spamtrain"" processes
Applicable to: Plesk for Linux Symptoms
High CPU usage for sa-learn and spamtrain processes in the server.
Cause
As sa-learn script is used by spamassassin to learn the specific properties of spam from a folder which supposedly contains only spam emails. CPU usage of the sa-learn process depends on the amount of the emails in mailboxes and its size. Then if the number of emails is huge - CPU overusage is expected.
Resolution
To workaround the issue use one of the following solutions: Connect to the server using SSH. Use nice or ionice utilities to decrease the priority of sa-update from the cron tasks. Create a wrapper file which will execute sa-learn with the lowest CPU priority:
# cp -a /usr/bin/sa-learn{,.orig} # echo ""/bin/nice -19 /usr/bin/perl -T -w /usr/bin/sa-learn.orig \$@"" > /usr/bin/sa-learn # chmod +x /usr/bin/sa-learn
Note: In Debian based OS the correct path is /usr/bin/nice Set the lowest priority to the currently running sa-learn processes execute the following:
# for i in $(ps axuwf | grep sa-learn | awk '{print $2}'); do renice 19 $i; done
Note: Process priority values range from -20 to 19. A process with the nice value of -20 is considered to be on top of the priority. And a process with nice value of 19 is considered to be low on the priority list. Disable the sa-update execution by moving 60sa-update and spamassassin files from /etc/cron.daily to a different location:
# mv /etc/cron.daily/60sa-update /root "
8,"Emails sent through a mailing list in Plesk to external mailboxes are not received: Relay access denied
Applicable to: Plesk for Linux Symptoms Emails sent through a mailing list (mailman) to external mailboxes (Gmail, Outlook, Yahoo!, etc.) are not received. One of the following error messages appears in /var/log/maillog:
CONFIG_TEXT: NOQUEUE: reject: RCPT from localhost[::1]: 454 4.7.1 list@example.com: Relay access denied; from=list@example.com to=john_doe@example.com proto=ESMTP helo=<mail.example.com> CONFIG_TEXT: NOQUEUE: reject: RCPT from localhost[127.0.0.1]: 554 5.7.1 One of the following error messages appears in /var/log/mailman/smtp-failure:
CONFIG_TEXT: delivery to list@example.com failed with code -1: Server not connected delivery to john_doe@example.com failed with code -1: [Errno 104] Connection reset by peer CONFIG_TEXT: delivery to john_doe@example.com failed with code 553: sorry, that domain isn't in my list of allowed rcpthosts (#5.7.1) Cause
localhost IPv4 and IPv6 addresses are not whitelisted.
Resolution
Add localhost IPv4 127.0.0.1 and IPv6 ::1/128 addresses to the white list: Log in to Plesk. Go to Tools & Settings > Mail Server Settings > White List. Click Add Network > add 127.0.0.1 to the IP address/mask field > click OK. Click Add Network > add ::1/128 to the IP address/mask field > click OK. Additional Information
With localhost IP addresses 127.0.0.1 and ::1/128 being white-listed, the limits on outgoing mail will not work. The corresponding warning will appear at Tools & Settings > Mail Server Settings:
PLESK_WARN: Warning: The limits on outgoing mail will not work for mail senders whose IP addresses are in the mail server's white list. For example, if there is localhost (127.0.0.0 / 8, ::1 / 128) in the white list, all mail from the local server will be successfully sent regardless of the limitations. Mail senders can use either local IP addresses (websites and custom scripts hosted on the local server) or external ones (customers who send mail from mail clients installed on their computers or mobile devices). To make the limits work for all mail senders (both local and external), remove all IP addresses and networks from the white list. Note that removing localhost (127.0.0.0 / 8, ::1 / 128) from the white list might disrupt the operation of websites and scripts that send mail from this server. For details about limitations on outgoing mail, see the Administrator's Guide, Protection from Outbound Spam."
7,"Plesk update/upgrade/component installation fails, if antivirus is installed: Unable to set the object owner: (5) Access is denied
Applicable to: Plesk Obsidian for Windows
Plesk Onyx for Windows
Plesk for Windows Symptoms Plesk might be inaccessible with a 500 error message. The following errors might be found in %plesk_dir%admin\logs\php_error.log:
CONFIG_TEXT: PHP Fatal error: Uncaught Error: Class 'Zend_Log' not found in C:\Program Files (x86)\Parallels\Plesk\admin\plib\Plesk\Log.php:169 CONFIG_TEXT: ERR [panel] PleskComponentNotInstalledException: The component was not installedfile: C:\Program Files (x86)\Plesk\admin\application\admin\controllers\WebAppFirewallController.phpline: 36code: 0trace: #0 C:\Program Files (x86)\Plesk\admin\plib\vendor\plesk\zf1\library\Zend\Controller\Action.php(133): Admin_WebAppFirewallController->init()...#5 C:\Program Files (x86)\Plesk\admin\htdocs\application.php(15): Plesk\Application_Web->run()ERR [panel.ui] The component was not installed Plesk upgrade or update fails with one of the following errors:
CONFIG_TEXT: Unable to set the object (C:\\Program Files (x86)\\Parallels\\Plesk\\admin\\****) owner: (5) Access is denied. CONFIG_TEXT: Unable to set the object (C:\\Program Files (x86)\\Parallels\\Plesk\\admin\\****) owner: (2) The system cannot find the file specified. CONFIG_TEXT: MSI: Error! Critical action 'Configure Plesk site...' failed: Access is denied. (Error code 5) at Unable to duplicate handle stdin Failed to install 'C:\ParallelsInstaller\parallels\PANEL-WIN_17.8.11\dist-windows\plesk-site_mu004.msi': Fatal error during installation. (Error code 1603) CONFIG_TEXT: Access is denied. (Error code 5) at StartService 'PleskSQLServer' Failed to install 'C:\ParallelsInstaller\parallels\PANEL-WIN_17.5.3\dist-msi-Microsoft-2003-i386\mysql-admin.msi': Fatal error during installation. (Error code 1603) Error: The installation of the package 'mysql' failed with code 1603. (upgrade: Upgrading Plesk SQL server...) CONFIG_TEXT: Upgrading Let's Encrypt extension... Package action: Execute, package: ext-letsencrypt, exec time: 3 sec. desc: ""program='[PLESK_INSTALLDIR]\bin\extension.exe',"" ""command-line='--upgrade-url"" ""https://ext.plesk.com/packages/f6847e61-33a7-4104-8dc9-d26a0183a8dd-letsencrypt/download?2.8.0-518',"" ""working-dir='',"" ""context='',"" ""arch=''"", output=' STDERR:filemng failed: plesk_exec_with_response(C:\Parallels\Plesk\admin\bin\filemng root file_exists C:\Parallels\Plesk\tmp\modF973.tmp) failed: Unable to execute plesk_exec_with_response: Unable to start (C:\Parallels\Plesk\admin\bin\filemng root file_exists C:\Parallels\Plesk\tmp\modF973.tmp) at Plesk impersonation(PipeServer::ServerThread::simpleRunAs line 687) at (zif_plesk_exec_with_response line 1135) ModSecurity might not appear in Tools & Settings and when reinstalling shows the following error messages appear in %plesk_dir%admin\logs\plesklog_debug.log:
CONFIG_TEXT: Error: Unable to set the object (C:\) owner: (5) Access is denied. at execute console command --set-security(vconsoleapp::start line 93) at execute ""C:\Program Files (x86)\Plesk\admin\bin\modsecuritymng.exe"" --set-security(vconsoleapp::run line 110) Cause
Antivirus software is blocking access to Plesk files/services during an update/upgrade or component installation.
Resolution Connect to the Plesk server via RDP Uninstall the antivirus software or add %plesk_dir% as an exclusion to antivirus software. Reboot the server. Rerun Plesk update/upgrade from Plesk > Tools and Settings > Updates and Upgrades or via a command-line interface:
C:\> plesk installer --select-release-current --reinstall-patch --upgrade-installed-components
Note: If the update continues failing with the same error, correct permissions for the folder from the error message, check out this KB article. "
3,"Unable to reconfigure domain on Plesk server: Invalid parameter number: no parameters were bound
Applicable to: Plesk for Linux Symptoms The following warning is shown by the Plesk Pre-Upgrade Checker:
CONFIG_TEXT: WARNING: Reference between several subscriptions and APS applications has been broken. The following error is displayed while making changes to the configuration of Plesk objects that assume Apache web server reconfiguration:
PLESK_ERROR: Error: New files of configuration for Apache web server were not built due to errors in configuration templates. The detailed error message was e-mailed to you, so please check the e-mail, fix the errors, and click here to retry generating configuration. Backup creation fails with an error:
CONFIG_TEXT: Unable to get APS instances on webspace id 123 (ErrorCode: 255, STDOUT:). Cause
Plesk database inconsistency.
Resolution Connect to the server via SSH:
Note: If direct SSH access to the server is not possible, contact server administrator for further assistance. Create a psa database dump:
# MYSQL_PWD=`cat /etc/psa/.psa.shadow` mysqldump -u admin psa > /var/lib/psa/dumps/psadump.kb112815.`date ""+%Y-%m-%d_%H:%M""`.sql Log in to the Plesk database:
# plesk db List configuration errors in Plesk database:
MYSQL_LIN: mysql> select id,objectId,status,description from Configurations where status=""error""; +-----+----------+--------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------+ | id | objectId | status | description | +-----+----------+--------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------+ | 5 | 1 | error | Template processing failed: file = /usr/local/psa/admin/conf/templates/default/domainVhost.php, error = SQLSTATE[HY093]: Invalid parameter number: no parameters were bound | | 195 | 96 | error | Template processing failed: file = /usr/local/psa/admin/conf/templates/default/domainVhost.php, error = SQLSTATE[HY093]: Invalid parameter number: no parameters were bound | | 205 | 101 | error | Template processing failed: file = /usr/local/psa/admin/conf/templates/default/domainVhost.php, error = SQLSTATE[HY093]: Invalid parameter number: no parameters were bound | | 835 | 434 | error | Template processing failed: file = /usr/local/psa/admin/conf/templates/default/domainVhost.php, error = SQLSTATE[HY093]: Invalid parameter number: no parameters were bound | | 837 | 435 | error | Template processing failed: file = /usr/local/psa/admin/conf/templates/default/domainVhost.php, error = SQLSTATE[HY093]: Invalid parameter number: no parameters were bound | +-----+----------+--------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------+ List broken contexts of APS applications ( subscriptionId should be the same as MainSubscriptionId or AdditionalSubscriptionId ):
MYSQL_LIN: mysql> select aps.id, pleskId, subscriptionId, s.id as MainSubscriptionId, su.id as AddSubscriptionId from apsContexts aps left join domains d on d.id=aps.pleskId left join domains w on w.id = d.webspace_id left join Subscriptions s on s.object_id=d.id left join Subscriptions su on su.object_id = w.id where (subscriptionId!=s.id and su.id is null) or (subscriptionId!=su.id and s.id is null) or aps.subscriptionId is null; +----+---------+----------------+--------------------+-------------------+ | id | pleskId | subscriptionId | MainSubscriptionId | AddSubscriptionId | +----+---------+----------------+--------------------+-------------------+ | 2 | 1 | 0 | 1 | NULL | | 3 | 96 | 96 | 75 | NULL | | 4 | 101 | 101 | 79 | NULL | | 5 | 434 | 0 | NULL | 75 | | 6 | 435 | NULL | NULL | 75 | +----+---------+----------------+--------------------+-------------------+ 5 rows in set (0.00 sec) Modify the broken contexts:
MYSQL_LIN: mysql> update apsContexts set subscriptionId=1 where pleskId=1; Query OK, 1 row affected (0.01 sec) Rows matched: 1 Changed: 1 Warnings: 0 mysql> update apsContexts set subscriptionId=75 where pleskId=96; Query OK, 1 row affected (0.00 sec) Rows matched: 1 Changed: 1 Warnings: 0 mysql> update apsContexts set subscriptionId=79 where pleskId=101; Query OK, 1 row affected (0.00 sec) Rows matched: 1 Changed: 1 Warnings: 0 mysql> update apsContexts set subscriptionId=75 where pleskId=434; Query OK, 1 row affected (0.00 sec) Rows matched: 1 Changed: 1 Warnings: 0 mysql> update apsContexts set subscriptionId=75 where pleskId=435; Query OK, 1 row affected (0.00 sec) Rows matched: 1 Changed: 1 Warnings: 0 Recreate all Apache configuration files:
# /usr/local/psa/admin/sbin/httpdmng --reconfigure-all "
8,"How does free Plesk Premium Antivirus define which 14 accounts to secure?
Applicable to: Plesk for Linux
Plesk for Windows Question
Plesk Premium Antivirus that is included for free to any Plesk license, secures only 14 mail accounts. How does it pick those 14 accounts?
Answer
Plesk Premium Antivirus secures random 14 mailboxes in the list of all recipients. There is no permanent list of accounts that are always protected.
The free version of the Plesk Premium Antivirus is designed for test purposes and should be used on a server with no more than 14 mailboxes. In case there are more mail accounts, consider purchasing Premium Antivirus paid license."
7,"Plesk websites show Error 503 after Plesk upgrade: The Module DLL C:\Windows\system32\inetsrv\rewrite.dll failed to load Applicable to: Plesk for Windows Symptoms Websites are not available after upgrading Plesk. The following error is shown:
CONFIG_TEXT: HTTP Error 503. The service is unavailable Events with ID 2280 can be found at Windows > Start > Event Viewer > Windows Logs > Application:
CONFIG_TEXT: The Module DLL C:\Windows\system32\inetsrv\rewrite.dll failed to load. The data is the error. CONFIG_TEXT: Could not load type '%SystemRoot%\system32\inetsrv\rewrite.dll'. Cause %SytemRoot%\system32\inetsrv\rewrite.dll does not exist on the filesystem or it's corrupted. Resolution Connect to the server via RDP; Make sure that the rewrite.dll file exists in the folder %SystemRoot%\System32\inetsrv: If the rewrite.dll doesn't exist, download the correct URL Rewrite Module version and install it at www.iis.net/urlrewrite If it exists, rename or remove %SystemRoot%\System32\inetsrv\rewrite.dll file and reinstall the package, which can be downloaded from www.iis.net/urlrewrite Open CMD as administrator; Continue Plesk upgrade:
C:\> plesk installer update "
7,"How to find Plesk key number for support request?
Applicable to: Plesk Question
How to find Plesk key number for support request?
Answer Log into Plesk.
Go to Tools & Settings > License Management > Key number: Note: in case the Tools & Settings or License Management page is absent contact your hosting provider. Solution using the SSH access Log into the server via SSH.
Execute the command below to get Plesk key number:
# plesk bin keyinfo --list | grep plesk_key_id | awk {'print $2'} PLSK000000010000
Note: in case the command above returns an empty output it means that the license key is not installed. Solution using the RDP access Log into the server via RDP. Start a command prompt as an Administrator.
Execute the command below to get Plesk key number:
C:\> plesk bin keyinfo.exe --list | findstr plesk_key_id plesk_key_id: PLSK000000010000
Note: in case the command above returns an empty output it means that the license key is not installed. "
7,"How to enable Oracle OCI8 extensions for Plesk PHP 7
Applicable to: Plesk 12.5 for Linux Question
How to enable Oracle OCI8 extensions for Plesk PHP 7
Answer
Warning: The article is applicable for RHEL/CentOS distributions. Install devel packages required to build custom PHP 7 modules
# yum install plesk-php70-devel gcc glibc-devel libmemcached-devel zlib-devel make libaio.x86_64 Download oracle-instantclient12.1-basic-12.1.0.2.0-1.x86_64.rpm and oracle-instantclient12.1-devel-12.1.0.2.0-1.x86_64.rpm from Oracle OTN and upload it on the server. Install oracle-instantclient12* packages:
# rpm -Uhv oracle-instantclient12.1-basic-12.1.0.2.0-1.x86_64.rpm oracle-instantclient12.1-devel-12.1.0.2.0-1.x86_64.rpm Install oci8 package with pecl # /opt/plesk/php/7.0/bin/pecl install oci8 Enable oci8 module in php.ini # echo ""extension=oci8.so"" > /opt/plesk/php/7.0/etc/php.d/oci.ini To install oci8 extension for other PHP engines installed via Plesk Installer, install PHP devel package for corresponding PHP version. For example, for PHP 7.2:
# yum install plesk-php72-devel
Note: That gcc, glibc-devel and other packages already installed on the Step 1
Repeat steps 4,5 from the above, just make sure that path is for the current PHP version:
# /opt/plesk/php/7.2/bin/pecl install oci8
# echo ""extension=oci8.so"" > /opt/plesk/php/7.2/etc/php.d/oci.ini
Check that extension is enabled:
# /opt/plesk/php/7.2/bin/php -m | grep ocioci8
Additional Information
How to add additional PHP module for PHP engines shipped with Plesk on Linux? "
2,"Unable to access to Plesk under admin: Another user with the same username (admin) is already logged in to Plesk
Applicable to: Plesk for Linux
Plesk for Windows Symptoms
Unable to log into Plesk with administrative account. A following warning appears:
PLESK_ERROR: Error: Unable to log you on. Another user with the same username (admin) is already logged in to Plesk.
Cause Allow multiple sessions under administrator's account option is disabled.
Resolution Connect to the server using SSH / via RDP;
Note: if direct SSH/RDP access to the server is not possible, contact server administrator for further assistance. Run the command below: # plesk bin admin -u -multiple-sessions true "
2,"Some Plesk operation failed: no secure shell available Applicable to: Plesk for Linux Symptoms An attempt to perform one of the following operations in Plesk might fail: Creating a Subscription Changing the password of the main Subscription system user in example.com > Web Hosting Access Deploying an application (e.g., WordPress) Settings Permanent SEO-safe 301 redirect from HTTP to HTTPS at Plesk > Domains > example.com > Hosting settings The operation fails might show the following error:
PLESK_ERROR: Error: no secure shell available File /usr/local/psa/admin/conf/site_isolation_settings.ini is modified and contains pre-defined shell:
# egrep ""shell.*="" /usr/local/psa/admin/conf/site_isolation_settings.ini shell = /bin/bash Plesk detects all the shells correctly:
# plesk sbin sysinfo getshell /bin/false /bin/sh /bin/bash /usr/bin/sh /usr/bin/bash /usr/local/psa/bin/chrootsh /bin/bash (chrooted) Cause
The configuration set in the file /usr/local/psa/admin/conf/site_isolation_settings.ini are overriding the settings configured at the Service Plan level.
Resolution
Note: The solution described in this article needs to be applied by the Plesk server administrator via SSH. If server access is not possible, please contact the service provider. Connect to the server via SSH Back up the configuration file /usr/local/psa/admin/conf/site_isolation_settings.ini:
# cp -a /usr/local/psa/admin/conf/site_isolation_settings.ini{,.backup} Comment out the forced shell parameter from the configuration file /usr/local/psa/admin/conf/site_isolation_settings.ini:
# sed -i.bak 's/shell.*=/;shell =/g' /usr/local/psa/admin/conf/site_isolation_settings.ini Control the SSH access permissions in the corresponding Service Plan or per-subscription: Service Plan: Log in to Plesk GUI > Service Plans > Service Plan Name > Permissions > Management of access to the server over SSH > Can allow access only to a chrooted environment or Can allow access to any type of shell > Update & Sync Subscription: Log in to Plesk GUI > Subscriptions > example.com > Customize (Right-sidebar) > Permissions > Management of access to the server over SSH > Can allow access only to a chrooted environment or Can allow access to any type of shell > Update & Lock In case the issue persists, enable the Setup of potentially insecure web scripting options that override provider's policy option in the corresponding Service Plan or per-subscription: Service Plan: Log in to Plesk GUI > Service Plans > Service Plan Name > Permissions > Enable Setup of potentially insecure web scripting options that override provider's policy option > Update & Sync Subscription: Log in to Plesk GUI > Subscriptions > example.com > Customize (Right-sidebar) > Permissions > Enable Setup of potentially insecure web scripting options that override provider's policy option > Update & Lock "
2,"How to enable/disable Plesk debug mode
Applicable to: Plesk for Linux
Plesk for Windows Question
How to enable/disable debug logging in Plesk?
Answer
The debug mode can be enabled either via the Plesk Panel.ini Editor extension in Plesk or in the Plesk configuration file ""panel.ini"" directly on a Plesk server.
In Plesk for Linux, debug log entries are written to the Plesk logfile /var/log/plesk/panel.log. Also, when running Plesk utilities with debug mode enabled in a command-line interface, they will produce debug log entries in their output.
In Plesk for Windows Server, debug log entries are written to the Plesk logfile %plesk_dir%admin\logs\php_error.log.
Warning: Once you are done with troubleshooting, disable debug mode back. Otherwise, it may fill up disk space over time. Enabling/disabling debug mode via the Plesk interface Log in to Plesk. Install the Panel.ini Editor from the Extensions menu in Plesk. Open Panel.ini Editor at Extensions > My Extensions. In Panel.ini Editor, switch to the Editor tab. If the editor is empty, do the following:
3.1. Download the panel_ini.txt file.
3.2. Open the downloaded file and copy its content.
3.3. Paste the content into the editor. Edit the the content and click Save: To enable debug mode, remove a semicolon "";"" at the beginning of the lines highlighted on the picture. To disable debug mode, put a semicolon "";"" back at the beginning of the lines. Enabling/disabling debug mode directly on a Linux server via SSH Connect to a Plesk server via SSH. Сheck ""panel.ini"" availability:
# ls -l /usr/local/psa/admin/conf/panel.ini If the file /usr/local/psa/admin/conf/panel.ini does not exist or is empty, create it by copying the sample configuration file /usr/local/psa/admin/conf/panel.ini:
# cp /usr/local/psa/admin/conf/panel.ini.sample /usr/local/psa/admin/conf/panel.ini Open the file /usr/local/psa/admin/conf/panel.ini in any text editor. In this example, we are using the vi editor:
# vi /usr/local/psa/admin/conf/panel.ini
or run the command below to open the file in an editor in Plesk Onyx:
# plesk conf panel.ini Edit the panel.ini file: To enable debug mode, remove a semicolon "";"" at the beginning of the bold lines shown in the example below. To disable debug mode, put a semicolon "";"" back at the beginning of the bold lines. Example of enabled debug mode:
CONFIG_TEXT: [debug] ; Enable debug mode (do not use in production environment) enabled = on [log] ; Log messages verbosity level (from 0 to 7) ; 0 - only critical errors, 7 - all including debug messages, default - 3 filter.priority = 7 ; Enable logging of SQL queries show.sql_query = on ; Enable logging of external utilities calls show.util_exec = on ; Enable logging of stdin and stdout for external utilities calls (do not use in production environment) show.util_exec_io = on Save the changes and close the file. Changes will be applied immediately, no service restart is required. Example of Plesk utility output when debug mode is enabled:
# /usr/local/psa/bin/ip_ban --update -ban_period 600 -ban_time_window 600 -max_retries 10 DEBUG [dbquery] [0] SQL: SET sql_mode = '' DEBUG [dbquery] [0] END: 0.00023102760314941 sec DEBUG [dbquery] [1] SQL: SET NAMES utf8 DEBUG [dbquery] [1] END: 0.00013208389282227 sec DEBUG [dbquery] [2] SQL: connect DEBUG [dbquery] [2] END: 0.00038313865661621 sec DEBUG [dbquery] [3] SQL: SET sql_mode = '' DEBUG [dbquery] [3] END: 0.00014400482177734 sec ... SUCCESS: The settings were updated. Example of Plesk utility output when debug mode is disabled:
# /usr/local/psa/bin/ip_ban --update -ban_period 600 -ban_time_window 600 -max_retries 10 SUCCESS: The settings were updated. Enabling/disabling debug mode directly on a Windows server via RDP Connect to a Plesk server via RDP. Open the file panel.ini located in the folder %plesk_dir%admin\conf\ (Just paste this path in Windows Explorer to open) in any text editor. If the panel.ini file does not exist, create it by copying the sample configuration file panel.ini.sample. Edit the panel.ini file: To enable debug mode, remove a semicolon "";"" at the beginning of the bold lines shown in the example below. To disable debug mode, put a semicolon "";"" back in the lines. Example of enabled debug mode:
CONFIG_TEXT: [debug] ; Enable debug mode (do not use in production environment) enabled = on [log] ; Log messages verbosity level (from 0 to 7) ; 0 - only critical errors, 7 - all including debug messages, default - 3 filter.priority = 7 ; Enable logging of SQL queries show.sql_query = on ; Enable logging of external utilities calls show.util_exec = on ; Enable logging of stdin and stdout for external utilities calls (do not use in production environment) show.util_exec_io = on Save the changes and close the file. Changes will be applied immediately, no service restart is required. Related Articles How to enable debug mode for Plesk back-end utilities on Windows
How to enable debug mode for Plesk Installer
How to enable debug mode for Plesk backup operations "
9,"[FIXED BUG] Unable to open AWStats web statistics page in Plesk: 404 Not Found The requested document was not found on this server
Applicable to: Plesk for Linux Symptoms Unable to open AWStats web statistics page with the following error:
CONFIG_TEXT: 404 Not Found The requested document was not found on this server Web Server at example.com Following directories are specified in /etc/psa/psa.conf file for AWStats scripts:
# egrep ""AWSTATS_BIN_D|AWSTATS_TOOLS_D"" /etc/psa/psa.conf AWSTATS_BIN_D /usr/share/awstats/wwwroot/cgi-bin AWSTATS_TOOLS_D /usr/share/awstats/tools The Statistics Rebuild Script fails with the following error:
CONFIG_TEXT: ./rebuild_awstats.sh: line 210: /usr/share/awstats/tools/logresolvemerge.pl: No such file or directory ERROR: failed to merge access_log*. Skipping domain. ERROR /usr/share/awstats/wwwroot/cgi-bin/awstats.pl cannot be executed. Web stat files have a huge size:
# ls -lhS /var/www/vhosts/system/example.com/logs/ | head ... -rw------- 1 root root 35G Aug 21 17:14 access_ssl_log.webstat-rw------- 1 root root 2.4G Aug 21 15:33 access_log.webstat-rw-r--r-- 1 root root 7.0M Aug 21 15:33 access_ssl_log.stat -rw-r--r-- 2 root root 5.7M Aug 21 17:39 access_ssl_log... This issue can occur after upgrade to Plesk Obsidian. Cause Product issue: #PPPM-11342 ""Accessing AWStats data for domains hosted in Plesk no longer results in the “404 Not Found” error.""Fixed in:
Plesk Obsidian 18 February 2020 (Linux) Resolution
Please consider updating your server: How to install Plesk updates Workaround
As a workaround, set the correct AWStats paths manually by following the steps below: Log in the server via SSH. Change the /etc/psa/psa.conf file according to the script location: for RHEL-based OSes: Check the packager of awstats package:
# rpm -qi awstats | grep Packager
Note: If the Packager isn't Plesk, check this knowledge base article for the solution. Adjust Awstats variables as follows:
# egrep ""AWSTATS_BIN_D|AWSTATS_TOOLS_D"" /etc/psa/psa.conf AWSTATS_BIN_D /var/www/cgi-bin/awstats AWSTATS_TOOLS_D /usr/share/awstats for Debian-based OSes: # egrep ""AWSTATS_BIN_D|AWSTATS_TOOLS_D"" /etc/psa/psa.conf AWSTATS_BIN_D /usr/lib/cgi-bin AWSTATS_TOOLS_D /usr/share/awstats/tools
Note: For Ubuntu 14.04 the following symlink should be created:
# ln -s /usr/lib/plesk-9.0/logresolvemerge /usr/share/doc/awstats/examples/logresolvemerge.pl Rebuild statistics as described in the article: How to recalculate AWStats statistics from logs for previous months "
7," How to upgrade Plesk to the next release
Applicable to: Plesk for Linux
Plesk for Windows Question
How to upgrade Plesk to the next release?
Answer
Plesk can be upgraded either via the Plesk interface or a command-line interface directly on a Plesk server.
During the upgrade process: Plesk will be unavailable
Websites will stay online To find out if your operating system is supported by the next Plesk release, visit the Plesk Lifecycle Policy page. Table of Contents Updating Plesk via the Plesk interface
Updating Plesk via a command-line interface Upgrading Plesk via the Plesk interface Note: Make sure that port 8447 is opened in firewall. If it is closed and cannot be opened, use the command-line instructions. In Plesk, go to Tools & Settings and click Updates and Upgrades. On the Updates and Upgrades page, click Install or Upgrade Product.
Note: If Plesk Obsidian is not available for upgrade, visit this KB article. On the Install or Upgrade Product page, select a Plesk version from the drop-down list and click Continue to begin the upgrade procedure.
Note: If your operating system supports the next Plesk release, but it is not in the list, check what release tier you are currently on at Plesk > Tools & Settings > Update and Upgrade Settings. For detailed instructions, see: Plesk Documentation: Upgrading Plesk Using Administrator GUI Upgrading Plesk via a command-line interface Connect to a Plesk server via SSH/RDP. Start Plesk Installer: On Linux, run the command:
# /usr/local/psa/admin/bin/autoinstaller On Windows Server, start a command prompt as an Administrator and run the command:
C:\> ""%plesk_bin%""\ai.exe --console Follow the on-screen instructions. For details, see: Plesk Documentation: Upgrading Plesk for Linux Using Installer Console
Plesk Documentation: Upgrading Plesk for Windows Using Installer Console Note: If your operating system supports the next Plesk release, but it is not in the list, check what release tier you are currently on at Plesk > Tools & Settings > Update and Upgrade Settings. Alternatively, quit Plesk Installer and start it once again with the key ""--all-versions"". Related Articles Plesk Upgrade Guide
How to install Plesk updates
"
9,"How to change the language in Awstats statistics page?
Applicable to: Plesk for Windows
Plesk for Linux Question
How to change the language in Awstats statistics page?
Answer
Click on a section to expand To change the language in Awstats for a specific domain Open configuration file: Linux: For HTTP traffic: /usr/local/psa/etc/awstats/awstats.domain.tld-http.conf For HTTPS traffic: /usr/local/psa/etc/awstats/awstats.domain.tld-https.conf Windows: %plesk_dir%\\Additional\\AWStats\\wwwroot\\cgi-bin\\domain.tld.conf
Set the Lang=""auto"" parameter to the desired language:
CONFIG_TEXT: Albanian=al Bosnian=ba Bulgarian=bg Catalan=ca Chinese (Taiwan)=tw Chinese (Simpliefied)=cn Croatian=hr Czech=cz Danish=dk Dutch=nl English=en Estonian=et Euskara=eu Finnish=fi French=fr Galician=gl German=de Greek=gr Hebrew=he Hungarian=hu Icelandic=is Indonesian=id Italian=it Japanese=jp Korean=ko Latvian=lv Norwegian (Nynorsk)=nn Norwegian (Bokmal)=nb, Polish=pl Portuguese=pt Portuguese (Brazilian)=br Romanian=ro Russian=ru Serbian=sr Slovak=sk Slovenian=si Spanish=es Swedish=se Turkish=tr Ukrainian=ua Welsh=cy
Or update all the conf files:
# sed -i 's/Lang=""auto""/Lang=""de""/g' /usr/local/psa/etc/awstats/* Regenerate statistics data by executing the following command:
Windows:
C:\> ""%plesk_bin%\\""statistics.exe --generate-domain-webstat domaint.tld Linux: # /usr/local/psa/admin/bin/statistics --generate-domain-webstat --domain-name domaint.tld To change the language in Awstats for all new domains Edit the following configuration file: Windows: %plesk_dir%\\Additional\\AWStats\\wwwroot\\cgi-bin\\awstats.model.conf Linux: /etc/awstats/awstats.model.conf Then run the command to regenerate statistics data: Windows: C:\> ""%plesk_bin%\\""statistics.exe --generate-all-webstat Linux: # /usr/local/psa/admin/bin/statistics --generate-all-webstat "
8,"How to set up default Outbound IP address for MailEnable?
Applicable to: Plesk for Windows Question
For Plesk on Windows servers, there is no Outgoing mail mode (Send from domain IP addresses, Send from domain IP addresses and use domain names in SMTP greeting, Send from the specified IP addresses) in Tools and Settings > Mail Server Settings.
How to set up default Outbound IP address for MailEnable?
Answer
Note: by default, MailEnable uses IPv6 if it is available in the server, therefore it may be required to disable IPv6 manually. To disable it connect to the server via RDP, and modify the Windows registry. Open branch ""HKEY_LOCAL_MACHINE\SOFTWARE\Mail Enable\Mail Enable\Connectors\SMTP"", set parameter ""IPv6 Status Value"" to value ""0. For details check MailEnable forum tread.
Note: assigning individual outbound IP per post office is possible only for Enterprise and Premium editions of MailEnable as a part of the ""Improved Smarthosting"" feature.
MailEnable has the option to configure which IP Address is used to connect to remote mail servers and send outbound mail. To access this setting follow steps below: Connect to the server via RDP. Open Mailenable Administrator by finding MailEnable in the Programs section of the start menu (or Start screen on Windows 2012). Go to MailEnable Management > Servers > localhost > Services and Connectors . Right-click SMTP and choose Properties. Switch to Outbound tab and select desired outbound IP address: By default, the first adapter/interface added to the computer is always used for outbound traffic. Right-click on SMTP > Stop and then SMTP > Start. Additional information Outgoing IP address for Mail Delivery
"
8,"Mailing list archives and settings are not transferred (migrated)
Applicable to: Plesk for Linux Symptoms
Advanced settings of mailing lists are lost after transfer (migration) in Plesk.
Mailman archives are not transferred when using Plesk Migrator.
Cause
Migration & Transfer Manager transfers only basic settings of mailing lists: list administrator, subscribers. Mailing list archives and other settings are not transferred, since Plesk cannot manage them.
Resolution
It is possible to transfer configuration of mailing list using Mailman's native utilities. Below example shows how to transfer settings of maillist maillist1 from one server to another: On a source server, save mailing list configuration into file:
# /usr/lib/mailman/bin/config_list -o maillist1.conf maillist1 Transfer maillist1.conf to destination server, where domain with mailing list has already been transferred and deployed, and restore configuration:
# /usr/lib/mailman/bin/config_list -i maillist1.conf maillist1 If you want Plesk Migrator to transfer Mailman archives, we suggest to vote for this functionality on Plesk UserVoice."
2,"Unable to create a subscription or domain: the IP pool is empty
Applicable to: Plesk Onyx for Linux Symptoms By clicking Plesk > Add subscription or Add domain one of the following error messages appear:
PLESK_WARN: Unable to create a subscription: the IP pool is empty.
PLESK_ERROR: Unable to create a subscription because there are no shared IP addresses and no free dedicated IP addresses in Plesk Some of the packages are marked as not installed in Plesk > Tools & Settings > Server Components or menu itself is empty. Cause
System packages were not configured.
Resolution Connect to the server using SSH; Check the list of not configured packages: # dpkg --list | grep -v ii iU apache2 2.4.7-1ubuntu4.9 amd64 Apache HTTP Server iU apache2-bin 2.4.7-1ubuntu4.9 amd64 Apache HTTP Server (binary files and modules) Finish configuration of system packages:
# dpkg --configure -a Reinstall Plesk updates; Browse to Plesk > Tools & Settings > Server Components and click Refresh button to update information. "
5,"Unable to restore or manage subscription: Unable to load object of type IPAddress with id=XXSymptoms
Error while trying to create, migrate or restore the subscription:
Unexpected Plesk API Error: Unable to load object of type IPAddress with id=XX: IPAddress: unable to select: no such row in the table
Cause
The issue is caused by a database inconsistency: IP pool of customer for whom the subscription is created contains a reference to a non-existent IP address.
Resolution Create databases backup according to How to backup/restore a Plesk database dump? article. Access Plesk database. Verify whether IP address with ID reported in the error message is missing:
MYSQL_LIN: mysql> select * from psa.IP_Addresses where id=XX; 0 rows in set (0.00 sec) There are two options: If the IP address with ID from an error message is missing from IP_Addresses: Find and remove all references to this IP address from ip_pool table:
MYSQL_LIN: mysql> select * from ip_pool where ip_address_id=XX; +----+---------------+-----------+ | id | ip_address_id | type | +----+---------------+-----------+ | 1 | XX | exclusive | +----+---------------+-----------+ mysql> delete from ip_pool where ip_address_id=XX; OR: Locate ID of the main IP on a server in IP_Addresses table and update tables IP_Addresses, ip_pool, and IpAddressesCollections by replacing ID of the main IP address to XX:
MYSQL_LIN: mysql> select id, ip_address, main from IP_Addresses where main='true'; +----+-------------+-------+ | id | ip_address | main | +----+-------------+-------+ | XX | 203.0.112.2 | true | +----+-------------+-------+ mysql> update IP_Addresses set id=XX where id=YY; mysql> update ip_pool set ip_address_id=XX where ip_address_id=YY; mysql> update IpAddressesCollections set ipAddressId=XX where ipAddressId=YY; If IP address with ID from an error message is present in IP_Addresses and this is the only IP address: MYSQL_LIN: mysql> select id, ip_address from psa.IP_Addresses; +----+-----------------+ | id | ip_address | +----+-----------------+ | XX | 203.0.112.2 | +----+-----------------+ 1 row in set (0.00 sec) Verify whether ID of IP address from error message is present in IpAddressesCollections
MYSQL_LIN: mysql> select * from psa.IpAddressesCollections where ipAddressId=XX; +----------------+-------------+ | ipCollectionId | ipAddressId | +----------------+-------------+ | 1 | XX | | 2 | XX | | 3 | XX | | 4 | XX | +----------------+-------------+ 4 rows in set (0.00 sec) Set proper ID in IpAddressesCollections.ipAddressId to ID of existing IP address:
MYSQL_LIN: mysql> UPDATE psa.IpAddressesCollections set ipAddressId='YY' where ipAddressId='XX'; Recreate configuration files for mail and web services: For Linux:
# /usr/local/psa/admin/bin/mchk # /usr/local/psa/admin/bin/httpdmng --reconfigure-all For Windows:
C:\> plesk repair web "
3,"Website on Plesk shows 403 Forbidden: Symbolic link not allowed or link target not accessible
Applicable to: Plesk 12.5 for Linux
Plesk 12.0 for Linux Symptoms
After restoration from backup website shows 403 Forbidden error.
In /var/www/vhosts/system/example.com/logs/error_log the following error appears:
CONFIG_TEXT: Symbolic link not allowed or link target not accessible: /var/www/vhosts/example.com/httpdocs/index.php
Cause
Symbolic links are not allowed in Apache configuration.
Resolution
Go to Domains > example.com > File Manager and add the following directive into .htaccess file of website:
CONFIG_TEXT: Options +FollowSymlinks
If solution did not help, connect to the server via SSH and make sure that symbolic link has correct ownership and modify it if necessary:
# chown -h <subscription_user>:psacln /var/www/vhosts/example.com/symlink
or disable symbolic link owner check by adding the following directive into .htaccess file:
CONFIG_TEXT: Options -SymLinksIfOwnerMatch"
9,"Subscription creation fails with error: Unable to find the awstats template file Applicable to:
Plesk for Linux Symptoms Creation of a subscription fails with an error:
PLESK_ERROR: Error: hosting update is failed: webstatmng: Unable to find the awstats template file /etc/awstats/awstats.model.conf System error 2: No such file or directory There is no /etc/awstats/awstats.model.conf file:
# ls /etc/awstats/awstats.model.conf ls: cannot access /etc/awstats/awstats.model.conf: No such file or directory Cause
The file /etc/awstats/awstats.model.conf is missing.
Resolution Log into the server via SSH. The file /etc/awstats/awstats.model.conf/ is a symlink for /etc/awstats/awstats.conf. Usi the command below create a symlink:
# ln -s /etc/awstats/awstats.conf /etc/awstats/awstats.model.conf In case the issue will persist, reinstall AWStats via Plesk Installer. "
8,"Autoreply for mail does not work in Plesk with SmarterMail
Applicable to: Plesk for Windows Symptoms Autoreply for mail does not work in Plesk with SmarterMail;
There are no any logs in Plesk and SmarterMail regarding any attempt to send an auto response. Cause
Plesk mail filter was disabled on SmarterMail server.
Resolution
Plesk does not use SmarterMail auto-reply feature, instead of this Plesk uses its own mail filter. If Plesk mail filter was disabled on SmarterMail server, auto-response will not work. Log in to SmarterMail as admin user. Enable Plesk mail filter in SmarterMail in SmarterMail Administrator > Settings > General Settings > Spool Command-Line File > Enabled Command-Line File should be C:\Program Files (x86)\Plesk\admin\bin\smmailfilter.exe %filepath
Note: path to smmailfilter.exe can be different on your the server "
8,"When does SpamAssassin begin using the Spam filter database for filtering emails?
Applicable to: Plesk 12.5 for Linux
Plesk 12.0 for Linux Question When does SpamAssassin begin using the Spam filter database for filtering emails? Answer According to the SpamAssassin documentation , the Bayes system is not activated until a certain number of ham (non-spam) and spam email messages has been learned. The default value is 200 of each ham and spam messages.It means that SpamAssassin begins to filter mails after 200 spam and 200 none-spam emails has been learned.This statistics is needed to distinguish spam mails. This default value can be changed in /etc/mail/spamassassin/local.cf by using the following SpamAssassin options: bayes_min_ham_num 100bayes_min_spam_num 100 SpamAssassin can be trained on per-mailbox basis. Check corresponding Plesk Documentation article.
"
3,"Apache failed to start: (24)Too many open files: Init: Can't open server certificate file
Applicable to: Plesk for Linux Symptoms It is not possible to start or restart Apache web server, all websites are down:
# service httpd start Starting httpd: [FAILED]
Or:
# systemctl start apache2.service Job for apache2.service failed because the control process exited with error code. See ""systemctl status apache2.service"" and ""journalctl -xe"" for details. The following error can be found in the /var/log/httpd/error_log file ( /var/log/apache2/error.log in Debian and Ubuntu):
CONFIG_TEXT: [error] (24)Too many open files: Init: Can't open server certificate file /usr/local/psa/var/certificates/cert8bV9dbI 'import site' failed; use -v for traceback
Or:
CONFIG_TEXT: AH00015: Unable to open logs The following error is shown when trying to start Apache using the strace utility (in Debian and Ubuntu, Apache binary is /usr/sbin/apache2 ):
# strace -q -vttT -s4096 /usr/sbin/httpd -e debug -k start ... open(""/var/www/vhosts/system/example.com/logs/access_ssl_log"", O_WRONLY|O_CREAT|O_APPEND|O_CLOEXEC, 0666) = -1 EMFILE (Too many open files) <0.000011> write(408, ""[Wed Sep 13 21:27:55.156566 2017] [log_config:error] [pid 22172:tid 140081010858112] (24)Too many open files: AH00649: could not open transfer log file /var/www/vhosts/system/example.com/logs/access_ssl_log.\n"", 235) = 235 <0.000034> write(2, ""AH00015: Unable to open logs\n"", 29) = 29 <0.000022> Cause
The maximum allowed number of file descriptors is not enough for Apache web server.
Resolution
Click on a section to expand For Systemd OS (RHEL 7-based, Debian 8, Ubuntu 16.04) Connect to the server via SSH Set desired open files limit to for both Apache and Nginx, using the following shell utility
# /usr/local/psa/admin/sbin/websrv_ulimits --set 32768 --no-restart Restart Apache and nginx services at Plesk > Tools & Settings > Services Management to apply changes. Another solution is to increase open file limit manually: Create the directory /lib/systemd/system/httpd.service.d/ directory ( apache2.service.d in Debian and Ubuntu):
# mkdir /lib/systemd/system/httpd.service.d/ In this directory, create limit_nofile.conf file in it with the following content:
# cat /lib/systemd/system/httpd.service.d/limit_nofile.conf [Service] LimitNOFILE=65536 Reload systemd unit files and start Apache (in Debian and Ubuntu, service is called apache2.service ):
# systemctl daemon-reload # systemctl start httpd.service
Note: If the issue still persists on the Debian-like systems, increase limits through APACHE_ULIMIT_MAX_FILES environment variable as it is described below for SysVinit OSes. For SysVinit OS (RHEL 6-based, RHEL 5, Debian 7) For Debian and Ubuntu: Connect to the server via SSH Put the APACHE_ULIMIT_MAX_FILES='ulimit -n 131072' line into the /etc/apache2/envvars file:
# grep ULIMIT /etc/apache2/envvars APACHE_ULIMIT_MAX_FILES='ulimit -n 131072' Restart the Apache service:
# service apache2 restart For RHEL-based operating systems: Connect to the server via SSH Comment the following section in the /usr/sbin/apachectl file:
CONFIG_TEXT: #ULIMIT_MAX_FILES=""ulimit -S -n `ulimit -H -n`"" #-------------------- -------------------- #|||||||||||||||||||| END CONFIGURATION SECTION |||||||||||||||||||| #Set the maximum number of file descriptors allowed per child process. #if [ ""x$ULIMIT_MAX_FILES"" != ""x"" ] ; then #$ULIMIT_MAX_FILES #fi After the commented section, add ulimit -n 131072 line:
CONFIG_TEXT: .......... #$ULIMIT_MAX_FILES #fi ulimit -n 131072 Add the ulimit -n 131072 line into the /etc/sysconfig/httpd file:
# grep -i ulimit /etc/sysconfig/httpd ulimit -n 131072 Restart the Apache service:
# service httpd restart "
5,"How to prepare Plesk server for migration
Applicable to: Plesk for Linux Question
What should be done to avoid errors during Plesk server migration?
Answer All Plesk components that are used on the source server should be installed on the destination server as well. For example, if the source server has PostgreSQL or Mailman, these packages must be installed on the destination server. Otherwise, the corresponding data will not be transferred. Make sure Plesk license on the destination server provides the same or broader feature set that the license of the source server does. Featured of different Plesk Editions are listed here. Contact Plesk Sales Team if license upgrade is required. Check if free disk space on the source server is enough to dump the data. All databases are transferred as dumps, so there must be enough free disk space on the source server to store dumps of the 5 biggest databases within the temporary directory (by default it is /tmp/panel_migrator). Configure IP addresses. Ideally, there should be a shared IP address on the destination server for every shared IP address on the source server. The same goes for dedicated IP addresses. During migration via GUI, Plesk performs IP address mapping automatically. The destination server must contain free disk space at least twice the size of the data being migrated. The extra space is needed to store the dump on the destination server and extract data from it.
Specify default MySQL character set latin1 in /etc/my.cnf:
CONFIG_TEXT: [mysql] default-character-set=latin1
To get current default characters:
# MYSQL_PWD=`cat /etc/psa/.psa.shadow` mysql -u admin -e 'status' | grep characterset Server characterset: latin1 Db characterset: latin1 Client characterset: latin1 Conn. characterset: latin1 Define the max_allowed_packet value for MySQL server in /etc/my.cnf to prevent issues during the database migration: CONFIG_TEXT: [mysqld] max_allowed_packet = 64M … "
3,"Unable to start nginx: Not starting nginx as it is disabled in config
Applicable to: Plesk 12.X for Linux
Plesk Onyx for Linux Symptoms Nginx is stopped:
# service nginx status nginx is stopped # service nginx status nginx dead but pid file exists Cannot start Nginx:
# /etc/init.d/nginx start Not starting nginx as it is disabled in config nginx service is disabled: CentOS/RHEL:
# cat /etc/sysconfig/nginx NGINX_ENABLED=no Debian/Ubuntu:
# cat /etc/default/nginx NGINX_ENABLED=no Nginx error log file at /var/log/nginx/error.log contains the following line:
CONFIG_TEXT: [emerg] 2060#0: duplicate listen options for [2001:db8:f61:a1ff:0:0:0:80]:80 in /etc/nginx/plesk.conf.d/server.conf:29 Cause
Nginx is disabled for starting in its configuration
Resolution Connect to the server via SSH. Enable nginx in it's configuration file: CentOS/RHEL:
# vi /etc/sysconfig/nginx Debian/Ubuntu:
# vi /etc/default/nginx Set this:
CONFIG_TEXT: NGINX_ENABLED=yes
in: CentOS/RHEL:
# cat /etc/sysconfig/nginx NGINX_ENABLED=yes Debian/Ubuntu:
# cat /etc/default/nginx NGINX_ENABLED=yes Reconfigure nginx and apache to listen to correct ports:
# plesk sbin nginxmng -d # plesk sbin nginxmng -e In case LiteSpeed Web Server is used Connect to the server via SSH. Disable nginx in Plesk to create correct configuration:
# plesk sbin nginxmng -d
Note: LiteSpeed requires nginx to be disabled, as it cannot work with it. "
8,"Horde login error: Unable to get webmail password!
Applicable to: Plesk for Linux Symptoms
It is not possible to log into Horde Webmail. The the following error appears:
CONFIG_TEXT: Unable to get webmail password!
Cause
/etc/psa-webmail/horde/.horde.shadow is missing or cannot be processed by Apache.
Resolution For Plesk 11.5 and newer Connect to the server via SSH. Check that the /etc/psa-webmail/horde/.horde.shadow file exists and it has the following permissions:
# ls -la /etc/psa-webmail/horde/.horde.shadow -rw-r----- 1 root horde_sysgroup 15 Jul 29 2014 /etc/psa-webmail/horde/.horde.shadow Make sure to set permissions as follows if they are different:
# chmod 755 /etc /etc/psa-webmail /etc/psa-webmail/horde # chown root:horde_sysgroup /etc/psa-webmail/horde/.horde.shadow # chmod 640 /etc/psa-webmail/horde/.horde.shadow Go to Plesk > Tools and Settings > Apache Web Server and check that suexec and fcgid modules are enabled. For Plesk 11.0 Check that the file /etc/psa-webmail/horde/.horde.shadow exists and that it has the following permissions:
# ls -la /etc/psa-webmail/horde/.horde.shadow -rw-r----- 1 root apache 15 Mar 20 2012 /etc/psa-webmail/horde/.horde.shadow Make sure that the Apache's user ( apache on CentOS/RedHat/SuSE and www-data on Debian/Ubuntu) can get the content of this file:
# su - apache -s /bin/sh -c ""cat /etc/psa-webmail/horde/.horde.shadow"" password Additional Information If the error ""Permission denied"" is received during diagnostics, correct the permissions:
# chmod 755 /etc /etc/psa-webmail /etc/psa-webmail/horde # chown root:apache /etc/psa-webmail/horde/.horde.shadow # chmod 640 /etc/psa-webmail/horde/.horde.shadow If the error ""No such file or directory"" is received, create a new /etc/psa-webmail/horde/.horde.shadow file with a random password, set the proper permissions as described above. "
10,"How to get a list of all websites published by Web Presence Builder? Applicable to: Plesk for Windows Plesk for Linux Symptoms
How to get a list of all websites which use Web Presence Builder?
Resolution For Linux Connect to the server via SSH as root. Execute the following command:
# plesk db ""select d.name as 'Website' from psa.domains d, psa.dom_param dp, sitebuilder5.site s where d.id=dp.dom_id and dp.param='site_builder_site_id' and s.uuid=dp.val and s.is_published is not null and d.status=0"" +-------------+ | Website | +-------------+ | example.com | | example.org | +-------------+ For Windows Connect to the server via RDP. Open Command Prompt as Administrator. Execute the following command:
C:\> plesk db ""select d.name as 'Website' from domains d, dom_param dp where d.id=dp.dom_id and dp.param='site_builder_site_id'"" +-------------+ | Website | +-------------+ | example.com | | example.org | +-------------+ "
8,"How to enable/disable HTTPS redirection for webmail in Plesk for Linux
Applicable to: Plesk for Linux Question
How to enable/disable HTTPS redirection (force webmail to use SSL) for webmail in Plesk for Linux?
Answer
A redirection in Webmail from HTTP to HTTPS on a Plesk for Linux server can be configured either via SSL It! extension, by creating a Plesk custom configuration template, modifying the webmail native configuration file or modifying the webmail htaccess file: Solution 1: SSL It! Extension (For a Single Domain) For Plesk Obsidian Install the SSL It! extension. Secure webmail with an SSL certificate. Go to Domains > example.com > SSL/TLS Certificates > Options > Enable Redirect from HTTP to HTTPS > Click on Configure > Select/deselect Apply to webmail > Click on Update to apply the changes. Solution 2: Creating a Plesk custom configuration template For Plesk Onyx and Obsidian Connect to a Plesk server via SSH. Create a directory for custom configuration templates:
# mkdir -p /usr/local/psa/admin/conf/templates/custom/webmail Copy the original file webmail.php to the created directory:
# cp -p /usr/local/psa/admin/conf/templates/default/webmail/webmail.php /usr/local/psa/admin/conf/templates/custom/webmail/ Open the file /usr/local/psa/admin/conf/templates/custom/webmail/webmail.php in a text editor (for example, ""vi"" editor) and insert the records below right before the first </VirtualHost> string:
CONFIG_TEXT: RewriteEngine On RewriteCond %{REQUEST_URI} !^/\.well\-known/acme\-challenge/ RewriteCond %{HTTPS} off RewriteRule ^ https://%{HTTP_HOST}%{REQUEST_URI} [R=301,QSA] Save the changes and close the file. Regenerate configuration files for all domains:
Note: During this operation, the websites will be unavailable for a short period of time. The execution time of this command depends on the number of domains on the server.
# plesk sbin httpdmng --reconfigure-all To disable this redirect, remove the /usr/local/psa/admin/conf/templates/custom/webmail/webmail.php file and repeat step 6. For Plesk Onyx and Obsidian: Plesk Premium Email Connect to a Plesk server via SSH. Edit the custom configuration template /usr/local/psa/admin/conf/templates/custom/webmail/roundcube.php created by Plesk Premium Email and locate the following text:
CONFIG_TEXT: RewriteEngine On RewriteRule ^/[a-zA-Z0-9]{16}/(.*) /$1 [PT,L] Add the following lines after the text block identified in the previous step:
CONFIG_TEXT: RewriteEngine On RewriteRule ^/[a-zA-Z0-9]{16}/(.*) /$1 [PT,L] # Redirect Kolab from HTTP to HTTPS RewriteCond %{REQUEST_URI} !^/\.well\-known/acme\-challenge/ RewriteCond %{HTTPS} off RewriteRule ^ https://%{HTTP_HOST}%{REQUEST_URI} [R=301,QSA] Save the changes and close the file. Regenerate configuration files for all domains:
Note: During this operation, the websites will be unavailable for a short period of time. The execution time of this command depends on the number of domains on the server.
# plesk sbin httpdmng --reconfigure-all To disable this redirect, remove the lines in bold added on step 3 and repeat step 5. Solution 3: Modifying the native configuration file of Roundcube/Horde For Plesk Onyx and Obsidian: Roundcube webmail Connect to a Plesk server via SSH. Open the file /usr/share/psa-roundcube/config/config.inc.php in a text editor (for example, ""vi"" editor) and add the following line at the end of the file:
CONFIG_TEXT: $config['force_https'] = true; Save the changes and close the file. To disable this redirect, set 'force_https' to 'false':
CONFIG_TEXT: $config['force_https'] = false; For Plesk Onyx and Obsidian: Horde webmail Connect to a Plesk server via SSH. Open the file /etc/psa-webmail/horde/horde/conf.php in a text editor (for example, ""vi"" editor) and change the value of $conf['use_ssl'] to 1:
CONFIG_TEXT: $conf['use_ssl'] = 1; Save the changes and close the file. To disable this redirect, set 'force_https' to 2:
CONFIG_TEXT: $conf['use_ssl'] = 2; Solution 4: Modifying the webmail htaccess file For Plesk Onyx and Obsidian: Roundcube webmail Connect to a Plesk server via SSH. Open the file roundcube.htaccess.inc in a text editor (for example, ""vi"" editor). The location of this file is: for CentOS/RHEL-based distributions:
MYSQL_LIN: /etc/httpd/conf/plesk.conf.d/roundcube.htaccess.inc for Debian/Ubuntu-based distributions:
MYSQL_LIN: /etc/apache2/plesk.conf.d/roundcube.htaccess.inc Insert the text below in the <IfModule mod_rewrite.c> section:
CONFIG_TEXT: <IfModule mod_rewrite.c> ... RewriteCond %{REQUEST_URI} !^/\.well\-known/acme\-challenge/ RewriteCond %{HTTPS} off RewriteRule ^ https://%{HTTP_HOST}%{REQUEST_URI} [R=301,QSA] </IfModule> Save the changes and close the file. Restart Apache: for CentOS/RHEL-based distributions:
# service httpd restart for Debian/Ubuntu-based distributions:
# service apache2 restart To disable this redirect, remove the lines added on step 3 and restart Apache. For Plesk Onyx and Obsidian: Horde webmail Connect to a Plesk server via SSH. Create a directory for custom configuration templates:
# mkdir -p /usr/local/psa/admin/conf/templates/custom/webmail Copy the original file horde.php to the created directory:
# cp -p /usr/local/psa/admin/conf/templates/default/webmail/horde.php /usr/local/psa/admin/conf/templates/custom/webmail/ Open the created file /usr/local/psa/admin/conf/templates/custom/webmail/horde.php in a text editor (for example, ""vi"" editor) and: Add the $hordeHtaccess record (line 6):
CONFIG_TEXT: <?php /** @var Template_VariableAccessor $VAR */ $hordeDocroot = $VAR->server->webserver->horde->docroot; $hordeSysUser = ""horde_sysuser""; $hordeSysGroup = ""horde_sysgroup""; $hordeHtaccess = $VAR->server->webserver->httpConfDir . ""/plesk.conf.d/horde.htaccess.inc""; $hordePhpIni = $VAR->server->webserver->horde->confD . ""/horde/php.ini""; ?> Add the Include record right before </Directory> (line 33):
CONFIG_TEXT: <?php endif; ?> Include ""<?php echo $hordeHtaccess ?>"" </Directory> </IfModule> Create the file horde.htaccess.inc: for CentOS/RHEL-based distributions:
# touch /etc/httpd/conf/plesk.conf.d/horde.htaccess.inc for Debian/Ubuntu-based distributions:
# touch /etc/apache2/plesk.conf.d/roundcube.htaccess.inc Regenerate configuration files for all domains (required once):
Note: During this operation websites will be unavailable for a short period of time. The execution time of this command depends on the number of domains on the server.
# /usr/local/psa/admin/sbin/httpdmng --reconfigure-all Open the created file horde.htaccess.inc and add rewrite rules:
CONFIG_TEXT: <IfModule mod_rewrite.c> RewriteEngine On RewriteCond %{REQUEST_URI} !^/\.well\-known/acme\-challenge/ RewriteCond %{HTTPS} off RewriteRule ^ https://%{HTTP_HOST}%{REQUEST_URI} [R=301,QSA] </IfModule> Save the changes and close the file. Restart Apache: for CentOS/RHEL-based distributions:
# service httpd restart for Debian/Ubuntu-based distributions:
# service apache2 restart To disable this redirect, remove the lines added on step 7 and restart Apache. "
6,"How to enable remote connections to MS SQL server on a Plesk server?
Applicable to: Plesk for Windows Question
How to enable remote connections to MS SQL server?
Answer Connect to the server via RDP. Press the Start button, go to Microsoft SQL Server XXXX (where XXXX is the MSSQL version) and click the SQL Server XXX Configuration Manager. Open the SQL Server Configuration Manager (Local) > SQL Server Network Configuration menu and click the Protocols for MSSQLSERVERXXXX (where XXXX is the MSSQL version). Make sure that the TCP/IP protocol has the Enabled status: Double-click the TCP/IP protocol, go to the IP Addresses tab and scroll down to the IPAll section. Specify 1433 in the TCP Port field (or another port if 1433 is used by another MS SQL Server) and press the OK button:
Note: the specified port, e.g, 1433, must be opened in the firewall.
If you use Microsoft SQL Server Management Studio to connect to SQL server with custom port, you should use coma with port for connection address like 1.2.3.4,1433. Go to SQL Server Configuration Manager (Local) > SQL Server Services, right-click the SQL Server (MSSQLSERVER) service and press the Restart button to apply made changes: Log in to Plesk. Go to Tools & Settings > Database Servers > MSSQLSERVER > Settings and click OK to reset cached connection settings. Additional information
Unable to add remote Microsoft SQL Server to Plesk for Windows: A network-related or instance-specific error has occurred
Unable to manage databases using webadmin: it is greyed out"
4,"[BUG] Cannot disable Multi-Factor Authentication for a domain in Google Authenticator
Applicable to: Plesk for Linux Symptoms Multi-Factor Authentication is turned on for a domain. The customer is unable to validate authentication as mobile phone was lost. Now it is required to turn off Multi-Factor Authentication so that no phone device would be involved in the login at Google Authenticator. Under administrator account, Multi-Factor Authentication is turned off in Google Authenticator for the domain: Plesk > Google Authenticator > Enable Multi-Factor Authentication option is not checked. Cause
This is Plesk internal issue with ID #PPPM-4485, the fix is considered to be included in the future Plesk updates.
Resolution Connect to the server via SSH. If the root access is not possible, contact the server administrator to perform these actions. Create Plesk database backup and access it. Determine Plesk client ID for the domain:
MYSQL_LIN: SELECT cl_id FROM domains WHERE name=""example.com""; +-------+ | cl_id | +-------+ | 23 | +-------+
Replace example.com with the domain name in question. Using cl_id from previous query execute the following:
MYSQL_LIN: SELECT * FROM ModuleSettings WHERE name=""enabled-23""; +-----------+------------+-------+ | module_id | name | value | +-----------+------------+-------+ | 9 | enabled-23 | true | +-----------+------------+-------+ Verify if module_id belongs to Google Authenticator:
MYSQL_LIN: SELECT name FROM Modules WHERE id = 9; +----------------------+ | name | +----------------------+ | google-authenticator | +----------------------+ Remove record about Google Authenticator for the issued customer:
MYSQL_LIN: DELETE FROM ModuleSettings WHERE name=""enabled-23""; "
0,"How to manage file/directory permissions via Plesk File Manager Applicable to: Plesk for Linux
Plesk for Windows Question
How to change file/directory permissions via Plesk File Manager?
Answer In Plesk, go to Domains > example.com > File Manager. Click next to a file/folder and click Change Permissions.
Note: If a file/directory is owned by a non-subscription user (For example, the root or apache user), it will not be possible to modify permissions on this file/directory: the Change Permissions button will be unavailable. On the Change Permissions page, modify Read/Write/Execute permissions. When finished, apply the changes. For more information about reviewing and changing permissions, see: Plesk Documentations: Setting File and Directory Access Permissions
"
8,"When mailbox on Plesk server is full, email sent to the mailbox is rejected during SMTP secession without bounce message
Applicable to: Plesk 12.0 for Linux
Plesk Onyx for Linux Symptoms When mailbox on Plesk server is full, email sent to the mailbox is rejected during SMTP session without bounce message.
In /var/log/maillog, the following entries can be found:
CONFIG_TEXT: qmail-queue-handlers[15273]: Handlers Filter before-queue for qmail started ... qmail-queue-handlers[15273]: from=mail1@example.com qmail-queue-handlers[15273]: to=mail1@example.com qmail-queue-handlers[15273]: handlers_stderr: DATA Mailbox full#015 qmail-queue-handlers[15273]: handlers_stderr: DEFER qmail-queue-handlers[15273]: DEFER during call 'check-quota' handler Cause
By default, Plesk's mail service does not send bounce response when a user's mailbox is full to prevent mass spamming with bounce messages. Plesk ""check-quota"" mail handler is used for deferring incoming emails without bounce message.
Resolution
The feature described above can be disabled on Plesk server. Solution for Plesk Onyx Note: Disabling ""check-quota"" mail handler is strongly not recommended because server's IP may be blacklisted due to lot of bounce messages which can be considered as spam by other servers.
Note: if user runs ""plesk repair mail"" command line tool it will re-enable ""check-quota"" mail handler back. Connect to the server via SSH. Run the following commands to disable ""check-quota"" handler:
/usr/local/psa/admin/sbin/mail_handlers_control --disable --name=check-quota --type=global --queue=before-queue /usr/local/psa/admin/sbin/mail_handlers_control --disable --name=check-quota --type=global --queue=before-sendmail After disabling 'check-quota' handler bounce messages will be send each time when recipient's mailbox has no sufficient space to receive an email. Solution for Plesk 12.0 Note: Disabling ""check-quota"" mail handler is strongly not recommended because server's IP may be blacklisted due to lot of bounce messages which can be considered as spam by other servers. Connect to the server via SSH. Backup Plesk database: plesk db dump psa > /root/psa_dump.`date +%F.%s`.sql Run the following commands to disable ""check-quota"" handler:
# MYSQL_PWD=`cat /etc/psa/.psa.shadow` mysql -u admin psa -e ""REPLACE INTO misc VALUES ('reject_mail_when_overquota', 'false')""
For 64-bit OS run the command:
# /usr/lib64/plesk-9.0/mail_mailbox_restore --handlers-only
For 32-bit OS run the command:
# /usr/lib/plesk-9.0/mail_mailbox_restore --handlers-only To enable ""check-quota"" handler back, use following commands: # MYSQL_PWD=`cat /etc/psa/.psa.shadow` mysql -u admin psa -e ""REPLACE INTO misc VALUES ('reject_mail_when_overquota', 'true')""
For 64-bit OS run the command:
# /usr/lib64/plesk-9.0/mail_mailbox_restore --handlers-only
For 32-bit OS run the command:
# /usr/lib/plesk-9.0/mail_mailbox_restore --handlers-only "
8,"Plesk Horde or RoundCube webmail shows blank page
Applicable to: Plesk for Linux Symptoms Horde or RoundCube webmail displays a blank page; There the following record in /var/log/httpd/error_log file:
CONFIG_TEXT: mod_fcgid: stderr: PHP Warning: require_once(): open_basedir restriction in effect. File(/usr/share/psa-roundcube/program/include/iniset.php) is not within the allowed path(s): (\\xe2\\x80\\x9c\\xe2\\x80\\x9d/var/www/vhosts) in /usr/share/psa-roundcube/index.php on line 51 Cause
Wrong settings in /etc/psa-webmail/horde/horde/php.ini or /etc/psa-webmail/roundcube/php.ini that do not allow webmail to run it's scripts. Resolution Log in the server via SSH.
Note: if direct SSH access to the server is not possible, contact server administrator for further assistance. Remove or comment out open_basedir = on in /etc/psa-webmail/horde/horde/php.ini or /etc/psa-webmail/roundcube/php.ini file.
"
0,"How to set limit of maximum file uploads max_file_uploads parameter for particular subscription?
Applicable to: Plesk Onyx for Linux
Plesk Onyx for Windows Question
How to set limit of maximum file uploads max_file_uploads parameter for particular subscription?
Answer
Go to Plesk > Domains > example.com > PHP Settings and specify max_file_uploads parameter in Additional directives field: Additional information:
How to customize PHP settings in Plesk"
9,"How disk usage is calculated by Plesk Applicable to: Plesk for Linux
Plesk for Windows Question
How disk usage is calculated by Plesk?
Answer Disk usage in Plesk Note: Disk usage displayed in Plesk is updated once a day during the Plesk daily maintenance task. The disk usage is displayed on the domains Statistics page:
Web Admin license edition: Plesk > Statistics Web Pro and Web Host license editions: Plesk > Subscriptions > example.com > View More Statistics (Under Hosting) These values are stored in the Plesk database in bytes (in binary). Find the subscription id:
# plesk db ""select id,name from domains where name='example.com'""+----+-------------+| id | name |+----+-------------+| 3 | example.com |+----+-------------+ Find its overall disk usage:
# plesk db ""SELECT SUM(real_size) FROM domains d WHERE d.id=3""+----------------+| SUM(real_size) |+----------------+| 59314176 |+----------------+ Overall disk usage is divided into four groups of services: Web (httpdocs, subdomains, web_users and all other data, not included in Mail, Databases, Other)
Mail (mailboxes, maillists)
Databases (dbases)
Other (anonftp, logs, domaindumps, configs, chroot) To find out what is included in the disk usage calculation of a subscription, in Plesk go to Tools & Settings > Server Settings: Information about the size of these four services is stored in the ""disk_usage"" table of the psa database. Run the following command to get them:
# plesk db ""SELECT SUM(httpdocs) + SUM(httpsdocs) + SUM(subdomains) + SUM(web_users) AS Web, 0 + SUM(mailboxes) + SUM(maillists) AS Mail, 0 + SUM(dbases) AS 'Databases', SUM(anonftp) + SUM(logs) + SUM(domaindumps) + SUM(configs) + SUM(chroot) AS Other FROM disk_usage AS disk_usage INNER JOIN domains AS domains ON domains.id = disk_usage.dom_id WHERE dom_id=3;""+--------+--------+-----------+--------+| Web | Mail | Databases | Other |+--------+--------+-----------+--------+| 856064 | 143360 | 58150912 | 163840 |+--------+--------+-----------+--------+ Disk usage on the file system
Disk usage of each subscription service can be calculated manually. To learn more about disk usage on the file system, visit Plesk Documentation: About Disk Space Usage Calculation."
0,"How to rerun daily maintenance tasks separately for Plesk on Linux?
Applicable to: Plesk for Linux Information
Since Plesk 11, Daily Maintenance Task has options that allow executing separate maintenance tasks.
This provides an easy way to debug different issues because it is not needed to rerun complete Daily Maintenance Task and wait when it will be finished.
Here is a help message:
# /usr/local/psa/bin/sw-engine-pleskrun /usr/local/psa/admin/plib/DailyMaintainance/script.php -h Usage: script.php [period|option] Period can be one of the following: daily weekly monthly Option can be one of the following: -h usage screen -l list available daily, weekly and monthly tasks -f <name> execute only one task with name <name>
List of all daily, weekly and monthly available tasks for Plesk Onyx (options which were added in Plesk Onyx are marked with ' * '):
# /usr/local/psa/bin/sw-engine-pleskrun /usr/local/psa/admin/plib/DailyMaintainance/script.php -l CheckForUpdates InstallUpdates InstallSystemPackageUpdates* UpdateKeys PleskUsage Sitebuilder MailUsage ExecuteStatistics ProcessAutoreports (daily and weekly) OptimizeStatistics AnalyseDomainStatistics AnalyseClientStatistics ExecuteSpamtrain LoadCustomizations UpdateApsCache UpdateApsApplications ExecuteGlCleaner StoreProtectedConfigs FileSharing UpgradePanel ExecuteWebStatistics UpdateModSecurityRuleSet (daily and weekly) AutoresponderEndDate UpdatePhpCurlCertificates ExecuteQuotacheck (weekly) BackupRestoreStats UpgradeExtensions ComposerSelfUpdate
List of all daily, weekly and monthly available tasks for Plesk 12.5 (options which were added in Plesk 12.5 are marked with ' * '):
# /usr/local/psa/bin/sw-engine-pleskrun /usr/local/psa/admin/plib/DailyMaintainance/script.php -l CheckForUpdates InstallUpdates UpdateKeys PleskUsage Sitebuilder MailUsage ExecuteStatistics ProcessAutoreports OptimizeStatistics AnalyseDomainStatistics AnalyseClientStatistics ExecuteSpamtrain LoadCustomizations UpdateApsCache UpdateApsApplications ExecuteGlCleaner StoreProtectedConfigs Filesharing UpgradePanel ExecuteWebStatistics UpdateModSecurityRuleSet AutoresponderEndDate* UpdatePhpCurlCertificates* ExecuteQuotacheck BackupRestoreStats UpgradeExtensions* ComposerSelfUpdate*
List of available tasks for Plesk 11.5 and Plesk 12.0:
# /usr/local/psa/bin/sw-engine-pleskrun /usr/local/psa/admin/plib/DailyMaintainance/script.php -l CheckForUpdates InstallUpdates UpdateKeys PleskUsage Sitebuilder MailUsage ExecuteStatistics ProcessAutoreports OptimizeStatistics AnalyseDomainStatistics AnalyseClientStatistics ExecuteSpamtrain LoadCustomizations UpdateApsCache UpdateApsApplications ExecuteGlCleaner StoreProtectedConfigs Filesharing UpgradePanel ExecuteWebStatistics UpdateModSecurityRuleSet ExecuteQuotacheck BackupRestoreStats
For example, to execute only Web Statistics:
# /usr/local/psa/bin/sw-engine-pleskrun /usr/local/psa/admin/plib/DailyMaintainance/script.php -f ExecuteWebStatistics
Additional information
How to rerun daily maintenance tasks separately for Plesk on Windows?"
5,"Migration/backup/restore/import/export of a Microsoft SQL database fails with error message: ""Operating system error 5(Access is denied.). terminating abnormally."" Applicable to: Plesk for Windows Symptoms
Migration/backup/restore/import/export of a Microsoft SQL database fails with one of the following error messages:
PLESK_ERROR: Cannot open backup device 'C:\\Program Files\\Parallels\\Plesk\\PrivateTemp\Temp47385.tmp'. Operating system error 5(failed to retrieve text for this error. Reason: 15105). BACKUP DATABASE is terminating abnormally.
PLESK_ERROR: Unable to backup database content. Database db_example. Db server .\MSSQL2016: Cannot open backup device 'C:\Windows\TEMP\tmp78C9.tmp'. Operating system error 5(Access is denied.). BACKUP DATABASE is terminating abnormally.
PLESK_ERROR: Cannot open backup device 'C:\Program Files (x86)\Parallels\Plesk\var\modules\panel-migrator\sessions\20180910022943\target-server\mssql-dumps\db_backup_example.com_db_example'. Operating system error 5(Access is denied.). VERIFY DATABASE is terminating abnormally.
Cause
Insufficient permissions for the user used by Microsoft SQL instance on a folder from the error message.
Resolution Connect to a Plesk server via RDP. Find the current Microsoft SQL system user:
2.1. Start a command prompt as an administrator and run the following command to launch Windows Services:
C:\> services.msc
2.2. In Windows Services, double-click on SQL Server to open its Properties.
2.3. In the SQL Server Properties window, switch to the Log On tab and copy the full name of the account:
Note: The MSSQL user has to be ""NT Service\MSSQL$MSSQLSERVERXXXX"" where XXXX is the MSSQL version Now grant the MS SQL user with a full control to the folder from the error message: %plesk_dir%var\modules\panel-migrator\sessions\<time_stamp> %plesk_dir%PrivateTemp C:\Windows\TEMP In the example below, we are granting the MSSQL user with a full control to the folder %plesk_dir%var\modules\panel-migrator\sessions\20180910022943 from the error message.
3.1. Right-click on the folder %plesk_dir%var\modules\panel-migrator\sessions\20180910022943 to open its Properties.
3.2. In the Properties window, switch to the Security tab and click Edit....
3.3. On the Permissions window, click Add....
3.4. In the opened window, past Microsoft SQL user name from step to and click Check Names. Click OK. 3.5. On the Permissions window, select the added user and allow him full control. Click OK to apply the changes. "
7,"Plesk update or upgrade fails: Upgrade data of MySQL Server, Access denied for user 'psa_root'@'localhost'
Applicable to: Plesk for Windows Symptoms Plesk upgrade fails with one of the following errors:
CONFIG_TEXT: MSI: Error! Critical action 'Upgrade data of MySQL Server...' failed: Command ""C:\Program Files (x86)\Parallels\Plesk\admin\bin\mysqlmng_adm.exe"" --up grade-server-data ""--initial-ver=5.5"" ""--target-ver=5.5.52"" failed with code 1. Output: Stop service... Removing InnoDB log files... Start service... Upgrading all databases... Execute C:\Program Files (x86)\Parallels\Plesk\MySQL\bin\mysql_upgrade.exe --for ce ""--host=127.0.0.1"" ""--port=8306"" ""--user=psa_root"" ""--password=*"" failed[1]: Looking for 'mysql.exe' as: C:\Program Files (x86)\Parallels\Plesk\MySQL\bin\mys ql.exe Looking for 'mysqlcheck.exe' as: C:\Program Files (x86)\Parallels\Plesk\MySQL\bi n\mysqlcheck.exe Error: Failed while fetching Server version! Could be due to unauthorized access.
Or:
CONFIG_TEXT: FATAL ERROR: Upgrade failed at (execExtUtilChecked line 137) at execute console command --upgrade-server-data(vconsoleapp::start line 122) \ at execute ""C:\Program Files (x86)\Parallels\Plesk\admin\bin\mysqlmng_adm.exe "" --upgrade-server-data ""--initial-ver=5.5"" ""--target-ver=5.5.52""(vconsoleapp::r un line 139) at (CmdAction::Commit line 412) at Execute action Upgrade data of MySQL Server...(executeList line 290) Failed to install 'C:\ParallelsInstaller\parallels\PANEL-WIN_17.0.17\dist-msi-Mi crosoft-2003-i386\mysql-admin.msi': Fatal error during installation. (Error code 1603)
Or:
CONFIG_TEXT: ERROR: The installation of the package 'mysql' failed with code 1603. (upgrade: Upgrading Plesk SQL server...) Not all packages were installed. Please contact product technical support. exit status 1
Or:
CONFIG_TEXT: Execute C:\\Program Files (x86)\\Parallels\\Plesk\\MySQL\\bin\\mysql_upgrade.exe --force --host=127.0.0.1 --port=8306 --user=psa_root --password=************ failed[1]: Looking for 'mysql.exe' as: C:\\Program Files (x86)\\Parallels\\Plesk\\MySQL\\bin\\mysql.exe Looking for 'mysqlcheck.exe' as: C:\\Program Files (x86)\\Parallels\\Plesk\\MySQL\\bin\\mysqlcheck.exe FATAL ERROR: Upgrade failed
OR
CONFIG_TEXT: MSI: Error! Critical action 'Upgrade data of MySQL Server...' failed: Command ""C:\\Program Files (x86)\\Parallels\\Plesk\\admin\\bin\\mysqlmng_adm.exe"" --up grade-server-data --initial-ver=5.5 --target-ver=5.5.41 failed with code 1. Output: Stop service... Removing InnoDB log files... Start service... Upgrading all databases... Can't decrypt data Failed to install 'C:\\ParallelsInstaller\\parallels\\PANEL-WIN_12.0.18\\dist-msi-Mi crosoft-2003-i386\\mysql-admin.msi': Fatal error during installation. (Error code 1603) ERROR: The installation of the package 'mysql' failed with code 1603. (upgrade: upgrading Parallels Panel SQL server...)
Or:
CONFIG_TEXT: MSI: Error! Critical action 'Upgrade data of MySQL Server...' failed: Command ""C:\Program Files (x86)\Parallels\Plesk\admin\bin\mysqlmng_adm.exe"" --up grade-server-data --initial-ver=5.7 --target-ver=5.7.26 failed with code 1. Output: Stop service... Removing InnoDB log files... Start service... Upgrading all databases... Execute C:\Program Files (x86)\Plesk\MySQL\bin\mysql_upgrade.exe --force ""--host=127.0.0.1"" ""--port=8306"" ""--user=psa_root"" ""--password=*"" failed[11]: mysql_upgrade: [Warning] Using a password on the command line interface can be insecure. mysql_upgrade: Got error: 1045: Access denied for user 'psa_root'@'localhost' (using password: YES) while connecting to the MySQL server Upgrade process encountered error and will not continue. at (execExtUtilChecked line 138) at execute console command --upgrade-server-data(vconsoleapp::start line 93) at execute ""C:\Program Files (x86)\Plesk\admin\bin\mysqlmng_adm"" --upgrade-server-data ""--initial-ver=5.7"" ""--target-ver=5.7.26""(vconsoleapp::run line 110)exit status 1 Plesk interface is not accessible with Error 500. Cause
The password for the MySQL user 'psa_root' is incorrect.
Resolution Connect to the Plesk server via RDP Create a backup of the Plesk system database:
C:\> ""%plesk_dir%\Mysql\bin\mysqldump.exe"" -uadmin -p -P8306 psa > C:\psa_backup.sql Generate a password for the MySQL user psa_root:
C:\> ""%plesk_bin%\mysqlmng_adm.exe"" --inject-root Rerun the Plesk update (or upgrade). If the steps above did not help, perform the following actions: Create a new password for the MySQL user psa_root:
C:\> ""%plesk_bin%\mysqlmng_adm.exe"" --inject-root --password=""<your_password_here>"" Run the mysql_upgrade utility:
C:\> ""%plesk_dir%MySQL\bin\mysql_upgrade.exe"" --force ""host=127.0.0.1"" ""port=8306"" ""user=psa_root"" ""password=<your_password_here>"" Rerun the Plesk update (or upgrade). "
2,"How to download a folder via Plesk File Manager Applicable to: Plesk for Linux
Plesk for Windows Question
How to download a folder via Plesk File Manager?
Answer Open the File Manager at Domains > example.com > File Manager. Select the folder (or several folders, if needed) using the checkbox and click Add to Archive. In the opened window, give your archive a name and press OK. The archive (.zip file) will be created in the same directory. Click on the button next to the created .zip file, then click Download. The file will be downloaded to your PC. Once downloaded, extract the .zip file to access your folder.
"
0,"How to find the Plesk version? Applicable to: Plesk for Linux
Plesk for Windows Question
How to find the Plesk version?
Answer Log into Plesk. For Service Provider view:Go to Home > System Overview: For Power User view:Go to Websites & Domains > System Overview tab: Note: If version/build is not visible, contact your hosting provider. Solution using the server access For Linux Log into the server via SSH.
Execute the command below:
# plesk version Product version: Plesk Onyx 17.8.11 Update #71 Update date: 2019/10/17 04:13 Build date: 2019/10/09 10:59 OS version: CentOS 7.6.1810 Revision: 710247408812d123e5ce26852ea1a0a9622cabfe Architecture: 64-bit Wrapper version: 1.2
Note: alternatively the Plesk version can be found in /usr/local/psa/version by executing the command:
# cat /usr/local/psa/version 17.8.11 CentOS 7 1708190409.21 For Windows Log into the server via RDP. Start the command prompt.
Execute the command:
C:\>plesk version Product version: Plesk Onyx 17.8.11 Update #71 Update date: 2019/10/18 02:15 Build date: 2019/10/09 11:03 Build target: Windows 2008/2012/2016 Revision: 710247408812d123e5ce26852ea1a0a9622cabfe Wrapper version: 1.2
Note: alternatively the Plesk version can be found in C:\Program Files (x86)\Plesk\version file. "
3,"High CPU load by IIS process on a server with Plesk Applicable to: Plesk for Windows Symptoms High load on the server. The operations hang or it takes too long to execute. Plesk sends email messages with the content like this:
CONFIG_TEXT: Server health parameter Services > IIS CPU usage changed its status from ""yellow"" to ""green"". Resolution
Identify the exact domain causing high CPU load Connect to the server through RDP Open Internet Information Services (IIS) Manager > server_name under ""IIS section"" click Worker Processes. Depending on the result, apply one of the following: If the issue is caused by PleskControlPanel application pool which is exclusively used by Plesk, Сontact Plesk Technical Support, as an additional investigation is required. If the issue is caused by application pool of a client's website, inspect website's code for resource consumption. Workaround
Limit CPU usage for application pool of the domain, following instructions from the KB article:
How to monitor and manage CPU usage for domains in Plesk for Windows"
3,"After dist-upgrade 403 Forbidden is shown on all websites: No matching DirectoryIndex (none) found
Applicable to: Plesk 12.5 for Linux
Plesk Onyx for Linux Symptoms After a dist-upgrade, all the websites are showing 403 Forbidden error or the Apache test page. The following errors can be found in the Apache error log file /var/log/apache2/error.log:
CONFIG_TEXT: Cannot serve directory /var/www/vhosts/default/htdocs/: No matching DirectoryIndex (none) found, and server-generated directory index forbidden by Options directive Going to Tools & Settings > Apache Web Server > The dir module is not enabled Cause
Apache misconfiguration.
Resolution Log in to Plesk GUI Enable the dir Apache module going to Tools & Settings > Apache Web Server > Select dir module > Click OK to apply changes Note: ""IncludeOptional mods-enabled/*.conf"" should be included to the /etc/apache2/apache2.conf:
# grep ""IncludeOptional mods-enabled/\*\.conf"" /etc/apache2/apache2.conf IncludeOptional mods-enabled/*.conf"
8,"How to specify default Return-Path for PHP mail scripts in Plesk
Applicable to: Plesk for Linux
Plesk for Windows Question
Default Return-Path for PHP mail script is taken as server administrator mail address.
How to specify exact default Return-Path for PHP mail scripts in Plesk?
Answer
As of now, the functionality of changing this setting via Plesk UI is not implemented.
As a workaround, according to PHP documentation, it is possible to re-define the values on a PHP level:
CONFIG_TEXT: Which ""From:"" mail address should be used in mail sent from PHP under Windows. This directive also sets the ""Return-Path:"" header.
This setting can be re-defined by adjusting corresponding php.ini file. For example: Log into Plesk. Go to Tools & Settings > PHP Settings > PHP 7.0 > php.ini and change sendmail_from to required mailbox:
PLESK_INFO: sendmail_from = john.doe@example.com To re-define Return-Path parameter for a particular domain, specify it in custom PHP settings for the domain at Domains > example.com > Websites & Domains > PHP Settings > Additional directives. Authentication-results parameter can be set by including in php.ini (for Linux, the default ""From"" field can be overridden for the outgoing emails):
CONFIG_TEXT: sendmail_path = ""/usr/sbin/sendmail -t -i -f john.doe@example.com"""
0,"How to make website accessible on www or non-www in Plesk
Applicable to: Plesk for Linux
Plesk for Windows Question
How to configure a redirect to www and vice-versa for a website on Plesk?
Answer
Note: This option may not work for WordPress based websites and any other websites that have a predefined configuration to use www or non-www in their code. Configure such websites through their administration panel or in configs. Make sure that there are no custom rules in Domains > example.com > Apache & Nginx Settings or in .htaccess files on Linux or web.config on Windows. Log in to Plesk. Go to Domains > example.com > Hosting Settings. Set Preferred domain parameter to www.example.com: "
8,"How to change the location for mailboxes in Plesk for Windows Server Applicable to: Plesk for Windows Question
How to change the location for mailboxes in Plesk for Windows Server?
Answer Connect to a Plesk server via RDP. Launch Plesk Reconfigurator at Windows Start > All Programs > Plesk. In Plesk Reconfigurator, select Change Plesk Mail Data location. Specify a new location for Plesk mail data and click Next. All existing mail data will be transferred to the new location as well.
Note: During this operation mail services and Plesk will be stopped. Related Articles How to change the location for backup files in Plesk for Windows Server
How to change the location for virtual hosts in Plesk for Windows Server
"
0,"How to register additional or external webmail services in Plesk?
Applicable to: Plesk for Linux
Plesk for Windows Question
How to register additional or external webmail service in Plesk?
Answer
By default, Horde and RoundCube webmails are installed on Plesk for Linux, and only Horde is installed on Plesk for Windows. Additionally, Plesk for Windows supports the following webmail clients: MailEnable Web Client
SmarterMail Web Client
IceWarp (Merak) Mail Server Web Client Atmail Open is supported by both Plesk for Linux and Plesk for Windows, versions until 11.5.
Note: Only administrator can add additional webmail. If you are a domain owner, please contact your service provider for assistance.
To register an external webmail service: Log into Plesk;
Go to Tools & Settings > Webmail and click Register Webmail: Specify the Webmail service name and Webmail service URL. Specify an address that begins with the http:// or https:// prefix. Leave the Available checkbox selected to make the registered webmail service available for selection in hosting plan settings. For additional details, visit Plesk Administrator Guide ."
2,"Plesk is not available: Logon failure: the user has not been granted the requested logon type at this computer or Error 503. The service is unavailable
Applicable to: Plesk for Windows Symptoms When loading the Plesk URL - https://203.0.113.2:8443/, the following error message is displayed:
PLESK_ERROR: ERROR: ExceptionUnable to logon user (VPS-2222\Plesk Administrator): (1385) Logon failure: the user has not been granted the requested logon type at this computer.0: common_func.php3:4147 plesk_internal_file_exists(string 'C:\Parallels\Plesk/admin/plib/locales/en-US/messages_en-US.php')1: common_func.php3:4147 plesk_file_exists(string 'C:\Parallels\Plesk/admin/plib/locales/en-US/messages_en-US.php')2: LocaleManager.php:94 LocaleManager::_locale_file_exists(string 'C:\Parallels\Plesk/admin/plib/locales/en-US/messages_en-US.php')3: LocaleManager.php:87 LocaleManager::locale_exists(string 'en-US')4: common_func.php3:2026 locale_exists(string 'en-US')5: class.Session.php:177 Session->Session()6: auth.php3:206 Plesk is not accessible with the following error:
CONFIG_TEXT: HTTP Error 503. The service is unavailable. PleskControlPanel application pool permanently goes down with the following errors in Event Viewer:
CONFIG_TEXT: Application pool PleskControlPanel has been disabled. Windows Process Activation Service (WAS) did not create a worker process to serve the application pool because the application pool identity is invalid. CONFIG_TEXT: The identity of application pool PleskControlPanel is invalid. The user name or password that is specified for the identity may be incorrect, or the user may not have batch logon rights. If the identity is not corrected, the application pool will be disabled when the application pool receives its first request. If batch logon rights are causing the problem, the identity in the IIS configuration store must be changed after rights have been granted before Windows Process Activation Service (WAS) can retry the logon. If the identity remains invalid after the first request for the application pool is processed, the application pool will be disabled. The data field contains the error number. Security Audit event with ID 4625 has contents like:
CONFIG_TEXT: An account failed to log on.Subject: Security ID: SYSTEM Account Name: SOMENAME$ Account Domain: SOMEGRP Logon ID: 0x3E7Logon Type: 4 Account For Which Logon Failed: Security ID: NULL SID Account Name: psaadm Account Domain: SOMEGRP Failure Information: Failure Reason: The user has not been granted the requested logon type at this machine. Cause
The issue is caused by incorrect local policies configuration on Plesk container.
Resolution Connect to the server using RDP. Make sure that ""Plesk Administrator"" user belongs to ""Administrators"" group: Hit Win + r on the keyboard, type compmgmt.msc in the Run window, and then press ""ENTER"".
Go to Local Users and Groups > Users > right click on Plesk Administrator > Properties > Member Of. If ""Plesk Administrator"" doesn't belong to ""Administrators"" group, add it using Add... button and type ""Administrators"". Switch to the tab General and disable the options Account is disabled and Account is locked out if they are enabled. Open Properties for psaadm user and disable the options Account is disabled and Account is locked out if they are enabled. Make sure that ""Administrators"" group is added to ""Log on as a batch job"": Hit Win + r on the keyboard, type gpedit.msc in the ""Run"" box, and then press ""ENTER"".
Go to Local Group Policy Editor > Computer Configuration > Windows Settings > Security Settings > Local Policies > User Rights Assignment > Log on as a batch job . Make sure that ""Administrators"" group is added, add it if it is required. Ensure that ""Everyone"", ""Plesk administrator"", ""Administrators"" groups, psaadm user are not listed in Local Group Policy Editor > Computer Configuration > Windows Settings > Security Settings > Local Policies > User Rights Assignment > Deny log on as a batch job . If the above steps did not help add ""psaadm"" and ""Plesk Administrator"" users to ""Log on as a batch job"" on step 2 and add ""psaadm"" user to ""Log on as a service"".
If all the above actions did not help run Plesk Reconfigurator in Windows > Repair Plesk Installation."
2,"[BUG] After successful MySQL upgrade, the old version of database server is shown in Plesk interface Applicable to: Plesk for Linux Symptoms MySQL/MariaDB database server has been successfully upgraded. For example, from 5.5 to 10.2:
# mysql --version mysql Ver 15.1 Distrib 10.2.25-MariaDB, for Linux (x86_64) using readline 5.1 The old version of database server still shown in Plesk: Cause
This is Plesk bug with ID PPP-45961, which is planned to be fixed in one of the future product updates. Resolution Login into Plesk;
Click on localhost in Tools & Settings > Database Servers: On the appeared screen click OK: Database server version will be updated according the actual version installed on the server: "
7,"Unable to update Plesk: Error: Failed to read product information from the file: Can't process products.inf3
Applicable to: Plesk 12.0 for Linux
Plesk 12.5 for Linux Symptoms Plesk Installer hangs on the products.inf3 file downloading:
CONFIG_TEXT: Checking for installed packages... File downloading products.inf3: Plesk Installer fails with the next error:
CONFIG_TEXT: File downloading products.inf3: File downloading versions.inf3: ERROR: Failed to read product information from the file : Can't process products.inf3: Failed to download the package http://example.com/parallels/products.inf3: The requested URL returned error: 404 Can't process versions.inf3: Failed to download the package http://example.com/parallels/versions.inf3: The requested URL returned error: 404 Automatic Plesk updates installation fails with the next error in the /var/log/plesk/install/autoinstaller3.log file:
CONFIG_TEXT: FileFetcher new object: target_dir=/root/parallels/, main_source_url=ftp://example.com/parallels/ FileFetcher: get file (~empty)/products.inf3 File downloading products.inf3: Error: server response timeout, retry... Error: server response timeout, retry... Error: server response timeout, retry... FileFetcher: get file (~empty)/versions.inf3 File downloading versions.inf3: Error: server response timeout, retry... Error: server response timeout, retry... Error: server response timeout, retry... Error: Failed to read product information from the file : Can't process products.inf3: Failed to download the package ftp://example.com/parallels/products.inf3: server response timeout A custom mirror repository is configured in the /root/.autoinstallerrc file:
CONFIG_TEXT: SOURCE_TYPE=""network"" SOURCE=""http://example.com/parallels/""
OR
CONFIG_TEXT: SOURCE_TYPE=""network"" SOURCE=""ftp://example.com/parallels/"" Cause
The custom repository is unreachable and/or incorrectly configured.
Resolution Connect to the server via SSH. Verify the URL of the repository in the /root/.autoinstallerrc file regarding the typos and edit it if it is required:
CONFIG_TEXT: [BEFORE] SOURCE_TYPE=""network"" SOURCE=""ftp://example.com/parallels/"" [AFTER] SOURCE_TYPE=""network"" SOURCE=""http://example.com/parallels/"" If the repository is still unreachable, then remove it:
# mv /root/.autoinstallerrc /root/.autoinstallerrc.bak
in order to continue using the default Plesk repository. "
8,"[BUG] Users are not able to log into mailboxes: Invalid or unsupported Unicode character or escape sequence found in string
Applicable to: Plesk for Linux Symptoms Users are not able to log into mailboxes and the following records can be found in the file /var/log/maillog: CONFIG_TEXT: plesk courier-imaps: LOGIN FAILED, user=john.doe@example.com, ip=[::ffff:203.0.113.2] CONFIG_TEXT: dovecot_authdb_plesk[9898]: No such user 'john.doe@example.com' in mail authorization database A domain does not exist in the output of the command /usr/local/psa/admin/sbin/mail_auth_view (or the output is empty at all without grep): # /usr/local/psa/admin/sbin/mail_auth_view | grep example.com# (empty output) Manual execution of the utility mail_auth_dump ( /usr/lib64/plesk-9.0/remote_mail_restore/mail_auth_dump on RHEL-based operating systems, /usr/lib/plesk-9.0/remote_mail_restore/mail_auth_dump on Debian and Ubuntu) with the Plesk debug logging enabled fails with the following error:
# /usr/lib/plesk-9.0/remote_mail_restore/mail_auth_dump .......... DEBUG [util_exec] [07d041579abfc778c97734f8eb0d4318-0] Finished in 0.0293s, Error code: 1, stdout: , stderr: /opt/psa/admin/bin/mail_auth_dump.worker[18105]: Input parse error: Invalid or unsupported Unicode character or escape sequence found in string. UTF8 encoded characters and '\u' escape sequences are not supported. Error occured at offset 51062, character '\'. ERR [util_exec] proc_close() failed ['/opt/psa/admin/bin/mail_auth_dump.worker' '--start' '--finish'] with exit code [1] Cause
The password of one of the mail accounts contains unsupported symbols like ä, ö, ü, symbols like ""♥"", or random sequences with leading ""\u"".
This repair tool behavior is confirmed as Plesk bug with ID PPPM-10902, which is planned to be fixed in future Plesk updates.
Resolution Enable Plesk debug logging (without enabling show.sql_query ). Connect to the server using SSH . Execute the utility mail_auth_dump ( /usr/lib64/plesk-9.0/remote_mail_restore/mail_auth_dump on RHEL-based operating systems, /usr/lib/plesk-9.0/remote_mail_restore/mail_auth_dump on Debian and Ubuntu) and in the output find the passwords with \u sequence. In Plesk interface, change the password for the found mail accounts. Execute the command /usr/local/psa/admin/sbin/mchk --with-spam . "
8,"How to activate/deactivate the mail service for a domain/subscription/server-wide
Applicable to: Plesk Onyx for Linux
Plesk Onyx for Windows Question
How to enable/disable the mail service for a domain?
Answer
To manage the mail service and the email accounts in Plesk, it is required to install a local mail server.
It can be verified which mail server is installed going to Tools & Settings > Mail Server Settings. If it is not yet installed, apply the steps from these KB articles: How to install/change a local mail server in Plesk for Linux
How to install/change a local mail server in Plesk for Windows Managing mail service via Plesk For a domain
Note: If previously the mail service has been disabled by a Plesk administrator, a Plesk customer will not be able to enable the mail service back. Go to Domains > example.com > Mail Settings. Enable/disable the option Activate mail service on this domain. Apply the changes. For a subscription Go to Subscriptions > example.com > Mail tab > Mail Setting tab. Select required domains using a checkbox and click Activate/Deactivate Services. In the pop-up window, select a required action in the drop-down menu and click OK. For all subscriptions under a service plan
Note: New settings will not be applied to existing subscriptions, if: - A subscriptions is locked from syncing with its service plan. - The Ability to change mail settings permission is enabled in service plan permissions settings (Service Plans > Example Plan > Permissions tab > Click Show more available permissions to reveal). Go to to Service Plans > Plan Name > Mail tab. Enable/disable the option Switch on the mail service. Click Update & Sync. Server-wide
Note: This option does not actually switch off the Plesk-managed mail server, but only removes some UI elements from the Customer Panel. These elements will be hidden from hosting service customers and their users. The following items are removed: - The Mail section. - Users section > user_name > Change Settings > Create an email address under your account option. To disable the mail service for all domains, see the command-line instructions. Go to Tools & Settings > Mail Server Settings. Enable/disable the option Enable mail management functions in Plesk. and click OK. Managing mail service via a command-line interface For a domain
# plesk bin subscription -u example.com -mail_service <option>
where <option> can be one of the following: true - enable the mail service for a domain false - disable the mail service for a domain For all subscriptions under a service plan
Note: Subscriptions will not be synced, if: - A subscriptions is locked from syncing with its service plan. - The Ability to change mail settings permission is enabled at Service Plans > Example Plan > Permissions tab (Click Show more available permissions to reveal).
# plesk bin service_plan -u ""Default Domain"" -mail <option>
where <option> can be one of the following: true - enable the mail service for a service plan false - disable the mail service for a service plan Server-wide For Linux
Run the command below to disable the mail service for all domains:
# for i in $(plesk bin site -l); do plesk bin site -u $i -mail_service <option>; done
where <option> can be one of the following: true - enable the mail service for all domains false - disable the mail service for all domains For Windows Server Start Windows PowerShell as an Administrator. Run the command below to disable the mail service for all domains:
PS &plesk bin site -l | % { if ($_) { plesk bin site -u $_ -mail_service <option> } }
where <option> can be one of the following: true - enable the mail service for all domains false - disable the mail service for all domains Additional Information
When the mail service is switched off on a domain: It will not be possible to send/receive emails Webmail (webmail.example.com) will stop work for a domain It will not be possible to log in to the mail account using email clients (Microsoft Outlook, Mozilla Thunderbird, etc.) On Plesk for Linux, to check the current status of the mail service on a domain, run the command:
# plesk bin subscription -i example.com | grep -i 'mail service' Mail service: On Related Articles How to set limitations on outgoing email messages in Plesk
"
8,"How to manage spam filter settings for multiple email accounts in Plesk for Linux? Applicable to: Plesk for Linux Question
How to set spam filter settings for bunch of email accounts avoiding configuration of Spamassassin on server level in Plesk for Linux?
Answer
Plesk GUI and spamasassin utility do not support multiple mail accounts management at once. Instead, the following command should be used to update multiple mailboxes simultaneously:
# plesk db -Ne""SELECT CONCAT(mail_name,'@',name) FROM mail,domains WHERE dom_id=domains.id AND postbox='true';""| while read i;do /usr/local/psa/bin/spamassassin -u $i -status true -action del -hits 5;done
This command will enable Spamassassin on all mailboxes (if disabled), set 5 hits required for marking a message as spam, set spam messages to be deleted
Or if such messages detected as spam should be moved to spam folder, then this can be used:
# plesk db -Ne""SELECT CONCAT(mail_name,'@',name) FROM mail,domains WHERE dom_id=domains.id AND name='example.com' AND postbox='true';""| while read i;do /usr/local/psa/bin/spamassassin -u $i -status true -action move -hits 7;done
In case it's needed to disable SpamAssassin on mailboxes from a specific domain:
# plesk db -Ne""SELECT CONCAT(mail_name,'@',name) FROM mail,domains WHERE dom_id=domains.id AND name='example.com' AND postbox='true';""| while read i;do /usr/local/psa/bin/spamassassin -u $i -status false;done
Additional information
For details about spam settings management via Plesk CLI, visit: 213412289 [How to] Manage spam settings in Plesk via CLI?"
8,"Unable to set Smartermail as default mail server: Unable to assign port to IP address
Applicable to:
Plesk Onyx for Windows Symptoms
Unable to set SmarterMail as default mail server due to an error:
CONFIG_TEXT: Error: Unable to set SmarterMail Server 203.0.113.2 as the default Mail Server: defpackagemng failed: Unable to assign port to IP address.Reason:Unknown IP Address: (Error code 1)
OR
CONFIG_TEXT: Error: Unable to set SmarterMail Server as the default Mail Server: defpackagemng failed: AssignPortToIP(203.0.113.2) failed: Error code -2. Error message: Unknown IP Address:at (SMSvcUtil::checkActionResult line 66)
Cause
MailEnable was not properly stopped.
Resolution
It is required to stop MailEnable completely in order to activate SmarterMail. For that: Log into the server via RDP.
Open Plesk Services Monitor from tray and stop all services of MailEnable.
Try enabling SmarterMail once again.
If the step above did not help, do the following: Open registry by typing regedit in the CMD.
Change HKLM > Software > Wow6432Node > Plesk > PSA Config > Config > MAIL_PROVIDER_DLL parameter with path to Plesk smartermailprovider.dll library, for example C:\Program Files (x86)\Parallels\Plesk\admin\bin\smartermailprovider.dll In HKLM > Software > Wow6432Node > Plesk > PSA Config > Config > Packages > Mailserver set Default to smartermail In Tools & Settings > Server Components click Refresh button Try adding Enabling SmarterMail once again.
"
5,"Backup manager shows 0 size for backups after changing the backup location on a Linux server
Applicable to:
Plesk for Linux Symptoms
After changing the backup location, Plesk backups have 0 size in the Plesk Backup Manager while backups have a proper physical size on the server.
Cause
Plesk stores backup size information in the /BACKUP_D/.discovered/*/props files, that are missing on the server.
The backups are still valid.
Resolution
There is now way to restore the size of these backups.
If the previous backup location still exist, move the props files to the new backup location:
# mv /var/lib/psa/dumps/.discovered/ /new/backup/location"
9,"Website on a Plesk cannot be resolved to the server with enabled DNS
Applicable to: Plesk 12.0 for Linux
Plesk 12.5 for Linux
Plesk Onyx for Linux
Plesk for Windows Symptoms A website is unavailable with the following error:
CONFIG_TEXT: This site can’t be reached ERR_NAME_NOT_RESOLVED DNS service is enabled in Tools & Settings > Services Management. Website does not resolve externally:
# dig +short example.com Locally website example.com is resolving correctly:
# dig +short example.com @localhost 203.0.113.2 External resolution works fine for TCP connections:
# dig +short +tcp example.com 203.0.113.2 Traceroute shows that the connection on 53 gets interrupted on UDP:
# traceroute -U -p 53 203.0.113.2 ... 8 thirdparty.com 173.124 ms 172.388 ms 169.308 ms 9 * * * 10 * * * DNS TCP or UDP port is filtered:
# nmap -p53 203.0.113.2 PORT STATE SERVICE 53/tcp filtered domain
# nmap -sU -p53 203.0.113.2 PORT STATE SERVICE 53/udp open|filtered domain Incoming emails don't work Cause
The UDP or TCP port 53 is filtered by firewall for incoming or/and outgoing connections.
Resolution
Allow inbound and outbound connections throw 53 port in the server Firewall:
Warning: In case if connections to the port 53 are filtered by an intermediate firewall, contact network administrator or Internet Service Provider (ISP) for assistance. Configuring Firewall rules in case Plesk firewall is used In case Plesk firewall is used: Log into Plesk. Open port 53 by creating a custom rule in Tools & Settings > Firewall > Modify Plesk Firewall Rules > Add Custom Rule: Apply firewall changes: Configuring Firewall rules via SSH (For Linux only) Connect to the server via SSH. Open 53 UDP and TCP ports for incoming and outgoing connections on the server firewall:
# iptables -I INPUT -m tcp -p tcp --sport 53 -j ACCEPT # iptables -I INPUT -m udp -p udp --sport 53 -j ACCEPT # iptables -I INPUT -m udp -p udp --dport 53 -j ACCEPT # iptables -I INPUT -m tcp -p tcp --dport 53 -j ACCEPT
For firewalld:
# firewall-cmd --permanent --add-port=53/tcp # firewall-cmd --permanent --add-port=53/udp # firewall-cmd --reload Save the newly added iptables rules.
# service iptables save "
0,"Firewall rules disappeared after restarting iptables
Applicable to: Plesk for Linux Symptoms
iptables service was restarted. After that, some rules have disappeared. What could be the reason?
Cause
If rules were added using /sbin/iptables utility, they were added to a chain in the memory and were not committed to the hard disk. Upon restart, those rules were flushed from the memory and not restored.
Resolution
In order to avoid losing rules after iptables restart, it is required to save the rules. on CentOS/RHEL-based distributions
Connect to the server via SSH and do the following: Method 1:
# service iptables-save > iptables_save.txt
If using this method, you will need to restore the rules after the restart:
# service iptables-restore < iptables_save.txt Method 2:
# service iptables saveSaving firewall rules to /etc/sysconfig/iptables: [ OK ] The above command saves the rules to the file system, and iptables restart will not affect them. on Debian/Ubuntu-based distributions Method 1:
# iptables-save > /etc/iptables/rules.v4
# iptables-restore < /etc/iptables/rules.v4 Method 2:
Install the iptables-persistent package:
# apt-get install iptables-persistent Related Articles RedHat: Saving IPTables Rules CentOS: Saving IPTables Rules "
2,"Intermittent error in Plesk: ""An operation on a socket could not be performed because the system lacked sufficient buffer space"" Applicable to: Plesk for Windows Symptoms
Operations in Plesk fail intermittently with error:
PLESK_ERROR: ERROR: Zend_Db_Adapter_Exception: SQLSTATE[HY000] [2002] An operation on a socket could not be performed because the system lacked sufficient buffer space or because a queue was full.
Cause
The server is trying to establish an outbound TCP connection from a port with a number greater than 5,000. Usually, this behavior is triggered by the existence of too many open outbound network connections on the server.
Resolution
Reconfigure the server to increase the maximum number of TCP ports from which outbound connections can be established. Instructions can be found in the Microsoft Knowledgebase article KB196271 ."
0,"Unable to clear the PHP session directory on Plesk server: Too many open files
Applicable to: Plesk for Linux Symptoms
Note: The article is only for the Plesk servers with RHEL-based operating systems (CentOS, Red Hat Enterprise Linux, CloudLinux, Virtuozzo Linux 7). The PHP session folder has a large number of files:
# ls -l /var/lib/php/session | wc -l 1139718 When the cron task /etc/cron.hourly/plesk-php-cleanuper is running, CPU usage increases to 100%. When trying to find all working PHP session processes with the below command, it fails with the error:
# [ -x /usr/lib64/plesk-9.0/maxlifetime ] && [ -d /var/lib/php/session ] && find /var/lib/php/session -depth -mindepth 1 -maxdepth 1 -type f -cmin +$(/usr/lib64/plesk-9.0/maxlifetime) ! -execdir fuser {} \; -delete Cannot open a network socket. Cannot open /proc directory: Too many open files fuser: error while loading shared libraries: libc.so.6: cannot open shared object file: Error 24 find: Failed to save working directory in order to run a command on `sess_fch2h2dm7s73t0g09r3dmepdp0': Too many open files Cause
The script plesk-php-cleanuper contains a string ! -execdir fuser {} \, which opens every file in the directory /var/lib/php/session and checks that it is not used by a working process and can be deleted. However, the maximum number of open files is set to 1024 by default.
Resolution Connect to the server using SSH. Check the size of directory /var/lib/php/session:
# du -h /var/lib/php/session 328M /var/lib/php/session If the directory size is larger than 1 MB, recreate it: # rm -rf /var/lib/php/session # mkdir /var/lib/php/session && chmod 1733 /var/lib/php/session/ If directory file size is equal or less than 1 MB, use the following steps: Clear the direcroty /var/lib/php/session using the command:
# [ -x /usr/lib64/plesk-9.0/maxlifetime ] && [ -d /var/lib/php/session ] && find /var/lib/php/session -depth -mindepth 1 -maxdepth 1 -type f -cmin +$(/usr/lib64/plesk-9.0/maxlifetime) -delete Increase the limit for open files in the file /etc/cron.hourly/plesk-php-cleanuper:
# cat /etc/cron.hourly/plesk-php-cleanuper #!/bin/sh ulimit -n 30480 .......... Re-run the task /etc/cron.hourly/plesk-php-cleanuper. "
5,"How to migrate from DirectAdmin to Plesk server? Applicable to:
Plesk for Linux
Symptoms
How to migrate from DirectAdmin to Plesk Onyx? Resolution
Migration from DirectAdmin 1.5.1 can be done from Plesk, using the Plesk Migrator Extension.
Make sure last Plesk MUs are installed How to install Plesk updates
Go to Tools & Settings-> Migration & Transfer Manager and select Direct Admin.
Note: in case if Tools & Settings-> Migration & Transfer Manager is absent, install Plesk Migrator extension according to the article How to Install Plesk Migrator? Note: when migrating from DirectAdmin installed on Ubuntu 10.x, only custom migrationis supported
Additional information
Migration Guide"
6,"Unable to Export Database Dump: mysqldump: Got error: 1044
Applicable to: Plesk for Linux Symptoms
Attempt to Export Dump of a database fails with the error:
CONFIG_TEXT: Unable to export a dump of db_name: Warning: Using unique option prefix database instead of databases is deprecated and will be removed in a future release. Please use the full name instead. mysqldump: Got error: 1044: Access denied for user 'user_name'@'%' to database 'db_name' when using LOCK TABLES.... Exception: (""program 'mysqldump' finished with non-zero exit code: %d"", 2)
Cause
Missing LOCK TABLES privilege for database user.
Resolution Connect to the server via SSH Manually create mysql database backup Access mysql database:
# plesk db mysql> use mysql Correct privileges for database user
MYSQL_LIN: mysql> GRANT LOCK TABLES ON db_name.* TO 'user_name'@'%'; Query OK, 0 rows affected (0.00 sec) mysql> flush privileges; Query OK, 0 rows affected (0.00 sec) "
0,"How to enable/disable SELinux on a server
Applicable to: Plesk for Linux Question
How to disable SELinux on a server?
Answer Enabling/disabling SELinux temporarily To temporary change SELinux mode on a server (until next server reboot if not changed back manually), use the setenforce command with the parameters 0 (permissive mode) and 1 (enforcing mode): permissive (option 0) - The SELinux system prints warnings, but does not enforce policy. Commonly used for troubleshooting. enforcing (option 1) - The SELinux security policy is enforced. To change SELinux mode to ""permissive"" Connect to a server via SSH. Run the command:
# setenforce 0 Check the current status of SELinux:
# sestatus | grep ""Current mode"" Current mode: permissive To set SELinux back to ""enforcing"", run
# setenforce 1 Enabling/disabling SELinux permanently Connect to a server via SSH. Open the file /etc/selinux/config in any text editor. In this example, we are using the vi utility:
# vi /etc/selinux/config Change the SELINUX value to: disabled to completely turn off SELinux on the server:
CONFIG_TEXT: SELINUX=disabled permissive to make SELinux print warnings instead of enforce security policy:
CONFIG_TEXT: SELINUX=permissive enforcing to make SELinux security policy enforced:
CONFIG_TEXT: SELINUX=enforcing Save the changes and close the file. Restart the server to apply the changes. Check the permanent status of SELinux:
# sestatus | grep ""Mode from config file"" Mode from config file: permissive "
5,"Unable to restore Plesk backup in CLI: Specified key is not suitable Applicable to: Plesk for Linux
Plesk for Windows Symptoms
Cannot restore Plesk backup using CLI:
# plesk bin pleskrestore --restore /var/lib/psa/dumps/domains/example.com/backup_example.com_info_1402032305.xml -level domains Unable to decrypt backup. Specified key is not suitable.
Cause
Backup was created with password protection, but the password is not provided during restoration.
Resolution
Use -backup-password option to specify the password.
Example for Linux:
# plesk bin pleskrestore --restore /var/lib/psa/dumps/domains/example.com/backup_example.com_info_1402032305.xml -level domains -ignore-sign -backup-password 'password'
Example for Windows:
C:\> plesk bin pleskrestore.exe --restore ""C:\example.com.zip"" -ignore-sign -verbose -level domains -backup-password 'password'
Alternatively, restore the backup without password using -ignore-backup-password option. But all the user passwords will be lost.
For more information, see the article."
4,"Unable to install Magento or other application in Plesk for Windows: The app requires the 'rewrite' web server module
Applicable to: Plesk 12.0 for Windows
Plesk 12.5 for Windows
Plesk Onyx for Windows
Plesk for Windows Symptoms
Unable to install an application in Plesk for Windows, for example Magento:
PLESK_ERROR: Error: Unable to install the app because its installation requirements are not met. Contact your hosting provider to resolve this problem.
In Requirements sections the following message appears:
CONFIG_TEXT: Apache module: The app requires the 'rewrite' web server module. PHP extension: The 'mcrypt' extension was not found.
The requirements will be shown after the installation attempt is performed, for example: Cause
The application requires Apache HTTP Server with enabled 'mod_rewrite' module, which is not supported by Plesk on Windows.
Resolution
The application is not supported in Plesk for Windows. Consider using another application with similar functionality that is supported in Plesk for Windows."
2,"Plesk Administrators (Custom View), Customers or Resellers are unable to manage security settings in Plesk Onyx
Applicable to: Plesk Onyx for Linux
Plesk Onyx for Windows Symptoms
Unable to manage the Security settings available at Hosting Settings in Plesk Onyx: SSL/TLS Support Permanent SEO-safe 301 redirect from HTTP to HTTPS Cause
The permission Hosting settings management is disabled in the respective Service Plan.
Resolution
In Plesk Onyx it's required to enable Hosting settings management permission to manage SSL/TLS Support and Permanent SEO-safe 301 redirect from HTTP to HTTPS:
Click on a section to expand For Customer or Reseller Log in to Plesk GUI Depending on the subscription status: Subscription is synchronized: Service Plans > Service Plan Name > Permissions > Enable Hosting settings management option > Click Update & Sync Subscription is locked/customized: Subscriptions > example.com > Customize > Permissions > Enable Hosting settings management option > Click Update & Lock For Plesk Administrator with Custom View enabled Log in to Plesk GUI Go to Tools & Settings > Custom View Settings > Hosting Tools > Enable Hosting settings management option > Click OK to save the changes "
5," How to restore a Plesk xml.tar/xml.zip backup file on another Plesk server
Applicable to: Plesk for Linux
Plesk for Windows Question
A Plesk xml.tar (Plesk for Linux) / xml.zip (Plesk for Windows Server) backup file has been downloaded via Plesk Backup Manager or from remote storage.
How to restore this backup on another Plesk server?
Answer
A Plesk backup can be restored either via Plesk interface or a command-line interface directly on a server.
Limitations: A Plesk xml.tar backup file cannot be restored in Plesk for Windows Server. A Plesk xml.zip backup file cannot be restored in Plesk for Linux. A restoration server must have the same or a higher Plesk version. A restoration server must have the same or higher Plesk license edition than the server where the backup has been created. The maximum size of an uploaded backup file is limited to 2Gb. If a backup file size is larger than 2Gb, upload this backup file via a command-line interface. Restoring a backup via Plesk (backup file is less than 2Gb) Go to Tools & Settings > Backup Manager and click Upload. Tick the option Upload backup files without a valid signature (by default, this option is available only for Plesk administrators, see this KB article for reference) and click Browse... to select a backup to upload. After the backup has been uploaded, in Backup Manager, click on this backup. Select: Selected objects - to restore some objects All objects (entire system) - to restore the whole backup file Click Restore to begin the restoration. Restoring a backup via a command-line interface Connect to a Plesk server where a backup should be restored via SSH (Linux)/RDP (Windows Server). Transfer the exported backup (for example, via any FTP agent). Restore the backup: On Linux, adjust the command below and run it:
# plesk bin pleskrestore --restore /root/backup_info_1712180545.xml.tar -level server -ignore-sign -backup-password ""backup_password""
where: /root/backup_info_1712180545.xml.tar - the full path to the backup server - the level to restore the server-wide backup. To restore only clients/domains/resellers use the appropriate keys instead: ""clients"" ""domains"" ""resellers"" backup_password - the password that was specified when downloading the backup from another Plesk server. If the password was not specified or is missing, remove -backup-password ""backup_password"" from the command For more restoration options, see Plesk Documentation: pleskrestore: Restoration from Backup. On Windows Server, start a command prompt as an Administrator, adjust the command below and run it:
C:\> plesk bin pleskrestore.exe --restore ""C:\backup_info_1712180545.xml.zip"" -ignore-sign -level server -backup-password ""backup_password""
where: C:\backup_info_1712180545.xml.zip - the full path to the backup server - the level to restore the server-wide backup. To restore only clients/domains/resellers use the appropriate keys instead: ""clients"" ""domains"" ""resellers"" backup_password - the password that was specified when downloading the backup from another Plesk server. If the password was not specified or is missing, remove -backup-password ""backup_password"" from the command For more restoration options, see Plesk Documentation: pleskrestore.exe: Restoration from Backups. Related Articles How to allow resellers and customers to upload backup files without a valid signature
How to upload a backup to the Plesk Backup Manager
"
8,"How to set up access to webmail via hostname mail.example.com on Plesk for Linux server
Applicable to: Plesk for Linux Question
How to set up access to webmail via hostname mail.example.com on Plesk for Linux server?
Answer
Such functionality is currently not implemented in Plesk. If it should be added to Plesk, consider voting for corresponding feature suggestion on our UserVoice portal.
Top-voted suggestions will be considered for implementing in Plesk.
In the meantime, one of the following workarounds can be used:
Note: Even with one of below workarounds applied, Plesk will still generate webmail login links with hostname webmail.example.com.
Click on a section to expand Using web server as a reverse proxy Note: This workaround works correctly with Let's Encrypt extension. Log into Plesk. Go to Subscriptions > example.com, click Add Subdomain and create subdomain named mail.example.com. Go to Domains > mail.example.com > PHP Settings, uncheck the option PHP support and click OK or Apply to save the changes. Go to Domains > mail.example.com > Apache & nginx Settings. Add a reverse proxy to webmail.example.com: If the Additional nginx directives field is present, add the following content to it:
CONFIG_TEXT: location ~ ^/(?!.well-known).*$ { proxy_pass https://webmail.example.com; proxy_set_header X-Real-IP $remote_addr; proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for; } If the Additional nginx directives field is absent: Add the following content to fields Additional directives for HTTP and Additional directives for HTTPS under Additional Apache directives:
CONFIG_TEXT: SSLProxyEngine on SSLProxyCheckPeerExpire off SSLProxyCheckPeerCN off SSLProxyCheckPeerName off SSLProxyVerify none ProxyPass /.well-known ! ProxyPass ""/"" ""https://webmail.example.com/"" ProxyPassReverse ""/"" ""https://webmail.example.com/"" Go to Tools & Settings > Apache Web Server, enable the module proxy_http in the section Apache modules and click OK or Apply to save the changes. Creating a custom web server configuration template in Plesk Onyx 17.0 and newer Warning: This workaround will not work correctly with Let's Encrypt - it will not be possible to issue a certificate for the hostname mail.example.com unless there is a subdomain mail.example.com. Connect to the server using SSH. Create the directory for custom templates:
# mkdir -p /usr/local/psa/admin/conf/templates/custom/webmail/ Copy the original template file webmail.php file to the created directory:
# cp -a /usr/local/psa/admin/conf/templates/{default,custom}/webmail/webmail.php Open the file /usr/local/psa/admin/conf/templates/custom/webmail/webmail.php for editing and add the directive ServerAlias right after the directive ServerName:
CONFIG_TEXT: ServerName ""webmail.<?php echo $VAR->domain->asciiName ?>"" ServerAlias ""mail.<?php echo $VAR->domain->asciiName ?>""
Note: There are two directives ServerName: under HTTP and HTTPS sections. The directive ServerAlias has to be added under each directive ServerName. Regenerate web server configuration files to apply the changes:
# /usr/local/psa/admin/bin/httpdmng --reconfigure-server Creating a custom web server configuration template in Plesk 12.5 and earlier Warning: This workaround will not work correctly with Let's Encrypt, it will not be possible to issue a certificate for mail.example.com unless there is a subdomain mail.example.com. Connect to the server using SSH. Create the directory for custom templates:
# mkdir /usr/local/psa/admin/conf/templates/custom Copy the original template file domainWebmail.php file to the created directory:
# cp -a /usr/local/psa/admin/conf/templates/{default,custom}/domainWebmail.php Open the file /usr/local/psa/admin/conf/templates/custom/domainWebmail.php for editing and add the directive ServerAlias right after the directive ServerName:
CONFIG_TEXT: ServerName ""webmail.<?php echo $VAR->domain->asciiName ?>"" ServerAlias ""mail.<?php echo $VAR->domain->asciiName ?>""
Note: There are two directives ServerName: under HTTP and HTTPS sections. The directive ServerAlias has to be added under each ServerName directive. Regenerate web server configuration files to apply the changes:
# /usr/local/psa/admin/bin/httpdmng --reconfigure-server Additional Information
How to secure webmail using Let's Encrypt in Plesk Onyx"
5," How to sync a subscription between source and destination servers after Plesk migration Applicable to: Plesk for Linux Plesk for Windows Question
How to synchronize a subscription between source and destination servers, which has been modified on a source server during/after Plesk migration? Answer
To sync subscription(s) between source and destination servers, use the Re-sync feature. Re-syncing a subscription On a destination Plesk server, go to Tools & Settings > Migration & Transfer Manager > click on an active migration session. Click on the [Re-sync] button next to a subscription that needs to be synchronized. Select what data needs to be re-synced for this subscription and click OK. Re-sync business objects will re-sync new objects that have been added on a source server during/after migration (DNS records, databases, FTP and Plesk users, GIT repositories, SSL certificates, etc.). Re-sync website files will re-sync only those files that have been added/modified on a source server during/after migration. Re-sync database data (tables, rows, etc) will remigrate database(s) completely. Re-sync mail messages will re-sync only new emails that have been sent/received/modified on a source server during/after migration. Emails/accounts, that already exist on a destination server, will not be removed. Re-syncing all subscriptions On a destination Plesk server, go to Tools & Settings > Migration & Transfer Manager > click on an active migration session. Switch to the List of subscriptions tab. Click Switch to advanced mode. Select subscriptions that need to be re-synced using check-boxes and click Re-sync. Select what data needs to be re-synced for this subscription and click OK. Re-sync business objects will re-sync new objects that have been added on a source server during/after migration (DNS records, databases, FTP and Plesk users, GIT repositories, etc.). Re-sync website files will re-sync only those files that have been added/modified on a source server during/after migration. Re-sync database data (tables, rows, etc) will remigrate database(s) completely. Re-sync mail messages will re-sync only new emails that have been sent/received/modified on a source server during/after migration. Emails/accounts, that already exist on a destination server, will not be removed. Synchronizing subscriptions via a command-line interface Synchronizing all content
To sync content of all subscriptions, use the following commands: Linux
# cd /usr/local/psa/var/modules/panel-migrator/sessions/<session_dir_name>/
# /usr/local/psa/admin/sbin/modules/panel-migrator/plesk-migrator copy-content Windows
C:\> cd %plesk_dir%\var\modules\panel-migrator\sessions\<session_dir_name>
C:\> ""%plesk_dir%admin/plib/modules/panel-migrator/backend/plesk-migrator.bat"" generate-migration-list
C:\> ""%plesk_dir%\admin\plib\modules\panel-migrator\backend\plesk-migrator.bat"" copy-content If initial migration was done via Plesk interface, it is required to modify the config.ini file in order to synchronize content via CLI. Add the following line in both [plesk] for target and [source] for source server directives in %plesk_dir%\var\modules\panel-migrator\conf\config.ini file:
CONFIG_TEXT: windows-password-type = ""plain""
As a result, config.ini will look alike:
CONFIG_TEXT: [GLOBAL] target-type = ""plesk"" session-dir = ""<session_dir_name>"" skip-log-priority-check = ""1"" skip-migrator-updates = ""1"" skip-set-session-directory-permissions = ""1"" use-separate-log = ""1"" source-type = ""plesk"" sources = ""source"" skip-rpc-agent-deployment = ""false"" adjust-applications = ""true"" [plesk] ip = ""10.10.10.10"" os = ""windows"" windows-username = ""Administrator"" windows-password = ""*******"" windows-password-type = ""plain"" [source] ip = ""20.20.20.20"" os = ""windows"" windows-username = ""Administrator"" windows-password = ""*******"" windows-password-type = ""plain"" session-dir = ""C:\panel_migrator"" copy-mail-content = ""full"" copy-web-content = ""full"" copy-db-content = ""full"" [ui] data-import-type = ""selected"" timing-policy = ""false"" resync-content = ""true"" operability-check = ""true""
Otherwise, the following error will appear:
CONFIG_TEXT: ""%plesk_dir%/admin/plib/modules/panel-migrator/backend/plesk-migrator.bat"" copy-content [INFO] Initialize Plesk Migrator [INFO] Load configuration [ERROR] The encrypted password is specified in the configuration option 'windows-password' of section 'plesk'. Migration with encrypted passwords is not supported by CLI interface. Replace the encrypted password by plain one (also change the password type to ""plain"") or set up the plain password in the environment variable 'PLESK_WINDOWS_PASSWORD'. Synchronizing content separately
Also, content can be synchronized separately. There are three types of content: Mail content
Database content
Web content During Mail content synchronization, all mail content is copied from a source server. New mail on a destination server will not be overwritten.
During Database content synchronization, content of a user's database (MySQL/MS SQL) on a destination server is replaced by content from a source server.
During Web content synchronization, files on a destination server are replaced by files from a source server.
For a specific type of content use the following options to sync web, mail and database content accordingly: copy-web-content copy-mail-content copy-db-content Note: Such commands synchronize already migrated objects' content. If during or after a migration, a new database or a mail account is created, it will not be synchronized. Instead, use the command below:
# /usr/local/psa/admin/sbin/modules/panel-migrator/plesk-migrator transfer-accounts --reload-source-data
To sync Business Objects only:
# /usr/local/psa/admin/sbin/modules/panel-migrator/plesk-migrator transfer-accounts --reload-source-data --skip-copy-web-content --skip-copy-mail-content --skip-copy-db-content --skip-services-checks --skip-infrastructure-checks --skip-main-node-disk-space-checks --skip-license-checks --skip-capability-checks --ignore-migration-list-errors
To sync content of certain domains only, use the following instruction: Prepare a migration list containing domains that should be synchronized.
The list format should be as follows:
CONFIG_TEXT: Customer: customer example.com Plesk Migrator should be pointed to that migration list directly when executed. For example, to sync web content: Linux: # /usr/local/psa/admin/sbin/modules/panel-migrator/plesk-migrator copy-web-content --migration-list-file <path-to-the-migration-list> Windows: C:\> ""%plesk_dir%admin/plib/modules/panel-migrator/backend/plesk-migrator.bat"" copy-web-content --migration-list-file <path-to-the-migration-list> "
8,"Webmail is not working on Plesk server: Error when communicating with the server
Applicable to: Plesk Onyx for Linux Symptoms Unable to send an email via Horde or/and Roundcube webmails due to one of the following errors:
PLESK_ERROR: Forbidden You don't have permission to access /imp/compose.php on this server
OR
PLESK_ERROR: Error when communicating with the server The following rows:
CONFIG_TEXT: [error] [client 203.0.113.2] ModSecurity: Access denied with code 403 (phase 2). Match of ""eq 0"" against ""MULTIPART_UNMATCHED_BOUNDARY"" required. [file ""/etc/httpd/conf.d/mod_security.conf""] [line ""70""] [msg ""Multipart parser detected a possible unmatched boundary.""] [hostname ""HOSTNAME""] [uri ""/horde/imp/compose.php""] [unique_id ""8m0u-n8AAAEAAD7blhoAAAAO""]
OR
CONFIG_TEXT: [client 203.0.113.2] ModSecurity: [file ""/etc/httpd/conf/modsecurity.d/rules/modsecurity_crs-plesk/modsecurity_crs_41_sql_injection_attacks.conf""] [line ""209""] [id ""981257""] [msg ""Detects MySQL comment-/space-obfuscated injections and backtick termination""] [data ""Matched Data: ,\\x22initial\\x22:1,\\x22after\\x22:96,\\x22before\\x22:64, found within ARGS:viewport: {\\x22view\\x22:\\x22SU5CT1g\\x22,\\x22initial\\x22:1,\\x22after\\x22:96,\\x22before\\x22:64,\\x22slice\\x22:\\x221:161\\x22}""] [severity ""CRITICAL""] [tag ""OWASP_CRS/WEB_ATTACK/SQL_INJECTION""] Access denied with code 403 (phase 2). Pattern match ""(?i:(?:,.*?[)\\\\da-f\\""'`\\xc2\\xb4\\xe2\\x80\\x99\\xe2\\x80\\x98][\\""'`\\xc2\\xb4\\xe2\\x80\\x99\\xe2\\x80\\x98](?:[\\""'`\\xc2\\xb4\\xe2\\x80\\x99\\xe2\\x80\\x98].*?[\\""'`\\xc2\\xb4\\xe2\\x80\\x99\\xe2\\x80\\x98]|\\\\Z|[^\\""'`\\xc2\\xb4\\xe2\\x80\\x99\\xe2\\x80\\x98]+))|(?:\\\\Wselect.+\\\\W*?from)|((? ..."" at ARGS:viewport. [hostname ""webmail.example.com""] [uri ""/services/ajax.php/imp/dynamicInit""] [unique_id ""Wgw@Z45Mc7SkeSM1wueOCQAAAAQ""], referer: http://webmail.example.com/imp/dynamic.php?page=mailbox
OR
CONFIG_TEXT: [client 203.0.113.2] ModSecurity: Access denied with code 403 (phase 2). Pattern match ""\\\\W{4,}"" at ARGS:_message. [file ""/etc/httpd/conf/modsecurity.d/rules/modsecurity_crs-plesk/modsecurity_crs_40_generic_attacks.conf""] [line ""37""] [id ""960024""] [rev ""2""] [msg ""Meta-Character Anomaly Detection Alert - Repetative Non-Word Characters""] [data ""Matched Data: >\\x0d\\x0a< found within ARGS:_message: <p>teste anexo</p>\\x0d\\x0a<div id=\\x22_rc_sig\\x22>-- <br />\\x0d\\x0a<div class=\\x22pre\\x22><span style=\\x22color: #000080;\\x22><em><strong>Drone Data & Systems</strong></em></span><br /><a href=\\x22http://www.d2s.pt\\x22 rel=\\x22noreferrer\\x22>www.d2s.pt</a></div>\\x0d\\x0a</div>""] [ver ""OWASP_CRS/2.2.9""] [maturity ""9""] [accuracy ""8""] [hostname ""webmail.example.com""] [uri ""/""] [unique_id ""WnnP1FCs8RsAAtZORcwAAAAV""]
OR
CONFIG_TEXT: [client 203.0.113.2] ModSecurity: [file ""/etc/httpd/conf/modsecurity.d/rules/tortix/modsec/12_asl_adv_xss_rules.conf""] [line ""37""] [id ""341256""] [rev ""5""] [msg ""Atomicorp.com WAF Rules: Possible Cross Site Scripting attack (detectXSS)""] [data ""2460,ARGS:_signature""] [severity ""CRITICAL""] Access denied with code 403 (phase 2). detected XSS using libinjection. [hostname ""webmail.example.com""] [uri ""/""] [unique_id ""XRHfTaYpqb9-31Zg5EGwHgAAAFg""], referer: https://webmail.example.com/?_task=settings&_action=edit-identity&_iid=698&_framed=1
appear in the Apache error log file: For CentOS-based systems:
/var/log/httpd/error_log For Debian-based systems:
/var/log/apache2/error.log Horde and Roundcube webmails work properly when ModSecurity is disabled at the Plesk > Tools & Settings > Web Application Firewall (ModSecurity) page OWASP or Comodo ModSecurity rule set is used. Cause
Strict ModSecurity rules like OWASP or Comodo prevent Horde or/and Roundcube webmails work properly.
Resolution Log into Plesk. Go to the Plesk > Tools & Settings > Web Application Firewall (ModSecurity) page. Depending on the used webmail and ModSecurity rule set, apply the required solution:
Note: if both Roundcube and Horde are affected - apply the required solutions for each webmail. For Horde webmail and OWASP ModSecurity rule set Navigate to the Settings tab. Add the next rows to the Custom directives field:
CONFIG_TEXT: <LocationMatch ""/horde/imp/compose.php""> SecRuleRemoveById 981231 SecRuleRemoveById 958125 SecRuleRemoveById 950005 SecRuleRemoveById 959914 SecRuleRemoveById 981257 SecRuleRemoveById 981260 SecRuleRemoveById 48 SecRuleRemoveById 49 SecRuleRemoveById 50 SecRuleRemoveById 51 SecRuleRemoveById 52 SecRuleRemoveById 53 SecRuleRemoveById 54 SecRuleRemoveById 55 SecRuleRemoveById 56 SecRuleRemoveById 57 SecRuleRemoveById 58 SecRuleRemoveById 59 SecRuleRemoveById 60 SecRuleRemoveById 61 SecRuleRemoveById 62 SecRuleRemoveById 63 SecRuleRemoveById 64 SecRuleRemoveById 65 SecRuleRemoveById 66 SecRuleRemoveById 67 SecRuleRemoveById 68 SecRuleRemoveById 69 SecRuleRemoveById 70 SecRuleRemoveById 71 SecRuleRemoveById 72 SecRuleRemoveById 73 SecRuleRemoveById 74 </LocationMatch> <LocationMatch ""/services/ajax.php/imp""> SecRuleRemoveById 958291 SecRuleRemoveById 981257 SecRuleRemoveById 958291 SecRuleRemoveById 981245 SecRuleRemoveById 981173 SecRuleRemoveById 981246 SecRuleRemoveById 981243 SecRuleRemoveById 33350147 </LocationMatch> Press the Apply button. For Horde webmail and Comodo ModSecurity rule set Navigate to the General tab. Find the CWAF tag in the Active list and click it to disable. Press the Apply button. If the issue still occurs, apply the resolution from the ""For Horde webmail and OWASP ModSecurity rule set"" article section as well. For Roundcube webmail Navigate to the Settings tab. Add the next rows to the Custom directives field:
CONFIG_TEXT: <LocationMatch ""/roundcube/""> SecRuleEngine Off </LocationMatch> Press the Apply button. "
5,"How to configure source server to accept SSH connections and allow user root to log in before the migration?
Applicable to: Plesk for Linux Question
Plesk Migration and Transfer Manager or Plesk Migrator require root access to source Linux servers in order to perform migration/transfer. How to configure source server to accept SSH connections and allow user 'root' to log in before the migration?
Answer By default, SSH server is mainly configured to allow root user to log in. However, it may have been reconfigured to have root logins disabled as a security measure. 'root' user is disabled by default on AWS instances and Ubuntu. Connect to the server via SSH. Escalate privileges to 'root':
# sudo su - # whoami root Set password for 'root' user:
# passwd Make sure that configuration file /etc/ssh/sshd_config has parameters PermitRootLogin and PasswordAuthentication are set to yes and not prepended by # symbol. Otherwise, open /etc/ssh/sshd_config in text editor and perform the necessary changes.
Note: before making this change, make sure that password for user root is sufficently complex (no less than 12 characters long, including numbers, upper/lowercase letters and special symbols). Change password if necessary. Restart SSH server if any configuration changes have been made:
# service sshd restart If the server has a firewall, it should be configured to allow incoming SSH connections from Plesk server. Review files /etc/hosts.allow and /etc/hosts.deny for any rules that may prevent access to SSH service from destination Plesk server. For example, if access to sshd service is denied in hosts.deny:
CONFIG_TEXT: sshd: ALL
Or:
CONFIG_TEXT: ALL: ALL
Then, hosts.allow should have a record which would allow SSH access from destination server:
CONFIG_TEXT: sshd: 192.0.2.2 192.0.2.3 : allow
Note: Replace IP addresses below with IP address of destination server. If destination server has several IP addresses, put all of them in one line, separated by spaces. "
8,"Configuration changes for mail server are not applied in Plesk because of empty mail authorization database
Applicable to: Plesk for Linux Plesk for Windows Symptoms
Mail server does not work on the Plesk server with one/several or the following symptoms: Unable to send/receive messages. The mail_auth_view utility does not show any mail accounts:
# plesk sbin mail_auth_view SPF checking of incoming emails is not triggered. Greylisting is still applied even if it is disabled for a domain Any of the mailbox settings are not getting applied Cause
Mail authorization database is empty and/or mail server misconfiguration.
Resolution
It is possible to use plesk repair utility in order to re-create mail users and configs. The easiest way to do this is by using Repair Kit extension that is available starting from Plesk Onyx 17.8: Log into Plesk Navigate to Extensions > Extension Catalog and search for 'Repair kit': Select the extension and install it on the next screen. Open the extension via Extensions > My Extensions > Repair Kit> Open or via Tools & Settings > Diagnose & Repair. Click Repair button near Mail Server: Solution for older versions of Plesk Connect to the server via SSH or RDP and execute the commands below:
For Plesk Onyx/12.5
CONFIG_TEXT: plesk repair mail
Note: All the accounts on Windows created not through Plesk interface will be removed. Additional information can be found below.
For Plesk 12.0, 11.x and 10.x
Use the mchk utility in order to repair/rebuild the mail server configuration and to restore the settings for all mailboxes created in Plesk. For Linux: # /usr/local/psa/admin/sbin/mchk --help Restore settings for all mailboxes. Usage: /usr/local/psa/admin/sbin/mchk [OPTION] OPTIONS: --without-spam restore all settings except for SpamAssassin configuration --with-spam restore all settings --spam-only restore only SpamAssassin settings Usage example: # /usr/local/psa/admin/sbin/mchk --with-spam For Windows: Warning: Only the settings that were applied to mailboxes through the Plesk interface or command-line utilities will be restored by mchk . Any custom configuration options applied by other means (e.g., through your mail server's configuration console) will be lost. Since Plesk 12.5, option --not-sync-password is available.
C:\>""%plesk_bin%\\mchk"" --help usage: mchk [options] ... --all [--fix=all|local] [--not-sync-password] --domain --domain-name= [--fix=local] [--not-sync-password] --domains --domain-names=<dom1[;dom2;...]>| [--via-file] [--fix=local] [--not-sync-password] --all-domains [--fix=local] [--not-sync-password] --mailbox --domain-name= --mail-name= [--not-sync-password] --global-settings --normalize-disabled-domains Usage example: C:\>""%plesk_bin%\\mchk"" --all --not-sync-password "
3,"Unable to start apache: (13)Permission denied: AH00072: make_sock: could not bind to address [::]:7080
Applicable to: Plesk for Linux Symptoms Apache fails to start with the following error:
CONFIG_TEXT: -- Unit httpd.service has begun starting up. httpd[24566]: (13)Permission denied: AH00072: make_sock: could not bind to address [::]:7080 httpd[24566]: (13)Permission denied: AH00072: make_sock: could not bind to address 0.0.0.0:7080 httpd[24566]: no listening sockets available, shutting down httpd[24566]: AH00015: Unable to open logs SELinux is in the enfocring mode:
# getenforce Enforcing Cause
SELinux permissions are set incorrectly.
Resolution Connect to the Plesk server via SSH. Reinstall the package with SELinux policy for Plesk with the following command:
# yum reinstall psa-selinux
Note: If the error ""Error failed to install SELinux"" appears, reinstall SELinux policy by executing following commands one by one:
# plesk installer --select-release-current --remove-component selinux # plesk installer --select-release-current --install-component selinux "
6,"Unable to access clients' MySQL databases on Plesk for Windows: Access denied for user 'admin'@'localhost' (using password: YES)
Applicable to: Plesk for Windows Note: This article is related to MySQL user's databases server on Windows. Not the Plesk SQL one. Plesk interface should be accessible.
Symptoms Cannot make database dump:
CONFIG_TEXT: mysqldump: Got error: 1045: Access denied for user 'admin'@'localhost' (using password: YES) when trying to connect Attempts to manage a customer's MySQL databases, remove mailbox produce errors:
PLESK_ERROR: Error: Connection to the database server has failed because of network problems: Try to establish connection failed
PLESK_ERROR: Error: Connection to the database server has failed because the supplied account does not possess administrative privileges: Access denied for user 'admin'@'localhost' (using password: YES)
PLESK_ERROR: Error: Connection to the database server has failed because the supplied account does not possess administrative privileges: Access denied for user 'root'@'localhost' (using password: YES) The MySQL server is marked in red on the Tools & Settings > Database Servers screen. Cause
Plesk stores incorrect MySQL server administrator password.
Resolution
To solve the issue and reconnect Plesk to the MySQL server do the following: Connect to the server using RDP. Stop the MySQL server (but not ""Plesk SQL Server"") from running on port 3306 using the Plesk Services Monitor, that can be started from Windows Start menu. Edit the MySQL configuration file %plesk_dir%Databases\MySQL\my.ini (%plesk_dir%Databases\MySQL\Data\my.ini in Plesk 12.5 or lower) and add the line skip-grant-tables to the [mysqld] section and save it using text editor:
CONFIG_TEXT: [mysqld] skip-grant-tables Start the MySQL server using the Plesk Services Monitor. Log into MySQL without the password:
C:\> ""%plesk_dir%\MySQL\bin\mysql.exe"" -P3306
For Plesk 12.5 or older:
C:\> ""%plesk_dir%\Databases\MySQL51\bin\mysql.exe"" Change the password for the MySQL administrator. For MySQL 5.1 and older:
MYSQL_WIN: UPDATE mysql.user SET Password = password('newpassword') WHERE User = 'admin';
For MySQL 5.6 and newer:
MYSQL_WIN: UPDATE mysql.user SET authentication_string = password('newpassword') WHERE User = 'admin';
If there is no user ""admin"" in MySQL find the actual MySQL administrator and rename the user to ""admin"":
MYSQL_WIN: mysql> UPDATE mysql.user SET Password = password('newpassword') WHERE User = 'admin'; Query OK, 0 rows affected (0.00 sec) <-- No user ""admin"" found mysql> select host, user from mysql.user; +-----------+------------------+ | host | user | +-----------+------------------+ | localhost | local_mysql_root | <--- MySQL administrator was renamed to ""local_mysql_root"" +-----------+------------------+ 1 row in set (0.00 sec) mysql> update mysql.user set user=""admin"" where user=""local_mysql_root""; Query OK, 1 row affected (0.00 sec) Rows matched: 1 Changed: 1 Warnings: 0 mysql> UPDATE mysql.user SET Password = password('newpassword') WHERE User = 'admin'; Query OK, 1 row affected (0.00 sec) Rows matched: 1 Changed: 1 Warnings: 0 Remove skip-grant-tables from the MySQL configuration file and restart the service. Log into the Plesk interface, go to the database server management settings ( Tools & Settings > Database Servers ), and change the password for the corresponding database server to the one set in Step 5. Plesk will re-establish the connection to the server. Note: in some rare cases step 6 may not work and the following procedure can be used for the admin user How to Reset the Root Password. Make sure the commands are adapted for the admin user.
Additional Information
How to retrieve/reset a password for the ""admin"" user in Plesk for Linux?"
2,"Syncing the subscription with its service plan failed because some of the services or resources defined in the plan cannot be actually provisioned with the subscription
Applicable to: Plesk for Linux
Plesk for Windows Symptoms
Cannot synchronize reseller John Doe with his service plan:
CONFIG_TEXT: Synchronization Failed Syncing the subscription with its service plan failed because some of the services or resources defined in the plan cannot be actually provisioned with the subscription. Available value indicates the actual state of a resource or a service in the system. Clicking OK will initiate setting the subscription values according to the available values.
Cause
Mismatch between the limits of reseller's subscriptions and limits of service plan assigned to this reseller.
Resolution
Check permissions and limitations defined in resellers service plan or reseller account settings defined by Plesk administrator: Log in to Plesk as administrator. Ensure that total sum of allowed resources (for example: CPU, RAM, disk space) for all subscriptions created under reseller John Doe is less or equal than limits set in service plan assigned to this reseller. Make the required corrections. In case the property specified in the initial error message is `Shared IP addresses, Navigate to Service Plans > Resellers > <Plan name> > IP Addresses tab and move at least one IP address to the Selected column. Click Update & Sync. Synchronize required reseller account with his service plan: Resellers > John Doe > Sync. Note: additional information about syncing resellers subscriptions and service plans can be found in Reseller's Guide."
2,"Unable to sync a subscription with service plan on Plesk server: Unable to accept the template: the following limitations are exceeded
Applicable to: Plesk for Linux
Plesk for Windows Symptoms When trying to sync customer's subscription with service plan, the following error occurs:
C:\> plesk bin subscription --sync-subscription example.com Unable to accept the template: the following limitations are exceeded. Description Requested Allowed Disk space 5.00 GB 0 B Microsoft SQL database quota Unlimited 0 B Microsoft SQL Server databases 1 0 Cannot synchronize a subscription:
Synchronization failed Unable to allocate required resources. Only 0 MB of space is available. The subscription belongs to a customer, this customer belongs to a reseller. Cause
Reseller's limits were exceeded. Limits that were allocated for reseller's customer overtake their own resources.
Resolution
Set the limits, distributed within Subscriptions and Customers to less or equal to the ones that reseller has: increase reseller's limits or decrease customer`s (subscription) limits.
Resolution Connect to the server via SSH / via RDP;
Note: If direct SSH/RDP access to the server is not possible, contact server administrator for further assistance. Unlock the subscription:
# plesk bin subscription --unlock-subscription example.com Discover insufficient resources (remember the command output):
# plesk bin subscription --sync-subscription example.com Discover the customer who owns the subscription at Subscriptions screen: Discover the reseller who owns the customer at Resellers screen: Go to Home > Resellers > Reseller1 > Customize (under the right column) > Resources and add the required resources. Press Apply&Lock . Synchronize the subscription:
# plesk bin subscription --sync-subscription example.com Alternatively, set Overselling policy as Overselling is allowed at Home > Resellers > Reseller1 > Customize (under the right column). Note: Overselling is allowed' option means that for reseller's overuse calculated statistics value will be used instead of ""Maximum possible"". If 'Overselling is allowed', then reseller with 1 GB/month traffic allowed will be able to create any amount of subscriptions, however, if the sum of their traffic will be more than 1GB, then all 'Overuse policy' will be used."
7,"How to install an SSL certificate for a domain in Plesk (Let's Encrypt / other certificate authorities)
Applicable to: Plesk for Linux
Plesk for Windows Question
How to install an SSL certificate for a domain in Plesk?
Answer Securing a domain with a free Let's Encrypt certificate (Plesk Onyx and Obsidian) Note: Before securing a domain with a Let's Encrypt certificate, make sure the domain name is resolved to a public IP address of the Plesk server from the Internet. If in doubt, check your domain name availability using DNS Lookup by MxToolBox. In Plesk, go to Extensions and search for Let's Encrypt. Click on Let's Encrypt and then click ""Get it free"" (or ""Install""). Go to Domains and select the domain you want to secure. Click Hosting Settings. On the Hosting Settings page, make sure that SSL/TLS support is enabled. Go back to domain's dashboard. Click Let's Encrypt. Select required options. We recommend to select: Include the ""www"" subdomain for the domain and each selected alias Secure webmail on this domain (https://webmail.example.com) Note: Email address will be used to receive important notifications and warnings. Click Install. At this stage, an SSL certificate from Let’s Encrypt is generated and set to secure the domain. This certificate is valid for the next 90 days and will be auto-renewed by the Let's Encrypt extension. To learn more about free SSL certificates, check the following Plesk Docs pages: Getting Free SSL/TLS Certificate from Let's Encrypt
Getting Free Wildcard SSL/TLS Certificates from Let's Encrypt Securing a domain with an SSL certificate from other certificate authorities First of all, you should have a purchased SSL certificate for your website on hands. If you don't have a certificate, you can use a free certificate issued by Let's Encrypt (see instructions above). Note: It is possible to use Plesk for generating CSR (Certificate Signing Request) for your certificate. For that, navigate to Domains > example.com > SSL Certificates, fill in the required fields and click Request. Such certificate will be Self-Signed and not valid for checks. Go to Domains > example.com > SSL/TLS Certificates.
Note: If you are using the SSL It! extension, click Advanced Settings. On the SSL/TLS Certificates page, add your certificate:
Note: If you are experiencing issues with a certificate installation, contact your certificate seller and ask for certificate installation instructions for Plesk. If an SSL certificate is stored in a single *.crt file:
Click Browse... to select a certificate file. Then click Upload Certificate. If an SSL certificate is stored in the form of *.key and *.crt files:
Click Add SSL/TLS Certificate and scroll down to the Upload the certificate files section and upload these files. If both the certificate and the private key parts of your certificate are contained in a *.pem file (you can check it by opening the *.pem file in any text editor), just upload it twice, both as the private key and the certificate. Click Upload Certificate once finished. If an SSL certificate is stored as a text:
Click Add SSL/TLS Certificate and scroll down to the Upload the certificate as text section. There, paste the certificate and the private key parts into the corresponding fields. Click Upload Certificate when you have finished. Once the certificate is created, go to Domains > example.com > Hosting Settings and: enable SSL support select your created SSL certificate click OK Open your website at https://example.com.
Note: In case of any issues, make sure that the certificate was properly selected. Related Articles How to enable redirection from HTTP to HTTPS for a domain in Plesk
Troubleshooting failed Let's Encrypt certificate installations in Plesk
"
7," Plesk for Linux services logs and configuration files Applicable to: Plesk for Linux Question
Where to find Plesk for Linux services logs and configuration files?
Answer
This article's sole purpose is providing information regarding the services that Plesk interacts with. Below you will find the configuration and log file locations of the services, which may be useful during a troubleshooting procedure.
For Plesk on Windows see this article.
Services Plesk
Plesk Installer Web Presence Builder Backup Manager Plesk Migrator Plesk Migration Manager Website & Mail Import Health Monitor Health Monitor Notification Daemon MySQL PostgreSQL Apache nginx Tomcat FTP Xinetd Named / BIND Courier-IMAP Dovecot Postfix qmail Horde RoundCube Mail forwarding Mailman SpamAssassin Premium Antivirus (Dr.Web) Kaspersky antivirus phpMyAdmin phpPgAdmin Logrotate Webalizer AWstats Watchdog (monit) Watchdog (rkhunter) Plesk Firewall Plesk Firewall (IP forwarding) IP Address Banning (Fail2Ban) ModSecurity Let's Encrypt Plesk-PHP Acronis Backup
Node.JS WordPress Toolkit Plesk Logs Error log: /var/log/sw-cp-server/error_log and /var/log/sw-cp-server/sw-engine.log Access log: /var/log/plesk/httpsd_access_log Panel log: /var/log/plesk/panel.log Services Stop: service psa stop Start: service psa start Restart: service psa restart Configuration PHP config on RHEL-based: /usr/local/psa/admin/conf/php.ini PHP config on Debian-based: /opt/psa/admin/conf/php.ini Panel config on RHEL-based: /usr/local/psa/admin/conf/panel.ini Panel config on Debian-based: /opt/psa/admin/conf/panel.ini Web server config: /etc/sw-cp-server/conf.d/plesk.conf User actions logging: Tools & Settings > Action log Plesk Installer Logs /var/log/plesk/install/autoinstaller3.log
/tmp/autoinstaller3.log Web Presence Builder Logs Error log: /usr/local/psa/admin/logs/sitebuilder.log Install/upgrade logs: /usr/local/sb/tmp/ No service control (working via the sw-cp-server service)
Configuration /usr/local/sb/config /etc/sw-cp-server/conf.d/plesk.conf /usr/local/psa/admin/conf/php.ini Backup Manager Logs Backup logs: /usr/local/psa/PMM/logs/backup-<datetime> Plesk Onyx; /var/log/plesk/PMM/ Plesk Obsidian
Restore log: /usr/local/psa/PMM/logs/restore-<datetime> or /usr/local/psa/PMM/rsessions Functionality is controlled by the Plesk control panel service
Configuration /etc/psa/psa.conf Plesk Migrator Configuration /usr/local/psa/var/modules/panel-migrator/conf/ /usr/local/psa/admin/plib/modules/panel-migrator/backend/conf/ Logs /usr/local/psa/var/modules/panel-migrator/logs/ /usr/local/psa/var/modules/panel-migrator/sessions/ Migration Manager Logs /usr/local/psa/PMM/logs/migration-<datetime> Functionality is controlled by the Plesk control panel service. Website & Mail Import Logs /usr/local/psa/var/modules/site-import/sessions/ Health Monitor Manager Logs /usr/local/psa/admin/logs/health-alarm.log Services Stop: service sw-collectd stop Start: service sw-collectd start Restart: service sw-collectd restart Configuration /usr/local/psa/admin/conf/health-config.xml /usr/local/psa/var/custom-health-config.xml /etc/sw-collectd/collectd.conf Health Monitor Notification Daemon Logs /usr/local/psa/admin/logs/health-alarm.log Services Stop: service psa-health-monitor-notificationd stop Start: service psa-health-monitor-notificationd start Restart: service psa-health-monitor-notificationd restart Configuration /usr/local/psa/admin/conf/health-config.xml /usr/local/psa/var/custom-health-config.xml MySQL Logs
Note: Log file location specified in my.cnf file:
Debian/Ubuntu
# cat /etc/mysql/my.cnf | grep log_error log_error = /var/log/mysql/error.log
CentOS/RHEL
# cat /etc/my.cnf | grep log-error log-error=/var/log/mariadb/mariadb.log /var/log/mysqld.log Services Stop: service mysqld stop Start: service mysqld start Restart: service mysqld restart Note: Service name differs on different Linux distributives: mysqld on CentOS/RHEL 5 and 6 mariadb on CentOS/RHEL 7 mysql on Debian/Ubuntu Configuration /etc/my.cnf /etc/mysql/my.cnf (Debian/Ubuntu) PostgreSQL Logs /var/lib/pgsql/pgstartup.log /var/log/postgresql/postgresql-x.x-main.log Services Stop: service postgresql stop Start: service postgresql start Restart: service postgresql restart Configuration /var/lib/pgsql/data/postgresql.conf CentOS/CloudLinux /var/lib/pgsql/data/pg_hba.conf Ubuntu/Debian /etc/postgresql/x.x/main/pg_hba.conf Apache
RHEL/CentOS Logs Global logs: Access log: /var/log/httpd/access_log Error log: /var/log/httpd/error_log Domain logs: Access logs: HTTP log: /var/www/vhosts/system/<domain_name>/logs/access_log HTTPS log: /var/www/vhosts/system/<domain_name>/access_ssl_log Error log: /var/www/vhosts/system/<domain_name>/error_log Services Stop: service httpd stop Start: service httpd start Restart: service httpd restart Configuration /etc/httpd/conf/httpd.conf /etc/httpd/conf.d/zz010_psa_httpd.conf (includes generated configuration files with the rest of the vhosts and the server configuration)
/etc/httpd/conf/plesk.conf.d/ Debian/Ubuntu Logs Global logs: Access log: /var/log/apache2/access.log Error log: /var/log/apache2/error.log Domain logs: Access logs: HTTP log: /var/www/vhosts/system/<domain_name>/logs/access_log HTTPS log: /var/www/vhosts/system/<domain_name>/access_ssl_log Error log: /var/www/vhosts/system/<domain_name>/error_log Services Stop: service apache2 stop Start: service apache2 start Restart: service apache2 restart Configuration /etc/apache2/apache2.conf /etc/apache2/conf-enabled/zz010_psa_httpd.conf(includes generated configuration files with the rest of the vhosts and the server configuration)
/etc/apache2/plesk.conf.d/ nginx Logs Global logs: Access log: /var/log/nginx/access.log Error log: /var/log/nginx/error.log Domain logs: Access logs: HTTP log: /var/www/vhosts/system/<domain_name>/logs/proxy_access_log HTTPS log: /var/www/vhosts/system/<domain_name>/proxy_access_ssl_log Error log: /var/www/vhosts/system/<domain_name>/proxy_error_log Services nginx Stop: service nginx stop Start: service nginx start Restart: service nginx restart nginx as a reverse-proxy Stop: /usr/local/psa/admin/bin/nginxmng --disable Start: /usr/local/psa/admin/bin/nginxmng --enable Status: /usr/local/psa/admin/bin/nginxmng --status Configuration /etc/nginx/nginx.conf /etc/nginx/conf.d/zz010_psa_nginx.conf (includes generated configuration files with the rest of the vhosts' and server configuration) Tomcat Logs /var/log/tomcat/* Services Stop: service tomcat stop Start: service tomcat start Restart: service tomcat restart Configuration /etc/tomcat/server.xml
/etc/tomcat/tomcat.conf Application configuration /var/lib/tomcat/application_name/ FTP Logs /var/log/plesk/xferlog (or /var/log/xferlog)
/var/log/plesk/ftp_tls.log Authentication logs /var/log/secure - CentOS/RHEL-based distributions /var/log/auth.log - Debian/Ubuntu-based distributions No service control (works via the Xinetd service)
Configuration /etc/xinetd.d/ftp_psa /etc/proftpd.conf /etc/proftpd.include xinetd Logs /var/log/messages Services Stop: service xinetd stop Start: service xinetd start Restart: service xinetd restart Configuration /etc/xinetd.conf /etc/xinetd.d/* (files with ""."" in the name are ignored) BIND Logs /var/log/messages /var/log/syslog Services Stop: service named stop Start: service named start Restart: service named restart Configuration /etc/named.conf Note: The service is called bind9 on Debian/Ubuntu and named-chroot on CentOS 7. Courier-IMAP Logs /var/log/maillog Services Stop: service courier-imap stop Start: service courier-imap start Restart: service courier-imap restart Configuration /etc/courier-imap/imapd /etc/courier-imap/imapd-ssl /etc/courier-imap/pop3d /etc/courier-imap/pop3d-ssl Dovecot Logs Logs can be found using the /usr/sbin/dovecot log find command Services Stop: service dovecot stop Start: service dovecot start Restart: service dovecot restart Configuration /etc/dovecot/dovecot.conf /etc/sysconfig/dovecot (CentOS/RHEL) /etc/dovecot/conf.d/11-plesk-security-ssl.conf Postfix Logs /var/log/maillog Services Stop: service postfix stop Start: service postfix start Restart: service postfix restart Configuration /etc/postfix/master.cf /etc/postfix/main.cf Qmail Logs /var/log/maillog Services Stop: service qmail stop Start: service qmail start Restart: service qmail restart Configuration Control files in /var/qmail/control/ /etc/xinetd.d/smtp_psa /etc/xinetd.d/smtps_psa /etc/xinetd.d/submission_psa Horde Logs Error log: /var/log/psa-horde/psa-horde.log No service control (works via the Apache web-server)
Configuration /etc/psa-webmail/horde/horde.conf /etc/psa-webmail/horde/horde/conf.php Roundcube Logs Error log: /var/log/plesk-roundcube/errors No service control (works via the Apache web-server)
Configuration /etc/psa-webmail/roundcube/* /usr/share/psa-roundcube/config/defaults.inc.php
Customizations: /usr/share/psa-roundcube/config/config.inc.php Mail forwarding Configuration /var/qmail/mailnames/<domain_name>/<user_name>/.qmail Mailman Logs /var/log/mailman/* Services Stop: service mailman stop Start: service mailman start Restart: service mailman restart Configuration /usr/lib/mailman/Mailman/mm_cfg.py /etc/mailman/sitelist.cfg
/etc/httpd/conf/plesk.conf.d/server.conf - web config for Mailman on RHEL/CentOS
/etc/apache2/plesk.conf.d/server.conf - web config for Mailman on Debian/Ubuntu SpamAssassin Logs /var/log/maillog Services Stop: service spamassassin stop Start: service spamassassin start Restart: service spamassassin restart Configuration /etc/mail/spamassassin/local.cf /var/qmail/mailnames/<domain_name>/<mailbox>/.spamassassin/user_prefs Premium Antivirus Logs /var/log/maillog /var/drweb/log/* Service control Stop: service drwebd stop Start: service drwebd start Restart: service drwebd restart Configuration /etc/drweb/* Kaspersky Antivirus Logs /var/log/maillog Service control Stop: service kavehost stop Start: service kavehost start Restart: service kavehost restart Configuration /opt/kav/sdk8l3/etc/kav-handler.cfg /etc/kavehost.xml Anti-virus database directory: /opt/kav/sdk8l3/bases/ phpMyAdmin Logs Error log: /var/log/sw-cp-server/error_log No service control (working via the sw-cp-server service).
Configuration /usr/local/psa/admin/htdocs/domains/databases/phpMyAdmin/libraries/config.default.php phpPgAdmin Logs Error log: /var/log/sw-cp-server/error_log No service control (working via the sw-cp-server service).
Configuration /usr/local/psa/admin/htdocs/domains/databases/phpPgAdmin/conf/config.inc.php Logrotate No service control. Executed by the daily maintenance task: /etc/cron.daily/50plesk-daily Configuration /usr/local/psa/etc/logrotate.conf /usr/local/psa/etc/logrotate.d/*
/etc/logrotate.conf
/etc/logrotate.d/* Webalizer No service control. Executed by the daily maintenance task: /etc/cron.daily/50plesk-daily Configuration /srv/www/vhosts/system/<domain_name>/conf/webalizer.conf AWstats No service control. Executed by the daily maintenance task: /etc/cron.daily/50plesk-daily Configuration /usr/local/psa/etc/awstats/awstats.<domain_name>-*.conf Watchdog (monit) Logs /usr/local/psa/var/modules/watchdog/log/wdcollect.log /var/log/wdcollect.log /usr/local/psa/var/modules/watchdog/log/monit.log /var/log/plesk/modules/wdcollect.log Service control Stop: /usr/local/psa/admin/bin/modules/watchdog/wd --stop Start: /usr/local/psa/admin/bin/modules/watchdog/wd --start Restart: /usr/local/psa/admin/bin/modules/watchdog/wd --restart Configuration /usr/local/psa/etc/modules/watchdog/monitrc /usr/local/psa/etc/modules/watchdog/wdcollect.inc.php Watchdog (rkhunter) Logs: /var/log/rkhunter.log Service control: Start: /usr/local/psa/admin/bin/modules/watchdog/rkhunter Configration: /usr/local/psa/etc/modules/watchdog/rkhunter.conf Plesk Firewall Service control Stop: service psa-firewall stop Start: service psa-firewall start Restart: service psa-firewall restart Configuration /usr/local/psa/var/modules/firewall/firewall-active.sh /usr/local/psa/var/modules/firewall/firewall-emergency.sh /usr/local/psa/var/modules/firewall/firewall-new.sh Plesk Firewall (IP forwarding) Service control Stop: service psa-firewall-forward stop Start: service psa-firewall-forward start Restart: service psa-firewall-forward restart Configuration /usr/local/psa/var/modules/firewall/* IP Address Banning (Fail2Ban) Logs: /var/log/fail2ban.log Service control Stop: service fail2ban stop Start: service fail2ban start Restart: service fail2ban restart Configuration: A set of IPTables rules. By default: iptables -N fail2ban-plesk-login iptables -A fail2ban-plesk-login -j RETURN iptables -A INPUT -p tcp -m multiport --dports 8880,8443 -j fail2ban-plesk-login ModSecurity Logs /var/log/modsec_audit.log
/var/www/vhosts/<domain_name>/logs/error_log Services Disable: /usr/local/psa/admin/bin/modsecurity_ctl -d Enable: /usr/local/psa/admin/bin/modsecurity_ctl -e Let's Encrypt Logs /usr/local/psa/admin/logs/panel.log Plesk-PHP php.ini /opt/plesk/php/7.x/etc/php.ini .ini files: /opt/plesk/php/7.x/etc/php.d/ Modules: /opt/plesk/php/7.x/lib64/php/modules/ Logs: /var/log/plesk-php7x-fpm/ Acronis Backup Service Control acronis_mms: Acronis Managed Machine Service is responsible for backup and recovery operations. /usr/local/psa/var/modules/acronis-backup/python/python -m acronis_backup_srv.app_daemon --config=/usr/local/psa/var/modules/acronis-backup/srv/config.ini: Extension frontend is implemented with a separate persistent process, running in the background.
/opt/plesk/php/7.x/etc/php.ini Logs: /var/log/plesk/panel.log
/var/log/trueimage-setup.log
/usr/local/psa/var/modules/acronis-backup/srv/log/ Node.js Logs: Global log /var/log/httpd/error_log CentOS/RHEL-based distributions /var/log/apache/error_log Debian/Ubuntu-based distributions /var/log/nginx/error.log On nginx-only hosting Domain's log /var/www/vhosts/system/example.com/logs/ WordPress Toolkit Log: /var/log/plesk/panel.log with Debug mode enabled User actions logging: Tools & Settings > Action log "
2,"How to disable access to Plesk for root or administrator users?
Applicable to: Plesk for Linux
Plesk for Windows Question
How to disable access to Plesk for root (Plesk for Linux) or Administrator (Plesk for Windows) users?
Answer Log into Plesk.
Go to Extensions > My Extensions > Panel.ini Editor > Open > Editor.
Note: in case of the Panel.ini Editor is absent in Extensions > My Extensions, install it using the solution from here. Add the text below at the end of the file:
CONFIG_TEXT: [login] systemAdmin = false Press the Save button. Solution using the SSH access (Plesk for Linux) Log into the server via SSH.
Using the vi text editor open the /usr/local/psa/admin/conf/panel.ini file. Add the text below at the end of the document and save the changes:
CONFIG_TEXT: [login] systemAdmin = false Solution using the RDP access (Plesk for Windows) Log into the server via RDP.
Open the %plesk_dir%admin\conf\panel.ini file with any text editor. Add the text below at the end of the document and save the changes:
CONFIG_TEXT: [login] systemAdmin = false Note: There is no possibility to disable access to Plesk for the admin user. Vote for this feature on the Plesk UserVoice portal. Top-ranked features are likely to be implemented in the next product releases."
6," How to upgrade MySQL 5.5 to 5.6/5.7 or MariaDB 5.5 to 10.0/10.1/10.2/10.3 on Linux?
Applicable to: Plesk for Linux This article provides instructions for upgrading MySQL 5.5 to 5.6/5.7 and MariaDB 5.5 to 10.0/10.1/10.2/10.3 on Linux.
Note: Upgrade can be performed in a command-line interface with the instructions below at your own risk. This task is supposed to be performed by a system administrator. If you are not familiar with Linux system administering and would like our professionals to handle this task on your behalf, contact Professional Services team at https://www.plesk.com/professional-services/.
To find out your Linux distribution, run:
# plesk version | grep ""OS version""
Or:
# cat /etc/*-release
Warning: MariaDB 10.3 is supported starting from Plesk Obsidian. Previous versions (Onyx and older) do not support MariaDB 10.3 and there are no plans to implement it currently.
Warning: MariaDB 10.4 and 10.5 are not currently supported by Plesk.
Warnings: Direct upgrade from MySQL 5.1 to MySQL 5.6/5.7 will break tables structure. The instructions for upgrading MySQL from 5.1 to 5.5 on Linux are available here: How to upgrade MySQL from 5.1 to 5.5 on Linux It is strongly recommended to create a server snapshot (full backup) before upgrading. Perform MySQL upgrade at your own risk. Before starting a MySQL upgrade, stop the WatchDog service if it is used on a server. Check its status with the service watchdog status command.
Notes: MySQL will not be upgraded on CentOS/RHEL-based operating systems if it was installed from the Webtatic Yum repository:
# rpm -qa | grep -i mysql mysql55w-server-5.5.57-1.w6.x86_64
To start an upgrade of MySQL/MariaDB, connect to a server via SSH as root/superuser and follow the instructions for your operating system: Plesk on CentOS 7 / RHEL 7 By default, CentOS 7 is shipped with MariaDB 5.5. MariaDB 10.x version is a drop-in replacement for MySQL 5.5-5.7. For security reasons, create a database dump of all databases with the following command:
# MYSQL_PWD=`cat /etc/psa/.psa.shadow` mysqldump -u admin --all-databases --routines --triggers > /tmp/all-databases.sql Stop MariaDB:
# service mariadb stop Remove additional packages like mariadb-bench:
# rpm -e --nodeps mariadb-bench For security reasons, copy the database directory in a separate folder:
# cp -v -a /var/lib/mysql/ /var/lib/mysql_backup Check if the mysql-server package is already installed:
# rpm -q --whatprovides mysql-server
If it is installed and the command above gives output, remove using the following command:
# rpm -e --nodeps `rpm -q --whatprovides mysql-server` Configure MariaDB repository: open the Setting MariaDB repositories page, select your OS distro, release and a desired MariaDB version. Once done, the configuration that should be added to the /etc/yum.repos.d/MariaDB.repo file will appear.
Warning: Do not select versions 10.4 and 10.5 because these MariaDB versions are not currently supported by Plesk.
Here is an example for MariaDB 10.2:
6.1. Open/create the MariaDB.repo file in any text editor. In this example, we are using the vi editor:
# vi /etc/yum.repos.d/MariaDB.repo
6.2. Add the content below to the file:
CONFIG_TEXT: [mariadb] name = MariaDB baseurl = http://yum.mariadb.org/10.2/centos7-amd64 gpgkey=https://yum.mariadb.org/RPM-GPG-KEY-MariaDB gpgcheck=1
6.3. Save the changes and close the file. Start an upgrade of MariaDB:
# yum install MariaDB-client MariaDB-server Once the upgrade is finished, start MariaDB:
# systemctl restart mariadb
OR
# systemctl restart mysql Upgrade MySQL databases:
# MYSQL_PWD=`cat /etc/psa/.psa.shadow` mysql_upgrade -uadmin Restart mysql service:
# systemctl restart mariadb
OR
# systemctl restart mysql Execute this command to update the package version inside Plesk:
# plesk sbin packagemng -sdf Note: After an upgrade, there may appear 'mysql' init script. It should be removed to avoid conflicts with MariaDB service. The same commands can be used to fix already existing conflict:
# systemctl stop mysql; killall mysqld # to stop the incorrect service if it is started # rm /etc/init.d/mysql && systemctl daemon-reload # to remove the incorrect service script and reload systemctl configuration # systemctl start mariadb # to start MariaDB if not started # systemctl enable mariadb # to make sure that MariaDB will start after the server reboot automatically Plesk on CentOS 6 / RHEL 6 For security reasons, create a database dump of all databases with the following command:
# MYSQL_PWD=`cat /etc/psa/.psa.shadow` mysqldump -u admin --all-databases --routines --triggers > /tmp/all-databases.sql
If the command fails with ""Cannot load from mysql.proc. The table is probably corrupted"", apply the solution from this KB article. Stop MySQL server:
# service mysqld stop For security reasons, create a backup of all existing databases:
# cp -a /var/lib/mysql /var/lib/mysql_backup Disable Atomic repository, if it is enabled:
# vi /etc/yum.repos.d/atomic.repo enabled = 0 Check for MySQL repo files left from previous installation.
# ls -l /etc/yum.repos.d/mysql*
If any found, remove them:
# rm -rf /etc/yum.repos.d/mysql-community-source.repo Install the MySQL-community repository:
# yum install https://dev.mysql.com/get/mysql80-community-release-el6-1.noarch.rpm Configure MySQL repository:
7.1. Open the mysql-community.repo file in a text editor. In this example, we are using the vi editor:
# vi /etc/yum.repos.d/mysql-community.repo
7.2. Select a MySQL version. In this example, we are upgrading MySQL to 5.7:
Warning: Disable MySQL 8.0 repository and exclude mysql-connector-odbc-8 version, as these releases are not supported by Plesk yet. If it is not disabled, yum will install the latest version which will cause major issues.
CONFIG_TEXT: [mysql56-community] enabled=0 ... [mysql57-community] enabled=1 ... [mysql80-community] enabled=0 ... [mysql-connectors-community] exclude=mysql-connector-odbc-8* ...
7.3. Save the changes and close the file. Install MySQL packages:
# yum update mysql
If update of mysql package ends with Nothing to do message, make sure that mysql* packages are not added to excludes in yum.conf file and remove it if it is in the list:
# cat /etc/yum.conf | grep exclude exclude=php-common php-cli php mysql* httpd* mod_ssl* Type y if this message appears:
CONFIG_TEXT: warning: rpmts_HdrFromFdno: Header V3 DSA/SHA1 Signature, key ID 5072e1f5: NOKEY Retrieving key from file:///etc/pki/rpm-gpg/RPM-GPG-KEY-mysql Importing GPG key 0x5072E1F5: Userid : MySQL Release Engineering <mysql-build@oss.oracle.com> Package: mysql57-community-release-el6-7.noarch (@/mysql57-community-release-el6-7.noarch) From : /etc/pki/rpm-gpg/RPM-GPG-KEY-mysql Is this ok [y/N]: Start MySQL server:
# service mysqld start
If the service does not start, check the following article: MySQL fails to start: mysql.user table is damaged. Upgrade MySQL databases:
# MYSQL_PWD=`cat /etc/psa/.psa.shadow` mysql_upgrade -uadmin Restart mysql service:
# service mysqld restart Execute the following commands to update package version inside Plesk:
# plesk bin service_node --update local # plesk sbin packagemng -sdf Plesk on CloudLinux Create a backup of all databases with the following command:
# MYSQL_PWD=`cat /etc/psa/.psa.shadow` mysqldump -u admin --all-databases --routines --triggers > /tmp/all-databases.sql Stop the MySQL service:
# service mysqld stop Copy a databases directory in a separate folder like this (for backup purposes also):
# cp -v -a /var/lib/mysql/ /var/lib/mysql_backup Start the MySQL service:
# service mysqld start Ensure that [mysqlclient] repository is enabled in /etc/yum.repos.d/cl-mysql.repo and the below command displays similar output:
# yum repolist enabled | grep mysqlclient Repository extras is listed more than once in the configuration mysqclient/7/x86_64 mysqlclient 7 Select MySQL/MariaDB version to install:
Note: The following command does not work if governor-mysql package is not installed. In such case, install it: # yum install governor-mysql
# /usr/share/lve/dbgovernor/mysqlgovernor.py --mysql-version=XXXXX
Note: Where 'XXXXX' has to be substituted with one of the following: mariadb100 for MariaDB v10.0 mariadb101 for MariaDB v10.1 mariadb102 for MariaDB v10.2 mysql55 for MySQL v5.5 mysql56 for MySQL v5.6 mysql57 for MySQL v5.7 Install selected previously MariaDB engine:
# /usr/share/lve/dbgovernor/mysqlgovernor.py --install
Warning: CloudLinux does not recommend to downgrade from MySQL v5.6, MariaDB 10.x Restart MySQL:
# service mysql restart Upgrade MySQL databases:
# MYSQL_PWD=`cat /etc/psa/.psa.shadow` mysql_upgrade -uadmin Restart MySQL:
# service mysql restart Execute the following commands to update package version inside Plesk:
# plesk bin service_node --update local # plesk sbin packagemng -sdf Plesk on Debian 8 & 9 Debian 8 & 9 are basically shipped with MariaDB. MariaDB 10.x version is a drop-in replacement for MySQL 5.5/5.6/5.7
Backup all existing databases using the KB article How to backup/restore a Plesk database dump and follow instructions on MariaDB site to update it: https://mariadb.com/kb/en/mariadb/installing-mariadb-deb-files/ Example for MariaDB 10.2
Install MariaDB:
Stop the MariaDB service:
# service mariadb stop
# curl -sS https://downloads.mariadb.com/MariaDB/mariadb_repo_setup | sudo bash -s -- --mariadb-server-version=mariadb-10.2 # apt install mariadb-server-10.2
If the installation fails with unmet dependencies:
CONFIG_TEXT: dpkg: mariadb-server-10.1: dependency problems, but removing anyway as you requested: plesk-mysql-server depends on virtual-mysql-server | mysql-server; however: Package virtual-mysql-server is not installed. Package mariadb-server-10.1 which provides virtual-mysql-server is to be removed. Package mariadb-server-10.2 which provides virtual-mysql-server is not installed. Package mysql-server is not installed. <...> The following packages have unmet dependencies: mariadb-server-10.2 : Depends: mariadb-client-10.2 (>= 10.2.19+maria~stretch) but it is not going to be installed Depends: mariadb-server-core-10.2 (>= 10.2.19+maria~stretch) but it is not going to be installed
Run the command below to correct them:
# apt --fix-broken install
If the command above fails with the following error:
CONFIG_TEXT: [...] Preparing to unpack .../mariadb-server-10.0_10.0.32-0+deb8u1_amd64.deb ... 47146 There is a MySQL server running, but we failed in our attempts to stop it. Stop it yourself and try again! dpkg: warning: subprocess old pre-removal script returned error exit status 1 dpkg: trying script from the new package instead ... 47146 There is a MySQL server running, but we failed in our attempts to stop it. Stop it yourself and try again! dpkg: error processing archive /var/cache/apt/archives/mariadb-server-10.0_10.0.32-0+deb8u1_amd64.deb (--unpack): subprocess new pre-removal script returned error exit status 1 insserv: warning: script 'apf' missing LSB tags and overrides Errors were encountered while processing: /var/cache/apt/archives/mariadb-server-10.0_10.0.32-0+deb8u1_amd64.deb E: Sub-process /usr/bin/dpkg returned an error code (1) [...]
Check this article: Plesk Update failed: There is a MySQL server running, but we failed in our attempts to stop it.
Check MySQL version:
# mysql -V mysql Ver 15.1 Distrib 10.2.19-MariaDB, for debian-linux-gnu (x86_64) using readline 5.2
Start the MariaDB service:
# service mariadb start
Note: It may be already started
Upgrade MySQL databases:
# MYSQL_PWD=`cat /etc/psa/.psa.shadow` mysql_upgrade -uadmin
Restart mysql service:
# service mariadb restart
Execute the following commands to update package version inside Plesk:
# plesk bin service_node --update local # plesk sbin packagemng -sdf Plesk on Ubuntu 18.04 Ubuntu 18.04 is shipped with MariaDB 10.1. MariaDB 10.x version is a drop-in replacement for MySQL 5.5-5.7. In order to upgrade MariaDB 10.1 to MariaDB 10.2, follow this steps: Create a backup of all databases with the following command:
# MYSQL_PWD=`cat /etc/psa/.psa.shadow` mysqldump -u admin --all-databases --routines --triggers > /tmp/all-databases.sql Stop the MariaDB service:
# service mariadb stop Install repositories from downloads.mariadb.org, for example qq:
Warning: Check the file ""/etc/apt/sources.list"" and the files inside directory ""/etc/apt/sources.list.d/"" and disable (comment with # at the beginning of the line) all MySQL repositories (e.g. MySQL 8 repository) to avoid installation of wrong MySQL versions by mistake.
# apt-get install software-properties-common # apt-key adv --recv-keys --keyserver hkp://keyserver.ubuntu.com:80 0xF1656F24C74CD1D8 # add-apt-repository 'deb [arch=amd64,arm64,ppc64el] http://mirror.truenetwork.ru/mariadb/repo/10.2/ubuntu bionic main' Create a backup of all MySQL data:
# cp -v -a /var/lib/mysql/ /var/lib/mysql_backup Start an upgrade with the following command. Leave all fields empty when asked for a root user password:
# apt-get install mariadb-server Start the MariaDB service:
# service mariadb start Upgrade MySQL databases:
# MYSQL_PWD=`cat /etc/psa/.psa.shadow` mysql_upgrade -uadmin Restart mysql service:
# service mariadb restart Execute the following commands to update package version inside Plesk:
# plesk bin service_node --update local # plesk sbin packagemng -sdf More information available in MySQL documentation at http://dev.mysql.com/.
Related Articles How to backup/restore all MySQL databases in Plesk for Linux
The Application Vault page or any application cannot be opened in Plesk: Can't open lib '/usr/lib/libmyodbc5.so'
Can't connect to local MySQL server through socket
Application Vault is not accessible: 502 Bad Gateway / WordPress installation hangs on 100%
"
0,"How to start or stop FTP service on a Plesk server Applicable to: Plesk for Linux
Plesk for Windows Question
How to check status, active/deactivate FTP service for the whole server?
Answer
Click on a section to expand For Linux FTP is working via the xinetd service. It is possible to start, stop, restart the service, as well as show its status and reload the settings (without actual restart of the service).
Manage service via Plesk interface: If 'systemctl' is unknown, use the commands below.
Manage service via SSH:
Connect to the server via SSH and use the following commands:
# service xinetd start
# service xinetd restart
# service xinetd status
For SystemD OSes:
# systemctl stop xinetd.service
# systemctl reload xinetd.service For Windows Manage service via Plesk interface:
Log in to Plesk GUI and go to Tools & Settings > Services Management - FTP Server Manage service via RDP:
Connect to the server via RDP and restart 'Microsoft FTP Service' in Windows Services console. "
4,"Application vault does not show any applications
Applicable to: Plesk Onyx for Linux
Plesk Onyx for Windows Symptoms Unable to see available applications in Plesk when accessing Domains > example.com > Applications > Available Applications. Instead of the applications list it shows:
CONFIG_TEXT: Your search did not match any apps. There is no available applications to install from the Application Vault in Subscriptions > example.com > Application: Cause
Option Provide only applications that I select enabled for the corresponding service plan or for customized subscription/webspace, however there is not any application added to the list of available applications.
Resolution Log into Plesk. Browse to one of the pages: Service Plans > service plan name > Applications tab Subscriptions > example.com > Customize > Applications tab: Add the necessary applications to the list Selected: Otherwise, disable option Provide only applications that I select, if it was checked by accident. "
5,"How to check if a scheduled backup is running via CLI?
Applicable to: Plesk Obsidian for Linux
Plesk Onyx for Linux Question
How to check if a scheduled backup is running or retrieve information via CLI?
Answer
Scheduled backup configuration
Note: Information about scheduled backups is kept in ""BackupsScheduled"" table of ""psa"" database.
Look for full server scheduled backup settings:
# plesk db ""select obj_id, obj_type, last, period, active, backup_time from BackupsScheduled where obj_type='server'"" +--------+----------+---------------------+--------+--------+-------------+ | obj_id | obj_type | last | period | active | backup_time | +--------+----------+---------------------+--------+--------+-------------+ | 1 | server | 2017-02-25 00:00:00 | 86400 | true | 06:30:00 | +--------+----------+---------------------+--------+--------+-------------+ 1 row in set (0.00 sec)
In order to find scheduled backup for a domain, domain ID should be found first:
# plesk db ""select id,name from domains where name='example.com'"" +----+----------------------------+ | id | name | +----+----------------------------+ | 94 | example.com | +----+----------------------------+
Use this ID to check scheduled backup task registered for the domain:
# plesk db ""select obj_id, obj_type, last, period, active, backup_time from BackupsScheduled where obj_id = 94"" +--------+----------+---------------------+--------+--------+-------------+ | obj_id | obj_type | last | period | active | backup_time | +--------+----------+---------------------+--------+--------+-------------+ | 94 | domain | 2017-08-28 20:55:53 | 604800 | true | 16:00:00 | +--------+----------+---------------------+--------+--------+-------------+
Note: Notice that ""period"" column describes if scheduled backup task is daily (86400), weekly (604800) or monthly (2592000). When backup task is launched
The ""backupmng"" is launched on scheduled time and checks if the following condition is met:
It starts backing up if current time is more than (BackupsScheduled.last + BackupsScheduled.period). Backup task status and result
The following sample command shows running backup processes: CentOS/RHEL: # grep ""Aug 30 16"" /var/log/cron | grep backupmng Aug 30 16:13:01 plesk CROND[31035]: (root) CMD ([ -x /usr/local/psa/admin/sbin/backupmng ] && /usr/local/psa/admin/sbin/backupmng >/dev/null 2>&1) Aug 30 16:28:01 plesk CROND[32121]: (root) CMD ([ -x /usr/local/psa/admin/sbin/backupmng ] && /usr/local/psa/admin/sbin/backupmng >/dev/null 2>&1) Debian/Ubuntu: # grep ""Aug 30 16"" /var/log/syslog | grep backupmng Aug 30 01:46:01 akhapaknysh CRON[29159]: (root) CMD ([ -x /opt/psa/admin/sbin/backupmng ] && /opt/psa/admin/sbin/backupmng >/dev/null 2>&1) Aug 30 02:01:01 akhapaknysh CRON[29203]: (root) CMD ([ -x /opt/psa/admin/sbin/backupmng ] && /opt/psa/admin/sbin/backupmng >/dev/null 2>&1) The latest scheduled task result can be checked in /var/lib/psa/dumps/domains/example.com/.discovered/backup_info_<date> directory."
7,"Is it possible to upgrade OS on the Plesk server? Applicable to: Plesk for Linux
Plesk for Windows Symptoms
Is it possible to upgrade OS on the Plesk server?
Resolution
Since Plesk 12.5, an Operating System upgrade is supported only for certain Operating Systems. For more information, check out the following article: How to perform dist-upgrade procedure on server with Plesk
For older versions, upgrade is not supported and not recommended. Consider migration via Plesk Migrator: Plesk Migration and Transfer Guide"
6,"How to check SQL Server connection without SQL Management Studio
Applicable to: Plesk for Windows Question
How to check SQL Server connection without SQL Management Studio?
Answer Create an empty file with .udl extension.
Double-click on it and specify all SQL server's credentials.
Click Test Connection .
"
2,"Opening menu ""Scheduled Tasks"" or ""Spam Filter"" on Plesk for Windows server fails: Error code -532462766
Applicable to:
Plesk Onyx for Windows
Symptoms On a Plesk for Windows server, accessing the menu Tools & Settings > Scheduled Tasks > Plesk Administrator or Tools & Settings > Spam Filter fails:
CONFIG_TEXT: crontabmng failed: (Error code -532462766) Running the utility ""%plesk_bin%\crontabmng.exe"" manually in the Command Prompt fails with the below error:
C:\> ""%plesk_bin%\crontabmng.exe"" --help Unhandled Exception: System.IO.FileNotFoundException: Could not load file or assembly 'psaobsolete.dll' or one of its dependencies. The specified module could not be found. at crontabmng.SchedulerFile.Main(String[] args) Creating or deleting a mailbox in Domains > example.com > Mail fails:
PLESK_ERROR: Internal error: Execution failed. Command: spammng Arguments: Array ( [0] => --list-languages ) Details: Exception has been thrown by the target of an invocation. Could not load file or assembly 'psaobsolete, Version=17.5.3.29301, Culture=neutral, PublicKeyToken=null' or one of its dependencies. The system cannot find the file specified. Message Execution failed. Command: spammng Arguments: Array ( [0] => --list-languages ) Details: Exception has been thrown by the target of an invocation. Could not load file or assembly 'psaobsolete, Version=17.5.3.29301, Culture=neutral, PublicKeyToken=null' or one of its dependencies. The system cannot find the file specified. File Os.php Line 138 Type PleskFatalException Cause
The library %plesk_bin%\psaobsolete.dll is not updated or missing.
Resolution Connect to the server using RDP. Download the package plesk-service-node-utilities.msi from https://autoinstall-win.plesk.com according to the installed Plesk version. For example: https://autoinstall-win.plesk.com/PANEL-WIN_17.5.3/dist-msi-Microsoft-2003-i386/plesk-service-node-utilities.msi. Start the Command Prompt as an Administrator. Create a temporary folder and unpack the downloaded package plesk-service-node-utilities.msi:
C:\> mkdir C:\plesk_tmp C:\> msiexec /a plesk-service-node-utilities.msi /qb TARGETDIR=C:\plesk_tmp Backup the original file %plesk_bin%\psaobsolete.dll and replace it with the one from the downloaded package:
C:\> copy ""%plesk_bin%\psaobsolete.dll"" ""%plesk_bin%\psaobsolete.dll_backup"" C:\> copy ""C:\plesk_tmp\Program Files\Parallels\Plesk\admin\bin\psaobsolete.dll"" ""%plesk_bin%\psaobsolete.dll"" "
7,"How to verify that Plesk is upgraded or installed successfully?
Applicable to: Plesk 12.0 for Linux
Plesk 12.0 for Windows
Plesk Onyx for Linux
Plesk Onyx for Windows Question
How to verify that Plesk is upgraded or installed successfully?
Answer
The following message should be in upgrade log in a browser or in the /var/log/plesk/install/autoinstaller3.log file:
CONFIG_TEXT: Components and product check results:Upgrade is finished Congratulations! The upgrade has been finished. Plesk is now running on your server
More information about Plesk upgrade can be found in Plesk documentation.
Note: On Plesk for Windows, logs are located in C:\ParallelsInstaller\autoinstaller3.log
You can check installed components by the following ways in Plesk Interface: Go to Tools & Settings > Server Components and verify installed components
Go to Tools & Settings > Updates and Upgrades "
0,"How to renew expired SSL certificate on Plesk?
Applicable to: Plesk for Linux
Plesk for Windows Question
When Plesk or another site is opened via HTTPS, a warning is displayed regarding an expired certificate.
How to renew this certificate?
Answer
Plesk offers multiple ways of renewing and using SSL certificates. It has Let's Encrypt extension that allows using free SSL certificates for domain and its aliases. The extension is capable of self-renewing the certificates, so there is no need to worry about manual renewals. See the following article to learn how to install and use Let's Encrypt certificates:
How to install SSL certificate for a domain in Plesk In case the certificate is purchased from some certificate center (for example from Comodo) and certificate expired, get in contact with the certificate issuer and get the renewed version of the cert. After that, upload the certificate via Tools & Settings > SSL/TLS certificates (server level) or via example.com > SSL/TLS certificates (domain level).
If self-signed certificate is used, generate a new one using instructions from the following documentation: Securing Plesk and the Mail Server With a Self-Signed Certificate"
2,"Unable to open/rename file in File Manager on Plesk server: Access denied
Applicable to: Plesk for Windows Symptoms Cannot open PHP Info page atDomains > example.com > PHP Settings > View the phpinfo() page:
CONFIG_TEXT: Server Error 500 PleskUtilException Access denied Unable to install Let's Encrypt certificate for a domain in Plesk with error below:
PLESK_ERROR: Status: 403 Detail: The key authorization file from the server did not match this challenge Website may be inaccessible with:
CONFIG_TEXT: 500 Internal server error One of the errors below can be observed with Plesk File Manager: Cannot change file permissions at Domains > example.com > File Manager:
PLESK_ERROR: filemng failed: Unable to get the object (C:\Inetpub\vhosts\example.com\httpdocs\path\file) security info: (5) Access is denied. Unable to access file or directory in File Manager with the following error:
PLESK_ERROR: Unable to open the directory: Unable to find the directory C:\Inetpub\vhosts\example.com\httpdocs: Access denied Unable to create zip archive in File Manager:
PLESK_ERROR: Unable to create the archive: 7-Zip [32] 16.04 %plesk_vhosts%\example.com\httpdocs\archive.zip Items to compress: 14161 WARNING: Access is denied WARNING: Cannot open 13 files at (CreateZip::onRunAsUser line 2783). Unable to rename/create file(or directory)/access domain's document root in File Manager with the following error:
PLESK_ERROR: Unable to find the directory C:\Inetpub\vhosts\example.com: Access denied 'Change Permissions' option in File Manager shows all the boxes are unmarked for the subscription system user, the permissions get automatically reset Cause
The system user does not have permissions to access subscription directories or incorrect security settings in %plesk_vhosts%example.com\.plesk\.Security file.
Resolution Connect to the server using RDP.
Note: if direct RDP access to the server is not possible, contact server administrator for further assistance. Rename the .Security file to .Security.bak in %plesk_vhosts%example.com\.plesk directory. Open Command Prompt as Administrator and execute the following command:
C:\> ""%plesk_cli%\repair.exe"" --repair-webspace-security -webspace-name example.com -all-filesystem-objects If there is %plesk_dir%\etc\DiskSecurity\permissions.xml file for customizing permissions, review the file and remove the folders of the domain in question "
8,"How to change the mail queue lifetime for Postfix Applicable to: Plesk for Linux Question
In some cases, mail gets stuck for 5 days filling up the mail queue. How to change the mail queue lifetime for Postfix?
Answer
By default, Postfix will keep trying to deliver mail for 5 days. The number of days is defined by the Postfix maximal_queue_lifetime parameter. To change this limit: Connect to a server via SSH. Run the command below specifying the number of days. In this example, we are setting the limit to 1 day:
# postconf -e 'maximal_queue_lifetime = 1d'
Note: Specify 0 when mail delivery should be tried only once. Verify the changes:
# postconf | grep maximal_queue_lifetime maximal_queue_lifetime = 5d
Note: Postfix service restart is not required. "
4,"MySQL error in Plesk for Linux: Column count of mysql.user is wrong. Please use mysql_upgrade to fix this error Applicable to: Plesk for Linux Symptoms Plesk upgrade fails with a similar to the below error message:
CONFIG_TEXT: ERROR while trying to upgrade APSC SQL database from 11.1.0 Check the error reason(see log file: /var/log/plesk/install/plesk_XX.X.XX_repair.log), fix and try again
In the mentioned above error logfile, the following error message appears:
CONFIG_TEXT: ERROR 1558 (HY000) at line 67: Column count of mysql.proc is wrong. Expected 20, found 16. Created with MySQL 50095, now running 50538. Please use mysql_upgrade to fix this error. It is not possible to create a database in Plesk or install WordPress with the error message below. In some cases, other actions may lead to the same error, e.g., WordPress installation, new PHP handler installation, password reset:
PLESK_INFO: Connection to the database server failed: Column count of mysql.user is wrong. Expected 42, found 39. Created with MySQL 50173, now running 50556. Please use mysql_upgrade to fix this error. Unable to create a database user or database or reconnect a database server at Tools & Settings > Database servers > db_server > OK:
PLESK_ERROR: Column count of mysql.user is wrong. Expected 45, found 48. The table is probably corrupted Plesk backup finishes with warnings:
PLESK_INFO: Warning: mysql ""db_example"" Not all the data was backed up into /var/lib/psa/dumps/domains/example.com/databases/db_example_1 successfully. Total space: 200.00 GB; Available space: 150.00 GB; Mounted on: /. mysqldump: Couldn't execute 'SHOW FUNCTION STATUS WHERE Db = 'db_example'': Column count of mysql.proc is wrong. Expected 21, found 20. Created with MariaDB 100134, now running 100313. Please use mysql_upgrade to fix this error (1558) Cause
The mysql.user table has an incorrect schema.
Resolution Connect to the server via SSH. For security reasons, create a backup of the /var/lib/mysql directory:
Note: This step is not required if you have a full server backup/snapshot to restore.
2.1. Stop the MySQL server (The command depends on OS and installed MySQL server):
# service mysqld stop # service mysql stop # service mariadb stop
2.2. Copy the directory (Make sure that there is enough disk space on the server using the command df -h):
# cp -rp /var/lib/mysql/ /root/
2.3. Start the MySQL server:
# service mysqld start # service mysql start # service mariadb start Upgrade MySQL databases:
# MYSQL_PWD=`cat /etc/psa/.psa.shadow` /usr/bin/mysql_upgrade -uadmin --force "
2," How to make Plesk interface accessible over a hostname without entering the port number
Applicable to: Plesk for Linux
Plesk for Windows Question
How to make Plesk interface accessible over a hostname without entering the port number? For example, https://server.example.com.
Answer
Note: server.example.com should resolve to the server IP address (A and AAAA records should exist in DNS settings)
Warning: As nobody should enter credentials in a non-secure form (HTTP), this method works only if the domain is being accessed through HTTPs protocol.
Plesk Obsidian
All new Plesk Obsidian servers have this feature enabled by default, while on upgraded servers this feature should be enabled.
Note: If an existing in Plesk domain is going to be used as an entry point to Plesk, make sure that the Permanent SEO-safe 301 redirect from HTTP to HTTPS option is enabled at Domains > example.com > Hosting Settings and a valid SSL certificate is used. via Plesk Log in to Plesk. Go to Tools & Settings > Customize Plesk URL. Specify the domain that will be used as an entry point to Plesk. Save the changes. via a command-line interface Connect to the Plesk server via SSH. Use the commands:
# plesk bin admin --enable-access-domain ""server.example.com""
In this case, if there is a website with the specified name, it will become inaccessible because Plesk panel will be shown.
# plesk bin admin --enable-access-domain """"
In this case, the panel will be accessible on any domain hosted on Plesk and not having website and via IP address on HTTPS.
# plesk bin admin --disable-access-domain
In this case, the feature will be disabled. Plesk will be accessible via default port 8443 only. Plesk Onyx for Linux via a command-line interface Notes: Apache + nginx Apache + nginx is the only configuration that supports the scenario. Any other configuration (for example, when LiteSpeed Web Server is used) is not supported. Plesk + WHMCS If Plesk is used under WHMCS and configuration described below is applied, then login from WHMCS to Plesk will not work. For more information, visit: WHMCS Module: Is it possible to login to Plesk UI using hostname without port
Warning: Fail2ban will be unable to prevent brute-force attempts because an IP address of a client will be 127.0.0.1, which is white-listed by default in Fail2ban configuration. Enable nginx as a reverse-proxy web-server. In Plesk, create a subscription with desired domain name (usually, the hostname). This domain should be resolved from the Internet. In this example, 'server.example.com' is used. Enable the option Permanent SEO-safe 301 redirect from HTTP to HTTPS at Domains > server.example.com > Hosting Settings: Un-check PHP support at Domains > server.example.com > PHP Settings and apply the changes. Go to Domains > server.example.com > Apache & nginx setting > scroll down to the Additional nginx directives field and add the following lines:
Note: The proxy_pass directive should contain an IP address of the domain.
CONFIG_TEXT: location ~ ^/(?!.well-known).*$ { proxy_pass https://203.0.113.2:8443; port_in_redirect off; proxy_set_header Host $host; client_max_body_size 2048m; } proxy_buffer_size 128k; proxy_buffers 4 256k; proxy_busy_buffers_size 256k; Apply the changes. "
3,"Plesk websites are inaccessible with 504 Gateway Timeout with enabled firewall: : Connection timed out
Applicable to: Plesk for Linux Symptoms If Nginx is enabled, all sites return the following error: CONFIG_TEXT: 504 Gateway Timeout error CONFIG_TEXT: 502 Bad gateway Fail2ban is not installed or disabled;
Apache and nginx services are running;
There are the following records in /var/log/httpd/error_log:
CONFIG_TEXT: upstream timed out (110: Connection timed out) while reading response header from upstream There are the following records in /var/www/vhosts/example.com/logs/proxy_error_log:
CONFIG_TEXT: 2018/01/25 07:41:57 [error] 18625#0: *8 connect() failed (111: Connection refused) while connecting to upstream Cause
Firewall blocks local connection on port 7080 and 7081, so Nginx is unable to connect to Apache.
Resolution Install Plesk Firewall if it is not installed How to install Plesk Firewall Go to Plesk > Tools & Settings > Firewall > Modify Plesk Firewall Rules >Add Custom Rule and allow 7080/7081 ports for all internal IP addresses for Incoming/Outgoing. Click on a section to expand Adding rules directly from the server To do this manually, connect to the server via SSH
Note: if direct SSH access to the server is not possible, contact server administrator for further assistance. Add rules using the commands below:
# iptables -A INPUT -s 10.10.10.10 -p tcp -m tcp --dport 7081 -j ACCEPT # iptables -A INPUT -s 10.10.10.10 -p tcp -m tcp --dport 7080 -j ACCEPT # iptables -A OUTPUT -s 10.10.10.10 -p tcp -m tcp --sport 7081 -j ACCEPT # iptables -A OUTPUT -s 10.10.10.10 -p tcp -m tcp --sport 7080 -j ACCEPT "
7,"How to convert CentOS installation to CloudLinux and install Plesk on it?
Applicable to:
Plesk for Linux
Question
How to convert CentOS installation to CloudLinux and install Plesk on it?
Answer Convert CentOS to CloudLinux using Official CloudLinux documentation: CloudLinux Documentation: Converting existing servers Installing on CentOS server with Plesk Once CloudLinux is installed, install Plesk: How to Install Plesk for Linux "
8,"Messages are not delivered: [552] Relay Denied: Failed to meet all relay criteria. Applicable to: Plesk 11.x for Windows Plesk 10.x for Windows Plesk 12.0 for Windows Plesk 12.5 for Windows Symptoms Auto-responder is not working or is not sending email messages to a specific domain. MailEnable SMTP debug log (located in %plesk_dir%Mail Servers\Mail Enable\Logging\SMTP\) contains the following error:
CONFIG_TEXT: [552] Relay Denied: Failed to meet all relay criteria. Attempt to relay to [SMTP:mailbox@example.com] was denied for requesting IP Address 203.0.113.2 Cause
The 203.0.113.2 IP address does not have relay rights.
Resolution Connect to the server via RDP; Open MailEnable > Servers > Localhost > Connectors > SMTP > Properties > Relay tab and ensure that Allow relay for privileged IP ranges option is enabled: Add server IP 203.0.113.2 to Privileged IPs list. Additional Information
How to send mail from an application or web page"
6,"Unable to log in to Plesk: Unable to connect to database: mysql_connect(): Permission denied /var/lib/mysql/mysql.sock
Applicable to: Plesk for Linux Symptoms Unable to log in to Plesk, the following error appears:
CONFIG_TEXT: ERROR: PleskDBException: Unable to connect to database: mysql_connect(): Permission denied /var/lib/mysql/mysql.sock (Error code: 2002). CONFIG_TEXT: ERROR: Uncaught exception 'PDOException' with message 'SQLSTATE[HY000] [2002] Permission denied' in /usr/local/psa/admin/externals/Zend/Db/Adapter/Pdo/Abstract.php Unable to start mariadb service with the following error:
CONFIG_TEXT: systemd[1]: Starting MariaDB database server... mariadb-prepare-db-dir[4030]: chmod: changing permissions of Б─≤/var/lib/mysqlБ─≥: Operation not permitted mariadb-prepare-db-dir[4030]: Initializing MySQL database mariadb-prepare-db-dir[4030]: chown: changing ownership of Б─≤/var/lib/mysqlБ─≥: Operation not permitted mariadb-prepare-db-dir[4030]: Cannot change ownership of the database directories to the 'mysql' mariadb-prepare-db-dir[4030]: user. Check that you have the necessary permissions and try again. mariadb-prepare-db-dir[4030]: Initialization of MySQL database failed. Unable to access MySQL database. The following error appears if trying to log in to database using mysqlutility:
CONFIG_TEXT: ERROR 1018 (HY000): Can't read dir of './db-name/' (errno: 13) The permissions of /var/lib/mysql/ are different from listed below:
# ls -ld /var/lib/mysql drwxr-xr-x 5 mysql mysql 4096 Apr 20 13:05 /var/lib/mysql Cause
Incorrect permissions for /var/lib/mysql/ directory and its subdirectories.
Resolution Log in to the server via SSH;
Note: if direct SSH access to the server is not possible, contact server administrator for further assistance. Set proper owner to the directory and files:
# chown -R mysql:mysql /var/lib/mysql # find /var/lib/mysql/* -type d -exec chmod 0700 {} \; # find /var/lib/mysql/* -type f -exec chmod 0660 {} \;
For Debian/Ubuntu
# chmod 700 /var/lib/mysql
For RHEL/CentOS
# chmod 755 /var/lib/mysql "
2,"How to reconfigure the PleskControlPanel website in IIS
Applicable to: Plesk for Windows Question
How to reconfigure the PleskControlPanel website in IIS > Sites?
Answer
The website PleskControlPanel in IIS is used to serve the Plesk user interface.
To reconfigure PleskControlPanel website apply the following steps: Recreating PleskControlPanel on Plesk Onyx and Obsidian Connect to the server via RDP. Open Command Prompt as administrator. Execute the following commands:
C:\> ""%plesk_bin64%""\websrvmng.exe --configure-anonymous-access
C:\> ""%plesk_bin64%""\websrvmng.exe --remove-sites-cache
C:\> ""%plesk_bin64%""\websrvmng.exe --configure-plesk-website Reconfiguring PleskControlPanel on Plesk 12.5 and newer Connect to the server via RDP. Delete the PleskControlPanel website from IIS > Sites. Launch Plesk Reconfigurator > Repair Plesk installation > Plesk Services as administrator. "
5,"Content cannot be listed via FTP on Plesk server
Applicable to: Plesk for Linux Symptoms Plesk server is behind NAT and have several IP addresses configured. FTP directory listing is working on the shared IP and not the dedicated IP. Attempt to list the content fails with the following error:
CONFIG_TEXT: ftp> ls 421 Service not available, remote server has closed connection Passive mode refused. /etc/proftpd.conf or /etc/proftpd.d/50-plesk.conf has MasqueradeAddress configured:
# grep -r Masq /etc/proftpd* MasqueradeAddress 203.0.113.2 Cause ProFTPd MasqueradeAddress configured on the server with several IP. MasqueradeAddress instruct FTP server advertise defined IP to FTP clients and they attempt to establish a connection to this address. Resolution Connect to the server via SSH;
Remove MasqueradeAddress from /etc/proftpd.conf or /etc/proftpd.d/50-plesk.conf Note: If this does not help, contact the network administrator or ISP to resolve the issue with the firewall."
6," Troubleshooting slow performance of the MySQL on Plesk server
Applicable to: Plesk for Linux
Plesk for Windows Symptoms Server is slow due to high CPU usage caused by the ""mysql"" process. According to this KB article there are multiple slow queries. Websites that are using MySQL databases operate slow. Database dump takes too much time to complete. Cause
The MySQL server is not tuned for optimal performance.
Troubleshooting
General Troubleshooting
Note: Database performance tuning is out of the scope of Plesk Free Technical Support.
Allocate RAM to the MySQL server:
Note: Increasing values may affect server performance. Make sure that there is enough RAM. Connect to the Plesk server via SSH or RDP. Open the MySQL configuration file my.cnf or my.ini in any text editor. Locations of the file are: for CentOS/RHEL:
CONFIG_TEXT: /etc/my.cnf for Debian/Ubuntu:
CONFIG_TEXT: /etc/mysql/my.cnf For Windows:
CONFIG_TEXT: %plesk_dir%Databases\MySQL\my.ini Add the following directives under the [mysqld] section or increase the values if these directives are already defined:
CONFIG_TEXT: innodb_buffer_pool_size=1024M query_cache_size=64M Save the changes and close the file. Restart the MySQL service: for CentOS/RHEL:
# service mysqld restart for Debian/Ubuntu:
# service mysql restart for Windows:
Open Task Manager > Services and restart MySQL56 (or MySQL51) service: Monitor CPU usage.
If CPU consumption increases again, consider reviewing the SQL code of a database that has slow queries. During a high level of CPU usage, find queries that are currently running and taking a lot of time:
# plesk db ""SHOW FULL PROCESSLIST"" +-----+-------+-----------+------+---------+------+-------+-----------------------+ | Id | User | Host | db | Command | Time | State | Info | +-----+-------+-----------+------+---------+------+-------+-----------------------+ | 12 | admin | localhost | psa | Sleep | 6763 | | NULL | | 100 | admin | localhost | psa | Query | 0 | NULL | SHOW FULL PROCESSLIST | +-----+-------+-----------+------+---------+------+-------+-----------------------+ 2 rows in set (0.00 sec) Check the MySQL error logfile /var/log/mysqld.log for errors. Check RAM and free disk space:
# free -h # df -h Find databases that cause slow MySQL performance by enabling the MySQL slow query log.
Note: With Repair Kit, it is possible to see the list of processes currently being handled by the local MySQL server. To do so, go to Tools & Settings > MySQL Process List (Beta) (under Assistance and Troubleshooting). Click a MySQL process to see its details: what queries are being processed and how much resources they consume. Advanced troubleshooting Analyze and optimize all tables in all databases: for Linux:
# MYSQL_PWD=`cat /etc/psa/.psa.shadow` mysqlcheck -uadmin --optimize --all-databases for Windows:
C:\> %plesk_dir%\MySQL\bin\mysqlcheck.exe -uadmin -P3306 --optimize --all-databases
Note: For accessing MySQL in Windows, it is required to add the line skip-grant-tables right under [mysqld] in %plesk_dir%Databases\MySQL\my.ini and restart MySQL service, as it is shown above. Do not forget to remove it and restart again after all is done. Install and run the mysqltuner utility. This utility will analyze the current MySQL server instance and provide recommendations for adjusting appropriate parameters. Linux version is available at: http://mysqltuner.com Windows version is available at: https://mysqltuner.codeplex.com "
0,"Is it possible to assign a different IP address to a subdomain hosted in Plesk?
Applicable to: Plesk for Linux
Plesk for Windows Question
How to assign a different IP address for an additional domain/subdomain hosted in Plesk?
Answer
In Plesk, IP address can be set for the whole subscription only meaning all domains under this subscription (main domain and add-on domains) will have the same IP address.IP addresses cannot be set for additional domains/subdomains separately from the main domain."
8,"MailEnable webmail shows 503 Service Unavailable: Application pool MailEnableAppPool has been disabled
Applicable to: Plesk Onyx 17.8 for Windows Symptoms MailEnable webmail shows error:
CONFIG_TEXT: HTTP Error 503 Service Unavailable. Error in Event Viewer > Windows Logs > System:
CONFIG_TEXT: Application pool MailEnableAppPool has been disabled. Windows Process Activation Service (WAS) encountered a failure when it started a worker process to serve the application pool. The following detailed error can be shown in:
CONFIG_TEXT: HTTP Error 401.2 - Unauthorized Module IIS Web Core Error Code 0x80070005 Physical Path C:\Program Files (x86)\Parallels\Plesk\Mail Servers\Mail Enable\Bin\NETWebMail Error in Event Viewer > Application:
CONFIG_TEXT: The identity of application pool MailEnableAppPool is invalid. The user name or password that is specified for the identity may be incorrect, or the user may not have batch logon rights. If the identity is not corrected, the application pool will be disabled when the application pool receives its first request. If batch logon rights are causing the problem, the identity in the IIS configuration store must be changed after rights have been granted before Windows Process Activation Service (WAS) can retry the logon. If the identity remains invalid after the first request for the application pool is processed, the application pool will be disabled. The data field contains the error number Cause
All system user credentials/profiles are removed after running sysprep, including the IIS user and the application pool user of MailEnable webmail.
Resolution Text instructions Connect to Plesk server via RDP Check that MailEnable WebMail website status in IIS Manager > Sites. Start it if it is stopped. Run MailEnable installer:
C:\> ""%plesk_dir%\Mail Servers\Mail Enable\Bin\MEInstaller.exe""
OR
C:\> C:\Program Files (x86)\Mail Enable\Bin\NETInstaller.exe"" Select the second option - ""Web application reconfigure (...)"" Give a random password for the MailEnable service accounts and press Next when prompted Select the fourth option ''Re-Register Administration (MCC) Components'' Select the thirteenth option ''Set .NET Framework version for web applications'' and click Apply when prompted Restart IIS: C:\> iisreset Additional information
If the issue persists, check this article."
2,"Unable to create an additional domain or a subdomain inside a subscription in Plesk for Windows Server: skelmng failed: Access is denied. (Error code 5) Applicable to: Plesk for Windows Symptoms When creating an additional domain or a subdomain inside an existing subscription, the operation fails with:
PLESK_ERROR: Error: skelmng failed: Access is denied. (Error code 5) at CreateDirectory(C:\Inetpub\vhosts\example.com\sub.example.com\css)...(Error code 1)
OR
PLESK_ERROR: Error: skelmng failed: Access is denied. (Error code 5) at retrieves attributes for file or directory C:\Inetpub\vhosts\example.com\sub.example.comat (fileExist line 90)(vconsoleapp::run line 117)(Error code 1) Cause
Web-space (subscription) security settings are corrupted.
Resolution Connect to the Plesk server via RDP. Start a command prompt as an Administrator. In the commands below, replace example.com with an affected subscription name and run: Repair the web-space security settings of the subscription:
C:\> ""%plesk_cli%\repair.exe"" --repair-webspace-security -webspace-name example.com Reconfigure subscription:
C:\> ""%plesk_cli%\repair.exe"" --reconfigure-web-site -web-site-name example.com Try to create an additional domain or a subdomain again.
Note: If all subscriptions in Plesk are affected, apply the solution from this KB article. "
4,"Installing application in Plesk from Application Vault or via CLI hangs at 0%
Applicable to: Plesk for Linux
Plesk for Windows Symptoms When installing or updating (if already installed) an application like WordPress either from Tools and Settings > Application Vault or from Domains > example.com > Applications a progress bar is shown but never changes from 0% Checking the longtasks table in the database, stuck tasks can be seen: # plesk db ""select * from longtasks where status <> 'done'"" +---------------------+----+--------------+---------+-----------------+---------+----------------+----------------+-------------+---------------+---------------------+-----+------------+ | startTime | id | type | status | statusProcessed | context | progressStatus | progressParams | progressMax | progressValue | finishTime | pid | externalId | +---------------------+----+--------------+---------+-----------------+---------+----------------+----------------+-------------+---------------+---------------------+-----+------------+ | 2018-11-06 17:37:04 | 76 | aps-download | started | 0 | NULL | queue | NULL | 100 | 0 | 0000-00-00 00:00:00 | 0 | NULL | | 2018-11-06 17:37:05 | 77 | aps-download | started | 0 | NULL | queue | NULL | 100 | 0 | 0000-00-00 00:00:00 | 0 | NULL | +---------------------+----+--------------+---------+-----------------+---------+----------------+----------------+-------------+---------------+---------------------+-----+------------+ Trying to work with applications through CLI such as downloading a package can be executed successfully but the process does does not finish:
# plesk bin aps -d -package-name mediawiki The task to download APS package started. Task id: 77
# plesk bin aps -g 77 The task is in progress. total: 100 completed: 0 The task is current. Cause
Stuck tasks in the psa.longtasks table.
Resolution Connect to the server via SSH or via RDP Backup the psa database by following the instructions form the article How to backup/restore a Plesk database dump? Log into MySQL and access the psa database:
# plesk db Delete stuck long tasks tasks:
MYSQL_LIN: mysql> delete from longtasks where status <> 'done'; "
7,"How to upgrade MailEnable to a newer version on Plesk server
Applicable to: Plesk for Windows Question
How to upgrade MailEnable to a newer version?
Answer Upgrading MailEnable on Plesk - How to Upgrade MailEnable on a Plesk Platform Details about backing up mail server data - ME020024 - HOWTO: How to backup and restore MailEnable configuration and user data Note: upgrade to Professional or Enterprise version requires a paid license key which should be bought from MailEnable directly. After buying a license key and applying it, the functionality of the upgraded version will be automatically unlocked."
0,"Domains were deleted from Plesk by mistake. Is there any way to find the user who performed this?
Applicable to: Plesk for Windows
Plesk for Linux Question
Domains were deleted from Plesk by mistake. Is there any way to find the user who performed this?
Answer
All operations performed in Plesk can be found in Plesk Action Log. It includes time, login, IP address, etc. Log into Plesk and go to Tools & Settings > Action Log.
Specify the assumed timeframe (when the item was removed) and click Download. Look though the log and find an entry like the following:
CONFIG_TEXT: 203.0.113.2 johndoe [2018-07-13 15:58:47] 'Delete additional domain' ('Client GUID': '73512902-73ec-4ce5-b826-0006090b9e56' => '', 'Domain GUID': 'e1cba795-d13e-4a76-8670-45ca01a343d9' => '', 'Domain Name': 'example.com' => '', 'Login Name': 'johndoe' => '') "
6,"Unable to start MySQL on Linux: unknown variable
Applicable to: Plesk for Linux Symptoms Plesk login page is unavailable:
CONFIG_TEXT: ERROR: PleskDBException: Unable to connect to database: mysql_connect(): No such file or directory /var/lib/mysql/mysql.sock (Error code: 2002). Please check that database server is started and accessible. (Abstract.php:69) MySQL fails to start. While attempt to start MySQL similar to the below error appears in the /var/log/mysqld.log or in /var/log/mariadb/mariadb.log with reference to different variable:
CONFIG_TEXT: [ERROR] /usr/libexec/mysqld: unknown variable 'set-variable=local-infile=0'[ERROR] Aborting Cause File /etc/my.cnf contains unsupported variable. Misspelling in variable name. Resolution Connect to the server via SSH; Check that variable name is set correctly in /etc/my.cnf; If the issue persists, comment the line with variable name in /etc/my.cnf file under [mysqld] section. Start MySQL service or restart if it is already running:
# service mysqld restart
or
# service mariadb restart "
2,"Unable to access Plesk: /usr/local/psa/admin/logs/panel.log cannot be opened with mode ""a"" Applicable to: Plesk for Linux Symptoms
Unable to access Plesk. The following error is shown:
PLESK_INFO: ERROR: Zend_Log_Exception ""/usr/local/psa/admin/logs/panel.log"" cannot be opened with mode ""a""
Cause
The owner for Plesk log file /var/log/plesk/panel.log is not correct.
Resolution Connect to the server via SSH; Rename the current /var/log/plesk/panel.log:
# mv /var/log/plesk/panel.log{,.bak} Restart sw-engine and sw-cp-server services:
# service sw-engine restart && service sw-cp-server restart If the issue persists, correct permissions to the following folders:
# chmod 0755 /var/log/ # chown psaadm /var/log/plesk/ "
3,"Apache modules are loaded twice in Plesk for CentOS/RHEL: [warn] module is already loaded
Applicable to: Plesk for Linux Symptoms
Apache configuration checker shows warnings:
# httpd -tAH01574: module actions_module is already loaded, skippingAH01574: module headers_module is already loaded, skippingAH01574: module logio_module is already loaded, skippingAH01574: module suexec_module is already loaded, skippingAH01574: module fcgid_module is already loaded, skippingSyntax OK
Cause
Apache modules are defined twice in Apache configuration files. Example:
# grep actions_module -rI /etc/httpd/* /etc/httpd/conf/httpd.conf:LoadModule actions_module /usr/lib64/httpd/modules/mod_actions.so/etc/httpd/conf.modules.d/00-base.conf:LoadModule actions_module modules/mod_actions.so
It does not affect Apache operability.
Resolution Connect to a Plesk server via SSH. Find in which files the module is duplicated. For example:
# grep actions_module -rI /etc/httpd/* /etc/httpd/conf/httpd.conf:LoadModule actions_module /usr/lib64/httpd/modules/mod_actions.so/etc/httpd/conf.modules.d/00-base.conf:LoadModule actions_module modules/mod_actions.so Open the file /etc/httpd/conf/httpd.conf in a text editor and comment a duplicated module with a hash symbol ""#"":
CONFIG_TEXT: # LoadModule actions_module /usr/lib64/httpd/modules/mod_actions.so Make sure that only one module is now commented out:
# grep actions_module -ir /etc/httpd/* Apply the same steps for other duplicated modules. Reload Apache:
# service httpd reload Related Articles Error message on the Home page in Plesk: module unique_id_module is already loaded, skipping
"
0,"How to install and enable nginx reverse proxy on a Plesk for Linux server Applicable to: Plesk for Linux Question
How to install and enable nginx reverse proxy on a Plesk for Linux server?
Answer
After enabling nginx reverse proxy on a Plesk server, it will be used in combination with Apache. To learn more about how nginx reverse proxy works with Apache, visit the following Plesk documentation page: Plesk Administrator's Guide: Apache with nginx Installing end enabling nginx reverse proxy via the Plesk interface Install the nginx reverse proxy component:
Note: Make sure that port 8447 is opened in firewall. If it is closed and cannot be opened, use the command-line instructions.
1.1. In Plesk, go to Tools & Settings and click Updates and Upgrades. 1.2. On the Updates and Upgrades page, click Add/Remove Components. 1.3. On the Add/Remove Components page, expand Web hosting and select Nginx web server for installation. Click Continue to begin the installation. Once the component is installed, enable the nginx reverse proxy service in Plesk:
2.1. Go to Tools & Settings > Services Management.
2.2. Click the button next to Reverse Proxy Server (nginx) once and wait. The process will take some time to configure. Installing end enabling nginx reverse proxy via a command-line interface Connect to a Plesk server via SSH. Install the nginx reverse proxy component using the following command:
# plesk installer --select-release-current --install-component nginx Manage nginx reverse proxy: To check the current status of nginx reverse proxy:
# /usr/local/psa/admin/sbin/nginxmng --status To enable the nginx reverse proxy service, run:
# /usr/local/psa/admin/sbin/nginxmng --enable To disable the nginx reverse proxy service, run:
# /usr/local/psa/admin/sbin/nginxmng --disable Note: The start and stop operations for nginx reverse proxy listed above switch the nginx web-server configuration for all domains in Plesk. This might cause a website downtime for a short period of time. Related Articles How to switch a domain to nginx-only hosting in Plesk
How a combination of Apache and nginx in proxy mode works
"
0,"How to enable ASP.NET 3.5 / ASP.NET 4.6 in Plesk for Windows Server
Applicable to: Plesk for Linux
Plesk for Windows Question
There is no ASP.NET 2.0 / ASP.NET 3.5 / ASP.NET 4.5 in Plesk at Domains > example.com > Hosting Settings > Microsoft ASP.NET support.
How to enable ASP.NET 2.0 / ASP.NET 3.5 / ASP.NET 4.5?
Answer
On Windows Server 2012 and later: ASP.NET 2.0 and ASP.NET 3.0 are included in ASP.NET 3.5. ASP.NET 4.5 and ASP.NET 4.7 are included in ASP.NET 4.6. Follow the these steps to enable ASP.NET versions: Connect to the server via RDP. Start Server Manager at Start menu > All Programs. In Server Manager, click Manage > Add Roles and Features. In Server Roles, expand Web Server (IIS) > Web Server > Application Development and select required components for installation: ASP.NET 3.5 and .NET Extensibility 3.5 ASP.NET 4.6 and .NET Extensibility 4.6 In Features, select .NET Framework 3.5 Features / .NET Framework 4.6 Features: Click Next and Install. Once the installation is completed, in Plesk go to Tools & Settings > Server Components and click Refresh to detect ASP.NET 3.5 or ASP.NET 4.6. Verify that ASP.NET 3.5 / ASP.NET 4.6 is shown in the components list under Web Scripting. The installed ASP.NET versions will now appear for selection at Domains > example.com > Hosting Settings > Microsoft ASP.NET support. Additional Information
Plesk Onyx and Obsidian support .NET versions 2.0 - 4.x. (including .NET 4.5, 4.6, 4.7 and 4.8 ). ASP.NET MVC is supported as well."
8,"Unable to change maximum message size: ""message size limit (X) must not be greater than the mailbox size limit (Y)""
Applicable to: Plesk for Linux Symptoms It is not possible to increase Maximum message size limit in Tools & Settings > Mail Server Settings, following error is displayed:
PLESK_INFO: mailmng-server failed: message size limit (25600000) must not be greater than the mailbox size limit(20480000)
OR
PLESK_INFO: PleskUtilExceptionmessage size limit (25600000) must not be greater than the mailbox size limit(20480000) mailbox_size_limit is set to a non-zero value in Postfix configuration:
# postconf mailbox_size_limitmailbox_size_limit = 20480000 Cause
Message size cannot be greater than the value of mailbox_size_limit parameter defined in Postfix configuration.
Resolution Connect to the server via SSH; Remove mailbox_size_limit by setting it to the zero:
# postconf -e mailbox_size_limit=0
Note: By default this parameter is and should be set to zero, which means no limitations on mailbox size from the Postfix side: the limitations should be enforced by Plesk instead. Log into Plesk Navigate to the Tools & Settings > Mail Server Settings Set the required Maximum message size and click on Ok Additional information
The message cannot be received: 552 5.3.4 Message size exceeds fixed limit Mail is rejected with MAILBOX IS FULL message even when mailbox was cleaned up"
0,"Unable to connect to Plesk FTP: unknown configuration directive Applicable to: Plesk for Linux Symptoms RHEL 6, or 7 or distribution based on it (CloudLinux, CentOS) in installed on the server Unable to connect to FTP. The following error is displayed on attempt:
PLESK_INFO: 421 Service not available, remote server has closed connection At the same time error similar error can be found in the /var/log/messages:
CONFIG_TEXT: fatal: unknown configuration directive <IfModule> tr_TR.UTF-8 is used as a system locale:
# locale | head -n1 LANG=tr_TR.UTF-8 glibc 2.18 or older is installed on the server:
# ldd --version ldd (GNU libc) 2.17 <...> Cause
Bug 15736 fixed in glibc 2.19, which causes ProFTPd to fail parsing the configuration file if the Turkish locale is set server-wide.
Resolution Connect to the server via SSH Backup the FTP configuration file:
# cp -a /etc/xinetd.d/ftp_psa /root Modify the service ftp section in the /etc/xinetd.d/ftp_psa, so it will run ProFTPd with ANSI C locale:
# sed -i 's/}/\tenv \t\t= LC_ALL=C LANG=C\n}/' /etc/xinetd.d/ftp_psa
The sample file contents should have an env specified as following:
CONFIG_TEXT: service ftp { flags = IPv6 disable = no socket_type = stream protocol = tcp wait = no user = root instances = UNLIMITED server = /usr/sbin/in.proftpd server_args = -c /etc/proftpd.conf -S 0.0.0.0 env = LC_ALL=C LANG=C } Restart xinetd service:
# service xinetd restart "
0,"How to enable/disable SNI support on the Plesk server
Applicable to: Plesk Question
How to enable/disable SNI support on the Plesk server?
Answer
By default, on clean Plesk installations (Linux and Windows) the support for SNI is turned on.
In case of Plesk upgrade on Windows from version 11.0 or earlier, the support for SNI is switched off. It can be turned on in Tools & Settings > Server Settings.
To enable SNI support on Plesk for Linux: Connect to the server using SSH. Change SNI_SUPPORT value to true:
# vi /etc/psa/psa.conf SNI_SUPPORT true
Note: to disable change value to false. Restart psa service:
# service psa restart The SSL support with SNI is possible only if the following requirements are met: The operating system of Plesk server supports SNI. Linux systems.
Windows Server 2012 and above. Users' browsers support SNI. Note: most modern web browsers, starting from IE 7, Firefox 2.0, Opera 8.0, and Chrome 1.0, support SNI, unless they are run on Windows XP. To learn more about SNI and the client software that supports it, refer to http://en.wikipedia.org/wiki/Server_Name_Indication
If SNI is not supported and Plesk administrator assigned an SSL certificate to a website hosted on a shared IP address, Plesk will associate that certificate with all other websites hosted on this IP address. In the same case, hosting customers with shared IP addresses will not be able to assign SSL certificates to their sites: the Websites & Domains > example.com > Secure Your Sites button will be hidden in their Control Panel.
For instructions on assigning SSL certificates to websites, refer to Plesk Administrator's Guide."
3,"Unable to start or enable nginx as proxy: 99: Cannot assign requested address
Applicable to: Plesk for Linux Symptoms The following error is present on the Domains > example.com page:
PLESK_ERROR: nginx: [emerg] bind() to 203.0.113.2:443 failed (99: Cannot assign requested address) nginx: configuration file /etc/nginx/nginx.conf test failed Unable to start nginx service. It is not possible to enable the nginx service:
# /usr/local/psa/admin/bin/nginxmng -e ERR [util_exec] proc_close() failed ERR [panel] Apache config (14299906990.63406700) generation failed: Template_Exception: nginx: [emerg] bind() to 203.0.113.2:80 failed (99: Cannot assign requested address) nginx: configuration file /etc/nginx/nginx.conf test failed Reconfiguration of domains fails due to the next error:
# /usr/local/psa/admin/bin/httpdmng --reconfigure-domain example.com Repairing web server configuration for the domain example.com [ERR [util_exec] proc_close() failed ['/usr/local/psa/admin/bin/httpdmng' '--reconfigure-domain' 'example.com'] with exit code [1] [FAILED] httpdmng failed: ERR [util_exec] proc_close() failed ['/usr/local/psa/admin/bin/nginx-config' '-t'] with exit code [1] ERR [util_exec] proc_close() failed ['/usr/local/psa/admin/bin/nginx-config' '-t'] with exit code [1] ERR [panel] Apache config (15487910340.68961700) generation failed: Template_Exception: nginx: [emerg] bind() to 203.0.113.2:80 failed (99: Cannot assign requested address) nginx: configuration file /etc/nginx/nginx.conf test failed
OR
# /usr/local/psa/admin/bin/httpdmng --reconfigure-all Execution failed. Command: httpdmng Arguments: Array ( [0] => --reconfigure-domains [1] => example.com ) Details: ERR [util_exec] proc_close() failed ['/usr/local/psa/admin/bin/nginx_control' '--restart'] with exit code [1] Can not reload proxy server: The IP address from the error message is marked as broken:
CONFIG_TEXT: 203.0.113.2 This IP address is not configured properly. Repair
at the Tools & Settings > IP Addresses page or is not present there at all. This IP address does not exist on the server:
# ip a | grep '203.0.113.2' # Some configuration files still contain this IP address:
# grep -ir '203.0.113.2' /etc/nginx/ /etc/nginx/plesk.conf.d/server.conf: listen 203.0.113.2:80; /etc/nginx/plesk.conf.d/server.conf: proxy_pass http://203.0.113.2:7080; /etc/nginx/plesk.conf.d/server.conf: listen 203.0.113.2:443 ssl; /etc/nginx/plesk.conf.d/server.conf: proxy_pass https://203.0.113.2:7081;
OR
# grep -ir '203.0.113.2' /etc/nginx/ /etc/nginx/plesk.conf.d/forwarding/example.com_nginx.conf: listen 203.0.113.2:80; /etc/httpd/conf/plesk.conf.d/forwarding/example.com_httpd.conf:<VirtualHost 203.0.113.2:7080 127.0.0.1:7080> /etc/nginx/plesk.conf.d/vhosts/example.com.conf: listen 203.0.113.2:443 ssl http2; Cause
The IP address from the error message is still present in some nginx configuration files.
Resolution Connect to the server via SSH. Make sure that no domains are assigned to the IP address from the error message:
Note: change the ""203.0.113.2"" IP address in the command below to the correct one based on the error message.
# plesk db ""SELECT DISTINCT d.name, GROUP_CONCAT(DISTINCT(IF(ip.public_ip_address IS NULL, ip.IP_Address, ip.public_ip_address)) SEPARATOR ', ') AS IPs FROM domains d JOIN DomainServices ds ON d.id=ds.dom_id JOIN IpAddressesCollections ipc USING(ipCollectionId) JOIN IP_Addresses ip ON ipc.ipAddressId=ip.id RIGHT JOIN Subscriptions s on s.object_id=d.id WHERE d.id IS NOT NULL GROUP BY d.name;"" | grep ""203.0.113.2"" #
If any domains were returned during the command execution:
CONFIG_TEXT: | example.com | 203.0.113.2 | | example.org | 203.0.113.2 |
change the IP address for these domains to the existing one. Make sure that the affected IP address does not exist on the server:
Note: change the ""203.0.113.2"" IP address in the command below to the correct one based on the error message.
# ip a | grep ""203.0.113.2"" # Log in to Plesk. Go to Plesk > Tools & Settings > IP Addresses and remove the affected IP address if it is still present there. Back to the SSH and reenable nginx:
# plesk sbin nginxmng -d # plesk sbin nginxmng -e Reconfigure domains:
# /usr/local/psa/admin/bin/httpdmng --reconfigure-all "
8,"Can`t create mail account or change mailbox password: Class not registered (COM Error 80040154)
Applicable to:
Plesk Onyx for Windows Symptoms Attempt to create domain results in error:
CONFIG_TEXT: Error: Unable to update the mail account properties:mailmng failed: Class not registered (COM Error 80040154) at Can't CreateInstance(MEAOPO.Mailbox) (Error code 1) The following error occurs on attempt to open Mail tab in Domains > example.com:
CONFIG_TEXT: Internal error: mailmng failed: Class not registered (COM Error 80040154) at Can't CreateInstance(MEAOPO.Mailbox) (Error code 1) Message mailmng failed: Class not registered (COM Error 80040154) at Can't CreateInstance(MEAOPO.Mailbox) (Error code 1) File Agent.php Line 243 Type PleskUtilException Cause
Corrupted MailEnable installation. MEAOPO.dll is missing or has incorrect permissions.
Resolution
It is required to repair MailEnable installation by MailEnable official means. For that: Log into the server via RDP. Take complete backup of MailEnable settings and user data according to official Mailenable guide . Start C:\Program Files (x86)\Mail Enable\Bin\MEInstaller.exe and execute it with 1, 2, 9 and 13 Actions.
Note: for older versions of Plesk (or for Onyx 17.8 versions that was upgraded) path for MEIinstaller.exe is %plesk_dir%\mail server\mail enable\bin\ It it will not help, reinstall/upgrade MailEnable to the latest supported version. Use the official MailEnable help page for the reference.
Note: The latest supported version information can be found in Plesk Onyx software requirements. Reboot the server to apply the change. "
2,"Apache Tomcat / PostgreSQL / Microsoft SQL Server management is missing in Plesk
Applicable to: Plesk for Linux
Plesk for Windows Symptoms Unable to register Apache Tomcat: Apache Tomcat is installed and is shown as running in Plesk at Tools & Settings > Service Management.
OR
Apache Tomcat is installed but cannot be started at Tools & Settings > Service Management: A floating notification says ""Service is not configured"" and management buttons are grayed out: There is no Java applications menu at Domains > example.com. Java applications is shown as Off at Tools & Settings > License Management. Unable to register PostgreSQL or Microsoft SQL Server: PostgreSQL / MS SQL Server is not available in Plesk at Tools & Settings > Database Servers. The PostgreSQL / MS SQL Server function icons are grayed-out at Tools & Settings > Service Management. PostgreSQL database server support / Microsoft SQL Server support is shown as Off at Tools & Settings > License Management. Cause
The installed Plesk license does not have the Power Pack add-on which includes management modules for Apache Tomcat / PostgreSQL / Microsoft SQL Server.
Note: Support for Apache Tomcat has been dropped in Plesk Onyx 17.8. For more information, visit this KB article.
Resolution
Purchase the Power Pack add-on in Plesk Store. For assistance, contact Plesk Online Sales team.
Note: After purchasing the Power Pack add-on, activate it in Plesk by going to Tools & Settings > License Management and clicking Retrieve Keys. Additional Information What do Plesk Feature Packs include?
"
3,"After dist-upgrade Apache was upgraded from 2.2 to 2.4, Apache and cannot start
Applicable to: Plesk for Linux Symptoms
Note: the article is related to the issue that occurs after Apache upgrade (during dist-upgrade for example). After failed Plesk upgrade on Debian OS with Apache version 2.4 installed, web server is not starting. The following error messages appears:
CONFIG_TEXT: apache2: Syntax error on line 234 of /etc/apache2/apache2.conf: Syntax error on line 5 of /etc/apache2/conf.d/zz010_psa_httpd.conf: Syntax error on line 72 of /etc/apache2/plesk.conf.d/server.conf: No matches for the wildcard '*.conf' in '/etc/apache2/plesk.conf.d/ip_default', failing (use IncludeOptional if required) Action 'configtest' failed. The Apache error log may have more information.
CONFIG_TEXT: Invalid command 'Order', perhaps misspelled or defined by a module not included in the server configuration
CONFIG_TEXT: SSLSessionCache: 'shmcb' session cache not supported (known names: dbm,memcache). Maybe you need to load the appropriate socache module (mod_socache_shmcb?).
CONFIG_TEXT: The apache2 instance did not start within 20 seconds. Please read the log files to discover problems.
CONFIG_TEXT: [proxy_balancer:emerg] [pid 25870] AH01177: Failed to lookup provider 'shm' for 'slotmem': is mod_slotmem_shm loaded?
CONFIG_TEXT: Invalid command 'Require', perhaps misspelled or defined by a module not included in the server configuration
CONFIG_TEXT: Invalid command 'User', perhaps misspelled or defined by a module not included in the server configuration1.
CONFIG_TEXT: Invalid command 'DirectoryIndex', perhaps misspelled or defined by a module not included in the server configuration
CONFIG_TEXT: ERROR: Config file dir.conf not properly enabled: /etc/apache2/mods-enabled/dir.conf is a real file, not touching it Cause
Configuration files were not completely switched to the new Apache 2.4
Resolution Check if custom templates exist in /usr/local/psa/admin/conf/templates folder. If so review all of them and change Include to IncludeOptional in every line what contain wildcard. If there are no custom templates change Include to IncludeOptional in every line what contain wildcard in the following files:
MYSQL_LIN: /etc/apache2/conf.d/zz010_psa_httpd.conf /etc/apache2/plesk.conf.d/server.conf /etc/apache2/plesk.conf.d/horde.conf Enable and activate the following Apache modules
# a2enmod authz_core authz_host access_compat socache_shmcb slotmem_shm mpm_worker unixd php5 dir "
8,"How to prevent plaintext authentication via IMAP/POP3 and SMTP in Postfix on Plesk server?
Applicable to: Plesk for Linux Question
How to prevent cleartext / plaintext authentication via IMAP/POP3 and SMTP in Postfix on Plesk server?
Answer
Note: If you don't have root access to the Plesk server via SSH, contact your service provider regarding this issue.
Click on a section to expand Plesk with Dovecot + Postfix Connect to the server via SSH Enable PCI compliance to Dovecot service:
# plesk sbin pci_compliance_resolver --enable dovecot Enable PCI compliance to Postfix service:
# plesk sbin pci_compliance_resolver --enable postfix Edit the file /etc/postfix/main.cf adding the following line:
CONFIG_TEXT: smtpd_tls_auth_only=yes Open the smtpd.conf file in a text editor (in this example, we are using the vi editor) and remove ""PLAIN"" and ""LOGIN"" from mech_list: on CentOS/RHEL-based distributions
# cat /usr/lib64/sasl2/smtpd.conf pwcheck_method: auxprop saslauthd auxprop_plugin: plesk saslauthd_path: /var/spool/postfix/private/plesk_saslauthd mech_list: DIGEST-MD5 CRAM-MD5 sql_engine: intentionally disabled log_level: 4 on Debian/Ubuntu-based distributions
# cat /etc/postfix/sasl/smtpd.conf pwcheck_method: auxprop saslauthd auxprop_plugin: plesk saslauthd_path: /private/plesk_saslauthd mech_list: DIGEST-MD5 CRAM-MD5 sql_engine: intentionally disabled log_level: 4 Restart mail services to apply the changes:
# service saslauthd restart && service postfix restart && service dovecot restart Note: If Qmail is used, it is recommended to switch to Postfix. Forcing secure connection over SMTP in Qmail requires patching which is not supplied by Plesk."
8,"Unable to create an additional domain: mailmng-outgoing failed Applicable to: Plesk Onyx for Linux Plesk Obsidian for Linux Symptoms An attempt to rename a domain create a domain or mail account under a subscription fails with the following errors:
PLESK_ERROR: Error: mailmng-outgoing failed: ERROR:outgoing:domains.subscription_id may not be NULL
Or
PLESK_ERROR: Error: mailmng-outgoing failed: ERROR:outgoing:mails.domain_id may not be NULL
Or
PLESK_ERROR: Error: mailmng-outgoing failed: ERROR:outgoing:mail_aliases.mail_id may not be NULL
Or PLESK_ERROR: Error: mailmng-outgoing failed: ERROR: outgoing: No backend DB entries were modified. The following errors may be seen in /var/log/plesk/panel.log :
CONFIG_TEXT: PleskUtilException: mailmng-outgoing failed: ERROR:outgoing:domains.subscription_id may not be NULLfile: /usr/local/psa/admin/plib/Service/Agent.phpline: 243code: 0
Or
CONFIG_TEXT: ERROR:outgoing:NOT NULL constraint failed: mails.domain_id
Or CONFIG_TEXT: ERR [1] '/usr/local/psa/admin/bin/mailmng-outgoing' '--rename-domain' '--old-name=old.example.com' '--new-name=example.com' failed with code 1.stdout:stderr:ERROR:outgoing:No backend DB entries were modified. Executing mailmng-outgoing manually fails with the same error:
# /usr/local/psa/admin/bin/mailmng-outgoing --add-domain --main-domain-name=example.com --domain-name=one.example.com --out-limit=50ERROR:outgoing:domains.subscription_id may not be NULL Cause
The subscription table of the /var/lib/plesk/mail/outgoing/data.db database does not have a record of the corresponding main domain (example.com).
Resolution Connect to the server via SSH;
Run the command below:
# plesk repair mail -y Additional Information
Unable to swap domain and domain alias names: boost::filesystem::filesystem_error Directory not empty "
2,"Unable to open File Manager on Plesk server: Unable to get file attributes: (5) Access is denied
Applicable to: Plesk for Windows Symptoms Backup creation fails with the following message:
PLESK_ERROR: Warning: domain ""example.com"" Cannot dump domain hosting content [Access to the path '%plesk_vhosts%\example.com' is denied.] Unable to create a domain in Plesk > Domains > Add New with Access is denied error; Unable to open the File Manager or change permissions for a file under Domains > example.com > File Manager with one of the errors below:
PLESK_ERROR: Unable to get file (C:\Inetpub\vhosts\example.com) attributes: (5) Access is denied. at execute ""C:\Program Files (x86)\Parallels\Plesk\admin\bin\filemng.exe"" domftp_user pst dirs PLESK_ERROR: Unable to find the directory C:\Inetpub\vhosts\example.com\: Access denied PLESK_ERROR: Access is denied. (Error code 5) at retrieves attributes for file or directory PLESK_ERROR: Access is denied. (Error code 5) at Open file PLESK_ERROR: Error: Access is denied. (Error code 5) at GetLongPathName('C:\Inetpub\vhosts\example.com') PLESK_ERROR: Unable to get attributes of the file %plesk_vhosts%\example.com\httpdocs\full\directory\path: Access is denied. The file will not be archived. Cause
Plesk Administrator is not in the Administrators group.
Resolution
Note: if direct RDP access to the server is not possible, contact server administrator for further assistance. Connect to the Plesk server via RDP. Open Command Prompt as Administrator and execute the following command:
C:\> compmgmt In the Computer Management console, expand System Tools > Local Users and Groups > Groups Double-click on Administrators If the Plesk Administrator is absent in the Members list, click Add... and add the Plesk Administrator. Note: if the issue still persists check the following article Unable to access of rename file in File Manager on Plesk server: Access denied "
3,"How to change Apache default charset on Plesk server
Applicable to: Plesk Onyx for Linux Question
How to change a character set in Apache configuration, e.g. from UTF-8 to ISO-8859-1?
Answer Server-wide solution Connect to the server via SSH. To change default charset server-wide, open /etc/httpd/conf/httpd.conf (СentOS/RHEL) or /etc/apache2/apache2.conf(Debian/Ubuntu) and edit/add using vi the AddDefaultCharset line to the end of the file:
CONFIG_TEXT: AddDefaultCharset ISO-8859-1 Restart Apache Web Server:
on CentOS/RHEL:
# service httpd restart
on Debian/Ubuntu:
# service apache2 restart Per-domain solution Log in to Plesk. Open subscription settings, go to Domains > example.com > Apache & Nginx Settings section. Add the following line to the Additional directives for HTTP and Additional directives for HTTPS sections:
CONFIG_TEXT: AddDefaultCharset ISO-8859-1 Go to Domains > example.com > PHP Settings and add the following line to the Additional directives section:
CONFIG_TEXT: default_charset = ""iso-8859-1"" Note: add the following line to Additional nginx directives under Domains > example.com > Apache & Nginx Settings in case the above steps do not take effect:
PLESK_INFO: charset iso-8859-1; "
6,"MySQL 5.5 on Plesk shows warning: Using unique option is deprecated and will be removed in a future release Applicable to: Plesk Onyx for Linux Symptoms MySQL 5.5 is installed on Plesk server. Errors in /var/log/mysql/error.log or /var/log/mysql.log:
CONFIG_TEXT: Using unique option prefix key_buffer instead of key_buffer_size is deprecated and will be removed in a future release. Please use the full name instead. Using unique option prefix myisam-recover instead of myisam-recover-options is deprecated and will be removed in a future release. Please use the full name instead. Cause key_buffer and myisam-recover are deprecated in MySQL 5.5. myisam-recover option is renamed as of MySQL 5.5.3 to myisam-recover-options .
Resolution
Note: This article may require additional administrative knowledge to apply. If any help is required, contact server’s administrator or hosting support. Log in to Plesk server via SSH
Rename the options in /etc/my.cnf or /etc/mysql/my.cnf as below using vi editor:
CONFIG_TEXT: key_buffer_size = 16M myisam-recover-options = BACKUP Restart MySQL server:
# service mysql restart || systemctl restart mariadb || service mysqld restart "
5,"What is Plesk Migrator? Applicable to: Plesk 12.5 for Linux Plesk Onyx for Linux
Plesk 12.5 for Windows Plesk Onyx for Windows
Plesk Obsidian for Linux
Plesk Obsidian for Windows Answer
Plesk Migrator is a tool that Plesk provides for migration to the latest Plesk versions.
It has pre- and post-migration checks, error reporting features, allows to re-sync data between an old and a new server after migration and more to make migration to Plesk an easy process. Supports migration to the following target platforms: Plesk Obsidian, Plesk Onyx, Plesk Onyx Multi Server, Plesk 12.5 Supports migration from the following source platforms: Plesk version 8.6 or later (Linux and Windows) cPanel, Confixx, Helm, Expand, Pro Control Panel, DirectAdmin Can be also used to migrate from: any older Plesk versions other control panels any other hosting environment Read more about Plesk Migrator: Migration to Plesk Migration Guide "
3,"Unable to start Apache on a Plesk server: Multiple RSA server certificates not allowed
Applicable to: Plesk for Linux Symptoms Apache fails to start with the following error message in its error logfile: on CentOS/RHEL-based distributions: /var/log/httpd/error_log on Debian/Ubuntu-based distributions: /var/log/apache2/error.log CONFIG_TEXT: [error] Init: Multiple RSA server certificates not allowed There is a domain that have the SSLCertificateFile directive defined in the file vhost_ssl.conf:
# grep -ir SSLCertificateFile /var/www/vhosts/system/*/conf/*.conf | grep vhost_ssl.conf/var/www/vhosts/system/example.com/conf/vhost_ssl.conf:SSLCertificateFile ""/usr/local/psa/var/certificates/cert9Qv944i"" Cause
The SSLCertificateFile directive is duplicated inside domain configuration.
Resolution Connect to a Plesk server via SSH. Find all files with duplicated SSLCertificateFile directives using the command:
# grep -ir SSLCertificateFile /var/www/vhosts/system/*/conf/*.conf | grep vhost_ssl.conf Open each vhost_ssl.conf file from the output above in any text editor (for example, vi editor) and remove the line with the SSLCertificateFile directive. Start Apache: on CentOS/RHEL-based distributions:
# service httpd start on Debian/Ubuntu-based distributions: # service apache2 start "
7,"Plesk installation/update/upgrade fails: Couldn't resolve host autoinstall.plesk.com
Applicable to: Plesk for Linux
Plesk for Windows Symptoms
Plesk installation/update/upgrade fails with the following error message:
CONFIG_TEXT: File downloading products.inf3: Error: Couldn't resolve host 'autoinstall.plesk.com', retry... Error: Couldn't resolve host 'autoinstall.plesk.com', retry...
OR
CONFIG_TEXT: Error: Failed to read product information from the file : Can't process products.inf3: Failed to download the file http://autoinstall.plesk.com/products.inf3: Could not resolve host: autoinstall.plesk.com
Cause
The address autoinstall.plesk.com (or autoinstall-win.plesk.com for Windows servers) is not resolvable from a Plesk server due to network issues.
In some cases, this can be a temporary issue.
Resolution Retry to update/upgrade Plesk later. If the procedure still fails, perform the checks below and contact your hosting/ISP provider with the collected information for further troubleshooting. For Linux Connect to a Plesk server via SSH. Check if autoinstall.plesk.com is accessible using the ping utility:
# ping autoinstall.plesk.com Check if autoinstall.plesk.com can be resolved from a Plesk server:
# nslookup autoinstall.plesk.com Verify that firewall is not blocking the connection. Make sure that name servers are correct in the file /etc/resolv.conf. If in doubt, use Google Public DNS IP addresses as shown below:
# cat /etc/resolv.conf nameserver 8.8.8.8 nameserver 8.8.4.4 Check that there is no search record in the file /etc/resolv.conf. If the search record is present, then it prevents DHCP client from updating the file /etc/resolv.conf (if it is updated automatically). Either comment out the search directive or add the link to the host autoinstall.plesk.com as shown below:
# cat /etc/resolv.conf ; generated by /sbin/dhclient-script search example.com autoinstall.plesk.com nameserver 192.168.0.1 For Windows Server Connect to the Plesk server via RDP. Start a command prompt and check if autoinstall-win.plesk.com is accessible using the ping utility:
C:\> ping autoinstall-win.plesk.com Check if autoinstall-win.plesk.com can be resolved from the Plesk server:
C:\> nslookup autoinstall-win.plesk.com "
5,"How to migrate from Plesk for Windows to Plesk for Linux and vice versa?
Applicable to: Plesk for Linux
Plesk for Windows Question
How to transfer data from Plesk for Windows to Plesk for Linux and vice versa?
Answer
Starting from Plesk Onyx cross-platform migration can be perform using free Website Importing extension. It can transfer: Applications
Website directories
Website databases
Individual mail accounts "
8,"Mail delivery does not work: do not list domain in BOTH mydestination and virtual_mailbox_domains
Applicable to: Plesk Onyx for Linux Symptoms
Incoming emails are not received, the following error appears in /var/log/maillog:
CONFIG_TEXT: postfix/trivial-rewrite[772518]: warning: do not list domain example.com in BOTH mydestination and virtual_mailbox_domains
Cause
Postfix misconfiguration.
Resolution
According to the official Postfix documentation it is prohibited to list virtual mailbox domain name as mydestination domain name. Connect to the server using SSH. Correct mydestination parameter in /etc/postfix/main.cfas below:
CONFIG_TEXT: mydestination = localhost.$mydomain, localhost, localhost.localdomain Restart postfix service:
# service postfix restart "
2,"Cannot access domain in Plesk: Client: unable to select: no such row in the table
Applicable to: Plesk for Linux Symptoms Cannot access domain in Domains > example.com which belongs to reseller's customer in Plesk with the error:
PLESK_ERROR: Client: unable to select: no such row in the table Unable to login to domain control panel using Manage in Customer Panel link. Browser shows error:
CONFIG_TEXT: The page isn't redirecting properly Cause
Database inconsistency caused by incorrect vendor_id value for the domain in psa.domains table.
Resolution Connect to the server via SSH; Create a dump of psa database according to KB-article #213904125; Find vendor_id value in domains table for affected domain:
MYSQL_LIN: mysql> select id, name, cl_id, vendor_id from psa.domains where name like '%example.com%'; +----+---------------+-------+-----------+ | id | name | cl_id | vendor_id | +----+---------------+-------+-----------+ | 49 | example.com | 34 | 3 | +----+---------------+-------+-----------+ Check that there is no record in clients table for such id:
CONFIG_TEXT: mysql> select * from psa.clients where id=3;Empty set (0.00 sec) Find proper vendor_id value using domains.cl_id by the following query:
MYSQL_LIN: mysql> select d.name, d.cl_id, d.vendor_id as 'domain_vendor_id', c.id, c.vendor_id as 'client_vendor_id' from psa.domains d join psa.clients c where d.cl_id=c.id and d.vendor_id=3; +------------------+-------+--------------------+----+------------------+ | name | cl_id | domain_vendor_id | id | client_vendor_id | +------------------+-------+--------------------+----+------------------+ | example.com | 34 | 3 | 34 | 20 | +------------------+-------+--------------------+----+------------------+ Update domains table with a correct value of vendor_id for example.com:
MYSQL_LIN: mysql> update psa.domains set vendor_id=20 where id=49; Additional Information
Cannot change customer's password or access customer's domains: SQLSTATE[23000]: Integrity constraint violation"
3,"How to ensure that Apache does not allow SSL 2.0/SSL 3.0 protocol
Applicable to: Plesk for Linux Question
The following warning is shown in security report:
PLESK_INFO: The remote service encrypts traffic using a protocol with known weaknesses. Description : The remote service accepts connections encrypted using SSL 2.0, which reportedly suffers from several cryptographic flaws and has been deprecated for several years. An attacker may be able to exploit these issues to conduct man-in-the-middle attacks or decrypt communications between the affected service and clients.
How to ensure that Apache does not allow SSL 2.0/SSL 3.0 protocol?
Answer
SSL protocols that are used by Apache can be set by means of the ""SSLProtocol"" directive. To disable SSL 2.0/SSL 3.0 protocols, modify the ssl.conf file: Connect to a Plesk server via SSH. Open the ssl.conf file in any text editor. In this example we use the vi editor: On CentOS/RHEL-based distributions:
# vi /etc/httpd/conf.d/ssl.conf On Debian/Ubuntu-based distributions:
# vi /etc/apache2/mods-enabled/ssl.conf Add the following line to disable SSL 2.0/SSL 3.0 protocols:
CONFIG_TEXT: SSLProtocol all -SSLv2 -SSLv3 Save the changes and close the file. Restart Apache to apply the changes: On CentOS/RHEL-based distributions:
# service httpd restart On Debian/Ubuntu-based distributions:
# service apache2 restart Additional Information mod_ssl - Apache HTTP Server
"
3,"How to set up .JSP pages to run from domain's DocumentRoot directory?
Applicable to: Plesk for Linux Question
How to set up .JSP (JavaServer Pages) to run from domain's DocumentRoot directory with the following requirements: The JSP application should be accessible by the root domain link (via the http://example.com/ address).
The application must be able to save its data.
The application must have configurable settings and code. Answer
Warning: Tomcat is no longer provided starting from Plesk Onyx 17.8 Prerequisites Ensure that Tomcat Java is installed and running in Tools & Settings > Services Management. For applications which do not use a document folder to store data A typical application in a .war format, uploaded via the Plesk interface in Domains > example.com > Java Applications, may meet all the requirements above.
The .war application will not be unpacked to persistent storage, and therefore, its files will not be alterable. However, some non-Plesk integrated solution or database may be used to save the application's data and settings (even multimedia files).
To modify the application code, it will be necessary to reinstall the package completely (remove the old .war file and upload the new one). During the maintenance procedure, the application will be unavailable. For applications which do use a document folder to store data Note: This method has the following weak points: It is required to have administrative access to configure context files and provide necessary permissions to the application files. The Tomcat user must be added to the 'psaserv' group, and this may cause some security issues. In the case of backing up Plesk sites, the custom Tomcat configuration will not be saved. It will be necessary to restore the configuration manually (including the tomcat user configuration). Connect to the server via SSH. Check the name of installed Tomcat service (e.g. Tomcat, Tomcat7 etc.) and ensure that it is running.
For SysV or Upstart-based OSes:
# service --status-all | grep tomcat tomcat6 (pid 7080) is running...
For SystemD-based OSes:
# systemctl | grep tomcat tomcat.service loaded active running Apache Tomcat Web Application Container Check the name of Tomcat user, using the name of the service from the previous step:
# grep tomcat6 /etc/passwd tomcat:x:91:91:Apache Tomcat:/usr/share/tomcat6:/sbin/nologin
Further in the instruction Tomcat user will be named ""tomcat"", and Tomcat service - ""tomcat6"". Add the Tomcat system account to 'psaserv' group to allow the user to access the httpdocs directories:
# usermod -a -G psaserv tomcat
Check that user was successfully added using:
# id tomcat uid=91(tomcat) gid=91(tomcat) groups=91(tomcat),502(psaserv) Rename .war file to .zip, or create a ZIP archive containing the application. Using Plesk file manager upload application archive to httpdocs folder and unpack it. Set the following ownership and permissions (use the username from step 3):
# chgrp -R psaserv /var/www/vhosts/example.com/httpdocs/ # chmod 0750 /var/www/vhosts/example.com/httpdocs/ # find /var/www/vhosts/example.com/httpdocs/ -type f -name ""*.jsp"" -exec chown tomcat {} \; # find /var/www/vhosts/example.com/httpdocs/ -type f -name ""*.jsp"" -exec chmod 664 {} \;
Note: if writing access to application folder is required for Plesk file manager or other scripts from the subscription, set the following permissions as well:
# find /var/www/vhosts/example.com/httpdocs/ -type f -exec chmod 664 {} \; # find /var/www/vhosts/example.com/httpdocs/ -type d -exec chmod 775 {} \; Forward all requests with the http://example.com/ URL to Tomcat: go to Plesk > domains > example.com > Apache & Nginx Settings and paste the following into Additional directives for HTTP section:
CONFIG_TEXT: <IfModule mod_jk.c> JkMount /* ajp13 </IfModule> Create virtual host base options in /etc/**tomcat6**/server.xml, paste the following into it right after one of the </Host> lines in the end of the file:
CONFIG_TEXT: <Host name=""example.com"" appBase=""/var/www/vhosts/example.com/httpdocs"" /> <Context crossContext=""false"" reloadable=""false"" useNaming=""true"" debug=""0"" privileged=""true"" docBase=""/var/www/vhosts/example.com/httpdocs"" cookies=""true"" path="""" cachingAllowed=""true"" />
Note: to make the website accessible using the URL http://example.com/ path parameter value should be empty.
For example:
# tail -n5 /etc/tomcat6/server.xml <Host name=""example.com"" appBase=""/var/www/vhosts/example.com/httpdocs"" /> <Context crossContext=""false"" reloadable=""false"" useNaming=""true"" debug=""0"" privileged=""true"" docBase=""/var/www/vhosts/example.com/httpdocs"" cookies=""true"" path="""" cachingAllowed=""true"" /> </Engine> </Service> </Server> Restart Tomcat service:
# service tomcat6 restart
In case of any issues, check log messages of Tomcat located in /var/log/tomcat/catalina*.log. Add index.jsp to Index files in Domains > example.com > Apache & Nginx Settings: "
5,"[FIXED BUG] Migration or website importing fails in Plesk: Incompatible ssh server (no acceptable macs)
Applicable to: Plesk Onyx for Linux Symptoms Migration or website importing of a domain to Plesk fails with error:
CONFIG_TEXT: [INFO] START: Check connections [ERROR] Failed to perform action: Check connections Error while checking connection settings: 'Failed to connect to the source server by SSH: Incompatible ssh server (no acceptable macs)' Migration was stopped. A source server is connected through Paramiko implementation of SSH2. SSH is configured without Paramiko preferred Message Authentication Code (MAC) algorithms on the source server:
# grep ""MACs"" /etc/ssh/sshd_config MACs hmac-sha2-512,hmac-sha2-256,hmac-ripemd160 Cause Product issue: #PMT-4361 ""Plesk Migrator no longer fails if the source server has customized SSH config and allows only new secure MACs.""Fixed in: Plesk Obsidian 23 October 2018 (fixed as PPP-36076, Linux) Resolution
Please consider updating your server: How to install Plesk updates Workaround
If update is not possible for some reason you may try the following temporary solution Connect to the source server using SSH. Open the file /etc/ssh/sshd_config in any text editor and add the following MACs, e.g:
CONFIG_TEXT: MACs hmac-sha1,hmac-md5,hmac-sha1-96,hmac-md5-96
Note: MACs should be appended to existing string with MACs declaration Reload SSH service:
# service sshd reload Restart migration or website importing. "
3,"Error message on the Home page in Plesk: Syntax error /etc/httpd/conf.d/00_mod_security.conf failing (use IncludeOptional if required)
Applicable to: Plesk for Linux Symptoms One of the following error messages is shown on the Home page in Plesk:
PLESK_ERROR: New configuration files for the Apache web server were not created due to the errors in configuration templates: [so:warn] [pid 55597:tid 140252507555968] AH01574: module unique_id_module is already loaded, skipping httpd: Syntax error on line 353 of /etc/httpd/conf/httpd.conf: Syntax error on line 13 of /etc/httpd/conf.d/00_mod_security.conf: No matches for the wildcard '00*exclude.conf' in '/etc/httpd/modsecurity.d', failing (use IncludeOptional if required).
OR
PLESK_ERROR: New configuration files for the Apache web server were not created due to the errors in configuration templates: [Wed Mar 21 12:25:31 2018] [warn] module security2_module is already loaded, skipping [Wed Mar 21 12:25:31 2018] [warn] module unique_id_module is already loaded, skipping Syntax error on line 35 of /etc/apache2/modsecurity.d/rules/tortix/modsec/50_plesk_basic_asl_rules.conf: ModSecurity: Found another rule with the same id . Apache configuration checker reports one or both of the warnings below (""httpd -t"" for CentOS/RHEL-based distributions, ""apache2 -t"" for Debian/Ubuntu-based distributions):
# httpd -t [warn] module security2_module is already loaded, skipping [warn] module unique_id_module is already loaded, skipping In some cases, Apache cannot be started. Cause
The ModSecurity configuration file 00_mod_security.conf contains duplicated records.
Resolution For CentOS/RHEL-based distributions Connect to the Plesk server via SSH. Open the /etc/httpd/conf.d/00_mod_security.conf file in a text editor (for example, the vi editor). Replace ""Include"" in the lines:
CONFIG_TEXT: Include modsecurity.d/00*exclude.conf Include modsecurity.d/*asl*.conf Include modsecurity.d/99*exclude.conf
with ""IncludeOptional"":
CONFIG_TEXT: IncludeOptional modsecurity.d/00*exclude.conf IncludeOptional modsecurity.d/*asl*.conf IncludeOptional modsecurity.d/99*exclude.conf Locate duplicated ModSecurity modules and disable them: 4.1. Run the command:
# grep -ir security2_module /etc/httpd/ && grep -ir unique_id_module /etc/httpd/
4.2. In case there is a module which is enabled twice in the output above, for example:
CONFIG_TEXT: /etc/httpd/conf.modules.d/00-base.conf:LoadModule unique_id_module modules/mod_unique_id.so /etc/httpd/conf.modules.d/10-mod_security.conf: LoadModule unique_id_module modules/mod_unique_id.so
disable it by putting the hash symbol ""#"" at the beginning of the line in the file 00_mod_security.conf:
CONFIG_TEXT: #LoadModule security2_module ... #LoadModule unique_id_module ... Restart Apache web-server:
# service httpd restart In Plesk, go to Tools & Settings > Web Application Firewall (ModSecurity) > Settings tab and click OK to refresh settings. For Debian/Ubuntu-based distributions Connect to the Plesk server via SSH.
Open the /etc/apache2/conf.d/00_mod_security.conf file in a text editor (for example, the vi editor). Replace ""Include"" in the lines:
CONFIG_TEXT: Include modsecurity.d/00*exclude.conf Include modsecurity.d/*asl*.conf Include modsecurity.d/99*exclude.conf
with ""IncludeOptional"":
CONFIG_TEXT: IncludeOptional modsecurity.d/00*exclude.conf IncludeOptional modsecurity.d/*asl*.conf IncludeOptional modsecurity.d/99*exclude.conf Locate duplicated ModSecurity modules and disable them:
4.1. Run the command:
# grep -ir security2_module /etc/apache2/ && grep -ir unique_id_module /etc/apache2/
4.2. In case there is a module which is enabled twice in the output above, for example:
CONFIG_TEXT: /etc/apache2/conf.d/00_mod_security.conf:LoadModule security2_module /usr/lib/apache2/modules//mod_security2.so /etc/apache2/mods-available/security2.load:LoadModule security2_module/usr/lib/apache2/modules/mod_security2.so
disable it by putting the hash symbol ""#"" at the beginning of the line in the file 00_mod_security.conf:
CONFIG_TEXT: #LoadModule security2_module ... #LoadModule unique_id_module ... Restart Apache web-server:
# service apache2 restart In Plesk, go to Tools & Settings > Web Application Firewall (ModSecurity) > Settings tab and click OK to refresh settings. Note: If the error about broken domain configuration appears on the Home page, apply the solution from this KB article."
8,"courier-imapd or dovecot services cannot be started: Address already in use
Applicable to: Plesk 12.5 for Linux
Plesk Onyx for Linux Symptoms Cannot start courier-imapd service:
# service courier-imapd start courier-imapd: bind: Address already in use
OR
Cannot start Dovecot service:
# service dovecot start Starting Dovecot Imap: Error: service(pop3-login): listen(*, 110) failed: Address already in use Error: service(pop3-login): listen(*, 995) failed: Address already in use Error: service(imap-login): listen(*, 143) failed: Address already in use Error: service(imap-login): listen(*, 993) failed: Address already in use Fatal: Failed to start listeners [FAILED] There is a process binding the ports required by Dovecot or Courier:
# lsof -i :110 -i :143 -i :993 -i :995 COMMAND PID USER FD TYPE DEVICE SIZE/OFF NODE NAME portreserve 348 root 25u IPv4 591668177 0t0 TCP *:pop3 (LISTEN) Cause
The ports required by Dovecot or Courier are being used by another process.
Resolution Connect to the server via SSH Kill the processes binding on the required ports:
# for PID in `lsof -i :110 -i :143 -i :993 -i :995 | egrep LISTEN | awk '{print $2}' | uniq`; do kill -9 $PID; done Start Courier or Dovecot service: Courier:
# service courier-imapd restart Dovecot
# service dovecot restart In case the PortReserve was the process binding the required ports, disable it with the following commands: For SysVinit:
# service portreserve stop# chkconfig portreserve off For Systemd:
# systemctl stop portreserve# systemctl disable portreserve "
6,"It is not possible to manage MSSQL server in Plesk
Applicable to: Plesk for Windows Symptoms WebAdmin license is used;
Microsoft SQL Server support is turn off in Tools & Settings > License Management:
MSSQL server is listed as installed in Tools & Settings > Updates & Upgrades > Add/Remove Components. For example, MSSQL 2017: The MSSQL components is enabled and present in Tools & Settings > Server Components: However there are no MSSQL servers are listed in Tools & Settings > Database Servers: It is not possible to add MSSQL as database server in Tools & Settings > Database Servers > Add Database Servers: Cause
License limitations: MSSQL Server management is not included by default into WebAdmin license.
Resolution
It is possible to purchase Power Pack or Developer Pack, which include MS SQL support.
Note: For license questions contact Online Sales team if the license has been purchased directly in Plesk Online store. Plesk partners need to contact their sales representative. "
3,"Apache config file cannot be generated: Wrong variable to subsitute Applicable to: Plesk for Linux Symptoms Apache configuration generation fails with the following or similar error:
PLESK_ERROR: New configuration files for the Apache web server were not created due to the errors in configuration templates:Template processing failed: file = /opt/psa/admin/conf/templates/default/domainVhost.php, error = Template_Exception: [Template_Variable_Domain_PhysicalHosting] Wrong variable to subsitute: maintenanceMode file: /opt/psa/admin/plib/Template/Processor.php line: 27 code: 0 Previous error: Template_Exception: [Template_Variable_Domain_PhysicalHosting] Wrong variable to subsitute: maintenanceMode file: /opt/psa/admin/plib/Template/Processor.php line: 27 code: 0 Previous error: Template_Exception: [Template_Variable_Domain_PhysicalHosting] Wrong variable to subsitute: maintenanceMode file: /opt/psa/admin/plib/Template/Variable/Abstract.php line: 67 code: 0. Custom Apache virtual host templates are used:
# ls -l /usr/local/psa/admin/conf/templates/custom/domain/-rw-r--r-- 1 root root 987 Jul 22 16:13 domainVhost.php Cause
Custom Apache virtual host templates contain a syntax error or reference to a nonexistent variable. Resolution Connect to the server using SSH. Move the custom templates folder to another location:
# mv -f /usr/local/psa/admin/conf/templates/custom /root/custom_templates/ Rebuild web server configuration files:
For RHEL-based Linux distributions (CentOS, RedHat, CloudLinux):
# /usr/local/psa/admin/sbin/httpdmng --reconfigure-all
For Debian-based Linux distributions (Ubuntu, Debian):
# /opt/psa/admin/sbin/httpdmng --reconfigure-all Note: Check Plesk Advanced Administration Guide to see the full list of allowed variables for custom virtual host templates."
3,"Websites on Plesk server are slow or PHP mail cannot be sent: mod_fcgid: ap_pass_brigade failed
Applicable to: Plesk Onyx for Linux Symptoms Error in /var/www/vhosts/example.com/logs/error_log:
CONFIG_TEXT: mod_fcgid: ap_pass_brigade failed in handle_request_ipc function, referer: http://www.example.com/index.php FcgidMaxRequestsPerProcess parameter is defined in web configuration. The below command returns non-empty output:
On RedHat/CentOS/CloudLinux:
# grep FcgidMaxRequestsPerProcess /etc/httpd/conf.d/fcgid.conf /var/www/vhosts/system/example.com/conf/vhost.conf /var/www/vhosts/system/example.com/conf/httpd.conf
On Ubuntu/Debian:
# grep FcgidMaxRequestsPerProcess /etc/apache2/mods-enabled/fcgid.conf /var/www/vhosts/system/example.com/conf/vhost.conf /var/www/vhosts/system/example.com/conf/httpd.conf Optional symptoms: Websites on Plesk server are slow or not available:
CONFIG_TEXT: 500 Internal server error Cannot send mail via PHP script Cause
""FcgidMaxRequestsPerProcess"" limit is reached in ""mod_fcgid"" Apache module configuration.
Resolution Solution for all domains on the server Connect to Plesk server via SSH; Open /etc/httpd/conf.d/fcgid.conf (on RedHat/CentOS/CloudLinux) or /etc/apache2/mods-enabled/fcgid.conf (on Ubuntu/Debian) using ""vi""; Increase value of FcgidMaxRequestsPerProcess parameter:
CONFIG_TEXT: <IfModule mod_fcgid.c> FcgidMaxRequestsPerProcess 500 </IfModule> Reload Apache configuration:
On RedHat/CentOS/CloudLinux:
# service httpd reload
On Ubuntu/Debian:
# service apache2 reload If it does not help, try to tune other mod_fcgid parameters, for example set FcgidOutputBufferSize equal 0. Solution for one particular domain Log into Plesk; Go to Domains > example.com > Apache & nginx Settings > Additional Apache directives; Set up or increase the FcgidMaxRequestsPerProcess parameter value in Additional directives for HTTP and Additional directives for HTTPS fields depending on website's preferable protocol (or in both):
CONFIG_TEXT: <IfModule mod_fcgid.c> FcgidMaxRequestsPerProcess 500 </IfModule> "
3,"[FIXED BUG] Website on Plesk server is not accessible when domain name contains uppercase letters: Service Temporarily Unavailable
Applicable to: Plesk for Linux Symptoms Website inaccessible with the following error:
CONFIG_TEXT: Service Temporarily Unavailable The server is temporarily unable to service your request due to maintenance downtime or capacity problems. Please try again later. A website on Magento is inaccessible with the error:
CONFIG_TEXT: ERR_TOO_MANY_REDIRECTS Website name contains upper-case letters and it is using Apache + PHP-FPM. The following error can be found in /var/www/vhosts/example.com/logs/error_log:
CONFIG_TEXT: [proxy:error] [pid 11255] (2)No such file or directory: AH02454: FCGI: attempt to connect to Unix domain socket /home/httpd/vhosts/system/example.com/php-fpm.sock (*) failed [proxy_fcgi:error] AH01079: failed to make connection to backend: httpd-UDS, referer: https://example2.com/profiles/ticket/XJ-447-329/conversation Domain reconfiguration fails:
CONFIG_TEXT: ERR [panel] Apache config generation failed: Template_Exception: mkdir: cannot create directory `/var/www/vhosts/system/Example.com/conf': No such file or directory mktemp: failed to create file via template `/var/www/vhosts/system/Example.com/conf/httpd.conf.XXXXXX': No such file or directory Can not create temporary file: /usr/local/psa/admin/plib/Template/Writer/Webserver/Abstract.php line: 75 code: 0 mkdir: cannot create directory `/var/www/vhosts/system/Example.com/conf': No such file or directory mktemp: failed to create file via template Cause Product issue: #PPPM-4284 ""Websites with uppercase letters are not working if they are configured with handler Apache+PHP-FPM"" Fixed in: Plesk Obsidian 02 July 2018 (fixed as PPP-25110) Resolution
Please consider updating your server: How to install Plesk updates Workaround If upgrade is not possible, use one of the following workarounds: Workaround 1. Log in to Plesk, go to Plesk > Domains > example.com > PHP Settings and change PHP handler to PHP FastCGI or PHP FPM served by nginx.
Workaround 2. Log in to Plesk, recreate or rename the subscription using lowercase letters only. The renaming can be done at Subscriptions > example.com > Domains > Hosting Settings. Since direct renaming will throw the ""domain name already exists"" error, use the following scheme: example.com - example2.com - example.com. "
8,"Horde login failed on the Plesk server: Could not open secure TLS connection to the IMAP server
Applicable to: Plesk for Linux Symptoms Horde webmail login failed with the following message: Login failed. Log /var/log/psa-horde/psa-horde.log contains the following error:
CONFIG_TEXT: WARN: HORDE [imp] [login] Could not open secure TLS connection to the IMAP server. [pid 35439 on line 732 of ""/usr/share/psa-horde/imp/lib/Imap.php""] ERR: HORDE [horde] FAILED LOGIN for john.doe@example.com (john.doe@example.com) [203.0.113.2] to horde [pid 35439 on line 216 of ""/usr/share/psa-horde/login.php""] gnutls library is installed on the server: On CentOS:
# rpm -qa | grep gnutls gnutls-2.8.5-4.el6.x86_64 On Debian\Ubuntu:
# dpkg -l | grep gnutls ii gnutls-bin 3.4.10-4ubuntu1.4 Attempt to log in via CLI produces the error:
# php -r '$user=""john.doe@example.com"";$pass=""<PASSWORD>"";imap_open( ""{127.0.0.1:143/imap/tls/novalidate-cert}"", $user, $pass, OP_DEBUG);' PHP Warning : imap_open(): Couldn't open stream {127.0.0.1:143/imap/tls/novalidate-cert} in Command line code on line 1 PHP Notice: Unknown: TLS/SSL failure for 127.0.0.1: SSL negotiation failed (errflg=2) in Unknown on line 0 Cause
PHP interoperability issue with GNU TLS library.
Resolution
Note: This article may require additional administrative knowledge to apply. If any help required, contact server’s administrator or hosting support.
Make sure the latest version of GNU TLS library is installed.
Alternatively, apply the following workaround: Login to the server via SSH. Create a backup of the Horde configuration file:
# cp -a /usr/share/psa-horde/imp/config/backends.php{,.bak} Open file /usr/share/psa-horde/imp/config/backends.php with a text editor and change the IMAP configuration in Horde webmail by editing the lines:
From:
CONFIG_TEXT: 'port' => 143 ... 'secure' => 'tls'
To:
CONFIG_TEXT: 'port' => 993... 'secure' => 'ssl' Make sure that the final configuration for IMAP server looks like below in /usr/share/psa-horde/imp/config/backends.php file:
CONFIG_TEXT: $servers['imap'] = array( // ENABLED by default; will connect to IMAP port on local server 'disabled' => false, 'name' => 'IMAP Server', 'hostspec' => 'localhost', 'hordeauth' => false, 'protocol' => 'imap', 'port' => 993, ... 'secure' => 'ssl', ); Additional information
Unable to login to webmail.example.com with valid credentials: Login Failed
Roundcube webmail is not accessible after an upgrade to Plesk Onyx 17.8 on Centos 6 "
0,"ModSecurity log is empty on Plesk server
Applicable to: Plesk for Linux Symptoms Mod Security log /var/log/modsec_audit.log is empty;
The command below shows that ModSecurity is disabled:
# /usr/local/psa/admin/bin/modsecurity_ctl -s Disabled Cause
ModSecurity is not enabled on the server.
Resolution Log in the server via SSH.
Note: if direct SSH access to the server is not possible, contact server administrator for further assistance. To enable Mod Security use the following command:
# /usr/local/psa/admin/bin/modsecurity_ctl -e After that operation, /var/log/modsec_audit.log will be created in the following directory:
# ls -la /var/log/modsec_audit.log -rw-r----- 1 root root 865608 Jun 29 09:37 /var/log/modsec_audit.log Note: if ModSecurity is enabled and /var/log/modsec_audit.log is empty, it means that no attack/threads are detected. OR ModSecurity is set to Detection only and it writes to Apache logs."
5,"Unable to access Plesk Backup Manager or remove a reseller/customer in Plesk: Unable to get dump list: error while loading shared libraries
Applicable to: Plesk for Linux Symptoms On attempt to open Plesk Backup Manager or remove a reseller/customer, the following error message appears in Plesk:
PLESK_ERROR: Error: Unable to get dump list: FTP dump file does not exists The following notification is also received in the Administrator mailbox:
CONFIG_TEXT: Error: Runtime error: Dump validation utility returned empty result at /usr/local/psa/admin/bin/plesk_agent_manager line 1268. Error: Dump validation utility returned empty result
Note: if Backup Manager is accessible this error is shown in the UI. On attempt to get a dump list via SSH, the operation fails due to missing library:
# /usr/local/psa/admin/bin/pmm-ras --get-dump-list --dump-storage=/var/lib/psa/dumps/ /usr/local/psa/admin/bin/pmm-ras: error while loading shared libraries: libjson-c.so.2: cannot open shared object file: No such file or directory
OR
# /usr/local/psa/admin/bin/pmm-ras --get-dump-list --dump-storage=/var/lib/psa/dumps/ /usr/local/psa/admin/bin/pmm-ras: error while loading shared libraries: libidn2.so.0: cannot open shared object file: No such file or directory
OR A backup fails with the following error:
CONFIG_TEXT: /usr/local/psa/admin/sbin/deployer: error while loading shared libraries: libidn2.so.0: cannot open shared object file: No such file or directory Migration fails with the following error message:
PLESK_INFO: Failed to import the remote configuration dump from the target server. Not all settings may be migrated. Error message: Unable to import file as dump: FTP dump file does not exists Cause
Missing libjson-c.so.2 or libidn2.so.0 library.
Resolution Connect to the (target) Plesk server via SSH. Install the missing library: If libjson-c.so.2 library is missing on CentOS/RHEL-based distributions, reinstall the json-c package with the command:
# yum reinstall json-c on Debian/Ubuntu-based distributions, reinstall the libjson-c2 package with the command:
# apt-get install --reinstall libjson-c2 If libidn2.so.0 library is missing
Re-install Plesk update:
# plesk installer --select-release-current --reinstall-patch --upgrade-installed-components
OR
# yum install libidn2 Related Articles Unable to access Plesk Backup Manager: Unable to get dump list
"
6,"Unable to start MySQL/MariaDB after changing the innodb_log_file_size parameter: log file ./ib_logfile0 is of different size
Applicable to: Plesk for Linux
Plesk for Windows Symptoms MySQL/MariaDB fails to start after setting up the innodb_log_file_size parameter in MySQL configuration: The error message on Linux:
MYSQL_LIN: start: Job failed to start
OR
MYSQL_LIN: Job for mariadb.service failed because the control process exited with error code. See ""systemctl status mariadb.service"" and ""journalctl -xe"" for details. The error message on Windows Server:
PLESK_INFO: The MySQL service fails to start with the error 1067 ""The process terminated unexpectedly"" The following messages appear in the MySQL logfile: Logfile location on Linux: /var/log/mysql/error.log (or /var/log/mariadb/mariadb.log if MariaDB is installed) Logfile location on Windows Server: %plesk_dir%MySQL\Data\<SERVER_NAME>.err CONFIG_TEXT: InnoDB: Error: log file ./ib_logfile0 is of different size 0 5242880 bytes InnoDB: than specified in the .cnf file 0 536870912 bytes! InnoDB: Possible causes for this error: (a) Incorrect log file is used or log file size is changed (b) In case default size is used this log file is from 10.0 (c) Log file is corrupted or there was not enough disk space In case (b) you need to set innodb_log_file_size = 48M [ERROR] Plugin 'InnoDB' init function returned error. [ERROR] Plugin 'InnoDB' registration as a STORAGE ENGINE failed. [Note] Plugin 'FEEDBACK' is disabled. [ERROR] Unknown/unsupported storage engine: InnoDB [ERROR] Aborting Consequences Plesk is not accessible with similar error messages below in a web-browser:
PLESK_INFO: Server Error 500 Zend_Db_Adapter_Exception SQLSTATE[HY000] [2002] No connection could be made because the target machine actively refused it.
OR
PLESK_INFO: Server Error 500 Zend_Db_Adapter_Exception SQLSTATE[HY000] [2002] No such file or directory Websites that use MySQL databases do not work or work improperly. Cause
After changing the innodb_log_file_size value in MySQL configuration, old log files ib_logfile0 and ib_logfile1 still exist with a different size on the server.
Resolution
Follow steps from this KB article: How to change the value of innodb_log_file_size in MySQL/MariaDB "
2,"Unable to create/remove subscription or start Migration Manager - Error: Permission denied. Applicable to: Plesk 12.5 for Linux
Plesk Onyx for Linux
Plesk 12.5 for Windows Symptoms Extensions tab is not shown. The DNS settings options is missing on all domains while BIND is correctly installed and running. On the Tools & Settings page a lot of tabs are missing. It is not possible to create or remove a subscription. The following error message appears:
PLESK_ERROR: Error: Permission denied.
OR
PLESK_WARN: Warning: Permission denied.
It is not possible to open Plesk Migration & transfer manager . The following error message appears:
PLESK_ERROR: Error: Permission denied.
Cause Simple view mode is activated in Plesk.
Resolution
Login to the server via SSH or RDP and switch to Service Provider view.
Linux:
# /usr/local/psa/bin/poweruser --off # /usr/local/psa/bin/poweruser --on -simple false
Windows:
C:\> ""%plesk_cli%\\poweruser"" --off""%plesk_cli%\\poweruser"" --on"
2,"Product configuration that is set in Partner Central is not applied to Plesk
Applicable to: Plesk for Linux Symptoms
Product configuration set in Partner Central is not reflected in Plesk.
Cause
Settings defined in Partner Central were not prolongated yet to Plesk. Plesk connects to Key Administrator daily upon running a daily maintenance task and gets updated product configuration associated with the license in Partner Central.
Resolution Connect to the server via SSH;
Note: If direct SSH access to the server is not possible, contact server administrator for further assistance. Set product configuration in Partner Central and wait for the Daily Maintenance task to be run and completed (in next 24 hours).
Or execute Daily Maintenance task to load customization: # /usr/local/psa/bin/sw-engine-pleskrun /usr/local/psa/admin/plib/DailyMaintainance/script.php -f LoadCustomizations
Alternatively, run the following utility to load the customization: # /usr/local/psa/bin/server_pref --load-customizations "
5,"Cannot create business object in Plesk: mailmng-outgoing failed: ERROR:outgoing:column name is not unique
Applicable to: Plesk for Linux Symptoms Migration to Plesk finishes with one of the following warnings and domain is created with No Hosting type (without hosting):
PLESK_ERROR: Failed deployment of domain example.com Warning: Execution of /usr/local/psa/admin/plib/api-cli/domain.php --create example.com -owner user -do-not-apply-skeleton -notify false -guid 056529ff-e402-463a-aa35-f82d124c4480 -creation-date 2015-03-09 -ip 10.10.10.10 -ignore-nonexistent-options failed with return code 1. Stderr is An error occurred during domain creation: mailmng-outgoing failed: ERROR:outgoing:column name is not unique Cannot create domain/subscription/reseller/customer with the same error:
PLESK_ERROR: An error occurred during domain creation: mailmng-outgoing failed: ERROR:outgoing:column name is not unique
or
PLESK_ERROR: Error: mailmng-outgoing failed: ERROR:__main__:UNIQUE constraint failed: domains.name Cause
Inconsistensy in outgoing mail control database.
Resolution Connect to the destination Plesk server via SSH. Backup database:
# cp /var/lib/plesk/mail/outgoing/data.db{,_bk} Remove the subscription in question from the outgoing mail control database:
# /usr/local/psa/admin/sbin/mailmng-outgoing --remove-domain --domain-name=example.com In case of migration re-sync subscription; In other cases re-create domain/subsctiption/reseller/customer.
"
6,"Unable to create customer or access Application Vault in Plesk: Access denied for user 'apsc'@'localhost'
Applicable to: Plesk for Linux
Plesk for Windows Symptoms It is not possible to create a new customer. The operation fails with the following error:
CONFIG_TEXT: Internal error: ODBC error #HY000: [MySQL][ODBC 3.51 Driver] Access denied for user 'apsc'@'localhost' (using password: YES) A similar error appears when creating a subscription, installing an APS application or accessing Application Vault at Tools & Settings:
CONFIG_TEXT: Internal error: ODBC error #HY000: [MySQL][ODBC 3.51 Driver] Access denied for user 'ODBC'@'localhost' (using password: NO) ODBC error #HY000: [MySQL][ODBC 3.51 Driver] Access denied for user 'ODBC'@'localhost' (using password: NO) ODBC error #HY000: File aps_php.php Line 11933 Type Exception Cause
Password for the apsc database user is set to the incorrect value, or is missing.
Resolution For Plesk 12.5, Onyx and Obsidian Connect to the server using SSH or RDP. Use the self-repair tool:
# plesk repair db
OR
C:\> plesk repair db
Note: Apply only the Recreate the APS database user account step when it will be suggested. For older Plesk versions Connect to the server using SSH or RDP. Download the script from the article Plesk Mass Password Reset script. Reset the APSC password using the script: On Linux
# /usr/local/psa/bin/sw-engine-pleskrun plesk_password_changer.php ""$(cat /etc/psa/.psa.shadow)"" --apsc On Windows
C:\> ""%plesk_dir%\admin\bin\php.exe"" -dauto_prepend_file= plesk_password_changer.php ""current_admin_password"" --apsc "
0,"What is the difference between options of 'Access to the server over SSH' parameter in Plesk?
Applicable to: Plesk Onyx for Linux Question
What is the difference between options of Access to the server over SSH parameter' in Plesk?
Answer
Plesk allows to configure different option for Access to the server over SSH for each website in Plesk > Domains > example.com > Web Hosting Access: Note: neither of the options below does affect remote access over FTP Forbidden - no remote access /bin/sh - /bin/sh (which is another name of /bin/bash in majority of Linux distributions) will be used to execute commands in a remote session. The user will obtain all access as an ordinary user, including access to /bin, /user etc., as well as to run any application. /bin/bash - Bourne-again shell (/bin/bash) will be used in the remote session to execute commands. Same restrictions as for /bin/sh access /bin/tcsh - Enriched C shell (/bin/tcsh) will be used to execute commands in remote session. Same restrictions as for /bin/sh access /bin/csh - C shell (/bin/csh) will be used to execute commands in remote session. Same restrictions as for /bin/sh access /bin/bash (chrooted) -- /bin/bash will be used to execute commands in chrooted environment. A user will be able to get access to files within its own subscription only. Any applications that are run from within the chroot will be unable to see the rest of the operating system in principle. By default, only basic commands like less, tar, zip are allowed in the chrooted environment. The list can be extended by following this article /bin/rbash - Restricted Bourne-again shell will be used to execute commands in a remote session. A restricted shell behaves identically to bash with the exception listed here "
5,"Plesk backup task is failing: Cannot stat: Permission denied
Applicable to: Plesk for Linux Symptoms Plesk backup creation finished with one of the following messages in Plesk interface:
PLESK_ERROR: Failed to pack files example.com_user-data_1307261006 in /var/lib/psa/dumps/domains/example.com /bin/tar: httpdocs/components/tmpForThumb: Cannot open: Permission denied /bin/tar: Exiting with failure status due to previous errors PLESK_WARN: Not all the data was backed up into /var/lib/psa/dumps/clients/cl_name/domains/example.com successfully. Mounted on: /. /bin/tar: .pki/nssdb: Cannot stat: Permission denied /bin/tar: Exiting with failure status due to previous errors PLESK_WARN: Warning: Subscription ""example.com"" Not all the data from /var/www/vhosts/example.com was backed up successfully: .cagefs/opt: Cannot open: Permission denied .cagefs/opt/alt: Cannot stat: Permission denied .cagefs/opt/alt/php56: Cannot stat: Permission denied .cagefs/opt/alt/php56/link: Cannot stat: Permission denied .cagefs/opt/alt/php56/link/conf: Cannot stat: Permission denied .cagefs/opt/alt/php73: Cannot stat: Permission denied .cagefs/opt/alt/php73/link: Cannot stat: Permission denied .cagefs/opt/alt/php73/link/conf: Cannot stat: Permission denied .cagefs/var: Cannot open: Permission denied .cagefs/var/run: Cannot stat: Permission denied .cagefs/var/run/cagefs: Cannot stat: Permission denied .cagefs/var/run/cagefs/utmp: Cannot stat: Permission denied Unable to restore a backup with the following message:
PLESK_WARN: Warning: Restore hosting ""example.com"" Can not deploy content of domain example.com warning: Archive error: Unable to extract files from /var/lib/psa/dumps/domains/example.com/backup_user-data_1907081210.tgz to /var/www/vhosts/example.com: /usr/lib/plesk-9.0/sw-tar: example.com/bin/gzip: Cannot open: File exists /usr/lib/plesk-9.0/sw-tar: example.com/bin/unzip PLESK_WARN: Warning: Archive error: Unable to extract files from /var/lib/psa/dumps/domains/example.com/backup_user-data_1907311520.tgz to /var/www/vhosts/example.com: /bin/tar: httpdocs/some-picture.jpg: Cannot open: File exists /bin/tar: httpdocs/wp-content/uploads/2019/some-picture.jpg: Exiting with failure status due to previous errors Multiple file and folders have root permissions under the subscription folder /var/www/vhosts/example.com Cause
Incorrect file or directory permissions for virtual host directories located at /var/www/vhosts/example.com.
Resolution Connect to the server via SSH. Correct the file permissions:
# plesk repair fs example.com If the command from the 2nd step does not help, restore default ownership and permissions for /var/www/vhosts/example.com:
In the case of one affected domain, the permissions can be restored following the steps on this article: How to restore default permissions in the virtual host directory on Linux?
Note: In case more than one domain is affected, fix the permissions issue for all affected domains. In this case, the following can be performed:
# plesk db -Ne ""select login,home from sys_users where mapped_to is null"" | while read login home; do chown -R $login $home; done Additional information
Backup task has finished with a warning: Cannot open: File exists /bin/tar"
7," How to install Plesk for Windows?
Applicable to: Plesk for Windows Question
How to install Plesk for Windows?
Answer
For Plesk installation, it's required a fresh Windows Server machine meeting the Plesk Software Requirements and with Internet access. You can create it on your own or purchase it from any Hosting Provider.
Note: Refer to our Knowledge Base for assistance in resolving errors that may appear during the installation process. Also, the following ports should be opened for Plesk to function correctly. Additional information can be found in the Plesk Documentation.
Click on a section to expand Plesk Installation via browser Plesk Installer Connect to the Windows Server via RDP Download and run the Plesk Installer ( plesk-installer.exe ) on the server. A browser window will be opened with an authorization form requesting the Administrator's credentials. Ports 8443 and 8447 should be opened to run the installer. In the browser window, choose Install or Upgrade Product, specify the necessary parameters and the components that are about to be installed, and follow the on-screen instructions. Once the Plesk installation is finished, the access to Plesk is possible via URL https://<ip_address_or_hostname>:8443 or https://localhost:8443 (From the server itself). Proceed with the first initialization by providing a new password for Plesk 'admin' user, choosing the Plesk license type and other details. Note: it is possible to select drive for installation: Plesk One-Click Installation Connect to the Windows Server via RDP Start a command prompt as Administrator Run PowerShell:
C:\> powershell Download Plesk Installer:
PS C:\> [Net.ServicePointManager]::SecurityProtocol = [Net.SecurityProtocolType]::Tls12; Invoke-WebRequest -URI https://installer-win.plesk.com/plesk-installer.exe -OutFile plesk-installer.exe Install Plesk with the following command:
PS C:\> .\plesk-installer.exe --select-product-id=panel --select-release-latest --installation-type=recommended Plesk Unattended Installation Note: More examples can be found in Plesk Installation and Upgrade Guide - Installing Plesk for Windows in Unattended Mode Connect to the Windows Server via RDP Start a command prompt as Administrator Run PowerShell:
C:\> powershell Download Plesk Installer:
PS C:\> [Net.ServicePointManager]::SecurityProtocol = [Net.SecurityProtocolType]::Tls12; Invoke-WebRequest -URI https://installer-win.plesk.com/plesk-installer.exe -OutFile plesk-installer.exe List all available releases:
PS C:\> .\plesk-installer.exe --show-all-releases List all available components for the required Plesk release. For example:
PS C:\> .\plesk-installer.exe --console --select-release-id PANEL_18_0_24_WIN --show-components --show-options Use the option --install-component and specify all required components. For example:
PS C:\> .\plesk-installer.exe --select-release-id PANEL_18_0_24_WIN --install-component panel --install-component common --install-component mailenable --install-component dns "
6,"Unable to start MySQL: Error unknown option '--skip-locking'
Applicable to: Plesk Onyx for Linux Symptoms The MySQL service is not starting after upgrade from 5.1 to 5.5 version.
The following errors can be found in /var/log/mysqld.log file:
CONFIG_TEXT: [ERROR] /usr/libexec/mysqld: unknown option '--skip-locking' [ERROR] Aborting Cause
The skip-locking directive is deprecated starting from MySQL 5.5 version.
Resolution Log into the server via SSH.
Using the vi text editor open the MySQL configuration file: For RHEL based systems (CentOS/CloudLinux):
CONFIG_TEXT: /etc/my.cnf For Debian based systems (Ubuntu/Debian):
CONFIG_TEXT: /etc/mysql/my.cnf Change the line below from:
CONFIG_TEXT: skip-locking
To
CONFIG_TEXT: #skip-locking Restart the MySQL service to apply the changes:
# service mysql restart 2> /dev/null || service mariadb restart 2> /dev/null "
6,"Database importing in Plesk fails: ERROR 2006 (HY000): MySQL server has gone away
Applicable to: Plesk for Linux Symptoms Database importing via Domains > example.com > Databases > Import Dump fails:
PLESK_ERROR: ERROR 2006 (HY000) at line 1253: MySQL server has gone away Traceback (most recent call last): File ""/usr/local/psa/admin/sbin/dbbackup"", line 6, in <module> File ""/usr/local/psa/lib/modules/python/dbbackup/dbbackup.py"", line 99, in main restore(options, password) File ""/usr/local/psa/lib/modules/python/dbbackup/dbbackup.py"", line 88, in restore raise Exception(""program 'mysql' finished with non-zero exit code: %d"" % p.returncode) Exception: program 'mysql' finished with non-zero exit code: 1 Subscription migration fails:
PLESK_ERROR: error: Failed to copy content of database 'example_db'Migration tools tried to perform operation in 3 attempts: Command execution failed on the local server with non-zero exit code.command: mysql --defaults-file=/usr/local/psa/var/modules/panel-migrator/sessions/<session-ID>/target-server/my_localhost_example_db.cnf -h localhost -P 3306 -uadmin example_db < /usr/local/psa/var/modules/panel-migrator/sessions/<session-ID>/target-server/db-dumps/example_db.sqlexit code: 1stdout: stderr: ERROR 2006 (HY000) at line 405: MySQL server has gone away Cause
Data string in dump is higher than max_allowed_packet default value in MySQL (4 MB).
Resolution
Increase the value of the MySQL parameter max_allowed_packet using the steps from this article."
8,"Domain mail services configuration error on Plesk server: ""mailmng failed: MEAOSM.Domain.GetDomain failed""
Applicable to: Plesk for Windows Symptoms
When trying to change domain mail settings, select webmail, the following error occurs:
PLESK_ERROR: Operation failed The operation you were performing failed. You can retry the operation with or without changing its parameters. You may also want to report this problem to our support so that we could help you as soon as possible. MEAOSM.Domain.GetDomain failed (Error code 1) PLESK_ERROR: Error: mailmng failed: MEAOSM.Domain.GetDomain failed at (MailEnable::openDomain line 87) at execute console command --turn-on-domain(vconsoleapp::start line 122) at execute ""C:\Program Files (x86)\Parallels\Plesk\admin\bin\mailmng"" --turn-on-domain ""--domain-name=example.com""(vconsoleapp::run line 139) (Error code 1) PLESK_ERROR: mailmng failed: MEAOSM.Domain.GetDomain failed at (MailEnable::openDomain line 87) at execute console command --set-discard(vconsoleapp::start line 93) at execute C:\Parallels\Plesk\admin\bin\mailmng --set-discard ""--domain-name=example.com""(vconsoleapp::run line 110) (Error code 1)
Cause
Postoffice in MailEnable is corrupted/missing.
Resolution Connect to the server via RDP;
Note: if direct RDP access to the server is not possible, contact server administrator for further assistance. Open MailEnable Administrator ( Start > All Programs > Mail Enable > MailEnable Administrator ).
Go to Messaging manager > Post Offices Create PostOffice example.com Create Domain example.com Open Command Prompt as Administrator and run the following command:
For one domain:
C:\> plesk repair mail example.com
For all domains:
C:\> plesk repair mail Re-run failed operations. "
0,"How to change alarm levels for Plesk Health Monitor?
Applicable to: Plesk for Linux
Plesk for Windows Question
How to change alarm levels for Health Monitor?
Answer
To change alarm levels in Health monitor it is required to adjust configuration files for the extensions that are located in /usr/local/psa/var/custom-health-config.xml and in /usr/local/psa/admin/conf/health-config.xml.
It is possible to adjust custom-health-config.xml file via Plesk UI. For that: Log in Plesk Download the current configuration file by clicking the Download Configuration File button in Server Management > Health Monitoring: Change the configuration file using any text editor. With the help of this file you can define: Alarm threshold for each parameter. Type of the alarm for each parameter: Exceeding of an absolute value, a relative value, or a trend value. Note: The detailed file structure and description for each of the file parameters are provided at the top of the configuration file. Upload the file with changes to Plesk by clicking the Upload Configuration File button in Server Management > Health Monitoring. For more details regarding the Configuring Health Monitor please use the this guide. Also, for just for the reference, all related .xml and .xsd files can be found in configs.zip archive in the attachment."
3,"PHP files are downloaded instead of executing
Applicable to: Plesk for Linux Symptoms PHP is not being handled correctly. Trying to access a PHP page, it asks to download it, instead of executing it. The issue appears in case PHP set as FPM application served by Apache. Cause
Plesk psa-phpfpm-configurator package is outdated.
Resolution
Upgrade psa-phpfpm-configurator package using Plesk Installer: via CLI:
Connect to the server via SSH and run:
# plesk installer --select-release-current --reinstall-patch --upgrade-installed-components via Plesk GUI:
Tools & Settings > Updates and Upgrades > Add and Remove Components and install any component. "
7," How to change or get the server hostname on Plesk server
Applicable to: Plesk for Linux Question
How to change or get a server hostname on Plesk server?
Answer
Note: A server hostname must be a fully qualified domain name (FQDN). The changes are not instant. It requires 24-48 hours to get new hostname propagated through all the DNS servers.
Warning: Server providers might deny hostname change, in such case contact the server provider.
Click on a section to expand In Plesk interface Login to Plesk Go to Tools & Settings > Server Settings > Full hostname:
Note: You must be Plesk Administrator to be able to see or change the hostname. Via Command Line Interface: Connect to the server using SSH as root To view hostname execute the command:
# hostname To change server hostname execute the following command with preferred hostname value instead of host.example.com:
# plesk bin server_pref --update -hostname host.example.com Restart sw-cp-server and sw-engine services:
# service sw-cp-server restart # service sw-engine restart If the hostname was not changed, use the native SystemD utility(CentOS7/Debian8+/Ubuntu16):
# hostnamectl set-hostname host.example.com
Note: In some cases, server restart is required. For Google Cloud instance the changes will not be saved after server restart. Use the following workaround: https://cloud.google.com/compute/docs/instances/custom-hostname-vm "
2,"Unable to access domain: C:\Inetpub\vhosts\example.com\httpdocs is out of webspace
Applicable to: Plesk for Linux
Plesk for Windows Symptoms The following error is shown when browsing domain at Domains > example.com or at Domains > example.com > FTP Access:
PLESK_ERROR: C:\Inetpub\vhosts\example.com\httpdocs is out of webspace Error like the following is shown in repair of Plesk database:
C:\> C:> plesk repair db -verbose The home directory of the domain example.com does not match the system user's default home directory .................... [ERROR] Replace ""/var/www/vhosts/example.com/httpdocs"" with ""/var/www/vhosts/example.net/httpdocs""? [Y/n] n Cause
Domain document root directory in the database differs from the actual one.
Resolution Connect to the server via RDP; Login to Plesk database; Check thatwww_root and home paths are set correctly in Plesk database:
MYSQL_WIN: select id,home from sys_users where home like ""%example.com%""; +----+--------------------------------+ | id | home | +----+--------------------------------+ | 15 | C:\inetpub\vhosts\example.com | +----+--------------------------------+ select www_root from hosting where sys_user_id=15; +----------------------------------------+ | www_root | +----------------------------------------+ | C:\inetpub\vhosts\example.com\httpdocs | +----------------------------------------+
Note: example.com is a domain where the issue exists. if it home or www_root does not exist, create it using one of the following queries:
MYSQL_WIN: update hosting set www_root='C:\\inetpub\\vhosts\\example.com\\httpdocs' where sys_user_id=15; update sys_users set home='C:\\inetpub\\vhosts\\example.com' where id=15; Update the permissions:
C:\> ""%plesk_cli%\repair.exe"" --repair-webspace-security -webspace-name example.com "
8,"How to increase log rotation period for services logs in Plesk on Windows server?
Applicable to: Plesk for Windows Question
How to increase storage period for services logs on Windows in Plesk?
Answer
By default, Plesk removes MailEnable logfiles every 24 hours to speed up execution calculation of mail statistics.
The ability to control the rotation period is implemented starting from Plesk Obsidian 18.0.25.
Historical logs number is configured via Plesk config registry value log_pleskwebsite_history. Follow the steps below to configure this value. Connect to the server via RDP;
Note: if direct RDP access to the server is not possible, contact server administrator for further assistance. Open Command Prompt as Administrator and execute the following command: C:\> REG ADD ""HKLM\SOFTWARE\Wow6432Node\PLESK\PSA Config\Config"" /v log_pleskwebsite_history /t REG_DWORD /d 4 /f
where 4 can changed to any value in days (default value equals 4). Click on a section to expand For older Plesk versions it is possible to move all log files to an alternate location and store them for as long as necessary Connect to the server via RDP.
Note: if direct RDP access to the server is not possible, contact server administrator for further assistance. Open system registry: Go to the following key:
For 32 bit OS : HKLM\\SOFTWARE\\Plesk\\PSA Config\\Config For 64 bit OS : HKLM\\SOFTWARE\\Wow6432Node\\PLESK\\PSA Config\\Config Create the following REG_SZ registry values:
For 32 bit OS:
HKLM\\SOFTWARE\\Plesk\\PSA Config\\Config\\SaveFTPLogsDirectoryHKLM\\SOFTWARE\\Plesk\\PSA Config\\Config\\SaveHTTPLogsDirectoryHKLM\\SOFTWARE\\Plesk\\PSA Config\\Config\\SaveMailLogsDirectory
For 64 bit OS:
HKLM\\SOFTWARE\\Wow6432Node\\PLESK\\PSA Config\\Config\\SaveFTPLogsDirectoryHKLM\\SOFTWARE\\Wow6432Node\\PLESK\\PSA Config\\Config\\SaveHTTPLogsDirectoryHKLM\\SOFTWARE\\Wow6432Node\\PLESK\\PSA Config\\Config\\SaveMailLogsDirectory
Note: All three values must be created. It is important because if one of them is missing, mail log rotation will be broken and statistics will not process mail logs correctly. Configure these values to point to the required folders, i.e., configure the values above to point to C :\movedlogs\ftp\ , C :\movedlogs\http\ , and C :\movedlogs\mail\ accordingly.
Note: By design, all three folders should be stored on the same volume. Do not create folders on separate volumes. Ensure that Log Rotation is enabled for domains in Plesk. Once it is done, log files are moved to the pointed-to folders after statistics calculation. "
2,"Unable to activate suspended customer or subscription in Plesk: The subscription is suspended because its subscriber was suspended Applicable to: Plesk Onyx for Linux
Plesk Onyx for Windows Symptoms Cannot activate suspended customer/subscription:
PLESK_ERROR: Error: Some of the selected customers were not activated. The account is still suspended due to the following reason: The account is suspended because its owner was suspended.
PLESK_ERROR: Error: Some of the selected subscriptions were not activated. The subscription is still suspended due to the following reason: The subscription is suspended because its subscriber was suspended.
PLESK_ERROR: Error: The account is still suspended due to the following reason: The account is suspended because its owner was suspended. The subscription owner (customer) is active
The customer owner (reseller) is active Cannot export database dump:
PLESK_ERROR: Unable to export dump: The subscription is suspended In some cases, domain's status is 0 (active) but subscription's status is 2 (suspended):
MYSQL_LIN: mysql> select status, webspace_status from domains where name='example.com'\G *************************** 1. row ************************** status: 0 *************************** 2. row ************************** webspace_status: 2 MySQL server hung during the subscription activation. Cause
Inconsistency in Plesk database.
Resolution
Note: This article may require additional administrative knowledge to apply. If any help required, contact server’s administrator or hosting support. Connect to a Plesk server via SSH/RDP. Create a dump of Plesk database: For Linux:
# plesk db dump psa > /root/psa_backup.sql For Windows Server:
C:\> plesk db dump psa > C:\psa_backup.sql Access the Plesk database:
# plesk db Activate the customer or subscription (replace the John Doe/example.com with actual name): Activating the customer:
MYSQL_LIN: mysql> UPDATE clients SET status=0 WHERE pname='John Doe'; Activating the subscription:
MYSQL_LIN: mysql> UPDATE domains SET status=0, webspace_status=0 WHERE name='example.com'; Once done, log in to Plesk, then suspend the customer or subscription from the step 4 and activate it back: "
8,"Unable to send email on Plesk server using webmail interface (Horde / RoundCube): Could not open secure TLS connection to the server
Applicable to: Plesk for Linux Symptoms Unable to send email on Plesk server using webmail interface (Horde or RoundCube), the following error appears: PLESK_ERROR: Could not open secure TLS connection to the server The following errors are found in /var/log/psa-horde/psa-horde.log:
PLESK_INFO: DEBUG: HORDE Load config file (conf.php; app: horde) [pid 51301 on line 109 of ""/usr/share/psa-pear/pear/php/Horde/Registry/Loadconfig.php""] DEBUG: HORDE [imp] Load config file (conf.php; app: imp) [pid 51301 on line 109 of ""/usr/share/psa-pear/pear/php/Horde/Registry/Loadconfig.php""] ERR: HORDE [imp] Could not open secure TLS connection to the server. [pid 51301 on line 1157 of ""/usr/share/psa-horde/imp/lib/Compose.php""] DEBUG: HORDE 1. Horde_Core_Ajax_Application->doAction() /usr/share/psa-horde/services/ajax.php:61 2. call_user_func() /usr/share/psa-pear/pear/php/Horde/Core/Ajax/Application.php:175 3. IMP_Ajax_Application_Handler_Common->sendMessage() 4. IMP_Compose->buildAndSendMessage() /usr/share/psa-horde/imp/lib/Ajax/Application/Handler/Common.php:555 The following errors are found in /var/log/maillog: PLESK_INFO: server postfix/smtpd[52260]: SSL_accept error from server.example.com[127.0.0.1]: -1 server postfix/smtpd[52260]: warning: TLS library problem: error:140760FC:SSL routines:SSL23_GET_CLIENT_HELLO:unknown protocol:s23_srvr.c:647: server postfix/smtpd[52260]: lost connection after STARTTLS from server.example.com[127.0.0.1] Cause
Incorrect settings in webmail configuration file /etc/psa-webmail/horde/horde/conf.php or in file /usr/share/psa-roundcube/config/config.inc.php.
Resolution Connect to the server via SSH as root. Edit configuration files with any text editor: For Horde:
Correct settings in /etc/psa-webmail/horde/horde/conf.php:
CONFIG_TEXT:// send email with authorization on SMTP server$conf['mailer']['params']['host'] = 'ssl://localhost';$conf['mailer']['params']['port'] = 465;$conf['mailer']['params']['auth'] = true;$conf['mailer']['params']['username_auth'] = true;$conf['mailer']['params']['password_auth'] = true;$conf['mailer']['type'] = 'smtp'; For Roundcube:
Add / edit the following lines in the file /usr/share/psa-roundcube/config/config.inc.php:
CONFIG_TEXT: $config['smtp_server'] = 'ssl://localhost'; $config['smtp_port'] = 465; "
5,"How to migrate a reseller or a subscription via command-line interface Applicable to: Plesk Onyx Question
How to migrate a reseller or a subscription via command-line interface?
Answer Configure Plesk Migrator according to the Plesk docs page Migration via Command Line. Create a migration list with the command: for Linux
# /usr/local/psa/admin/sbin/modules/panel-migrator/plesk-migrator generate-migration-list for Windows Server
C:\> ""%plesk_dir%admin/plib/modules/panel-migrator/backend/plesk-migrator.bat"" generate-migration-list Open the created migration list in a text editor. It should look like:
CONFIG_TEXT: # Admin subscriptions and customersPlan: Default Domain example.net Customer: client # client Plan: Default Domain example.com Reseller Plan: Default Reseller Reseller: reseller # reseller Customer: customer # customer Plan: Default Domain example.org Edit the migration list by removing subscriptions, resellers, clients that should not be migrated. For example, to migrate only one reseller and his customer, remove everything except the following lines:
CONFIG_TEXT: Reseller Plan: Default Reseller Reseller: reseller # reseller Customer: customer # customer Plan: Default Domain example.org Save the changes and close the file. Perform pre-check: for Linux
# /usr/local/psa/admin/sbin/modules/panel-migrator/plesk-migrator check for Windows Server
C:\> ""%plesk_dir%admin/plib/modules/panel-migrator/backend/plesk-migrator.bat"" check Transfer the data: for Linux
# /usr/local/psa/admin/sbin/modules/panel-migrator/plesk-migrator transfer-account for Windows Server
C:\> ""%plesk_dir%admin/plib/modules/panel-migrator/backend/plesk-migrator.bat"" transfer-accounts Perform the final check: for Linux
# /usr/local/psa/admin/sbin/modules/panel-migrator/plesk-migrator test-all for Windows Server
C:\> ""%plesk_dir%admin/plib/modules/panel-migrator/backend/plesk-migrator.bat"" test-all "
2,"Unable to access logs and files for a domain: System error 13: Permission denied Applicable to: Plesk for Linux Symptoms The following error appears in Plesk web interface when attempting to open domain logs under Domains > example.com > Logs:
PLESK_ERROR: Internal error: filemng failed: filemng: opendir failed: Permission denied system error 13: Permission denied Message filemng failed: filemng: opendir failed: Permission denied system error 13: Permission denied File Agent.php Line 219 Type PleskUtilException Attempt to change PHP settings fails in Domains > example.com > PHP Settings:
PLESK_ERROR: filemng failed: filemng: opendir failed: Permission denied system error 13: Permission denied Cause
Incorrect permissions/ownership are set for domain folders.
Resolution Connect to the server via SSH as root
Set correct permissions and ownership using the following command:
# chown psaadm:root /var/www/vhosts/system/example.com/logs/ # chmod 700 /var/www/vhosts/system/example.com/logs/ "
8,"Plesk webmail does not work: Call to undefined function mysql_connect()
Applicable to: Plesk Onyx for Linux Symptoms Plesk is installed on CentOS, RHEL or CloudLinux
Horde or Roundcube webmail does not work:
CONFIG_TEXT: A fatal error has occurred Call to undefined function mysql_connect() Details have been logged for the administrator. 500 Internal Server Error php_mysql module is missing from the list of loaded PHP modules:
# php -m | grep mysql # Cause
php_mysql package is not installed or php_mysql module is not loaded.
Resolution Login to Plesk via SSH Check if php-mysql package is installed or not:
# rpm -qa | grep php-mysql php-mysql-8.0.0-1.x86_64 Remove the existing package if it was identified:
# yum remove php-mysql
or # rpm -e --nodeps php-mysql-8.0.0-1.x86_64 --justdb Identify system PHP version:
# php -v PHP 7.0.30 (cli) (built: Apr 24 2018 21:41:09) ( NTS ) Enable the PHP repository for the system PHP (for 7.0 in this example) # vi /etc/yum.repos.d/*-php70.repo
CONFIG_TEXT: enabled=1 Install php-mysql package:
# yum install php-mysql Optionally, check if php-mysql modules are loaded:
# php -m | grep mysql mysqli mysqlnd pdo_mysql "
5,"How much disk space is needed for migration on source and destination servers? And where?
Applicable to: Plesk 12.5 for Linux
Plesk Onyx for Linux
Plesk Onyx for Windows
Plesk 12.5 for Windows Question
How much disk space is needed on source and destination servers for migration?
Answer Source server All content, except for databases, is copied directly to the destination server using rsync utility. Therefore, amount of free disk space on the source server must be greater than the size of all databases on subscriptions selected for the transfer. Note: this requirement applies only for transfer between two Plesk servers. Migration from other panels requires that amount of free disk space is the same as the size of all migrated objects.
The Temp directory specified in a new migration (from target server) is the one used to store the database dumps and temp files at the source server for later migration to destination server: Destination server The amount of free disk space on the destination server must be greater, than the total size of subscriptions selected for the transfer. Go to Tools & Settings > Summary Report and select Full Report to see full size of all subscriptions on the server.
It is recommended to add 5-10 Gb on top of the estimated size of the data. This way, either server will have enough free disk space for other operations. Example Three subscriptions are selected for the transfer:
• domain1.test has size of 10G. Among those are two databases - 1.5G and 0.5G in size.
• domain2.test has size of 3G. No databases exist on this subscription.
• domain3.test has size of 12G. Two databases - 2.5G and 1.5G in size - exist on this subscription.
In this case, source server must have 16G of free disk space (size of all databases + 10G) and destination server must have 35G of free disk space (size of all subscriptions + 10G)."
0," TTFB for site in Plesk is too high. What can be done to improve it?
Applicable to: Plesk for Windows
Plesk for Linux Question
The initial website appearance time (Time To First Byte) takes much time. What can be done to improve it?
Answer
Note: To get an idea what is a good value, compare your website performance against big service providers such as Google, Youtube, Amazon, Microsoft, etc.
Time To First Byte (TTFB) is a metric that depends on many variables. It can equally be intertwined either with the destination server side of things or any other node of the connection route.
First of all, check if the issue relates to Network particularities. Network On Windows server, open website locally and check TTFB with browsers Development mode (can be enabled in any browser with F12). On Linux server execute the below command with websites URL:
# curl -s -w '\nLookup time:\t\t%{time_namelookup}\nConnect time:\t\t%{time_connect}\nSSL handshake time:\t%{time_appconnect}\nPre-Transfer time:\t%{time_pretransfer}\nRedirect time:\t\t%{time_redirect}\nTime to first byte:\t%{time_starttransfer}\n\nTotal time:\t\t%{time_total}\n' -o /dev/null http://example.com If TTFB in local environment reduces significantly (more than 500ms), contact system administrator to test network connection bandwidth (iperf) and stability (mtr).
If most of bandwidth is taken by DNS, test website with another DNS servers, for example use 8.8.8.8 Google DNS. Make sure that TTFB depends on the website content indeed Log in to Plesk. Go to Plesk > Domains > example.com > File Manager and create test_ttfb_file.php and test_ttfb_file.html.
Note: change the ""example.com"" website name in the path above to the correct one. Open the test_ttfb_file.php file and add the next content:
CONFIG_TEXT: <?php phpinfo(); ?> Open the test_ttfb_file.html file and add the following content:
CONFIG_TEXT: <html> <body> Hello world </body> </html> Check TTFB on these sample pages by opening them in a browser with the debug console (can be enabled in any browser with F12) or by execution commands below:
Note: change the ""example.com"" website name in the commands below to the correct one.
# curl -s -w '\nLookup time:\t\t%{time_namelookup}\nConnect time:\t\t%{time_connect}\nSSL handshake time:\t%{time_appconnect}\nPre-Transfer time:\t%{time_pretransfer}\nRedirect time:\t\t%{time_redirect}\nTime to first byte:\t%{time_starttransfer}\n\nTotal time:\t\t%{time_total}\n' -o /dev/null https://example.com/test_ttfb_file.html Lookup time: 0.000956 Connect time: 0.052297 SSL handshake time: 0.167975 Pre-Transfer time: 0.168120 Redirect time: 0.000000 Time to first byte: 0.223718 Total time: 0.223787
# curl -s -w '\nLookup time:\t\t%{time_namelookup}\nConnect time:\t\t%{time_connect}\nSSL handshake time:\t%{time_appconnect}\nPre-Transfer time:\t%{time_pretransfer}\nRedirect time:\t\t%{time_redirect}\nTime to first byte:\t%{time_starttransfer}\n\nTotal time:\t\t%{time_total}\n' -o /dev/null https://example.com/test_ttfb_file.php Lookup time: 0.000868 Connect time: 0.051084 SSL handshake time: 0.165087 Pre-Transfer time: 0.165256 Redirect time: 0.000000 Time to first byte: 0.224418 Total time: 0.224494 If TTFB for sample files is fine the root cause of the issue is connected with the website code. Follow further steps to continue the issue troubleshooting. Once the Network performance is considered as fine and sample pages are load fast, proceed to the optimization of website/webserver per instructions below.
Ideally, each case should be inspected and treated individually. General recommendations can be found below: WordPress website In most cases, there are some plugins, which can contain heavy content or deprecated PHP functions. Try to disable all plugins at Plesk > Domains > WordPress > Plugins. If it helped, try to determine the plugin, which causes delay by enabling them one by one. The same can be caused by themes. Try to enable default WordPress theme (for example, ""Twenty Seventeen"", ""Twenty Sixteen"") and check TTFB. Plesk for Linux Improve performance on web server side: go to Plesk > Domains > example.com > Apache & nginx Settings and turn on the following options: Proxy mode
Smart static files processing
Serve static files directly by nginx
Enable nginx caching Enable GZIP compression with reference to How to enable gzip compression for a website on Linux; Enable ""keep-alive"" requests in Apache: go to Plesk > Domains > example.com > Apache & nginx Settings and add the following Additional directives for HTTP and Additional directives for HTTPS fields:
CONFIG_TEXT: KeepAlive On MaxKeepAliveRequests 100 KeepAliveTimeout 100 Plesk for Windows Log in to Plesk; Enable Dedicated application pool for the website at Domains > example.com > Dedicated IIS Application Pool for Website > Switch On Connect to the server via RDP. Open Internet Information Services (IIS) Manager at Control Panel > Administrative Tools > Internet Information Services (IIS) Manager Go to SERVERNAME > Application Pools, right-click on the application pool of the website, choose Advanced Settings In appeared windows change in (General) section ""Start Mode"" to AlwaysRunning; Change in CPU section ""Limit action"" to No Action; Go to Sites > example.com > Advanced Settings...(in right column); Switch ""Preload Enabled"" option to True. Enable ""keep-alive"" requests with reference to How to enable keep-alive for a website hosted on Windows Server article. Additional information
Troubleshooting slow websites"
0,"What are the Plesk system requirements
Applicable to: Plesk for Linux
Plesk for Windows Question
What are the Plesk software and hardware requirements?
Answer
The Plesk software and hardware requirements are available on the following Plesk Docs pages: Software Requirements for Plesk Obsidian Hardware Requirements for Plesk Obsidian Additional Information Plesk Requirements – Hardware & Software
"
8,"Horde Webmail has incorrect timezone
Applicable to: Plesk Onyx for Linux
Plesk Onyx for Windows Symptoms The timezone is set in Plesk > Tools & Settings > System Time > Time Zone > Your time zone for example as (GMT -08:00) America/Anchorage: The timestamps for incoming emails in Horde webmail are showing incorrectly(differ from the configured timezone in Tools & Settings > System Time). Cause
The timezone is not configured in the php.ini file of the Horde webmail.
Resolution Solution for Linux Log into the server via SSH.
Using the vi text editor open the /etc/psa-webmail/horde/horde/php.ini file. Add the line below at the end of the file and save the changes:
CONFIG_TEXT: date.timezone = America/Anchorage
Note: the additional timezones can be found here. Solution for Windows Log into the server via RDP.
Using any text editor open the %plesk_dir%Webmail\horde\conf\php.ini file.
Find and change the line below from:
CONFIG_TEXT: date.timezone=UTC
To
CONFIG_TEXT: date.timezone=America/Anchorage
Note: the additional timezones can be found here. Save the changes. "
6,"How to reset a password for the 'sa' user of a Microsoft SQL Server instance
Applicable to: Plesk for Windows Question
How to reset a password for the sa user of a Microsoft SQL Server instance?
Answer
To change a password for the sa user use any of these tools: osql utility in a command prompt
Microsoft SQL Management Studio
Plesk interface (if Microsoft SQL Server instance is registered in Plesk) Using osql utility in a command prompt Start a command prompt as an Administrator and list all Microsoft SQL Server instances:
C:\> OSQL -L Servers: WIN-TVSNFL1C14U\MSSQLSERVER2016 WIN-TVSNFL1C14U\MSSQLSERVER2017
Note: AS stated by Microsofr here, due to the nature of broadcasting on networks, osql may not receive a timely response from all servers. Therefore, the list of servers returned may vary for each invocation of this option. If the command does not display any server, try to execute it another time. In the command below, specify a Microsoft SQL Server instance for which you want to reset a password and replace ***** with your new password. Once done, run the command:
C:\> osql -S ""WIN-TVSNFL1C14U\MSSQLSERVER2017"" -E -Q ""exec sp_password NULL,'*****','sa'"" For a remote Microsoft SQL Server instance, use its remote server name or IP address:
C:\> osql -S ""SERVERNAME or IP ADDRESS\INSTANCE_NAME"" -E -Q ""exec sp_password NULL,'*****','sa'"" Using Microsoft SQL Management Studio Download and install SQL Server Management Studio on your Windows Server. Once installed, start Microsoft SQL Management Studio. To do this, run the command below in a command prompt:
C:\> ssms.exe Select Microsoft SQL Server instance for which you want to reset a password from the drop-down list and connect using Windows Authentication. In the Object Explorer, expand Security > Logins > right-click on sa to open its Properties. In the Properties window, set a new password for sa and click OK to apply the changes. If Windows administrator does not have permissions to reset a sa user password, refer to the instructions from this Microsoft article: Connect to SQL Server When System Administrators Are Locked Out - SQL Server | Microsoft Docs Using Plesk interface (if Microsoft SQL Server instance is registered in Plesk) Follow these steps if Microsoft SQL Server instance is registered in Plesk. In Plesk, go to Tools & Settings > Database Servers. Click on a hostname of a Microsoft SQL Server instance, password for which you wish to change. Click Change Password. Specify a new password and click OK. "
5,"FTP service cannot be started by xinetd if IPv6 is disabled Applicable to: Plesk 12.5 for Linux Plesk 10.x for Linux Plesk 11.x for Linux Plesk 12.0 for Linux Symptoms FTP service fails to start with the following error:
CONFIG_TEXT: xinetd[503]: socket creation failed (Address family not supported by protocol (errno = 97)). service = ftp xinetd[503]: Service ftp failed to start and is deactivated.` IPv6 support is disabled:
# grep v6 /etc/modprobe.conf alias ipv6 off options ipv6 disable=1 # grep -i v6 /etc/sysconfig/network NETWORKING_IPV6=no IPV6FORWARDING=yes Cause
The issue is caused by disabled IPv6 support on the host
Resolution
Connect to the server via SSH and remove the line in /etc/xinetd.d/ftp_psa
as shown in the example below:
CONFIG_TEXT: service ftp { flags = IPv6 <== REMOVE flags = IPv4 <== ADD disable = no socket_type = stream protocol = tcp wait = no user = root instances = UNLIMITED server = /usr/sbin/in.proftpd server_args = -c /etc/proftpd.conf }
Note: this change could be lost after Plesk upgrade."
6,"Opening phpMyAdmin from Plesk fails: Cannot connect: invalid settings
Applicable to: Plesk Onyx for Linux Symptoms
Accessing phpMyAdmin for a database from Plesk in Domains > example.com > Databases fails:
CONFIG_TEXT: Cannot connect: invalid settings Cause
Mismatch of the database user's password saved in Plesk and in MySQL server.
Resolution Log into Plesk. Go to Domains > example.com > Databases. Under a database name, click on the name of a database user: Specify a new password in fields Password and Confirm password. Click OK or Apply to save the changes. "
6,"PostgreSQL server cannot be added into Plesk: password authentication failed for user ""postgres""
Applicable to: Plesk for Linux Symptoms Adding PostgreSQL server fails with the following error in Plesk UI:
PLESK_ERROR: Error: The test connection to the database server has failed because the supplied account does not possess administrative privileges: pg_connect(): Unable to connect to PostgreSQL server: FATAL: password authentication failed for user ""postgres"" PostgreSQL database server is disabled in Tools & Settings > Database Servers. The following message is shown when pointing on grey circle in-front of PostgreSQL server:
PLESK_INFO: You need to supply a valid administrator username and password before Plesk can connect to this server. Cause
Password for PostgreSQL user postgres does not correspond password in Plesk database.
Resolution For Plesk Onyx For Plesk Onyx, there is an automatic solution for that (solution is Applicable for Plesk Onyx and higher): Log into the server via SSH.
Download postgresql.zip from the attachment and extract it:
# wget https://support.plesk.com/hc/en-us/article_attachments/360010930913/postgresql.zip# unzip postgresql.zip# chmod +x postgresql.sh Run the script to sync the passwords:
# ./postgresql.sh For older versions of Plesk Connect to the server using SSH. Locate pg_hba.conf file:
# find / -name pg_hba.conf /var/lib/pgsql/data/pg_hba.conf Make a backup of the pg_hba.conf:
# cp -p /var/lib/pgsql/data/pg_hba.conf{,.bk} Modify pg_hba.conf file as below:
CONFIG_TEXT: host all all 127.0.0.1/32 trust host all all ::1/128 trust Restart PostgreSQL server to apply changes:
# service postgresql restart Login to PostgreSQL server and reset the password (press Enter instead of inputting the password):
# psql -U postgres -h localhost psql (9.2.23) Type ""help"" for help. Reset the password:
MYSQL_LIN: ALTER USER postgres with password 'new_password';
where new_password is new password for postgres user. Revert changes in pg_hba.conf by coping the backup and restarting the service:
# cp -p /var/lib/pgsql/data/pg_hba.conf.bk /var/lib/pgsql/data/pg_hba.conf # service postgresql restart "
2,"How to add custom locale to Plesk?
Applicable to: Plesk for Linux Question
How to add a new locale in Plesk?
How to create custom language files for Plesk?
Answer
In the examples below, English 'en-US' locale is used as an original one and Czech 'cs-CZ' locale as a new one: Copy existing locale, e.g. 'en-US'
# cp -npr /usr/local/psa/admin/application/admin/resources/languages/en-US/ /usr/local/psa/admin/application/admin/resources/languages/cs-CZ/# cp -npr /usr/local/psa/admin/application/default/resources/languages/en-US/ /usr/local/psa/admin/application/default/resources/languages/cs-CZ/# cp -npr /usr/local/psa/admin/plib/locales/en-US/ /usr/local/psa/admin/plib/locales/cs-CZ/# cp -npr /usr/local/psa/admin/application/smb/resources/languages/en-US/ /usr/local/psa/admin/application/smb/resources/languages/cs-CZ/ Rename the files according to the locale code:
# cd /usr/local/psa/admin/plib/locales/cs-CZ# rename 's/en-US/cs-CZ' /usr/local/psa/admin/plib/locales/cs-CZ/* Modify messages_*.php file
# sed -i 's/en-US/cs-CZ/g' ./messages_cs-CZ.php Modify or create meta.xml file, if it does not exist, to reflect the locale name in Plesk UI
# vi /usr/local/psa/admin/plib/locales/cs-CZ/meta.xml
The file content should looks as follows:
CONFIG_TEXT: <?xml version=""1.0"" encoding=""utf-8""?><!-- Copyright 1999-2017. Parallels IP Holdings GmbH. All Rights Reserved. --><locale><language>Česky</language><country>Czech</country></locale>
Note: Custom language and country names should be placed inside <language> </language> and <country> <\country> tags. Add locale to Plesk:
# plesk db ""replace into locales values ('cs-CZ', 'true');"" Modify the files according to language specifics. When logged in using the new locale, GUI items will be reflected accordingly. For more information check Plesk localization guide"
2,"Plesk is not accessible: Unable to find service node for web service on domain with id=xxx
Applicable to: Plesk for Linux
Plesk for Windows Symptoms When trying to log into Plesk or when trying to open a domain in dashboard, Plesk shows the following error:
PLESK_ERROR: Internal error: Unable to find service node for web service on domain with id=111 The command ""plesk repair db"" reports the following error message:
# plesk repair db -nInconsistency in the table 'domains' for the column id: No rows in the table 'DomainServices' with type = 'web', dom_id = 111 ........ [ERROR] Cause
Inconsistency in the Plesk database.
Resolution
Note: Steps below are the same for both Linux and Windows. Connect to the Plesk server via SSH/RDP. Create a dump of the Plesk database: on Linux:
MYSQL_LIN: MYSQL_PWD=`cat /etc/psa/.psa.shadow` mysqldump -uadmin psa > /root/psa_backup.sql on Windows:
C:\> plesk db dump psa > C:\psa_backup.sql Connect to the Plesk database with the command (On Windows Server use a command prompt):
# plesk db Find the domain's ""ip_address_id"" using dom_id value from the error message (for example dom_id = 111):
MYSQL_LIN: mysql> select dom_id,param,val from dom_param where param='ip_addr_id' and dom_id=111;+--------+------------+------+| dom_id | param | val |+--------+------------+------+| 111 | ip_addr_id | 1 |+--------+------------+------+ Find the ""id"" with the type ""mail"" in DomainServices:
MYSQL_LIN: mysql> select * from DomainServices where dom_id=111;+------+--------+------+--------+---------------+----------------+| id | dom_id | type | status | parameters_id | ipCollectionId |+------+--------+------+--------+---------------+----------------+| 25 | 111 | mail | 0 | 639 | 25 |+------+--------+------+--------+---------------+----------------+ Find ""id"" of the IP address assigned to the domain:
MYSQL_LIN: mysql> select * from IpAddressesCollections where ipCollectionId=25;+----------------+-------------+| ipCollectionId | ipAddressId |+----------------+-------------+| 25 | 1 |+----------------+-------------+ Find the next free value for the ""id"" field in the DomainServices table: MYSQL_LIN: mysql> select max(id)+1 from DomainServices;+-----------+| max(id)+1 |+-----------+| 1447 |+-----------+ Create the missing records using id from step 7 (in this example id=1447) and ipCollectionId as 1 + the value from step 6 (in this example ipCollectionId=26 [25+1]): In the DomainServices table:
MYSQL_LIN: mysql> insert into DomainServices (id, dom_id, type, status, parameters_id, ipCollectionId) values ('1447', '111', 'web', '0', '0', '26'); In the IpAddressesCollections table:
MYSQL_LIN: mysql> insert into IpAddressesCollections (ipCollectionId, ipAddressId) values ('26', '1'); In the IpCollections table:
MYSQL_LIN: mysql> insert into IpCollections (id) values ('26'); Install Plesk microupdates:
# plesk installer update Additional Information Unable to login Plesk: Unable to find service node for web service on domain
"
6,"MySQL upgrade fails on Plesk server: Error: Package: php-mysql-5.4.45-5.el6.remi.x86_64 (@remi)
Applicable to: Plesk for Linux Symptoms
Unable to upgrade MySQL to 5.6 version:
# yum install mysql ... Error: Package: php-mysql-5.4.45-5.el6.remi.x86_64 (@remi) Requires: libmysqlclient.so.18(libmysqlclient_16)(64bit) Removing: mysql-libs-5.5.48-1.el6.remi.x86_64 (@remi) libmysqlclient.so.18(libmysqlclient_16)(64bit) ...
Cause
php-mysql-5.4.45-5.el6.remi.x86_64 is not compatible with mysql-community-libs-5.6.29 .
Resolution
Note: This article may require additional administrative knowledge to apply. If any help required, contact the server’s administrator or hosting support. Connect to the server via SSH Install yum-utils package:
# yum install yum-utils Disable Remi's RPM repository
# yum-config-manager --disable remi Remove php-mysql-5.4.45-5.el6.remi.x86_64 package:
# rpm -e --nodeps php-mysql-5.4.45-5.el6.remi.x86_64 Continue upgrade of MySQL to 5.6 version in accordance to this article If php-mysql module is required, install it from Atomic repository as below: Enable Atomic repository:
# wget -q -O - http://www.atomicorp.com/installers/atomic | sh Install php-mysql package:
# yum install php-mysql Verify that it is installed:
# php -m | grep mysql mysql mysqli pdo_mysql Additional information
How to upgrade MySQL 5.5 to 5.6/5.7 or MariaDB 5.5 to 10.0/10.1/10.2 on Linux"
9,"Unable to start named/named-chroot: zone example.com has no address records, bad zone
Applicable to: Plesk for Linux Symptoms When starting the BIND DNS service from an SSH console, the operation fails with:
# systemctl status named-chroot.service named-chroot.service - Berkeley Internet Name Domain (DNS) Loaded: loaded (/usr/lib/systemd/system/named-chroot.service; enabled; vendor preset: disabled) Active: failed (Result: exit-code) since vie 2017-01-01 12:00:00 GMT; 6s ago Process: 7833 ExecStartPre=/usr/sbin/named-checkconf -t /var/named/chroot -z /etc/named.conf (code=exited, status=1/FAILURE) named-checkconf[7833]: zone example.com/IN: loaded serial 1501115404 systemd[1]: named-chroot.service: control process exited, code=exited status=1 systemd[1]: Failed to start Berkeley Internet Name Domain (DNS). systemd[1]: Unit named-chroot.service entered failed state. systemd[1]: named-chroot.service failed The following error message appears in /var/log/messages or in the output of named configuration file syntax checking tool: on CentOS/CloudLinux 7:
# /usr/sbin/named-checkconf -t /var/named/chroot -z /etc/named.conf zone 0.0.127.IN-ADDR.ARPA/IN: loaded serial 20010622 zone example.com/IN: NS 'ns1.example.com' has no address records (A or AAAA) zone example.com/IN: NS 'ns2.example.com' has no address records (A or AAAA) zone example.com/IN: not loaded due to errors. _default/example.com/IN: bad zone ... on Debian/Ubuntu-based distributions:
# /usr/sbin/named-checkconf -t /var/named/run-root -z /etc/named.conf zone 0.0.127.IN-ADDR.ARPA/IN: loaded serial 20010622 zone example.com/IN: NS 'ns1.example.com' has no address records (A or AAAA) zone example.com/IN: NS 'ns2.example.com' has no address records (A or AAAA) zone example.com/IN: not loaded due to errors. _default/example.com/IN: bad zone ... When starting the DNS Server (BIND) service at Tools & Settings > Services management, the operation fails with:
PLESK_ERROR: Unable to start service: Unable to manage service by dnsmng: ('start', 'dns'). Error: Cause
Some DNS records are missing for the domain.
Resolution
Apply one of the following solutions: Add missing DNS records via Plesk In Plesk, go to Domains > example.com > DNS Settings. Add the missing NS/A record.
Note: To adjust DNS for multiple/all domains at once, add the missing entry at Tools and Settings > DNS Template and click Apply DNS Template. Add missing DNS records via a command-line inetrafce Connect to the server via SSH. Run the repair utility:
# plesk repair dns -y Start the DNS server: on CentOS 7:
# service named-chroot start on Debian/Ubuntu-based distributions:
# service bind9 status
If BIND DNS server still fails to start, add missing records via Plesk using the solution from ""Add missing DNS records via Plesk"". "
3,"Plesk upgrade or update fails: ERROR while trying to check the hostname
Applicable to: Plesk for Linux Symptoms Plesk installer shows warning in the beginning of upgrade:
CONFIG_TEXT: Your host name must resolve to the correct IP address of your server, unless you are using network address translation (NAT). Please quit Parallels Installer, fix the host name resolution problem, and then try installing again. You can skip the hostname check and continue the installation, however, in such a case, the installer cannot guarantee a successful installation. Plesk upgrade to next release or Plesk updates installation fails:
CONFIG_TEXT: Can not bind a socket to address host.example.com:715 - Cannot assign requested address
or
CONFIG_TEXT: Please specify the host name in the /etc/hosts file or specify DNS configuration in the /etc/resolv.conf on your system. ERROR while trying to check the hostname
or
CONFIG_TEXT: Warning: Host name check failed. Can't bind to socket: Cannot assign requested address (hostname='example.com', ip=203.0.113.3) Cause
Invalid hostname or IP address configuration in /etc/hosts or /etc/sysconfig/network.
Resolution Connect to Plesk via SSH Identify the server hostname and IP address:
# hostname server.example.com
# ip a | grep inet | egrep -v ""127.0.0.1|::1"" inet 203.0.113.2/32 brd 203.0.113.2 scope global venet0:0 Set actual IP address and hostname in /etc/hosts file identified on previous step:
CONFIG_TEXT: 203.0.113.2 server.example.com
If the server has several IP addresses, ping the hostname from local server or workstation to determine the main address:
# ping host.example.com PING server.example.com (203.0.113.2) 56(84) bytes of data. 64 bytes from server.example.com (203.0.113.2): icmp_seq=1 ttl=56 time=54.9 ms
If the server is behind NAT, use the private server IP address. Click here to see the command used to check IP address from the local computer # nslookup host.example.com ... Name: host.example.com Address: 203.0.113.2 For CentOS7/CloudLinux7/RHEL7 only, specify the hostname from step 2:
# hostnamectl set-hostname host.example.com "
3,"Classic ASP website shows 500 Internal server error: Server.MapPath() error 'ASP 0175 : 80004005'
Applicable to: Plesk for Windows Symptoms A website based on Classic ASP shows the following error in a web-browser:
PLESK_INFO: 500 – Internal server error After enabling debug logging for ASP in IIS (IIS Manager > Sites > example.com > ASP > Debugging Properties > Send Error to Browser > True), the website starts to show:
PLESK_INFO: Server.MapPath() error 'ASP 0175 : 80004005' Disallowed Path Characters /asptest/admin/conn.asp, line 10 The '..' characters are not allowed in the Path parameter for the MapPath method. After starting the Failed Requests Tracing in Plesk at Domains > example.com, the following error can be found:
PLESK_INFO: ASP_LOG_ERRORLineNumber 6ErrorCode ASP 0131Description Disallowed Parent Path Cause
The Enable Parent path parameter is set to False in domain's ASP settings in IIS.
Resolution
Note: This guide is intended for Plesk administrators with RDP access to a Plesk server. If you are a domain owner, please contact your service provider for assistance. Connect to the Plesk server via RDP. In IIS Manager, expand SERVERNAME > Sites > click on example.com > ASP. Set Enable Parent path to True. Click Apply. "
0," How to synchronize locked subscriptions with their service plans
Applicable to: Plesk for Linux
Plesk for Windows Question
A subscription is flagged with a blue lock saying:
PLESK_INFO: The subscription is locked for synchronization: It is excluded from syncing with the service plan because the subscription parameters were customized.
How to synchronize locked subscriptions with their service plans?
Answer Synchronizing a subscription with its service plan via Plesk Go to Subscriptions > example.com. Click Unlock & Sync in the Account section on the right.
Click on the picture to enlarge Synchronizing all subscriptions via a command-line interface In Plesk for Linux Connect to a Plesk server via SSH. Create a list with all locked subscriptions:
# plesk db -sNe ""select name from domains d INNER JOIN Subscriptions s ON d.id=s.object_id where d.webspace_id=0 AND s.object_type='domain' AND s.locked='true'"" > /root/locked_subscriptions.txt Unlock subscriptions from the generated list:
# for domain in `cat /root/locked_subscriptions.txt`; do /usr/local/psa/bin/subscription --unlock-subscription $domain; done Synchronize these subscriptions with their service plans:
# for domain in `cat /root/locked_subscriptions.txt`; do /usr/local/psa/bin/subscription --sync-subscription $domain; done (Optional) Check that no unsynced subscriptions left. The following command should return empty output:
# plesk db -sNe ""select name from domains d INNER JOIN Subscriptions s ON d.id=s.object_id where d.webspace_id=0 AND s.object_type='domain' AND s.synchronized='false'"" In Plesk for Windows Server Connect to the Plesk server via RDP. Start a command prompt as an Administrator. Create a list with all locked subscriptions:
C:\> plesk db -sNe ""select name from domains d INNER JOIN Subscriptions s ON d.id=s.object_id where d.webspace_id=0 AND s.object_type='domain' AND s.locked='true'"" > locked_subscriptions.txt Unlock and synchronize subscriptions from the generated list:
C:\> for /f %i in (locked_subscriptions.txt) do plesk bin subscription --unlock-subscription %i & for /f %i in (locked_subscriptions.txt) do plesk bin subscription --sync-subscription %i (Optional) Check that no unsynced subscriptions left. The following command should return empty output:
C:\> plesk db -sNe ""select name from domains d INNER JOIN Subscriptions s ON d.id=s.object_id where d.webspace_id=0 AND s.object_type='domain' AND s.synchronized='false'"" Additional Information Hosting Plans and Subscriptions - Plesk Administrator's Guide
Syncing Subscriptions and Plans - Plesk Reseller's Guide "
5,"Horde Calendar, Address Book and preferences are not migrated
Applicable to: Plesk for Linux Symptoms
Domains have been migrated to Plesk using Plesk Migration & Transfer Manager (Tools & Settings > Migration & Transfer Manager), but Calendar, Personal address book and Horde preferences were not migrated.
Cause
Migration of Horde Calendar, Address Book and preferences is not supported by Plesk Migrator: The Horde database format differs significantly from one version to another, which makes it impossible to automate this process.
If you would like to see this feature in Plesk, please vote for this feature on Plesk UserVoice: https://plesk.uservoice.com/forums/184549-feature-suggestions/suggestions/32263882 Resolution Use the Import/Export feature of Horde webmail to migrate address books per email account. On the source server, log in to Horde > go to Address Book tab > click Import/Export. Click Export to save a contacts.csv file. On the target Plesk server, log in to Horde > go to Address Book tab > click Import/Export. Click Choose file > select contacts.csv and click Open > define options and click Next. In order to migrate Horde Calendar, Address Book and preferences, migrate the Horde database. Use the commands below for manual migration.
Note: Already existing Horde data on the target Plesk server will be lost.
Warning: Horde versions must be the same on both source and destination servers! Dump the database on the source server:
# MYSQL_PWD=`cat /etc/psa/.psa.shadow` mysqldump -u admin horde > source_horde.sql For security reasons, on the target (destination) server, back up the Horde database:
# MYSQL_PWD=`cat /etc/psa/.psa.shadow` mysqldump -u admin horde > target_horde.sql Then, delete and recreate the database:
# MYSQL_PWD=`cat /etc/psa/.psa.shadow` mysql -u admin -e""drop database horde"" # MYSQL_PWD=`cat /etc/psa/.psa.shadow` mysql -u admin -e""create database horde"" Restore data from the source server:
# MYSQL_PWD=`cat /etc/psa/.psa.shadow` mysql -u admin horde < source_horde.sql "
7,"Difference between Power User View and Service Provider View in Plesk
Applicable to: Plesk for Linux
Plesk for Windows Description
Warning: #1 the following information is for administrator account of the server only. It is not applicable to subscription owner/users or customer accounts, because for those accounts it will be always Power User view.
Warning: #2 Information also might be not applicable for servers that have the view locked on the license level. To check that, contact Customer/Partner Success department. Service provider view is available for Web Pro and Web host editions only.
There are several product User Interface views available for you. Depending on view used, features and settings may be located in different places or even enabled/disabled.
Different views are better suited to different types of users. There are two types of them: Power User view - this view is intended for enabling a single, simplified interface for server administrators to manage their own websites, e-mail accounts, and other services. Service Provider view - this view offers interfaces for use by the server administrator, resellers, and hosting users. Switch interface view using Plesk GUI To change UI in Plesk click Change view at the bottom of the page and select Service Provider view/Power User view. Interface view can be switched under Home > Tools & Settings > Interface Management: Note: Plesk administrator cannot change the view to Power User view if at least one reseller or customer exist in Plesk.
There is also Tools & Settings > Interface management > Interface control visibility tab where it is possible to hide predefined groups of buttons from the Plesk: Switch interface view using CLI For Linux: Log into the server as a root user over SSH. Execute the following command in order to change view to Service Provider view:
# plesk bin poweruser --off Execute the following command to change view to Power User view:
# plesk bin poweruser --on For Windows: Connect to the server via RDP and open cmd.exe as administrator and execute the following to enable Service provider view: To enable Service provider view execute the following command:
C:\> plesk bin poweruser --off To enable Power user view, execute the following:
C:\> plesk bin poweruser --on "
9,"Cannot send mail messages from Plesk server. Client host rejected: cannot find your reverse hostname
Applicable to: Plesk for Linux Symptoms Mails are not sent to some specific addresses. There are the following error messages in the /var/log/maillog file:
CONFIG_TEXT: ME-IXXXX: [0A9BDE4490704C08A66604721DC0C96B.MAI] Remote server returned a response indicating a temporary failure. Server Response: (450 4.7.1 Client host rejected: cannot find your reverse hostname, [203.0.113.2]) CONFIG_TEXT: Reason: Remote SMTP Server Returned: 550 5.7.0 Your server IP address [203.0.113.2] is missing a reverse DNS entry Cause
Reverse DNS zone for the affected IP address and domain does not exist.
Resolution
Reverse DNS records should be created by the owner of the IP address. Usually, it is a Hosting service provider or Internet Service Provider (ISP). Contact IP address provider and request to create reverse DNS zone for affected IP address and domain. "
8,"[FIXED BUG] Mail accounts cannot log into Plesk web interface if password is encrypted
Applicable to: Plesk for Linux Symptoms Mail accounts with Access to the Control Panel option set in Domains > example.com > Email Addresses > mailbox name cannot log into Plesk GUI with PLAIN password if the password is encrypted in the database. The following error is displayed:
PLESK_ERROR: Error: You have entered incorrect username or password. The users had an encrypted password before the upgrade:
# mysql -uadmin -p`cat /etc/psa/.psa.shadow` -Dpsa -e ""select mail_name, domains.name as domain from accounts, mail,domains where dom_id = domains.id and mail.account_id = accounts.id and type='crypt'"" +-----------+--------+ | mail_name | domain | +-----------+--------+ | admin | example.com | +-----------+--------+ PLAIN authentication to the mail server itself works without issues, only Plesk GUI login does not work. Cause Product issue: #PPPM-1405 ""It is now possible to log in to Plesk with an email address account, whose password was encrypted.""Fixed in:
Plesk Obsidian 27 August 2019 (fixed as PPP-43681) Resolution
Please consider updating your server: How to install Plesk updates Workaround Connect to the server via SSH Get a list of mail users with encrypted passwords (affected users):
# mysql -uadmin -p`cat /etc/psa/.psa.shadow` -Dpsa -e ""select mail_name, domains.name as domain from accounts, mail,domains where dom_id = domains.id and mail.account_id = accounts.id and type='crypt'"" +-----------+--------+ | mail_name | domain | +-----------+--------+ | admin | example.com | +-----------+--------+ Change the password for all users retrieved from the list in Domains > example.com > Email Addresses > mailbox name As a workaround for Plesk 12.5 and Plesk Onyx, use:Note: This fix below will resolve the issue for encrypted passwords which starts with ""$1$"".Note: For Plesk 12.5 the custom fix can be applied without password changing.Click on a section to expand
For RHEL/CentOS based system Plesk 12.5 and Plesk Onyx 17.0:
# wget https://support.plesk.com/hc/en-us/article_attachments/360004705833/User_1.zip # unzip User_1.zip # mv /usr/local/psa/admin/plib/Smb/Db/Table/Row/User.php{,.bk} # mv User.php /usr/local/psa/admin/plib/Smb/Db/Table/Row/User.php
Plesk Onyx 17.5:
# wget https://support.plesk.com/hc/en-us/article_attachments/360004678194/User_2.zip # unzip User_2.zip # mv /usr/local/psa/admin/plib/Smb/Db/Table/Row/User.php{,.bk} # mv User.php /usr/local/psa/admin/plib/Smb/Db/Table/Row/User.php
Plesk Onyx 17.8:
# wget https://support.plesk.com/hc/en-us/article_attachments/360004707293/User_3.zip# unzip User_3.zip # mv /usr/local/psa/admin/plib/Smb/Db/Table/Row/User.php{,.bk} # mv User.php /usr/local/psa/admin/plib/Smb/Db/Table/Row/User.php For Debian/Ubuntu based system Plesk 12.5 and Plesk Onyx 17.0:
# wget https://support.plesk.com/hc/en-us/article_attachments/360004707293/User_1.zip # unzip User_1.zip # mv /opt/psa/admin/plib/Smb/Db/Table/Row/User.php{,.bk} # mv User.php /opt/psa/admin/plib/Smb/Db/Table/Row/User.php
Plesk Onyx 17.5:
# wget https://support.plesk.com/hc/en-us/article_attachments/360004707293/User_2.zip # unzip User_2.zip # mv /usr/local/psa/admin/plib/Smb/Db/Table/Row/User.php{,.bk} # mv User.php /usr/local/psa/admin/plib/Smb/Db/Table/Row/User.php
Plesk Onyx 17.8:
# wget https://support.plesk.com/hc/en-us/article_attachments/360004707293/User_3.zip# unzip User_3.zip # mv /opt/psa/admin/plib/Smb/Db/Table/Row/User.php{,.bk} # mv User.php /opt/psa/admin/plib/Smb/Db/Table/Row/User.php "
0,"How to check what limits have been exceeded by a subscription/reseller?
Applicable to: Plesk for Windows
Plesk for Linux Question
A subscription/reseller is suspended every day for no apparent reason.
How to check what limits have been exceeded by a subscription/reseller?
Answer Check limits manually: For a reseller:
Go to Plesk > Resellers > John Doe > View More Statistics > Resources For a subscription:
Go to Plesk > Subscriptions > example.com > Account > Resources Turn on notifications regarding exceeded limits: Go to Plesk > Tools & Settings > Notifications Make sure that Resource usage limits exceeded by subscription and Subscription suspended due to resource overuse events are enabled and email addresses for notifications are set.
Once any limit is exceeded, an email with this information will be sent to the mentioned mailbox, e.g:
PLESK_INFO: The following resources were overused by subscription 'example.com', owned by user 'John Doe':Sites published with Presence Builder: 01 used / 0The subscription was suspended. "
2,"How to use different SSL certificates for Plesk UI (over port 8443)?
Applicable to: Plesk for Linux
Plesk for Windows Question
How to use different SSL certificates if different Plesk UI hostnames are used?
For example, have different valid certificates for: https://contoso.com:8443
https://example.com:8443
https://domain.com:8443 Answer
The functionality is not yet implemented in Plesk. Vote for it on our UserVoice: Feature Suggestions. SSL support for resellers. Top-voted suggestions are likely to be included in the next Plesk updates."
6," How to fix InnoDB corruption cases for the MySQL databases on Plesk for Linux?
Applicable to: Plesk for Linux Symptoms The following error is shown in Plesk:
PLESK_INFO: ERROR: PleskMainDBException MySQL query failed: Incorrect information in file: './psa/misc.frm' PLESK_INFO: ERROR: PleskDBException: Unable to connect to database: mysql_connect(): No such file or directory /var/run/mysqld/mysqld.sock (Error code: 2002). Please check that database server is started and accessible. (Abstract.php:69) PLESK_INFO: ERROR: Zend_Db_Adapter_Exception: SQLSTATE[HY000] [2002] No such file or directory PLESK_INFO: ERROR: Zend_Db_Adapter_Exception: SQLSTATE[HY000] [2002] Connection refused: 0: /usr/local/psa/admin/externals/Zend/Db/Adapter/Pdo/Abstract.php:144 Domain overview page on Domains > example.com is not accessible:
CONFIG_TEXT: 500 Server Error Type SB_Facade_Exception_Generic Message File generic.php Line 33 phpMyAdmin might show the following error message:
PLESK_ERROR: Could not save configuration #1932 - Table 'phpmyadmin_AAbBc0CdDeEf.pma_userconfig' doesn't exist in engine Plesk upgrade fails with the following error:
PLESK_INFO: DATABASE ERROR!!! Database psa database found, but version undefined MySQL service does not start:
# service mysqld start Timeout error occurred trying to start MySQL Daemon. Starting MySQL: [FAILED] mysqldump and mysqlcheck utilities fail with an error message claiming a table does not exist (use the MySQL administrator account to check):
# mysqlcheck -uadmin -p****** db_example db_example.BackupTasks error : Can't find file: 'BackupTasks.MYD' (errno: 2) A table cannot be properly queried with the SELECT statement:
MYSQL_LIN: select * from db_example.misc; ERROR 1033 (HY000): Incorrect information in file: './db_example/misc.frm' The table cannot be repaired because the InnoDB engine does not support repair queries:
# mysql> repair table misc; +-------------------------+--------+----------+-------------------------------------------------------+ | Table | Op | Msg_type | Msg_text | +-------------------------+--------+----------+-------------------------------------------------------+ | psa.APSApplicationItems | repair | note |The storage engine for the table doesn't support repair| +-------------------------+--------+----------+-------------------------------------------------------+ The following information can be found in the MySQL log file /var/log/mysql/error.log, /var/log/mysqld.log, or /var/log/mariadb/mariadb.log:
CONFIG_TEXT: 150704 19:09:27 InnoDB: Waiting for the background threads to start 150704 19:09:28 InnoDB: Error: tablespace size stored in header is 3712 pages, but 150704 19:09:28 InnoDB: the sum of data file sizes is only 3072 pages 150704 19:09:28 InnoDB: Cannot start InnoDB. The tail of the system tablespace is 150704 19:09:28 InnoDB: missing. Have you edited innodb_data_file_path in my.cnf in an 150704 19:09:28 InnoDB: inappropriate way, removing ibdata files from there? 150704 19:09:28 InnoDB: You can set innodb_force_recovery=1 in my.cnf to force 150704 19:09:28 InnoDB: a startup if you are trying to recover a badly corrupt database. CONFIG_TEXT: InnoDB: Assertion failure in thread 3876 in file ha_innodb.cc line 17352 InnoDB: We intentionally generate a memory trap. InnoDB: Submit a detailed bug report to http://bugs.mysql.com. InnoDB: If you get repeated assertion failures or crashes, even InnoDB: immediately after the mysqld startup, there may be InnoDB: corruption in the InnoDB tablespace. Please refer to InnoDB: http://dev.mysql.com/doc/refman/5.6/en/forcing-innodb-recovery.html InnoDB: about forcing recovery. CONFIG_TEXT: InnoDB: Assertion failure in thread 140154354255616 in file trx0purge.c line 848 InnoDB: Failing assertion: purge_sys->purge_trx_no <= purge_sys->rseg->last_trx_no InnoDB: We intentionally generate a memory trap. CONFIG_TEXT: InnoDB: Your database may be corrupt or you may have copied the InnoDB tablespace but not the InnoDB log files. Please refer to http://dev.mysql.com/doc/refman/5.7/en/forcing-innodb-recovery.html for information about forcing recovery CONFIG_TEXT: [ERROR] InnoDB: Attempted to open a previously opened tablespace. Previous tablespace database/table uses space ID: 882 at filepath CONFIG_TEXT: [Note] InnoDB: Starting crash recovery. [ERROR] InnoDB: Tablespace 11904 was not found at ./example_db/example1.ibd. [ERROR] InnoDB: Set innodb_force_recovery=1 to ignore this and to permanently lose all changes to the tablespace. [ERROR] InnoDB: Tablespace 11905 was not found at ./example_db/example2.ibd. [ERROR] InnoDB: Cannot continue operation. CONFIG_TEXT: InnoDB: Error: space header page consists of zero bytes in data file ./ibdata1 CONFIG_TEXT: InnoDB: Database page corruption on disk or a failed file read of page 660. A table cannot be properly queried with the SELECT statement - additional possible output: MariaDB [psa]> select * from db_example.misc; ERROR 2006 (HY000): MySQL server has gone away No connection. Trying to reconnect... Cause
InnoDB corruption.
Most InnoDB corruptions are hardware-related. Corrupted page writes can be caused by power failures or bad memory. The issue also can be caused by using network attached storage (NAS) and allocating InnoDB databases on it.
Resolution
Note: Since the MySQL service's control, logs and configuration file's location is different on the different operating systems, this article provides general command examples only. Check the following article for additional information regarding MySQL on different operating systems [Linux] Local MySQL server for all databases For additional information check your operating system and MySQL documentation.
Note: for Windows, see the following article: How to fix InnoDB corruption cases for the MySQL databases on Plesk for Windows?
There are several ways to recover a failed MySQL database:
Firstly, connect to the server using SSH. I. Force InnoDB Recovery Stop the affected MySQL service:
# service mysql stop Back up all the MySQL data storage files. By default, they are located in /var/lib/mysql/
For example:
# mkdir /root/mysql_backup # cp -a /var/lib/mysql/* /root/mysql_backup/ Set the innodb_force_recovery value under the [mysqld] section in the MySQL configuration file. This option will allow you to start MySQL service and create all databases dump.
For example:
# vi /etc/my.cnf [mysqld] innodb_force_recovery = 2 Start the MySQL service. If the service fails to start, set the parameter innodb_force_recovery to greater value and try starting MySQL again. Value of the parameter innodb_force_recovery can be from 1 to 6.
Warning: Only set innodb_force_recovery to a value greater than 0 in an emergency situation, so that you can start InnoDB and dump your tables. Values of 4 or greater can permanently corrupt data files. Therefore, increase this value incrementally, as necessary. Please see more details in the official MySQL Documentation. If the service fails to start with an error like:
CONFIG_TEXT: InnoDB: Waiting for the background threads to start
Add directive innodb_purge_threads according to the following article: Unable to start MySQL service: InnoDB: Waiting for the background threads to start Try to dump all databases:
# MYSQL_PWD=`cat /etc/psa/.psa.shadow` mysql -Ns -uadmin psa -Ne""show databases""|grep -v information_schema | grep -v performance_schema > /root/db_list.txt # mkdir /root/db_backup/ # cat /root/db_list.txt | while read i; do MYSQL_PWD=`cat /etc/psa/.psa.shadow` mysqldump -uadmin ""$i"" --routines --databases > /root/db_backup/""$i"".sql; echo $i; sleep 5; done If the dump fails with an error like: CONFIG_TEXT: Incorrect information in file: './psa/APSApplicationItems.frm' when using LOCK TABLES""`
then increase innodb_force_recovery value, restart MySQL service, and try to dump the databases again. It is better to dump databases one by one, separately. In that case, there is no need to go through restore of all databases once again if restore failed for some reason. If unable to dump the databases, then try using method II (Copy table content) or III (Restore from the backup) which are described below. Remove all the MySQL data storage files except the mysql folder. For example:
# rm -rf `ls -d /var/lib/mysql/* | grep -v ""/var/lib/mysql/mysql""` Remove the innodb_force_recovery option from the MySQL configuration file. Restart the MySQL service:
# service mysqld restart Check the MySQL log file for any errors. Restore databases from the dumps made on the 5th step. For example:
# for db in `cat /root/db_list.txt`; do echo -e ""Importing $db...""; MYSQL_PWD=`cat /etc/psa/.psa.shadow` mysql -uadmin < /root/db_backup/$db.sql; done II. Copy table contents Repeat steps #1-4 from the method I to back up all the MySQL data storage files and enable InnoDB recovery mode. Try to make a copy of a table:
MYSQL_LIN: CREATE TABLE <new_table> LIKE <crashed_table>; MYSQL_LIN: INSERT INTO <new_table> SELECT * FROM <crashed_table>; If the copy was created successfully, then replace corrupted table with newly created:
MYSQL_LIN: RENAME TABLE <crashed_table> TO <old_table>; MYSQL_LIN: RENAME TABLE <new_table> TO <crashed_table>; MYSQL_LIN: DROP TABLE <old_table>;
Note: Depending on the MySQL version used, it might be necessary to set lower innodb_force_recovery value or remove it from the MySQL configuration file and restart MySQL service to successfully perform the DROP and RENAME operations. Please see more details in the official MySQL Documentation. III. Restore from a backup If the instructions above did not help, the only remaining method is to restore the databases from backups. Do not forget to remove the innodb_force_recovery option from the MySQL configuration file before restore. To restore Plesk-related databases (psa, apsc, horde) see How to backup/restore a Plesk database dump article. For example:
# ls -tl /var/lib/psa/dumps -rw------- 1 root root 141960 Aug 8 01:03 mysql.daily.dump.0.gz -rw------- 1 root root 141925 Aug 7 01:03 mysql.daily.dump.1.gz # zcat /var/lib/psa/dumps/mysql.daily.dump.0.gz | MYSQL_PWD=`cat /etc/psa/.psa.shadow` mysql -u admin psa To restore customer's databases from Plesk backup see the Restoring Data from Backup Archives section in the Administrator's Guide.
Note: If timeouts are encountered when restoring databases, set the wait_timeout value in the MySQL configuration file and restart the MySQL service. For example:
# vi /etc/my.cnf [mysqld] wait_timeout = 1800 "
0,"How to generate certificate signing request (CSR) for domain in Plesk
Applicable to: Plesk for Linux Question
How to generate certificate signing request (CSR) for domain in Plesk?
Answer
Note: This article may require additional administrative knowledge to apply. If any help required, contact server’s administrator or hosting support. Generating CSR for SAN (multi-domain) certificates is not supported, vote and comment on the following feature request from Plesk UserVoice channel. Via Plesk GUI Video instructions: 1. Log in to Plesk and go to Domains > example.com > SSL/TLS Certificates
2. Click Add SSL/TLS Certificate: 3. Specify the certificate parameters: Certificate name. This will help you identify this certificate in the repository. Bits. Choose the encryption level of your SSL certificate. In Plesk Onyx, 2048, 3072 and 4096 bits are available. Country, State or province, location (city), organization name (company). The values you enter should not exceed the length of 64 symbols. The domain name for which you want to purchase an SSL certificate. This should be a fully qualified domain name. Example: example.com. Email: The website administrator's email address Make sure that all the provided information is correct and accurate, as it will be used to generate your private key.
4. Click Request: Plesk will generate your private key and certificate signing request (CSR) and add them to your certificates repository (Domains > example.com > SSL/TLS Certificates).
5. Now that the CSR has been generated, provide it to the chosen Certificate Authority to purchase a certificate from them. In the list of certificates in Domains > example.com > SSL/TLS Certificates, click the name of the certificate you need. 6. Locate the CSR section on the page and copy to clipboard text that starts with the line -----BEGIN CERTIFICATE REQUEST----- and ends with the line -----END CERTIFICATE REQUEST----- . 7. Provide the CSR to the Certification Authority when purchasing the certificate. The exact procedure differs from one Certificate Authority to another, so contact the Certificate Authority for assistance. Once the purchase is completed, you will be given the certificate in the form of either a *.crt file, a *.pem file, or in text form. Via command line Video instructions: Connect to the server via SSH. Run the following command:
# openssl req -new -newkey rsa:2048 -nodes -keyout server.key -out server.csr
where ""server"" is the name of your server. This will begin the process of generating two files: the private key file to decryption SSL Certificate, and certificate signing request (CSR) file used to apply for the SSL Certificate. When prompted for common name (domain name), enter the fully qualified domain name for the site that is to be secured. If generating an Nginx CSR for Wildcard SSL Certificate, the common name should start with asterisk (e.g. *.example.com ). After that, other information will be requested, such as organizational information beginning with geographic information. There may be default information set already. Then .csr file will be created. Save (back up) the generated .key file as it will be required later when installing the SSL certificate in the webserver. "
0,"Failed to install ModSecurity rule set in Plesk: Unable to find row xxx with id in domains table
Applicable to: Plesk Onyx for Linux
Plesk Onyx for Windows Symptoms
Unable to activate Tools & Settings > Web Application Firewall (ModSecurity) in Plesk with the following error:
PLESK_ERROR: Failed to install the Mod-security rule set: Unable to find row with id 221 in domains table.
OR
PLESK_ERROR: Db_Table_Exception: Unable to find row with id 221 in domains table.
OR
PLESK_ERROR: Failed to update the ModSecurity rule set: Unable to find row with id 221 in domains table.
Cause
Database inconsistency.
Resolution
Note: This article is intended for use by server administrators. In case there is no administrative SSH or RDP access to the server, contact the server administrator or server provider. Plesk for Linux Connect to the server using SSH. Create Plesk database dump:
# plesk db dump psa > ./psa_dump.sql Run the automatic database repair:
# plesk repair db Plesk for Windows Connect to the server using RDP. Open PowerShell as administrator. Create Plesk database dump:
PS plesk db dump psa | Out-File psa_dump.sql Run the automatic database repair:
PS plesk repair db If the issue persists, access Plesk database:
PS plesk db Remove the entries for Application Pools that have no domain relations from the database:
MYSQL_WIN: DELETE i, ia FROM IisAppPools i LEFT JOIN IisAppPoolDomains ia ON i.id = ia.poolId LEFT JOIN domains d ON d.id = ia.domainId WHERE d.name IS NULL AND i.id != 1; "
7,"Plesk upgrade/update/repair fails: No space left on device
Applicable to: Plesk for Linux Symptoms Plesk upgrade or update fails with various errors in Plesk or /tmp/autoinstaller3.log:
CONFIG_TEXT: dpkg: error processing /var/cache/apt/archives/wpb-designs-00_12.0.4-43480.14051315_all.deb (--unpack):error creating directory `./usr/local/sb/htdocs/templates/generic/presets_default/resume/00_1': No space left on device
PLESK_ERROR: ERROR: Failed to read product information from the file : Can't process products.inf3: Failed to write to the file /root/parallels/products.inf3.tmp: No space left on device. Can't process versions.inf3: File could not be downloaded, probably due to insufficient amount of free disk space.
PLESK_ERROR: ERROR: Failed to install or upgrade the extension 'WordPress Toolkit' (package: wp-toolkit): PHP Warning: ZipArchive::extractTo(): No space left on device; Inodes limit check shows the following:
# df -i Filesystem Inodes IUsed IFree IUse% Mounted on /dev/vzfs 800000 800000 0 100% / none 2097152 95 2097057 1% /dev Cause
Inodes limit has been exceeded on disk partition. Resolution
Contact system administrator to increase the inodes limit.
For a Virtuozzo container, log in to Virtuozzo server using SSH and use the following command:
# vzctl set <CT> --save --diskinodes 850000:900000
where <CT> is the corresponding ID of the container with Plesk."
8,"""Activate mail service on domain"" button is greyed out
Applicable to: Plesk for Linux
Plesk for Windows Symptoms
Mail service is disabled in Subscription > example.com > Mail > Mail Settings and it is not possible to enable it through the control panel because Activate mail service on domain button is greyed out but the subscription is active.
Cause
Database inconsistency.
Resolution Connect to the server via SSH/via RDP. Disable and enable mail service for domain via command line:Plesk for Linux
# plesk bin mail --off example.com# plesk bin mail --on example.com Plesk for Windows
C:\> plesk bin mail --off example.comC:\> plesk bin mail --on example.com Additional information
""Activate mail service on domain"" button is greyed out"
6,"Website is unavailable: Failed to login to session state SQL server for user
Applicable to: Plesk Onyx for Windows Symptoms
A website is unavailable:
CONFIG_TEXT: Server Error in '/' Application. Failed to login to session state SQL server for user 'jdoe'. [SqlException (0x80131904): Login failed for user 'jdoe'.]
Cause
Incorrect credentials set for database user in %plesk_vhosts%example.com\httpdocs\web.config.
Resolution Log in to Plesk. Open Domains > example.com > Databases > example_db > jdoe. Change the password to the necessary one. Connect to the server via RDP. Open %plesk_vhosts%example.com\httpdocs\web.config. Find ""<ConnectionStrings>"" section and type correct IP address of the database server and credentials - user and password:
CONFIG_TEXT: <connectionStrings> <add name=""example_db"" connectionString=""Persist Security Info=True;Initial Catalog=example_db;Data Source=203.0.113.2;User ID=jdoe;Password=password"" /> </connectionStrings> "
3,"Website returns 403 Forbidden or blank page: AH00529: pcfg_openfile: unable to check htaccess file, ensure it is readable
Applicable to: Plesk for Linux Symptoms Website is not working:
CONFIG_TEXT: You don't have permission to access / on this server. Additionally, a 403 Forbidden error was encountered while trying to use an ErrorDocument to handle the request.
OR
The blank page is shown instead of content. The domain's error log /var/www/system/example.com/logs/error_log contains the following:
CONFIG_TEXT: (13)Permission denied: /var/www/vhosts/example.com/.htaccess pcfg_openfile: unable to check htaccess file, ensure it is readable, referer: http://example.com/ (13)Permission denied: [client 203.0.113.2:39024] AH00529: /var/www/vhosts/example.com/httpdocs/.htaccess pcfg_openfile: unable to check htaccess file, ensure it is readable and that '/var/www/vhosts/example.com/httpdocs/' is executable A lot of TIME_WAIT connections to/from 7080/7081 or 80/443 ports. Cause
Apache service does not have proper permissions to vhost or httpdocs folder.
Resolution
The most common cause of this issue is missing executable permissions on the folders.
Click on a section to expand First, try to repair permissions for the website content. For Plesk Onyx 17.8 Connect to the server via SSH. Execute the following command (replacing example.com with the domain name):
# plesk repair fs example.com Add executable for all the folders inside the document root of the website:
# find /var/www/vhosts/example.com/httpdocs/ -type d -exec chmod 755 {} \; For Plesk Onyx 17.5 and lower: Connect to the server via SSH. Execute the following command (replace example.com in the command below with the domain name:
# INFO=($(MYSQL_PWD=`cat /etc/psa/.psa.shadow` mysql -uadmin psa -sN -e'SELECT h.www_root,s.login FROM domains d, hosting h, sys_users s WHERE s.id=h.sys_user_id AND h.dom_id=d.id AND d.name=""example.com""')); chown -R ${INFO[1]}:psacln ${INFO[0]}; chown ${INFO[1]}:psaserv ${INFO[0]} Execute the following command (replacing example.com with the domain name):
# plesk repair fs example.com Add executable for all the folders inside the document root of the website:
# find /var/www/vhosts/example.com/httpdocs/ -type d -exec chmod 755 {} \; In case the issue will persist, check whether or not the site is compatible with PHP handler. Click here to reveal additional information regarding this point In Plesk interface, navigate to Domains > example.com > PHP Settings and try to switch handlers (by FastCGI or to PHP-FPM) to a different one: There is also a chance that this issue is global and it affects all the websites. In that case, it is required to check Apache user permissions: For Debian Find the username that is used by the Apache service. This username is defined in the APACHE_RUN_USER variable in /etc/apache2/envvars:
# grep APACHE_RUN_USER /etc/apache2/envvars export APACHE_RUN_USER=www-data Add that user to the psaserv group. For example, if the Apache user is www-data, you would add the user in the psaserv group as below:
# usermod -a -G psaserv www-data Restart web server
# service apache2 restart For CentOS Add the apache user to the psaserv group:
# usermod -a -G psaserv apache Restart web server
# service httpd restart Note: If the server is running on Proxmox VE, this configuration is not going to work as expected. Please contact Proxmox support for further assistance.
Note: It is also worth checking SELinux in case CentOS is used on the server. Set it to permissive with setenforce 0 command to check it."
8,"How to show the emails in HTML by default in Horde on a Plesk server?
Applicable to:
Plesk for Linux
Question
How to show the emails in HTML by default in Horde on a Plesk server?
Answer
Note: To apply the solution from this article it is required to have SSH access to the server
By default, inline HTML viewing is disabled in Horde and it can be enabled following these steps: Connect to the server via SSH Create the mime_drivers.local.php files:
# cp -a /usr/share/psa-horde/config/mime_drivers{,.local}.php
# cp -a /usr/share/psa-horde/imp/config/mime_drivers{,.local}.php Set the 'inline' parameter from false to true:
# sed -i.backup ""s/'inline' => false,/'inline' => true,/g"" /usr/share/psa-horde/imp/config/mime_drivers.local.php
# sed -i.backup ""s/'inline' => false,/'inline' => true,/g"" /usr/share/psa-horde/config/mime_drivers.local.php "
0,"How to disable or remove File Sharing tab (WebDAV) in Plesk?
Applicable to: Plesk for Linux
Plesk for Windows Question
How to disable or remove File Sharing tab in Plesk so that it is not visible to customers?
Answer
It is not possible to hide/remove File sharing, also known as WebDav component, as this functionality is not implemented in Plesk yet. Please vote for this feature at plesk.uservoice.com.
The top-ranked suggestions are likely to be included in the next versions of Plesk. File sharing is available for subscriptions that belong to admin. As a result, all users, associated with subscriptions that are owned by admin, will have File sharing option.
As a workaround, create a new customer and assign the subscription to it: Log in to Plesk. Create a customer in Customers > Add new customer. Change the subscriber for the subscription in question to the newly created customer in Subscriptions > example.com > Change Subscriber. This way subscription will be owned by a new customer, not by admin, thus, File sharing tab will not be available. "
3,"Website hosted on Plesk for Windows server is not accessible: 500 Internal Server Error: An ASP.NET setting has been detected that does not apply in Integrated managed pipeline mode
Applicable to: Plesk Onyx for Windows Symptoms A domain http://example.com or its statistics page http://example.com/plesk-stat/webstat is not accessible with one of the following errors:
CONFIG_TEXT: 500 Internal server error CONFIG_TEXT: HTTP Error 500.24 - Internal Server Error An ASP.NET setting has been detected that does not apply in Integrated managed pipeline mode. Detailed Error Information: Module ConfigurationValidationModule Notification BeginRequest Handler ExtensionlessUrlHandler-Integrated-4.0 Error code 0x80070032 Requested URL http://example.com:80/ Physical Path C:\Inetpub\vhosts\example.com\httpdocs Logon Method Not yet determined Logon User Not yet determined Also, the following error message can be found in failed request tracing report for a website based on ASP.NET 2.0 (Failed Request Tracing can be enabled in Plesk in Domains > example.com > Failed Request Tracing > Start Tracing):
CONFIG_TEXT: ModuleName ConfigurationValidationModule Notification 1 HttpStatus 500 HttpReason Internal Server Error HttpSubStatus 22 ErrorCode 2147942450 ConfigExceptionInfo Notification BEGIN_REQUEST ErrorCode The request is not supported. (0x80070032) Cause
The website is designed for ""classic pipeline mode"", but the application pool of the website is in ""integrated pipeline mode"".
Resolution
Change managed pipeline mode in Plesk interface: Log into Plesk; Go to Domains > example.com > Dedicated IIS Application Pool for Website; If the button Switch On with a green label is shown, then click on it to enable a dedicated pool for the website: Once a dedicated pool for the website is enabled, choose an option Classic from a drop-down list in Managed pipeline mode field: Click OK to apply the changes. Additional information
For more details about running ASP.NET 2.0 site with IIS 7.x, visit the following page."
2,"[FIXED BUG] Unable to access Backup Manager in Plesk: 504 Gateway Timeout
Applicable to: Plesk for Linux Symptoms Unable to access Plesk > Tools & Settings > Backup Manager, the following error is shown in browser:
CONFIG_TEXT: 504 Gateway Timeout There are the following records in /var/log/sw-cp-server/error_log file:
CONFIG_TEXT: [error] 3235#0: *1483 upstream timed out (110: Connection timed out) while reading response header from upstream, client: 123.123.123.12, server: , request: ""GET /plesk/server/backup/local-repository/ HTTP/1.1"", upstream: ""fastcgi://unix:/var/run/sw-engine.sock"", host: ""11.12.13.14:8443"", referrer: ""https://11.12.13.14:8443/admin/server/tools?context=tools"" It is possible to find such system process while trying to access Backup Manager:
# ps ax | grep pmm 11357 ? R 0:37 /usr/bin/python /usr/local/psa/admin/sbin/pmmcli --get-tasks-list Restore,Backup 5dfb2ce3-1743-4cac-902e-78773bc245d6 any There are a lot of ""Permission denied"" messages in /usr/local/psa/PMM/sessions/TIME_STAMP/migration.result files:
# egrep -lir 'Permission denied' /usr/local/psa/PMM/sessions/ | xargs wc -l 34544 /usr/local/psa/PMM/sessions/2013-11-13-030003.384/migration.result 34544 /usr/local/psa/PMM/sessions/2013-12-22-013005.54/migration.result 34543 /usr/local/psa/PMM/sessions/2013-12-05-013004.227/migration.result 34534 /usr/local/psa/PMM/sessions/2013-11-06-030003.347/migration.result 35502 /usr/local/psa/PMM/sessions/2013-11-10-030003.623/migration.result Cause Product issue: #PPPM-7211 ""Support issue #PPPM-7211"" Fixed in: Plesk Onyx 17.8 17 April 2018 Resolution
Please consider updating your server: How to upgrade Plesk to the next release "
3,"[BUG] Cache expiration header in additional Nginx directives does not get applied
Applicable to: Plesk for Linux Symptoms Cache expiration is enabled in Nginx in Plesk according to the article with expiration time set explicitly, but cache expiration headers are not returned:
# wget -S https://example.com/wp-content/uploads/file.jpg 2>&1 | egrep ""Server|Content-Type|Cache-Control|Expires"" Server: nginx Content-Type: image/jpeg Website is a WordPress instance. In Domains > example.com > PHP Settings for a domain PHP handler is set as FPM application served by nginx. Cause
This is Plesk internal issue with ID #PPPM-4413, which is planned to be fixed in future Plesk updates.
Resolution
As a workaround, apply the following solution: Log into Plesk. Change PHP handler to FPM application served by Apache in Domains > example.com > PHP Settings. Check if Leveraging Browser Caching for nginx is enabled, for example:
# wget -S https://example.com/wp-content/uploads/file.jpg 2>&1 | egrep ""Server|Content-Type|Cache-Control|Expires"" Server: nginx Content-Type: image/jpeg Expires: Thu, 05 Oct 2017 20:36:13 GMT Cache-Control: max-age=604800
# curl -I -c - ""https://example.com/wp-content/uploads/file.jpg"" -k ... Expires: Thu, 05 Oct 2017 20:53:53 GMT Cache-Control: max-age=604800 ... "
2,"On Plesk server with CloudLinux, creating domain or changing domain's hosting type fails: Error: hosting update is failed
Applicable to:
Plesk for Linux
Symptoms Plesk is installed on a server with CloudLinux operating system. Creating a new domain or changing domain's hosting type fails:
PLESK_ERROR: Error: hosting update is failed: vhostmng-content failed: failed to copy file '/var/www/vhosts/.skel/0' to '/usr/local/psa/tmp/agent137acd1c2205108da51330c6267b94e9/0' The following error is found in the log file /var/log/plesk/panel.log:
CONFIG_TEXT: ERR [1] Exception: PHP Warning : symlink(): Permission denied; File: /usr/local/psa/admin/plib/Service/Agent/Transport/Local/Put.php, Line: 25 Cause
Plesk user psaadm is prevented to create symlinks. Refer to the CloudLinux Documentation for more details.
CloudLinux symlink protection features are not supported by Plesk.
Resolution Connect to the server using SSH. Open the file /etc/sysctl.conf for editing and disable the options fs.protected_symlinks_create
and fs.enforce_symlinksifowner:
# vi /etc/sysctl.conf ..... fs.protected_symlinks_create = 0 fs.enforce_symlinksifowner = 0 Apply the changes:
# sysctl -p "
2,"Unable to access Plesk: Table 'psa.table_name' doesn't exist
Applicable to: Plesk for Linux
Plesk for Windows Symptoms Plesk is not accessible with one of the following error messages in a web-browser:
PLESK_INFO: ERROR: Zend_Db_Statement_Exception: SQLSTATE[42S02]: Base table or view not found: 1146 Table 'psa.sessions' doesn't exist ERROR: Zend_Db_Statement_Exception: SQLSTATE[42S02]: Base table or view not found: 1146 Table 'psa.sessioncontexts' doesn't exist ERROR: Zend_Db_Statement_Exception: SQLSTATE[42S02]: Base table or view not found: 1146 Table 'psa.servicenodes' doesn't exist PLESK_INFO: ERROR: PleskMainDBException MySQL query failed: Unknown column 'id' in 'field list' PLESK_INFO: ERROR: Plesk\Exception\Database: DB query failed: SQLSTATE[42S02]: Base table or view not found: 1146 Table 'psa.sessions' doesn't exist, query was: DESCRIBE `sessions` PLESK_INFO: DB query failed: ""DESCRIBE `sessions`"" Error: SQLSTATE[42S02]: Base table or view not found: 1146 Table 'psa.sessions' doesn't exist, query was: DESCRIBE `sessions` PLESK_INFO: DB query failed: SQLSTATE[42S02]: Base table or view not found: 1146 Table 'psa.misc' doesn't exist, query was: replace into misc (param, val) values(:param, :val) Cause
The Plesk 'psa' system database is corrupted.
Resolution
Restore the Plesk 'psa' system database from a Plesk daily dump.
Note: Restoration of the 'psa' database does not affect users' data. For Plesk on Linux Connect to the Plesk server via SSH. Switch to the directory with daily dumps:
# cd /var/lib/psa/dumps List all available Plesk daily dumps:
# ls -l mysql.daily* -rw------- 1 root root 236253 Feb 3 01:51 mysql.daily.dump.0.gz -rw------- 1 root root 229653 Feb 2 01:48 mysql.daily.dump.1.gz -rw------- 1 root root 222485 Feb 1 01:56 mysql.daily.dump.2.gz where mysql.daily.dump.0.gz is the most recent daily dump. Restore the 'psa' database from the most recent daily dump. In this example, the 'psa' database is being restored from mysql.daily.dump.0.gz:
# zcat mysql.daily.dump.0.gz | sed -n '/-- Current Database: `psa`/,/-- Current Database:*/p' | MYSQL_PWD=`cat /etc/psa/.psa.shadow` mysql -uadmin --default-character-set=utf8 Access Plesk.
If Plesk is still not accessible, try to restore the 'psa' database from an earlier Plesk daily dump:
# zcat mysql.daily.dump.1.gz | sed -n '/-- Current Database: `psa`/,/-- Current Database:*/p' | MYSQL_PWD=`cat /etc/psa/.psa.shadow` mysql -uadmin --default-character-set=utf8 For Plesk on Windows Server Connect to the Plesk server via RDP. Switch to the directory with daily dumps:
C:\> cd %plesk_dir%Mysql\Backup List all available Plesk daily dumps with the 'psa' database sorted by date (newest first):
C:\> dir psa* /O:-D Directory of C:\Program Files (x86)\Plesk\MySQL\Backup 03/29/2019 08:33 PM 502,879 psa-20190329203301.sql 03/28/2019 08:33 PM 468,888 psa-20190328203301.sql 03/27/2019 08:33 PM 468,888 psa-20190327203301.sql Restore the 'psa' database from the latest available daily dump. In this example, we are restoring the dump from 03/29/2019: For Plesk Onyx
C:\> plesk db < psa-20190329203301.sql For Plesk 12.5 and previous releases
Note: MySQL admin password is required for this operation.
C:\> ""%plesk_dir%""\Mysql\bin\mysql.exe -uadmin -p -P8306 < psa-20190329203301.sql Access Plesk. "
7,"Unable to update Plesk: The following signatures couldn't be verified because the public key is not available
Applicable to: Plesk Onyx for Linux Symptoms
Unable to update Plesk, the process fails with the following error:
CONFIG_TEXT: GPG error: http://autoinstall.plesk.com jessie InRelease: The following signatures couldn't be verified because the public key is not available: NO_PUBKEY BD11A6AA914BDF7E
Cause
Plesk GPG key is not installed.
Resolution Log into the server via SSH.
Fetch and install GPG key by executing the commands below one by one:
# wget http://autoinstall.plesk.com/plesk.gpg
# apt-key add plesk.gpg "
6,"MySQL shows the error: Too many open files
Applicable to: Plesk for Linux Symptoms An error message related to MySQL service appears in one of these log files: /var/log/plesk/panel.log /var/log/mysql/error.log /var/log/mariadb/mariadb.log /var/log/syslog The error message might look as follows:
CONFIG_TEXT: ERROR: [pool example.com] cannot get uid for user 'root': Too many open files (24) CONFIG_TEXT: Error: SQLSTATE[HY000]: General error: 23 Out of resources when opening file '/tmp/#***.MYD' (Errcode: 24 - Too many open files) CONFIG_TEXT: [ERROR] /usr/sbin/mysqld: Can't open file: './usr_web587_1/etqvi_languages.frm' (errno: 24 - Too many open files) CONFIG_TEXT: Failed to process database 'wordpress_f' from domain 'example.com': MySQL error 1018: Can't read dir of './wordpress_f/' (errno: 24 ""Too many open files"") executing query: SHOW TABLE STATUS FROM `wordpress_f` CONFIG_TEXT: [ERROR] Error in accept: Too many open files
CONFIG_TEXT: DB query failed: SQLSTATE[HY000]: General error: 1016 Can't open file: './psa/misc.frm' (errno: 24), query was: select param, val from misc MySQL service goes down periodically. Plesk fails to load or operations with MySQL databases fail with one of the following error messages:
PLESK_INFO: ERROR: PleskDBException: Unable to connect to database: mysql_connect(): MySQL server has gone away (Error code: 2006) (Abstract.php:69) PLESK_INFO: DB query failed: SQLSTATE[HY000]: General error: 23 Out of resources when opening file '/tmp/#sql_2ff_0.MAI' (Errcode: 24 ""Too many open files""), query was: DESCRIBE `sessions` A Plesk backup is created with the following warning:
CONFIG_TEXT: WARNING : (mysql object 'johndoe_opencart_e') Not all the data was backed up into /var/lib/psa/dumps/clients/johndoe/domains/example.com/databases/johndoe_opencart_e_1 successfully. mysqldump: Couldn't execute 'show table status like 'address'': Can't read dir of './johndoe_opencart_e/' (errno: 24 - Too many open files) (1018) Plesk disk usage statistics might not be calculated. Cause
The open files limit has been reached by the MySQL service. When MySQL fails to open required files, the process gets hanged and systemd fails to stop MySQL process.
Resolution
Warning: Increasing the open file limits might affect the amount of used connections. In order to avoid instability, consider increasing it as well by following instructions from this KB article. For systemd operating systems Note: systemd operating systems listed below have MariaDB installed by default. If MariaDB has been replaced by MySQL, follow the resolution steps for MySQL. CentOS 8
CentOS 7
Debian 9
Ubuntu 18.04
Ubuntu 16.04 With MariaDB installed Connect to the server via SSH. Modify MariaDB startup script:
# systemctl edit mariadb Set open files limit for the MariaDB service:
CONFIG_TEXT: [Service] LimitNOFILE=8192 Restart the MariaDB service:
# systemctl restart mariadb Verify the changes:
# egrep ""open files"" /proc/$(cat `plesk db -Ne ""show variables like 'pid_file'"" | awk '{print $2}'`)/limits Max open files 8192 8192 files With MySQL installed Connect to the server via SSH. Modify MySQL startup script:
# systemctl edit mysql Set open files limit for the MySQL service:
CONFIG_TEXT: [Service] LimitNOFILE=8192 Restart the MySQL service:
# systemctl restart mysql Verify the changes:
# egrep ""open files"" /proc/$(cat `plesk db -Ne ""show variables like 'pid_file'"" | awk '{print $2}'`)/limits Max open files 8192 8192 files For Debian 8 with MySQL installed For Debian 8 with MySQL installed Connect to the Plesk server via SSH. Create a new directory and a new configuration file for the MySQL service:
# mkdir -p /lib/systemd/system/mysql.service.d/ # touch /lib/systemd/system/mysql.service.d/limits.conf Set open files limit for the MySQL service:
# echo ""[Service]"" >> /lib/systemd/system/mysql.service.d/limits.conf # echo ""LimitNOFILE=8192"" >> /lib/systemd/system/mysql.service.d/limits.conf Restart the MySQL service and daemon loader:
# systemctl daemon-reload # systemctl restart mysql For initV operating Systems CentOS 6
Ubuntu 14.04 With MySQL installed Connect to the server via SSH. Open the /etc/security/limits.conf file in a text editor. In this example, we are using the vi editor:
# vi /etc/security/limits.conf Add the following at the end of the file:
CONFIG_TEXT: mysql hard nofile 8192mysql soft nofile 8192 Save the changes and close the file. Then open the /etc/mysql/my.cnf file using a text editor. Add/Increase the open_files_limit value in /etc/mysql/my.cnf for both [mysqld] and [mysqld_safe] sections:
CONFIG_TEXT: [mysqld] open_files_limit = 8192 [mysqld_safe] open_files_limit = 8192 Reboot the system. "
8," Unable to send emails using Plesk local mail server: Connection timed out or connection refused. (#4.4.1)
Applicable to: Plesk for Linux
Plesk for Windows Symptoms Unable to send and forward emails from Plesk server to external servers either completely or intermittently, causing mail queue to fill up. Emails cannot be sent by using PHP script. One of the following errors may be found in /var/log/maillog:
Postfix
CONFIG_TEXT: postfix/smtp[27746]: E3B24978700: to=john.doe@example.com, relay=none, delay=537, delays=446/0.02/91/0, dsn=4.4.1, status=deferred (connect to example.com[203.0.113.2]:25: Connection timed out)
CONFIG_TEXT: postfix/smtp[15684]: connect to example.com[203.0.113.2]:25: Connection timed out
CONFIG_TEXT: postfix/smtp[27746]: E3B24978700: to=john.doe@example.com, relay=none, delay=537, delays=446/0.02/91/0, dsn=4.4.1, status=deferred (connect to example.com[203.0.113.2]:25: Connection refused)
QMail
CONFIG_TEXT: qmail: 1491974064.856278 delivery 8214: deferral: Sorry,_I_wasn't_able_to_establish_an_SMTP_connection._(#4.4.1) On Windows the error below may be found in MailEnable > Servers > localhost > Services and Connectors > SMTP > Logs > Debug > SMTP-Debug-xxxx.log:
CONFIG_TEXT: ME-I0018: [0BCF8603898D4D25B155B5AFF7FB0FA4.MAI] Outbound message from ([SMTP:john.doe@example.com]) requeued as [FFEFCD05AA0A4CE9B2E74C7CAA6D8FE5.MAI] to the target domain [example.net] ME-I0123: Domain [example.net] has MX list [mx1.example.net,mx2.example.net] ME-I0026: [FFEFCD05AA0A4CE9B2E74C7CAA6D8FE5.MAI] Sending message ME-IXXXX: [FFEFCD05AA0A4CE9B2E74C7CAA6D8FE5.MAI] DNS resolved to the following record: IP Address=203.0.113.2, Family=2, Type=1, Protocol=6 ME-E0038: [FFEFCD05AA0A4CE9B2E74C7CAA6D8FE5.MAI] Communications Error: Socket connection to mx1.example.net failed (error 10060). The host was either not contactable or it rejected your connection. Socket Family = 2; Host=203.0.113.2; Port=25 Local mail delivery between domains in Plesk works. Outbound connections via port 25 from Plesk server are restricted either completely or intermittently:
# telnet smtp.gmail.com 25 Trying 203.0.113.2... telnet: connect to address 203.0.113.2: Connection refused Firewall on the Plesk server does not restrict connections to port 25. Cause
Port 25 is blocked for outbound connections. Sometimes internet service providers (ISP) can restrict or limit outbound/inbound connections on port 25 due to security reasons. Also, Google Cloud platform has such port blocked by default and services like G Suite should be used to send mail.
Resolution
Note: Networking tasks and the local firewall configuration are the activities that should be handled by Plesk server administrator, as Plesk is a part of the server infrastructure and relays on local network settings.
Note: Once port 25 is opened by your hosting/cloud provider and mail starts to work, you may safely close the message about TCP port 25 being blocked in Plesk at Tools & Settings > Mail Server Settings.
Note: For example of mail relay configuration, refer to our official Udemy course.
Here are general troubleshooting steps: Make sure that the local firewall does not cause the issue. Stop the service temporarily and try to send mail or open mail port under Plesk > Tools & Settings > Firewall; If the issue still persists, it means that the cause is outside of the Plesk server. In that case, contact network administrator and discuss if port 25 can be added to allowed ones or not.
If any of Cloud Services are used, it is needed to check the firewall on the Cloud Service’s side. Cloud Provider References to unlock SMTP ports Google Cloud Outbound connections to port 25 are limited by default to prevent outgoing spam.
Google Cloud: Sending Email from an Instance Amazon (AWS) outbound connections to port 25 are limited by default to prevent outgoing spam.
AWS: How do I remove the throttle on port 25 from my EC2 instance Integrating Amazon SES with Postfix Microsoft Azure Azure blocks port 25 for new users. Submit a request by using the following link: Subscription Management Problem type: Request to enable Port 25 email flow Use a third-party service like SendGrid. Create a SendGrid account and configure Postfix to use SendGrid as a relay. Vultr To unlock port 25 follow: https://www.vultr.com/docs/what-ports-are-blocked Nitrado
Block the ports 25, 465 and 587 by default but can unlock them (see point 3) https://server.nitrado.net/eng/pages/cloud_server_tos OVH
Configure firewall on port 25: https://docs.ovh.com/ca/en/dedicated/firewall-network/ Alibaba Cloud Alibaba ECS instances Apply the form to enable TCP port 25. Scaleway Ports 25, 465 and 587 can be unlocked: https://www.scaleway.com/en/faq/why-can-i-not-send-any-email/ Linode Linodes on newly created customer accounts will have connections from ports 25, 465, and 587 blocked by default. Additional information
How to configure Postfix to send email from a Google Cloud server using SendGrid? How to configure MailEnable to send emails on Google Cloud Platform instance? "
5,"How to check Plesk migration status
Applicable to: Plesk Onyx for Linux
Plesk Onyx for Windows
Plesk Onyx for Linux
Plesk Onyx for Windows Question
How to check a migration session status? Answer
The status can be checked in log files. Migration is performed in several parallel threads (by default, 5). So, it is not correct just to open the log file and check the last entry to get the migration status.
To check the migration status: Log in to the target server via SSH Open progressfile. It will contain information like:
Subscription migration status: CONFIG_TEXT: +-----------------------------------------------+------------------------+--------+ | Subscription | Status | Action | +-----------------------------------------------+------------------------+--------+ | example.com | In Progress | | +-----------------------------------------------+------------------------+--------+ | example2.com | Finished with warnings | | +-----------------------------------------------+------------------------+--------+ | example3.com | Finished with warnings | | +-----------------------------------------------+------------------------+--------+ | example4.com | Finished with warnings | |+-----------------------------------------------+------------------------+--------+ Find the task that has the In Progress status and remember the name of subscription it handles. Open debug.log and find the subscription name from step the step 3. Check the number of thread that is handling the subscription (ST1...ST5). For example:
CONFIG_TEXT: =|2019-07-18_04:55:20,456|I|ST1|core.reports.printer|example.com||Subscription 'example.com' Filter debug.logby the thread number and check the last entry to find out the task status:
For Windows:
C:\> findstr ST1 debug.log
For Linux:
# grep ST1 debug.log Migration of a big domain or a significant number of mailboxes may take several hours. In such cases, no changes may be seen in the log files, but continually decreasing free disk space on disk drive will indicate that the process is running. If no changes are seen in the aforementioned files for hours and no changes on the file system/mailboxes, it is likely that the migration process got hung up. Restart the session according to this article."
3,"nginx fails to start/reload on a Plesk server: Too many open files
Applicable to: Plesk for Linux Symptoms The nginx service fails to start/reload with the following error in the /var/log/nginx/error.log file:
CONFIG_TEXT: nginx: [emerg] open() ""/var/www/vhosts/system/example.com/logs/proxy_access_ssl_log"" failed (24: Too many open files) Some or all websites are not accessible.
After installing a new certificate for the domain, the old one is still shown in a web browser, however the correct certificate is selected at the Domains > example.com > Hosting Settings page. Cause
Nginx's virtual host opens 4 log files for each virtual host with physical hosting: proxy_access_log
proxy_access_ssl_log
webmail_access_log
webmail_access_ssl_log As a result of this fact, the maximum number of open files is exceeded by the nginx server due to big number of domains (more than 100).
Resolution
Warning: Execution of the websrv_ulimits utility without --no-restart option initiates rebuilding of web configuration files for all domains and can cause a significant downtime in case of a big number of hosted websites. Execute the command during the maintenance time frame.
It is good practice to set open files limit value more than number of domains in Plesk * 16 at least. In example below provided actions how to set limit to 4096: Connect to the server via SSH Set open files limit to 4096 for both Apache and Nginx, using the following shell utility:
# /usr/local/psa/admin/sbin/websrv_ulimits --set 4096 --no-restart Restart Apache and nginx services at Plesk > Tools & Settings > Services Management to apply changes.
Check that 'Max open files limit' was applied properly, after web services restarting:
# grep 'Max open files' /proc/$(cat /var/run/nginx.pid)/limits Max open files 4096 4096 file "
6,"How to change Plesk integration with external database server
Applicable to: Plesk for Linux
Plesk for Windows Question External database server changed its IP address.
The connection to database in Plesk > Tools & Settings > Database Servers is shown as failed.
A new server IP address is already added connected with Plesk as another database server and already has several new databases. How to change integration information for old databases to a new database server?
Answer In case the database server with new IP address does not exists in Plesk, create it Log into Plesk Navigate to Tools & Settings > Database Servers Click on Add Database Server, specify the server's type, access details and click on Ok Modify the Plesk database to use the proper IP address Connect to the server via SSH or RDP Create Plesk database backup Access Plesk database Find the required server ID:
SELECT id,host,type FROM psa.DatabaseServers;
+----+------------------+-------+
| id | host | type |
+----+------------------+-------+
| 1 | localhost | mysql |
| 3 | 203.0.113.2,1433 | mssql |
| 5 | 203.0.113.3,1433 | mssql |
+----+------------------+-------+
3 rows in set (0.00 sec)
Note: Here databases and users hosted on the database server with ID 3 will be moved to the ID 5. Use these IDs to change current databases reference:
UPDATE psa.db_users SET db_server_id = 5 WHERE db_server_id = 3;
UPDATE psa.data_bases SET db_server_id = 5 WHERE db_server_id = 3; Verify the connection and database count in Plesk > Tools & Settings > Database Servers and remove unnecessary connection by selecting it and clicking on Remove. "
4,"[FIXED BUG] Unable to install WordPress using remote database server: Error establishing a database connection
Applicable to: Plesk 12.5 for Linux
Plesk Onyx for Linux Symptoms When installing WordPress using WordPress Toolkit and a remote database server, the following error message appears in the /var/log/plesk/panel.log:
CONFIG_TEXT: ERR [panel] Script execution failed:ERR [panel] CommonPanel_Aps_ServiceCreationHelper::installService Non-zero exit status returned by script.ERR [util_exec] proc_close() failed ['/usr/local/psa/admin/bin/sappmng' '--run-application-script' '--script-file-name=configure' '--script-name=remove' '--script-language=php' '--user-name=plesktech' '--php-cli=/usr/bin/php' '--php-ini=/var/www/vhosts/system/example.com/etc/php.ini' '--application-full-name=file:////usr/local/psa/var/apspackages/apscatalogzXVeAO.zipef1f22d3-df06-ff/cache'] with exit code [1]ERR [1] '/usr/local/psa/admin/bin/sappmng' '--run-application-script' '--script-file-name=configure' '--script-name=remove' '--script-language=php' '--user-name=plesktech' '--php-cli=/usr/bin/php' '--php-ini=/var/www/vhosts/system/example.com/etc/php.ini' '--application-full-name=file:////usr/local/psa/var/apspackages/apscatalogzXVeAO.zipef1f22d3-df06-ff/cache' failed with code 1.stdout:Unable to connect to DB: Access denied for user 'wordpress_wp1'@'3.3.3.3' (using password: YES)
OR
CONFIG_TEXT: ERR [panel] Task failed: id=286, pid=1226597, type=ext-wp-toolkit-task\install, error=Error establishing a database connection. This either means that the username and password information in your `wp-config.php` file is incorrect or we can’t contact the database server at `remote_server_ip:3306`. This could mean your host’s database server is down.{""err_code"":true,""err_message"":""Error establishing a database connection. This either means that the username and password information in your `wp-config.php` file is incorrect or we can\u2019t contact the database server at `remote_server_ip:3306`. This could mean your host\u2019s database server is down.""} Local connections only are allowed in Plesk at Tools & Settings > Database Hosting Preferences: Cause Product issue: #PPPM-4582 ""WordPress installation is failed if remote database is set and ""Allow local connections only""""Fixed in:
Plesk Obsidian 20 November 2018 (fixed as PPP-39129) Resolution
Please consider updating your server: How to install Plesk updates Workaround
If update is not possible for some reason you may try the following
temporary solution Apply one of the following workarounds: Use a local database server to install WordPress. Change the Default settings for remote access of database users setting to Allow remote connections from any host (or Allow remote connections from with a remote server IP address) at Tools & Settings > Database Hosting Preferences. "
0," How to configure Greylisting? Applicable to: Plesk 12.5 for Linux Plesk Onyx for Linux Plesk 11.x for Linux Plesk 12.0 for Linux Question
How to configure Greylisting in Plesk?
Answer
Greylisting works as follows: the first message is rejected, and the next message sent from the same address (sender server IP address and 'From:') will be accepted after a certain length of time passes.
After the first email is rejected, the sender's address is added to the Greylisting database. The information is stored there for an expiration time interval (expire-interval). For the message to be accepted, the grey interval (grey-interval) must complete. If the message was sent before the grey interval has passed, the penalty interval (penalty-interval) is added.
Greylisting configuration is not possible via Plesk web-interface, but only with Plesk CLI.
The utility is /usr/local/psa/bin/grey_listing for Redhat-based OS and /opt/psa/bin/grey_listing on Debian-based OS.
Parameters like expire-interval, grey-interval, penalty-interval, and others are configured via the utility grey_listing. Run the utility with --info-server to display configuration settings:
# /usr/local/psa/bin/grey_listing --info-server Grey listing configuration. Grey listing checking disabled Grey interval 5 minutes Expire interval 51840 minutes Penalty interval 2 minutes Penalty disabled Personal grey listing configuration allowed Server-wide black list: Server-wide white list: White domains patterns list: Black domains patterns list: *[0-9][0-9]-[0-9][0-9]-[0-9][0-9]* *[0-9][0-9].[0-9][0-9].[0-9][0-9]* *[0-9][0-9][0-9]-[0-9][0-9][0-9]-[0-9][0-9][0-9]* *[0-9][0-9][0-9].[0-9][0-9][0-9].[0-9[0-9][0-9]* dsl|pool|broadband|hsd dynamic|static|ppp|dyn-ip|dial-up SUCCESS: Gathering of server wide information complete.
Black/White lists for Greylisting are configured server-wide and per individual mail account in GUI.
Server-wide Greylisting White/Black lists are configured on the page Spam Filter Settings at Tools & Settings > Spam Filter Settings . Greylisting White/Black lists configuration per mail account: Domains > domain name > Mail Accounts > mail_account@domain_name > Spam Filter.
The page allows you to add email addresses only. To add the domain localhost to the White list, try adding the address *@localhost.
Alternatively, you may use Plesk CLI grey_listing to configure the spam filter. For example, to add the domain to the server-wide White list:
# /usr/local/psa/bin/grey_listing --update-server -whitelist add:*@domain.tld SUCCESS: Update of server-wide settings complete.
To add the domain example.com to the Greylisting White list for the mail account mail@domain.tld:
# /usr/local/psa/bin/grey_listing --update-mailname mail@domain.tld -whitelist add:*@example.comSUCCESS: Update of mail 'mail@
To get information about Black/White lists on mail accounts for mail@domain.tld:
# /usr/local/psa/bin/grey_listing --info-mailname mail@domain.tldGrey listing configuration for mail@domain.tldUser's black list:User's white list: *@example.comSUCCESS: Gathering information for 'mail@domain.tld
Additional information
Note: Greylisting feature is available only in Plesk for Unix/Linux.
https://docs.plesk.com/en-US/onyx/administrator-guide/mail/antispam-tools/greylisting-linux.63249/"
5,"Plesk Migrator shows warning: There is not enough free exclusive IPv4/IPv6 addresses on target Plesk Applicable to: Plesk for Linux
Plesk for Windows Symptoms Plesk Migrator shows one of the the following warnings on pre-migration check:
PLESK_INFO: There is not enough free exclusive IPv4 addresses on target Plesk to map all source exclusive IP addresses. This subscription will be migrated to default shared IP address Add more free exclusive IP addresses to target panel or change IP addresses of migrated subscriptions after migration
OR
PLESK_INFO: There is not enough free exclusive IPv6 addresses on target Plesk to map all source exclusive IP addresses. This subscription will be migrated to default shared IP address Add more free exclusive IP addresses to target panel or change IP addresses of migrated subscriptions after migration
OR
PLESK_INFO: There is no shared IPv6 address on target Plesk. Fix Plesk configuration so there is at least one shared IPv6 address A customer/reseller account on the source server has an exclusive (dedicated) IP address assigned or there are IPv4 and IPv6 addresses assigned to a domain on the source server, but IPv6 is missing on the destination server. Cause
Number of exclusive (dedicated) IP address on the destination server is less than on the source server.
Resolution
This warning can be safely ignored and migration can be continued: Subscriptions that use exclusive (dedicated) IP addresses on the source server will be migrated to a default shared IP address on the target server.
After migration, you may add new dedicated IP addresses on the destination server and assign migrated subscriptions to them. If there are IPv4 and IPv6 addresses assigned to a domain on the source server, but IPv6 is missing on the destination server, apply one of the following solutions: On the destination server, add an IPv6 address in Plesk at Tools and Settings > IP Addresses. On the source server, set an IPv6 address to None for a domain at Domains > example.com > Web Hosting Access. Related Articles Migration fails: There is no shared IPv4 address on target Plesk
"
0,"How to change IP address for domains/clients/resellers in Plesk for Linux
Applicable to: Plesk for Linux Question
How to change IP address for domains/clients/resellers in Plesk for Linux?
Answer
Switch all existing domains to a single IP address that exists in system: Connect to the server via SSH ; Create Plesk database backup ; Run the following command:
# for i in $(plesk bin subscription -l); do plesk bin subscription -u ""$i"" -ip <ip_address>; done Note: <ip_address> here is the IP address that will be used instead of the current one. This IP must exist in the system. Additional information How to change the IP address of Plesk server?
Plesk documentation: Changing IP address How to change IP address for multiple subscriptions in Windows reconfigurator.pl fails: no such network interface
"
8,"Is it possible to use another port for SMTP connection if 25 port is blocked by ISP?
Applicable to: Plesk for Linux Question
Is it possible to use another port for SMTP connection if 25 port is blocked by ISP?
Answer
Usually, ISP blocks only outgoing 25 port. There are two options: Contact ISP and ask to unblock 25 port for outgoing traffic.
Setup relayhost(smarthost) in postfix following steps from any 3rd-party resource like this. If ISP also blocks incoming 25 port, it will be impossible to use mail service on this server. Anyway, contact ISP for assistance.
Additional information For configuring Mail Submission port 587 in Plesk for Windows please refer to the article For configuring Mail Submission port 587 in Plesk for Linux please refer to the article Note: Plesk server cannot be configured to use 587 port for outbound SMTP traffic. Either only 25 or 25 in conjunction with 587 can be used. Also, Plesk will still be listening on 25 port alongside with 587."
9,"[BUG] Secondary NS server is used as primary one in SOA record
Applicable to: Plesk for Linux
Plesk for Windows Symptoms The first NS server that is specified in Tools & Settings > DNS Template > ns1.<domain> is not a primary name server in SOA record. Changing of any NS record in DNS Template and then applying changes to the existing domains leads to changing primary name server in a domain's zone file. Cause
This is Plesk bug with ID #PPPM-2226. Resolution
The issue has been fixed in Plesk Obsidian, consider upgrading to the latest version to be able to select NS server in SOA.
As a workaround: Login to Plesk admin panel. Go to Tools & Settings > DNS Template and click on <domain> for NS record ns2.<domain>: Click OK without modifications: Then, apply the changes to all hosted domains: Select Apply the changes to all zones option > OK: Now verify that such changes are done by logging into the server over SSH. And checking the named zone files:
# egrep SOA /var/named/chroot/var/example.com@ IN SOA ns1.example.com. info.plesk.domain.tld. ( Once the changes are verified, it may take from 24 to 48 hours to propagate the change over the internet.
"
5,"Domain is suspended every day by backup and not resumed
Applicable to: Plesk for Linux
Plesk for Windows Symptoms
A domain becomes suspended in Plesk Control Panel every day without any manual actions.
Cause
A scheduled backup task is failing, while the option Suspend domains until backup task is completed is enabled in the backup task properties. The domain is suspended for the duration of the backup, but since the backup does not complete, the domain is not resumed.
Resolution
Log in to Plesk GUI and disable the option ""Suspend domains until backup task is completed"" from the Scheduled Backup Settings: For server-level backup: Tools & Settings > Backup Manager > Scheduled Backup Settings For reseller-level backup: Tools & Settings > Backup Manager > Scheduled Backup Settings (while logged in as reseller). For customer-level backup: Customers > ""Manage Hosting"" for customer > ""Account"" tab > Backup My Account and Websites > Scheduled Backup Settings For subscription-level backup: Subscriptions > subscription > ""Websites & Domains"" tab > Backup Manager > Scheduled Backup Settings "
5,"Unable to create or restore backup on Plesk server: Can't find public key in database, Can't initialize RSA private key
Applicable to: Plesk for Linux
Plesk for Windows Symptoms Restoration of a backup fails with the following error:
PLESK_ERROR: Error: backup_sign: Can't find public key in database: backup_sign: Can't get server's public key The following error occured during a scheduled backup:
PLESK_ERROR: Unable to create remote backup. Error: Unable to export backup: Can't initialize RSA private key Backup process finishes with a warning:
Warning: Unable to upload the backup to the FTP storage: Unable to set backup sign certificate Migration pre-check shows the following warning:
CONFIG_TEXT: stderr: rsync: link_stat ""/root/plesk_migrator/plesk_migrator-9xcxzh5oqyrrqyfdhjs8dezlk536xa5p/backup.tar"" failed: No such file or directory (2) rsync error: some files/attrs were not transferred (see previous errors) (code 23) at main.c(1650) [Receiver=3.1.2] rsync: [Receiver] write error: Broken pipe (32) Cause
Backup sign certificate is missing.
Resolution
Note: if you don't have root access to Plesk server via SSH/RDP, contact your hosting provider regarding the issue
For Linux: Connect to the server via SSH. Regenerate the backup sign key using below command:
Note: in case of migration run the command on the source server
# /usr/local/psa/admin/sbin/backup_sign --generate Restore or make a backup again. For Windows: Connect to the server via RDP. Regenerate the backup sign key using the below commands:
C:\> cd %plesk_bin% backup_sign.exe --generate Restore or make a backup again. "
8,"What is SPF and how to configure it on a Plesk server
Applicable to: Plesk for Linux
Plesk for Windows Question
What is SPF and how to configure it on a Plesk server?
Answer
SPF (Sender Policy Framework) is a system that ensures emails are genuine by comparing them against a TXT list of approved senders. Senders are published in the DNS record. These DNS entries can be trusted because owners and administrators are the only individuals allowed to make them.
To access SPF configuration form, in Plesk go to Tools & Settings > Mail Server Settings and specify the required options in the SPF spam protection section. If you don't have the Tools & Settings menu, contact your hosting support. Once the SPF resource is enabled, DNS TXT records will be provided for each A and MX records at Domains > example.com > DNS Setings.
DNS TXT records have the following format:
CONFIG_TEXT: example.com IN TXT ""v=spf1 spf\\_string""
Here, spf1 is SPF version, and spf\_string takes the combination of the so-called mechanisms:
CONFIG_TEXT: a, ptr, mx, ip4, include, all
Where all is a finalizing mechanism and must be placed at the end. Each mechanism may have a prefix pointing to a certain type of processing messages:
CONFIG_TEXT: '-' fail (message is rejected) '~' softfail (message is passed with warning) '+' pass (message is passed - the default prefix value) '?' neutral The simplest (and most popular)
An SPF record will look like:
CONFIG_TEXT: example.com IN TXT ""v=spf1 mx -all""
This means that mail from john_doe@example.com can be sent only from his MX record. There can be used other options. If other servers send mail from domain.com, you can describe them by giving ""arguments"" to the a:, mx:, ip4:, and ptr: mechanisms. mx: takes domain names and approves all the MX servers of these domains. Example:
CONFIG_TEXT: ""v=spf1 a mx a:example.com -all""
Mail can be sent from his MX and from example.com server.
To set both ipv4 and ipv6 SPF records, the following syntax can be used:
CONFIG_TEXT: ""v=spf1 ip4:XX.XX.XX.XX ip6:XXXX:XXXX:XXXX:XXXX:XXXX:XXXX:XXXX:XXXX ~all"" Additional Information SPF Wizard - SPF Generator DNS tool
Can SPF, DKIM and DMARC free you from junk emails? - Plesk
"
7,"Plesk license key upload error: The license key is invalid. In order to use Plesk, please obtain and install a new valid license key
Applicable to: Plesk 12.5 for Linux
Plesk 12.0 for Linux Symptoms
License Key upload failed with the following error:
PLESK_ERROR: Error: The license key is invalid. In order to use Plesk, please obtain and install a new valid license key. The license key is intended only for use with Parallels Plesk operating inside the following virtual environments: Parallels Virtuozzo Containers, VMWare, Microsoft Hyper-V, Xen, KVM, Parallels Server.
Cause
The Plesk service cannot execute a back-end utility or the utility is unable to change some files because of incorrect permissions.
Resolution Connect to the server via SSH Make sure that the following files have proper permissions and owners:
# ls -al /usr/local/psa/admin/sbin/*wrapper ---s--x--- 1 root psaadm 13120 Jun 13 21:51 ./admin/sbin/mod_wrapper ---s--x--- 1 root psaadm 13632 Jun 13 21:51 ./admin/sbin/wrapper If you see different permissions or owners, run the commands from the following article Different operations in Plesk fails with error: System error 13: Permission denied to correct them. Remove the /etc/sw/keys/registry.xml file.
# rm -f /etc/sw/keys/registry.xml Log into Plesk. The registry.xml file will be recreated. If the issue persists, check the steps in the following article: The license key is intended only for use with Plesk operating inside the following virtual environments "
5,"Backups are not created: Unable to write to output file: Disk quota exceeded
Applicable to: Plesk Obsidian for Linux
Plesk Obsidian for Windows
Plesk Onyx for Linux
Plesk Onyx for Windows Symptoms Locally stored backups cannot be created The following error can be found in the /usr/local/psa/PMM/sessions/<session-id>/psadump.log:
CONFIG_TEXT: [6576]: 06:50:54 ERROR ef58d6a3-9149-4976-8737-06e24f9215e7 Unable to create dump:Logging::error('Unable to create dump', 'fatal') called at /usr/local/psa/admin/bin/plesk_agent_manager line 650[6573]: 06:50:55 ERROR ef58d6a3-9149-4976-8737-06e24f9215e7 Unable to create dump:Logging::error('Unable to create dump', 'fatal') called at /usr/local/psa/admin/bin/plesk_agent_manager line 650Unable to create dump: Unable to write to output file: Disk quota exceeded at /usr/local/psa/PMM/agents/shared/Storage/Splitter.pm line 83.Unable to create dump: Broken pipe at /usr/local/psa/PMM/agents/shared/Storage/FileStorage.pm line 134. Cause
Disk quota on the server is exceeded.
Resolution
Contact system administrator to increase disk space on server or adjust disk quota."
8,"How to create mail account for a subdomain on Plesk server?
Applicable to: Plesk for Windows
Plesk for Linux Question
How to create mail account for a subdomain?
Answer
This functionality was implemented in Plesk Obsidian.
While Plesk Onyx, apply two following workarounds: Log into Plesk. Create new subdomain as Website domain (not as Subdomain) in Subscriptions > example.com > Add domain > sub.example.com
This way a new domain will be created under a subscription and the functionality to create new mailbox accounts will be available. Plesk for Windows Connect to the server via RDP.
Use command line utility to create a mail account for a subdomain
C:\> ""%plesk_cli%\subscription.exe"" -u sub.example.com -mail_service true %plesk_cli%\mail.exe"" --create user@sub.example.com -passwd ***** -mailbox true
NOTE: Webmail is not available for subdomains. "
2,"Unable to access File Manager for a certain domain or for all domains on a server: Permission denied
Applicable to: Plesk for Linux Symptoms Unable to access File Manager for a certain domain or for all domains on a server:
PLESK_ERROR: Server Error 500 PleskUtilException Internal error: Unable to find the directory /var/www/vhosts/example.com/: filemng failed: filemng: opendir failed: Permission denied System error 13: Permission denied Unable to execute actions on File Manager: such as ZIP extraction, Copy, Rename, Changing Permissions, etc. Unable to connect via FTP to a domain main folder or a sub-folder with the following error:
CONFIG_TEXT: Unable to connect FTP :421 Service not available, remote server has closed. Alternatively, it is not possible adding files to archive in Domains > example.com > File Manager > Add to Archive:
PLESK_ERROR: Unable to create the archive: filemng failed: filemng: /usr/bin/zip execution failed: zip warning: Permission denied zip warning: Permission denied zip warning: Permission denied zip warning: Permission denied zip warning: Permission denied zip warning: Permission denied. Cause
Incorrect permissions on domain's folder.
Resolution
Click on a section to expand Via Plesk GUI Log in to Plesk GUI Install Repair Kit extension Go to Tools & Settings > Diagnose & Repair > File System > Repair Via SSH Connect to the server via SSH Run the following command to repair file permissions:
# plesk repair fs -y example.com
To fix permissions for all the domains:
# plesk repair fs -y "
9,"How to enable/disable web statistics for a domain in Plesk
Applicable to: Plesk Onyx for Linux
Plesk Onyx for Windows Question
How to enable/disable web statistics for a domain in Plesk?
Answer Enabling/disabling web statistics via Plesk In Plesk, go to Domains > example.com > Hosting Settings. Set Web statistics to according to your needs. None means disabled. Enabling/disabling web statistics via a command-line interface Connect to the Plesk server via SSH (Linux) / RDP (Windows Server). Execute the following command via the command line:
CONFIG_TEXT: plesk bin domain --update example.com -webstat <option>
where available options are: none awstats webalizer Additional Information
There are two web-statistics tools that come along with Plesk and can be installed via Plesk Installer: AWStats
Webalizer Related Articles How to install / uninstall Plesk components
"
0,"How to find and edit PHP configuration files in Plesk for a domain or for global PHP handler Applicable to: Plesk for Linux
Plesk for Windows Question
Where are php.ini files (PHP configuration files) for a domain or global PHP handler located on the Plesk server? And how to edit them?
Answer
Note: If one of the menus or options is not available on your Plesk installation, please contact your server's administrator or hosting provider support, account access is limited.
In Plesk Onyx and 12.5 only Edit PHP configuration for one domain Login to Plesk By clicking Domains > example.com > PHP Settings > View the phpinfo() page it is possible to see all the PHP configuration for this domain. To edit it, just configure the required options in Domains > example.com > PHP Settings and add all the required PHP settings: Edit php.ini for all domains Login to Plesk Global PHP handler configuration file is stored in Tools and Settings > PHP Settings > click on a PHP handler > php.ini tab: Edit the required options and click OK Note: Some of the options may be hidden by Plesk administrator. Upgrade to the latest Plesk version to be able to edit these options in Plesk interface. Editing PHP configuration via Service Plan for multiple domains If it is required to make changes for few subscriptions, it is easy to do via Service Plan. Assign all the required subscriptions in Service Plans Go to PHP Settings and after changing them click Update & Sync. Using SSH/RDP for old Plesk versions. It is required to connect to the server using SSH or RDP connection
PHP uses different configuration files depending on a handler type. When the changes are made in the web interface, the following configuration files on a server are updated on Linux:
Domain's php.ini
It depends on that PHP Handler is set in Plesk > Domains > example.com > Hosting Settings: Nginx + PHP-FPM by OS vendor:
Domain's php.ini: /etc/php*/fpm/fpm.d/example.com.conf (for Ubuntu) or /etc/php-fpm.d/example.com.conf (for Centos)
Global PHP handler (system PHP): /etc/php.ini Nginx + PHP-FPM supplied with Plesk:
Domain's php.ini: /opt/plesk/php/<php_verion>/etc/php-fpm.d/example.com.conf
Global PHP handler: /opt/plesk/php/<php_verion>/etc/php.ini Apache + FastCGI:
Domain's php.ini: /var/www/vhosts/system/example.com/etc/php.ini Apache + PHP_mod:
Domain's php.ini: /var/www/vhosts/system/example.com/conf/httpd.conf Global php.ini Any PHP by OS vendor
Global PHP handler (system PHP): /etc/php.ini Any PHP version by Plesk:
Global PHP handler: /opt/plesk/php/<php_verion>/etc/php.ini Windows
All the PHP configuration files are stored in ""%plesk_dir%""/Additional/PHP*
Domain's php.ini file is being generated after any changes in PHP settings and can be found by the following path C:\Inetpub\vhosts\example.com\httpdocs\.user.ini "
8,"Is it possible to set up mail (IMAP/SMTP) settings auto-discovery in Plesk?
Applicable to: Plesk for Linux
Plesk for Windows Question
Is it possible to set up mail (IMAP/SMTP) settings auto-discovery in Plesk?
Answer
This feature is implemented in Plesk Obsidian; see the following article for details: How to manage mail autodiscover in Plesk Obsidian? "
7,"mod_perl, mod_python, mod_php Apache modules are not installed by default in Plesk Applicable to: Plesk for Linux Question
mod_perl, mod_python, mod_php Apache modules are not installed by default.
Why are not they installed?
Answer
Starting from Plesk 12.5, the following changes were made in terms of Apache modules: mod_perl and mod_python are not included. mod_php still included, but disabled by default. It was done for security reasons. Why using these Apache modules on shared hosting is insecure: File security. mod_php , mod_perl and mod_python run under account of Apache server, and therefore scripts executed by these modules can potentially access any user file. For example, files containing highly confidential personal data can be read by a script from another domain. Security of database connections. Database connections of other users can be hijacked, and since all users can read each other's code, database usernames and passwords are visible to any user. Potential system compromising. Due to security issues in Apache code (it can be resolved by using jails or chroot mechanisms). Which options to use Perl and Python remain: By default, Python and Perl are handled by FastCGI ( mod_fcgid module). For Python, it is also possible to use Application server (this option is described in this article ). Note: If an application is designed for using with mod_perl or mod_python, updating its code can be required."
3,"Internal Server Error: Could not create a Disk Cache Sub-directory for the Application Pool
Applicable to: Plesk 12.0 for Windows Symptoms Website on ASP shows Internal Server Error. The following error can be found in Event Viewer > Windows Logs > Applications the following error can be found:
CONFIG_TEXT: The Template Persistent Cache initialization failed for Application Pool 'domain.tld(domain)(2.0)(pool)' because of the following error: Could not create a Disk Cache Sub-directory for the Application Pool. The data may have additional error codes. Cause
Missing system folders or incorrect permissions.
Resolution
Note: This article may require additional administrative knowledge to apply. If any help required, contact server’s administrator or hosting support. Connect to the server via RDP. Execute the command below in the Command Prompt to list the path for ASP cache:
C:\> %windir%\system32\inetsrv\appcmd list config -section:system.webServer/asp <system.webServer> <asp> <session /> <comPlus /> <cache diskTemplateCacheDirectory=""%SystemDrive%\inetpub\emp\ASP Compiled Templates"" /> <limits /> </asp> </system.webServer> Ensure that the path from the output above exists (""%SystemDrive%\inetpub\emp\ASP Compiled Templates""`):`
C:\> mkdir ""%SystemDrive%\inetpub\emp\ASP Compiled Templates"" A subdirectory or file C:\inetpub\emp\ASP Compiled Templates already exists. Ensure the folder permissions include NETWORK SERVICE :
C:\> icacls ""%SystemDrive%\inetpub\emp\ASP Compiled Templates"" /grant ""NETWORK SERVICE:(OI)(CI)(M)"" processed file: C:\inetpub\emp\ASP Compiled Templates Successfully processed 1 files; Failed processing 0 files Restart the IIS service:
C:\> iisreset "
6,"MySQL values open_files_limit and max_connections are not applied
Applicable to: Plesk for Linux Symptoms The value of max_connections changes to 214 automatically after some time, although the value itself is defined in my.cnf:
# grep -i 'max_connections' /etc/my.cnf max_connections=2048
# plesk db ""SHOW GLOBAL VARIABLES LIKE 'max_connections' \G"" *************************** 1. row *************************** Variable_name: max_connections Value: 214 The value of open_files_limit is reset after system updates are installed. In the log file /var/log/mysqld.log the following records can be found:
CONFIG_TEXT: [Warning] Changed limits: max_open_files: 1024 max_connections: 214 table_cache: 400 When restoring a MySQL backup, the following error is shown:
Warning: mysql ""databasename"" Not all the data was backed up into [...]/databasename_1 successfully. mysqldump: Got error: 23: Out of resources when opening file '[...]' (Errcode: 24 - Too many open files) when using LOCK TABLES Unable to export database in Plesk:
PLESK_ERROR: Unable to export a dump of databasename: mysqldump: Got error: 1016: ""Can't open file: './databasename/table.frm' (errno: 24)"" when using LOCK TABLES Cause
Default open_files_limit for MySQL has been reached.
Resolution
Connect to the server via SSH and adjust open_files_limit for the MySQL service as below.
Note: This article may require additional administrative knowledge to apply. If any help required, contact server’s administrator or hosting support. On systemd-based systems (RHEL/CentOS/CloudLunix 7 and above, Ubuntu 16.04 and above, Debian 8 and above) Find out whether MySQL, or MariaDB service is used:
# systemctl list-unit-files | grep -E 'mysql|mariadb' mariadb.service enabled Create an override for the service file from the previous step:
# systemctl edit mariadb.service
Note: In case mysql.service, or mysqld.service was displayed on the previous step, replace ""mariadb.service"" with it. Add the following content to the opened text editor and save the file:
CONFIG_TEXT: [Service] LimitNOFILE=4096
Note: Value might be increased if required, 4096 is only a suggested value. Restart the MySQL/MariaDB server:
# systemctl restart mysql mysqld mariadb 2>/dev/null On System V/Upstart systems (Ubuntu 14.04, RHEL/CentOS/CloudLinux 6) For Debian-based distributions: Add the following lines in /etc/security/limits.conf:
CONFIG_TEXT: mysql soft nofile 4096 mysql hard nofile 4096 Add the following to the end of file into /etc/pam.d/common-session :
CONFIG_TEXT: session required pam_limits.so Add the following to the end of file into /etc/pam.d/common-session-noninteractive:
CONFIG_TEXT: session required pam_limits.so Add the following line in /etc/mysql/my.cnf and under the [mysqld] section:
CONFIG_TEXT: open_files_limit = 4096 Restart the MySQL service:
# service mysql restart For RHEL-based distributions: Add the following line in /etc/sysctl.conf:
CONFIG_TEXT: fs.file-max = 65536 Edit the file /etc/security/limits.conf and add lines:
CONFIG_TEXT: * soft nproc 40960 * hard nproc 40960 * soft nofile 40960 * hard nofile 40960 Edit the file /etc/security/limits.d/90-nproc.conf and add lines:
CONFIG_TEXT: * soft nproc 40960 * hard nproc 40960 * soft nofile 40960 * hard nofile 40960 Add the following line in /etc/my.cnf and under the [mysqld] section:
CONFIG_TEXT: open_files_limit = 4096 Restart the MySQL service:
# service mariadb restart "
2,"Why it is not possible to manage particular settings under subscription user account with Administrator role?
Applicable to: Plesk for Linux
Plesk for Windows Question
Additional user with Administrator role has been created in Users menu, however he cannot manage particular settings. For example: Tools & Settings, Additional Apache directives and Additional nginx directives are absent. Why?
Answer
By design user added via Subscriptions > example.com > Users has limited set of permissions. These users are not considered to perform the same actions that Plesk administrator is able to. If it is required to create user with Plesk administrator privileges, create Additional Administrator Account,
Additional information
Managing Additional User Accounts "
9,"How to recalculate statistics for a particular domain in Plesk Applicable to: Plesk for Windows Plesk for Linux Question
Domain's statistics has been changed. How to manually recalculate statistics for one domain to reflect the changes in Plesk?
Answer
Note: This guide is intended for Plesk administrators with an SSH/RDP access to a Plesk server. If you are a domain owner, please contact your service provider for assistance.
Click on a section to expand For Linux Connect to a Plesk server via SSH. Use the 'statistics' utility to calculate web page access statistics, traffic usage statistics and disk space usage statistics:
# plesk sbin statistics --calculate-one --domain-name=example.com Click on a section to expand For Windows Connect to a Plesk server RDP . Use the 'statistics' utility to calculate web page access statistics, traffic usage statistics and disk space usage statistics:
C:\> plesk sbin statistics --calculate-one --domain-name=example.com
C:\> ""%plesk_bin%""\web_statistics_executor.exe --calculate-domain --domain-name=example.com --webspace-name=example.com
If the command does not result in the statistics update, execute the below command:
C:\> ""%plesk_bin%""\statistics.exe --generate-domain-webstat --domain-name=example.com Additional information
How to recalculate statistics for all domains via Plesk"
8,"Unable to send an email to Gmail: Our system has detected that this message does not meet IPv6 sending guidelines regarding PTR records Applicable to: Plesk for Linux
Plesk for Windows Symptoms Plesk server has IPv6 address. When an email message is sent from a Plesk server to a Gmail account, it fails to be delivered. The following error message appears in mail logfile: On Linux: /var/log/maillog On Windows Server: %plesk_dir%Mail Servers\Mail Enable\Logging\SMTP\SMTP-Debug.log OR C:\Program Files (x86)\Mail Enable\Logging\SMTP\SMTP-Debug.log CONFIG_TEXT: ipv6_failed_after_I_sent_the_message./Remote_host_said:_550-5.7.1_[ipv6______16]_Our_system_has_detected_that_this/550-5.7.1_message_does_not_meet_IPv6_sending_guidelines_regarding_PTR_records/550-5.7.1_and_authentication._Please_review/550-5.7.1_https://support.google.com/mail/?p=ipv6_authentication_error_for_more/550_5.7.1_information._hg7si388602wjb.61_-_gsmtp/ The email message sender receives the following message:
CONFIG_TEXT: Remote host said: 550-5.7.1 [2a00:14e8:211:2123::2 16] Our system has detected that this 550-5.7.1 message does not meet IPv6 sending guidelines regarding PTR records 550-5.7.1 and authentication. Please review 550-5.7.1 https://support.google.com/mail/?p=ipv6_authentication_error for more 550 5.7.1 information. la8si618732wjb.94 - gsmtp Cause Gmail Guidelines for IPv6 are not met.
Resolution
Verify that the IPv6 address has a PTR-record from any Linux shell:
# dig -x 2001:db8:f61:a1ff:0:0:0:80 |grep PTR ;0.8.0.0.0.0.0.0.0.0.0.0.0.0.0.0.f.f.1.a.1.6.f.0.8.b.d.0.1.0.0.2.ip6.arpa. IN PTR example.com
Verify that the answer for PTR record query matches the IP address obtained via the forward DNS resolution of the hostname specified in the PTR record:
# dig example.com|grep IN|grep A 203.0.113.2 2001:db8:f61:a1ff:0:0:0:80
In case these conditions are not met, contact your Internet Service Provider (ISP). On Linux, apply one of the following workarounds: Configuring mail server to use IPv4 only (Postfix) Connect to the Plesk server via SSH. Find out which protocols are currently enabled with the command:
# postconf inet_protocols inet_protocols = all If the output is the same, modify Postfix configuration file main.cf by executing the command below:
# postconf inet_protocols=ipv4 Restart Postfix to apply the changes:
# service postfix restart Verify the changes:
# postconf inet_protocols inet_protocols = ipv4 Disabling IPv6 addresses on the server In Plesk, go to Tools & Settings > IP Addresses > click on the Sites number next to IPv6. If there are domains hosted on IPv6, go to Domains > example.com > Web Hosting Access and switch these domains to IPv4 only. When you are sure no domains are using IPv6 in Plesk, connect to the Plesk via SSH and open the file /etc/sysctl.conf in a text editor. In this example, we are using the vi editor:
# vi /etc/sysctl.conf Add the following lines:
# grep ipv6 /etc/sysctl.conf net.ipv6.conf.all.disable_ipv6=1 net.ipv6.conf.default.disable_ipv6=1 Apply the changes with the following command:
# sysctl -p Remove IPv6 addresses from Plesk: Click Reread IP at Tools & Settings > IP Addresses. Related Articles Unable to send an email from a Plesk server to Gmail: 421-4.7.0 This message does not have authentication information or fails to pass 421-4.7.0 authentication checks
Outgoing emails sent from Plesk server to mail services like GMail, Yahoo goes to spam folder. How to troubleshoot?
"
2,"Unable to remove a PHP handler: This handler is corrupted or broken
Applicable to: Plesk for Linux Symptoms PHP handler is marked as corrupted in Plesk > Tools & Settings > PHP Settings:
PLESK_ERROR: This handler is corrupted PHP handler is marked as broken while listing handlers via CLI:
# /usr/local/psa/bin/php_handler --list id: display name: php-cli: status: 5.5-latest 5.5.latest /opt/atomic/atomic-php55/root/usr/bin/php broken
Or:
Plesk does not list this handler as registered:
# /usr/local/psa/admin/bin/php_handlers_control --list | grep '5.5-latest' # Attempt to remove this handler fails:
# /usr/local/psa/bin/php_handler --remove -id 5.5-latest The PHP handler ""5.5-latest"" is not found Plesk database contains a record for the handler:
# plesk db ""select section,name from ServiceNodeEnvironment where name='5.5-latest'"" +-------------+---------------------+ | section | name | +-------------+---------------------+ | phphandlers | 5.5-latest | +-------------+---------------------+ Cause
PHP 5.5 handler provided by Atomic is not installed on the server and database contains outdated information about that handler.
Resolution
Connect to the server via SSH and reread handlers information using the following command:
# /usr/local/psa/admin/bin/php_handlers_control --reread "
2,"Plesk shows 503 Service Unavailable: iisnode.dll failed to load The data is the error
Applicable to: Plesk for Windows Symptoms When loading Plesk the following error is displayed:
CONFIG_TEXT: HTTP Error 503. The service is unavailable In Event Viewer > Windows Logs > Application the following error:
CONFIG_TEXT: The Module DLL C:\\Program Files (x86)\\iisnode\\iisnode.dll failed to load. The data is the error. PleskControlPanel Application pool is stopped at IIS Manager > server > Application Pools Cause
Plesk users psaadm and psacln do not have access to C:\\Program Files (x86)\\iisnode\\ directory by default.
Resolution Connect to the server via RDP. Add the following lines into the disksecurity.xml file which is stored in %plesk_dir%\\etc\\DiskSecurity\\ directory:
CONFIG_TEXT: <!-- Program Files\\iisnode --> <Entry AccounType=""1"" Account=""Psaadm"" Path=""{ProgramFiles}"" SubPath=""iisnode"" AceFlags=""ThisFolderSubfoldersAndFiles"" AccessMask=""Read"" EntryFlags=""0x40"" /> <Entry AccounType=""1"" Account=""Psacln"" Path=""{ProgramFiles}"" SubPath=""iisnode"" AceFlags=""ThisFolderSubfoldersAndFiles"" AccessMask=""Read"" EntryFlags=""0x40"" /> Open Plesk Reconfigurator by running the following command in cmd:
C:\> ""%plesk_dir%admin\bin\reconfigurator.exe"" Correct disk permissions: OR Repair Plesk Installation > tick checkbox Plesk File Security > Check. Start Plesk Services Monitor: Restart Plesk Management Service Start PleskControlPanel application pool at IIS > server > Application Pools > PleskControlPanel > Start "
4,"How does authentication via Plesk LDAP Auth extension work? Applicable to: Plesk 12.5 for Linux Plesk Onyx for Linux Question
How does Plesk LDAP Auth extension work and for which of the following type of Plesk user accounts? Reseller accounts
Customer accounts
User accounts such as mail account
Additional Administrator Accounts Answer
Note: Currently, the LDAP Auth extension cannot be configured via CLI. Vote and comment on this feature request from our Official Plesk UserVoice channel as top-voted suggestions are likely to be included in future versions.
The extension allows to disable Plesk native authentication and enable LDAP authentication to Plesk. In other words, if there is an external LDAP server (a central database storing multiple combinations of usernames and passwords), it is possible to use one login/password pair to log into several Plesk servers that have the extension installed and configured to use the same LDAP server.
Note: The extension works as LDAP client and does not provide ability to manage login/password storage as a LDAP server.
Note: LDAP extension cannot be used for webmail.
In case if it is needed to use both Plesk native authentication and LDAP Auth methods, enable LDAP Auth settings only at Extensions > LDAP Auth as it is shown below: No additional configuration from OS level is required before installing the LDAP Auth extension. The only requirement is that Plesk should have the user with the same name as the one on LDAP server. For example, LDAP server has user jdoe with password password. Then it is required to create the same user in Plesk, configure extension and disable Plesk native authentication. After that it will be possible to log into Plesk as jdoe with password password.
Note: The type of the user is not related specifically to account type.
For Windows it is required to specify domain name with ending slash DOMAIN\ in ""Login prefix"" or a suffix such as @example.com.
The following ports should be open from Plesk to Domain Controller: UDP Port 88 for Kerberos authentication
UDP Port 389 for LDAP and TCP Port 636 for SSL LDAP to handle queries from client computers to the domain controllers "
8,"How to activate SpamAssassin server-wide in Plesk? Applicable to: Plesk for Linux Plesk for Windows Question
How to activate SpamAssasin server-wide and make it enabled for all Plesk mailboxes?
Answer Log in to Plesk Open Tools & Settings > Spam Filter Check box Switch on server-wide SpamAssassin spam filtering Uncheck box Apply individual settings to spam filtering Click Apply. "
9,"How to remove password from domain's web statistics page in Plesk
Applicable to: Plesk 12.5 for Linux
Plesk for Linux Question
How to remove password from domain's web statistics page (AWstat or Webalizer) and restore it after?
Answer
By default, web statistics page protected with a login and password of the system user of a subscription.
Password protection for web statistics page can be removed as follows: Go to Domains > example.com > Hosting settings page
Untick checkbox for Protect access to your web statistics with your FTP username and password checkbox.
If the issue persists, connect to the server via SSH and run:
# plesk repair web example.com Note: Be careful, if a domain configured with additional users under Domains > example.com > Password-Protected Directories unsetting of Web statistics (Protect access to your web statistics with your FTP username and password) checkbox for the directory where web statistics are stored, will flush these settings."
10,"How to make a module be showing on one page instead of all pages? Applicable to: Plesk 11.x for Linux Plesk 11.x for Windows Web Presence Builder for Linux While editing a page in Web Presence Builder the same module is showing in all subpages. How to make it be displayed on one page only?
Answer
The module was placed into the ON ALL PAGES page's area (site-wide module).
Resolution
Each module of Web Presence Builder may be placed into the page-specific area or site-wide area: To place a module only on the current page, select the module under the Modules tab, and drag it to any of the areas marked with the text ONLY ON THIS PPAGE .uch areas are located within the main content block and near the top of each sidebar.
To divide the content area into columns and insert a module into one of them, drag the module to the left or right edge of the content area and then insert it. Note that sidebar areas cannot be divided into columns. To place a module on all pages of the website, select the module under the Modules tab, and drag it to any of the areas marked with the text ON ALL PAGES . Such areas are located above and below the main content block, in sidebars, header, and footer. Note : Check userGuides for details: Presence Builder 11.5 User Guide Presence Builder 12.0 User Guide "
5,"Migration fails: Failed to transfer WPB sites, unrecognized option: publish-sb-site Applicable to: Plesk for Windows Symptoms Unable to migrate domain with the following error in /usr/local/psa/var/modules/panel-migrator/sessions/<date>/debug.log:
CONFIG_TEXT: Failed to transfer WPB sites of subscription 'example.com'Migration tools tried to perform operation in 3 attempts: Command {plesk_bin_domain} --update {domain_name} -publish-sb-site true -sb-site-id {site_id} with arguments {'site_id': 'plesk_bin_domain': u'/usr/local/psa/bin/domain', 'domain_name': u'example.com'} failed with exit code 1stderr: Unrecognized option: '-publish-sb-site' The amount of sites published with Presence Builder is shown as 0 on the destination server at Tools & Settings > License Management. Cause
Web Presence Builder add-on is not installed on the destination server license.
Resolution
Apply one of the following solutions and then rerun migration: Install a Web Presence Builder add-on on the destination server
To continue manage websites in Web Presence Builder on the destination server, purchase a Web Presence Builder add-on for a Plesk license.If you are a Plesk Partner, add a Web Presence Builder add-on to a Plesk license in your Partner Central account. For assistance, contact Plesk Customer Success team.
Alternatively, obtain a trial Plesk license and install it on the destination server. Note that once a trial license expires, it will be required to purchase a full Plesk license. Disable Web Presence Builder for the affected websites, if it is not required on the destination server Connect to the source Plesk server. Run the following command to disable Web Presence Builder for the affected domain:
# plesk bin site --update example.com -publish-sb-site false "
0,"Cannot access website or Plesk Interface behind the NAT
Applicable to:
Plesk for Linux Symptoms Server configured with Plesk NAT manager and domains are resolved properly to external IP address. However websites are not accessible from outside. tcpdump utility is not showing traffic from external IP addresses on the interface:
# tcpdump -i eth0 -nl tcp port 80 tcpdump: listening on any, link-type LINUX_SLL (Linux cooked), capture size 65535 bytes 0 packets captured 0 packets received by filter 0 packets dropped by kernel Cause
Firewall misconfiguration.
Resolution Check NAT configuration for proper IP addresses mapping. Check that there are no firewall restrictions for ports 80 and 443 between the client and the server.
It can be checked with following commands on the client Linux computer from outside:
# curl -vvv 203.0.113.2:80 | grep HTTP * About to connect() to 203.0.113.2 port 80 (#0) * Trying 203.0.113.2... HTTP/1.1 200 OK
# curl -vvv 203.0.113.2:443 | grep HTTP * About to connect() to 203.0.113.2 port 443 (#0) * Trying 203.0.113.2... HTTP/1.1 200 OK Check that ports are opened using nmap utility on the linux computer from outside:
# nmap 203.0.113.2 -p80 PORT STATE SERVICE 80/tcp open http
# nmap 203.0.113.2 -p443 PORT STATE SERVICE 443/tcp open https Note: If ports are filtered or closed, it is needed to check Firewall settings on NAT/external Firewall side."
2,"Unable to access Plesk: psaerror(string 'Unable to connect to database: mysql_connect()
Applicable to: Plesk for Linux Symptoms Unable to log in to Plesk, the following error is shown:
PLESK_INFO: ERROR: PleskFatalException Unable to connect to database: mysql_connect() [<a href='function.mysql-connect'>function.mysql-connect</a>]: No such file or directory The following warning can be observed in the /var/log/mysql/error.log :
CONFIG_TEXT: InnoDB: Warning: difficult to find free blocks from InnoDB: the buffer pool (986 search iterations)! Consider InnoDB: increasing the buffer pool size. MySQL service does not start. Cause
'innodb_buffer_pool_size' is too low.
Resolution Connect to the Plesk server via SSH.
Note: If direct SSH access to the server is not possible, contact server administrator for further assistance. Open the my.cnf configuration file in a text editor. In this example, we use the vi editor: on CentOS/RHEL-based distributions
# vi /etc/my.cnf on Debian/Ubuntu-based distributions
# vi /etc/mysql/my.cnf Increase innodb_buffer_pool_size in the my.cnf configuration file, you may set it to 100M:
CONFIG_TEXT: innodb_buffer_pool_size=100M Restart the MySQL service to apply the changes (The command depends on operating system and MySQL version):
# service mariadb restart # service mysql restart # service mysqld restart "
3,"How to update web server settings via CLI for all domains on Plesk for Linux server?
Applicable to:
Plesk for Linux
Question
How to update web server settings via CLI for all domains on a Plesk for Linux server?
Answer Connect to the server using SSH. Execute one of the commands depending on which setting should be changed: To enable serving PHP by nginx:
# plesk bin site -l | while read i; do plesk bin subscription --update-web-server-settings $i -nginx-serve-php true; done To disable the option Domains > example.com > Apache & nginx Settings > Smart static files processing on all domains:
# plesk bin site -l | while read i; do plesk bin domain --update-web-server-settings $i -nginx-transparent-mode true; done To enable the options Domains > example.com > Apache & nginx Settings > Serve static files directly by nginx on all domains:
# plesk bin site -l | while read i; do plesk bin domain --update-web-server-settings $i -nginx-serve-static true; done Other settings can be updated by substituting the setting name (after --update-web-server-settings $i) in the commands above. Available settings -apache-directory-index <directory index> - Set index pages for the specified website. For example: index.html index.htm index.text -apache-restrict-follow-sym-links true|false - Restrict the ability to follow symbolic links. -nginx-proxy-mode <true|false> - Proxy mode -nginx-transparent-mode <true|false> - Smart static files processing -nginx-serve-static <true|false> - Serve static files directly by nginx -nginx-static-extensions <extensions> - Sets static files extensions that should be served directly by nginx. If empty value is specified, the static files extensions from the default nginx configuration (/var/www/vhosts/example.com/system/conf/last_nginx.conf) will be used. Use this option with the -nginx-serve-static command. -nginx-serve-php <true|false> - Turns on/off processing PHP files by the nginx reverse proxy server. The default value is ""false"". "
3,"ASP website shows error: Could not load type 'System.ServiceModel.Activation.HttpModule' from assembly
Applicable to: Plesk for Windows Symptoms The following error message appears on attempt to open a website on ASP.NET 4.0:
CONFIG_TEXT: Could not load type 'System.ServiceModel.Activation.HttpModule' from assembly 'System.ServiceModel, Version=3.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089' Cause ASP.NET 4 is not properly registered in Microsoft IIS. web.config file of the domain (%plesk_vhosts%example.com\httpdocs\web.config) contains information about an invalid ASP.NET version (e.g. ASP.NET 3.5, although the site is using the ASP.NET 4). Resolution Try switching Microsoft ASP.NET version to 2.0 in Plesk at Domains > example.com > Hosting Settings. In case it will result in another error, apply the following solution: Connect to the server via RDP. Start a command prompt as an Administrator and re-register ASP.NET 4.0 module in ISS: For Windows Server 2012 and later:
C:\> dism.exe /Online /Enable-Feature /all /FeatureName:IIS-ASPNET45 For Windows Server 2008:
C:\> C:\WINDOWS\Microsoft.NET\Framework\v4.0.30319\aspnet_regiis.exe -iru Restart IIS in order to apply the change:
C:\> iisreset Check the web.config file for the domain. If it is corrupted, rename it and re-create it. On a Plesk Onyx server, it is possible by running the command:
C:\> plesk repair web example.com
It is possible to modify web.config file for the website by adding the following string as an example:
CONFIG_TEXT: <add name=""ServiceModel"" type=""System.ServiceModel.Activation.HttpModule, System.ServiceModel, Version=3.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089"" preCondition=""managedHandler,runtimeVersionv2.0"" /> "
6,"Unable to import a database in Plesk: UNKNOWN CHARACTER SET: utf8mb4
Applicable to: Plesk for Linux
Plesk for Windows Symptoms Unable to import a database with utf8mb4 charset. The following error appears in PhpMyAdmin:
CONFIG_TEXT: UNKNOWN CHARACTER SET: 'utf8mb4'
OR
CONFIG_TEXT: unknown collation 'utf8mb4_unicode_520_ci' The database is imported to MySQL version 5.1 The database is imported to MySQL version > 5.5.x, but different operating system distribution Cause
The utf8mb4 charset is not supported by MySQL 5.1, or not supported in that OS distribution.
Resolution For Linux
Upgrade MySQL server to 5.5 version or higher using the article: How to upgrade MySQL server to 5.5 on Linux For Windows Server
Run Plesk installer and install all the latest updates or upgrade to a newer Plesk version.
Note: *_520_ci collations are supported starting from MySQL 5.6."
0,"How to change expiration date for all subscriptions to unlimited
Applicable to: Plesk 11.x for Linux
Plesk 11.x for Windows
Plesk 12.0 for Linux
Plesk 12.0 for Windows
Plesk 12.5 for Linux
Plesk 12.5 for Windows
Plesk Onyx for Linux
Plesk Onyx for Windows Question
How to set expiration date for all subscriptions to unlimited in back end?
Answer For Windows: For Plesk Onyx: Connect to the server via RDP and retrieve domain names from the database:
C:\> plesk db -Ne ""select name from domains where webspace_id=0;"" > webspaces_list.txt Run the following command to set expiration date of all subscriptions to unlimited:
C:\> for /f %i in (webspaces_list.txt) do ""%plesk_cli%\subscription_settings.exe"" -u %i -expiration -1 For Plesk Onyx and below: Connect to the server via RDP and retrieve domain names from the database
C:\> cd %plesk_dir% cd MySQL/bin/ mysql -uadmin -p -P8306 psa -Ne""select name from domains where webspace_id=0;"" > С:\\webspaces_list.txt Run the following command to set expiration date of all subscriptions to unlimited:
C:\> for /f %i in (C:\\webspaces_list.txt) do ""%plesk_cli%\\subscription_settings.exe"" -u %i -expiration -1 For Linux: Connect to the server via SSH and do the following:
# MYSQL_PWD=`cat /etc/psa/.psa.shadow` mysql -uadmin psa -e""select name from domains where webspace_id=0;"" | grep -v ""name"" > /tmp/webspaces.list # while read l; do /usr/local/psa/bin/subscription_settings -u $l -expiration -1; done < /tmp/webspaces.list "
2,"Plesk is not accessible: Starting sw-cp-serverd: nginx: [emerg] BIO_new_file(""/usr/local/psa/admin/conf/httpsd.pem"") failed
Applicable to: Plesk 12.5 for Linux
Plesk 12.0 for Linux Symptoms It is not possible to access Plesk. While trying to start sw-cp-server the following error occurs: # service sw-cp-server startStarting sw-cp-serverd: nginx: [emerg] BIO_new_file(""/usr/local/psa/admin/conf/httpsd.pem"") failed (SSL: error:02001002:system library:fopen:No such file or directory:fopen('/usr/local/psa/admin/conf/httpsd.pem','r') error:2006D080:BIO routines:BIO_new_file:no such file) [FAILED] The /usr/local/psa/admin/conf/httpsd.pem file is missing:
# ls -la /usr/local/psa/admin/conf/httpsd.pemls: cannot access /usr/local/psa/admin/conf/httpsd.pem: No such file or directory Cause
Missing httpsd.pem certificate file.
Resolution Login to the server via SSH. Recreate httpsd.pem certificate using following steps:
# cd /usr/local/psa/admin/conf/
# openssl req -new -nodes -x509 -out httpsd.pem -newkey rsa:2048 -keyout httpsd.pem -days 3650 Restart sw-cp-server:
# service sw-cp-server restart "
7,"Discontinued support of features and components in Plesk Onyx 17.0
Applicable to: Plesk Onyx for Windows
Plesk Onyx for Linux Information
The following components and features are no longer available in Plesk Onyx for installation or usage. Click on the required section to get details on why these features are dropped and recommendations on what to do: Customer and Business Manager Why? Customer and Business Manager is now owned, maintained and supported by Odin (subsidiary of Ingram Micro), so we are removing it from Plesk Onyx distribution. Since the product belongs to a different entity, we are also dropping its support. What to do? New installations of Plesk Onyx do not include CBM as a part of their distribution and are not manageable with CBM. If you have a remote CBM instance used for managing multiple Plesk servers, we cannot guarantee that it will be able to manage Plesk Onyx. If you were using CBM, we recommend switching to a different billing and provisioning system.
Note: Upgrade to Plesk Onyx in unattended mode will be blocked if you have any customer account(s) in CBM. The only way to complete the upgrade in unattended mode is to uninstall CBM or perform an upgrade in the interactive mode. Important: If you upgrade to Plesk Onyx without uninstalling CBM, CBM will stop working. Windows VZ Templates Why? Plesk Onyx will not support installation and upgrade using Windows VZ templates due to extremely low use of Windows VZ templates among Plesk users. What to do? If you were using Windows VZ Templates to install Plesk, we recommend to install and upgrade Plesk using Plesk Installer. x86-based distributions of operating systems Why? Plesk Onyx cannot be upgraded or installed on x86 (x32) versions of OSes supported by Plesk Onyx due to lack of popularity, reduced efficiency and overall usage decline of x86 architecture compared to x64. What to do? For those who use Plesk on x86 (x32) versions of OSes supported by Plesk Onyx, we recommend migrating your Plesk installations to Plesk Onyx installed on an x64-based version of the same distribution. You can use our new Plesk Migrator extension for migration.
Note: the full list of the supported OSes can be found here. CentOS 5 / RHEL5 / CloudLinux 5 / Ubuntu 12.04 Why? Plesk Onyx cannot be upgraded or installed on CentOS 5, RHEL 5 and CloudLinux 5 OSes. These OSes are outdated, their share among Plesk server OSes is very low and they are obsolete and unsupported. Also, a lot of new software doesn't work on these OSes, which prevents us from delivering new features and fixes. What to do? For those who use Plesk on these OSes we recommend migrating to CentOS 7, RHEL 7 and CloudLinux 7 respectively. You can use our new Plesk Migrator extension for migration.
Note: for Ubuntu 12.04 dist-upgrade procedure is possible: How to perform dist-upgrade procedure on server with Plesk. Microsoft Windows 2008 (not R2) Why? Plesk Onyx cannot be upgraded or installed on Microsoft Windows 2008 OS. It is outdated, its share among Plesk server OSes is very low and it's difficult to deliver new features and fixes on it. What to do? For those who use Plesk on Windows 2008 we recommend migrating to Microsoft Windows Server 2012 R2. You can use our new Plesk Migrator extension for migration. ASP.NET 1.1 Why? Plesk Onyx does not support ASP.NET 1.1 on the Windows platform. This particular version of ASP.NET is EOLed, doesn't work on newer Windows Server OSes and is barely used on Plesk servers. What to do? Those who are upgrading to Plesk Onyx from previous Plesk versions will still have ASP.NET 1.1 handlers available on their sites. However, ASP.NET 1.1 will be removed after any reconfiguration of these sites. If this happens, Plesk will switch to ASP.NET 2.0 or 4.0, depending on OS version. SmarterMail 6.x - 9.x Why? Plesk Onyx does not support SmarterMail 9.x or earlier. SmarterMail supports only the two latest versions of their mail server software, so they only support SmarterMail 15 and 16 as of the time of this writing. What to do? If you have SmarterMail 9.x or earlier, you won't be able to manage mail via Plesk if you upgrade to Plesk Onyx. We strongly recommend you to upgrade SmarterMail to at least version 10.x before upgrading to Plesk Onyx. Miva Why? Plesk Onyx does not support Miva scripting. Miva usage among Plesk users is very low and Miva usage overall is steadily declining over the years. What to do? If you're using Miva, your sites and servers using Miva might be able to continue using it after the upgrade to Plesk Onyx, but we do not guarantee their functioning. You will be using Miva at your own risk. Shared SSL support on Windows Why? Plesk Onyx does not have a Shared SSL feature on the Windows platform anymore. This feature was unpopular among Plesk users and with advent of free Let's Encrypt SSL/TLS certificates there is no value in it anymore. What to do? If you were using shared SSL on Windows, the shared SSL links will be left in the system during the upgrade to Plesk Onyx. The UI for the shared SSL feature will not be available. The domains which used SSL certs provided by another domain will be able to use these SSL certs until the virtual host configuration of these domains is changed. We suggest installing Let's Encrypt extension for Plesk and use free Let's Encrypt SSL/TLS certificates to secure your websites. Unity Mobile Why? Plesk Onyx does not support Unity Mobile. The Unity Mobile service was shut down some time ago by its authors and it's not possible to provide it to our customers anymore. What to do? If you were using Unity Mobile, we suggest you find a different solution for creating mobile versions of your websites, if that's still required. 10.4 upgrade drop Why? Plesk Onyx does not support direct upgrade from Plesk 10.4 because Plesk 10.4 was EOLed on May 3, 2015. Users of Plesk 10.4 are still able to upgrade to Plesk 12.5. What to do? If you are using Plesk 10.4 and you want to upgrade to Plesk Onyx, we recommend using our new Plesk Migrator extension to migrate your Plesk 10.4 instance to Plesk Onyx. Alternatively, if you use Plesk 10.4 on an OS that is still supported by Plesk Onyx, you can upgrade to Plesk 12.5, and then upgrade your Plesk 12.5 instance to Plesk Onyx. perl-apache-asp component drop Why? Plesk Onyx does not support perl-apache-asp. This component hasn't been updated since 2011/08/16 and is barely used on Plesk servers. What to do? Those who are upgrading to Plesk Onyx from previous Plesk versions will still have perl-apache-asp available on their sites with the ability to manage it. However, new Plesk Onyx installations will not have perl-apache-asp available. "
6,"Plesk and/or websites are inaccessible: SQLSTATE[08004] [1040] Too many connections error
Applicable to: Plesk for Linux Symptoms The following error appears in the Plesk interface or during Plesk migration process:
PLESK_INFO: Unable to connect to database: Too many connections SQLSTATE[08004] [1040] Too many connections Websites fail to load with the error:
PLESK_INFO: Error Establishing a Database Connection Plesk license installation fails with the error:
PLESK_ERROR: Incorrect ServerInfo format (Error code: 2) exit status 1 Cause
This error means that the maximum number of simultaneous connections to the MySQL server has been reached. New connections to the server cannot be established at this time.
Resolution For Plesk on Linux Automatic Solution Connect to the Plesk server via SSH. Download, unzip and run automatic script that will set the MySQL parameter max_connections to 300:
# wget https://support.plesk.com/hc/article_attachments/360003572374/maxconn.zip # unzip maxconn.zip # chmod +x maxconn # ./maxconn
Note: If the automatic solution did not help, apply the manual solution below. Manual Solution Connect to the Plesk server via SSH. Find the current max_connections value:
# plesk db ""SHOW VARIABLES LIKE 'max_connections'"" +-----------------+-------+ | Variable_name | Value | +-----------------+-------+ | max_connections | 151 | +-----------------+-------+ Open the MySQL configuration file my.cnf in a text editor. In this example, we are using the vi editor: on CentOS/RHEL-based distributions
# vi /etc/my.cnf on Debian/Ubuntu-based distributions
# vi /etc/mysql/my.cnf Increase the number of connections by adding this directive under the [MySQLD] section:
CONFIG_TEXT: [mysqld] max_connections=300 Save the changes and close the file. Restart MySQL/MariaDB service to apply the changes using one of these commands:
# service mysql restart
# service mariadb restart For Plesk on Windows Server Manual Solution Connect to the Plesk server via RDP. Open the MySQL configuration file %plesk_dir%Databases\MySQL\my.ini in a text editor. Increase the number of connections by adding this directive under the [MySQLD] section (the default value is 300):
CONFIG_TEXT: [MySQLD] max_connections=300 Save the changes and close the file. Restart the MySQL/MariaDB service. "
6,"Plesk is not available: Unknown database 'apsc'
Applicable to: Plesk 11.x for Linux
Plesk 12.0 for Linux
Plesk 12.5 for Linux
Plesk Onyx for Linux Symptoms Plesk is showing the following error:
PLESK_ERROR: ERR [panel] Exception: ODBC error #HY000: [unixODBC][MySQL][ODBC 5.3(w) Driver]Unknown database 'apsc' file: /usr/share/aps_php/aps_php.php line: 11933 code: 0
or:
PLESK_ERROR: New files of configuration for Apache web server were not built due to errors in configuration templates: Template processing failed: file = /usr/local/psa/admin/conf/templates/default/domainVhost.php, error = [unixODBC][MySQL][ODBC 3.51 Driver]Unknown database 'apsc'. Provisioning subscription from OBAS to Plesk may fail with the following error on OBAS side:
CONFIG_TEXT: Process provisioning for document; Error occurred while fetching components list and network settings from Plesk node: Failed to get Site Applications from Plesk Node. Migration may fail with the following error:
PLESK_ERROR: An error occurred during importing package: ODBC error #HY000: [unixODBC][MySQL][ODBC 5.1 Driver]Access denied for user 'psaadm'@'localhost' (using password: NO) Tools & Settings > Diagnose & Repair shows:
CONFIG_TEXT: Connection to APSC DB is not possible: ODBC error #42S02: [ma-3.0.8][10.1.44-MariaDB-0ubuntu0.18.04.1]Table 'apsc.aps_package' doesn't exist Cause
APS Controller database apsc does not exist on the server.
Resolution
There are 3 ways to restore apsc database: Find the latest apsc database backup and restore it as described in the article here. For example:
# ls -lt /var/lib/psa/dumps/ | grep apsc | head -1 -rw------- 1 root root 4118 Mar 6 02:02 mysql.preupgrade.apsc.17.5.3-17.5.3.20180306-020233.dump.gz # gunzip /var/lib/psa/dumps/mysql.preupgrade.apsc.17.5.3-17.5.3.20180306-020233.dump.gz # MYSQL_PWD=`cat /etc/psa/.psa.shadow` mysql -f -uadmin apsc < /var/lib/psa/dumps/mysql.preupgrade.apsc.17.5.3-17.5.3.20180306-020233.dump If there are no backups of the database found in /var/lib/psa/dumps/, repair database with bootstrapper.sh script:
For Plesk Onyx 17.5:
# /usr/local/psa/bootstrapper/pp17.5.3-bootstrapper/bootstrapper.sh repair
For Plesk Onyx 17.0:
# /usr/local/psa/bootstrapper/pp17.0.17-bootstrapper/bootstrapper.sh repair
For Plesk 12.5:
# /usr/local/psa/bootstrapper/pp12.5.30-bootstrapper/bootstrapper.sh repair
For Plesk 12:
# /usr/local/psa/bootstrapper/pp12.0.18-bootstrapper/bootstrapper.sh repair
For Plesk 11.5:
# /usr/local/psa/bootstrapper/pp11.5.30-bootstrapper/bootstrapper.sh repair If neither of above methods worked, create an empty apsc database and register it in Plesk using secure password:
# MYSQL_PWD=`cat /etc/psa/.psa.shadow` mysql -uadmin -e""CREATE DATABASE apsc"" # MYSQL_PWD=`cat /etc/psa/.psa.shadow` mysql -uadmin apsc < /usr/local/psa/bootstrapper/pp***-bootstrapper/db/apsc_mysql_db.sql # /usr/local/psa/bin/sw-engine-pleskrun /usr/local/psa/admin/plib/scripts/register_apsc_database.php --register -host localhost -port 3306 -database apsc -login apsc -password ""****"" "
9,"Statistics calculation fails: The system cannot find the path specified
Applicable to:
Plesk for Windows Symptoms
Statistics calculation fails with the following message:
C:\> ""%plesk_bin%\web_statistics_executor.exe""The system cannot find the path specified. (Error code 3) at Open file 'C:\Inetpub\vhosts\example.com\.plesk\statistics\example.com\webstat\CopyAWStats.lock' at (VFile::open line 104) at Calculate web statistics by config 'C:\Inetpub\vhosts\example.com\logs\iis\W3SVC14\web_stat_executor.conf'(WebStatisticsExecutor::calculate line 82)
Cause Domain/subdomain folder structure is not correct. Incorrect removal of a domain/subdomain that leads to an incorrect Web statistics engine configuration. Resolution Connect to a Plesk server via RDP. Start a command prompt as an Administrator and run the following commands: If it's Plesk 12.x or lower:
C:\> cd ""%plesk_cli%""repair.exe --update-vhosts-structurerepair.exe --update-all-domains-web-stat If it's Plesk Onyx:
C:\> plesk repair fs If the problem is not resolved, check that the domain example.com exists in Plesk and that the file system contains the following directory:
C:\> C:\Inetpub\vhosts\example.com\.plesk\statistics\example.com\webstat\ Make sure that in IIS there's a domain with ID 14 (from folder name W3SVC14):
C:\> C:\inetpub\vhosts\example.com\logs\W3SVC14 Open IIS: Start > Windows Administrative Tools > Internet Information Services (IIS) Manager At <Server_Name> > Sites, ordered by ID, check if there's a domain with ID 14 (according to this example).
A- If it does not exist: move the folder W3SVC14 out of C:\Inetpub\vhosts, for example to Administrator's desktop.
B- If it exists in IIS: verify that the domain example.com is in the content of the file C:\Inetpub\vhosts\example.com\logs\iis\W3SVC14\web_stat_executor.conf as follows:
CONFIG_TEXT: <?xml version=""1.0"" encoding=""UTF-8"" standalone=""no""?><config><domain name=""example.com"" webspaceName=""subscription.com"" default_doc=""""><webstat type=""awstats""/><alias name=""example.com""/><alias name=""www.example.com""/></domain></config> "
5,"Backup fails with error: Not enough free disk space to backup selected objects
Applicable to: Plesk 11.x for Linux
Plesk 12.0 for Windows
Plesk 12.5 for Linux
Plesk 12.5 for Windows
Plesk Onyx for Linux
Plesk Onyx for Windows Symptoms Backup fails with one of the following errors in Plesk UI:
PLESK_ERROR: Not enough free disk space to backup selected objects. At least 60862Mbytes free disk space is required.
OR
PLESK_ERROR: Error: server ""server"" Cannot encrypt dump file (this is not fatal error!): Error occured while sending feedback. HTTP code returned: 500 Error occured while sending feedback. HTTP code returned: 500 DB query failed: SQLSTATE[HY000]: General error: 1030 Got error 28 from storage engine, query was: DESCRIBE `clients` When creating backup from CLI using pleskbackup utility, dump is deleted without clear message in /var/log/plesk/PMM/pmmcli.log:
CONFIG_TEXT: DEBUG: We are going to delete incompleted backup from local storage backup_info_1711271102.xml DEBUG: Executing asynchronously [25566] process. CmdLine is '/usr/local/psa/admin/bin/pmm-ras --delete-dump-files --dump-storage=/var/lib/psa/dumps --dump-file-specification=backup_info_1711271102.xml --session-path=/usr/local/psa/PMM/sessions/2017-11-27-110256.247' ...INFO: Outgoing packet: <?xml version=""1.0"" ?><response> <errcode>0</errcode> <data> <task-status task-id=""10""> <finished log-location=""/usr/local/psa/PMM/sessions/2017-11-27-110256.247/migration.result"" status=""error""> </finished> </task-status> </data> </response> Cause
There is not enough disk space on the server.
Resolution Connect to the server via SSH or via RDP Increase the disk space on the server or free some space. Execute the following command in order to update Plesk Usage with the new disk space:
# plesk daily ExecuteStatistics "
3,"Website is inaccessible: 504 Gateway Timeout
Applicable to: Plesk for Linux Symptoms Website is inaccessible:
PLESK_INFO: 504 Gateway Time-out
or
PLESK_INFO: 502 Bad gateway In /var/www/vhosts/example.com/logs/proxy_error.log one of the following error is found:
CONFIG_TEXT: [error] 13463#0: *236171 upstream timed out (110: Connection timed out) while reading response header from upstream, client: 203.0.113.2, server: example.com, request: ""GET / HTTP/1.1"", upstream: ""http://203.0.113.2:7080/"", host: ""example.com""
or
CONFIG_TEXT: [error] 13463#0: *236761 upstream timed out (110: Connection timed out) while SSL handshaking to upstream, client: 203.0.113.2, server: example.com, request: ""GET /site/b55qrk5.php?aoqm=jaggery HTTP/1.1"", upstream: ""https://203.0.113.2:7081/site/b55qrk5.php?aoqm=jaggery"", host: ""example.com"" In /var/www/vhosts/example.com/logs/error_log the following entries may be found:
CONFIG_TEXT: [proxy_fcgi:error] [pid 6657:tid 139812767536896] (104)Connection reset by peer: [client 203.0.113.2:43472] AH01075: Error dispatching request to :, referer: http://www.example.com/administrator/index.php?option=com_k2&view=item&cid=62 WP All Import plugin fails with error ""Your server terminated the import process."" Cause
Subscription resources has been exceeded or PHP script is loading too much time.
Resolution Log into Plesk. Go to Domains > example.com > PHP Settings and increase max_execution_time and max_input_time, e.g: Command-line solution Connect to the server via SSH. Open corresponding php.ini file for the domain and adjust settings as below:
# grep max /var/www/vhosts/system/example.com/etc/php.ini .. max_execution_time = 3000 max_input_time = 6000 Update PHP settings:
# /usr/local/psa/bin/php_settings -u Per-domain PHP settings of all domains were successfully updated. "
9,"How to add a new DNS record for a domain via Plesk interface?
Applicable to: Plesk for Linux
Plesk for Windows Question
How to add a new DNS record for a domain via Plesk interface?
Answer
Warning: DNS settings is available only if the DNS server component is installed on Plesk server. If it is not installed - install DNS server component using this guide: How to install Plesk components. Log into Plesk. Go to Domains > example.com > DNS Settings.
Note: If only NS records are shown, click Enable button in order to enable local DNS service for a domain. Click Add Record. Select Record type, for example, A and fill in the required information Click OK and then click Update. Additional information Plesk Administrators Guide: DNS
"
9,"How to recalculate Plesk statistics starting from particular date on Windows
Applicable to: Plesk Onyx for Windows Question
How to recalculate statistics using old IIS log files starting from a particular date?
Answer
When the statistics.exe utility is run, either manually or during daily maintenance, it performs the following actions to calculate statistics for each domain: Parse IIS log files for the domain and only select non-processed records. Merge the selected records with the records from the default website log file. Process the resulting log file with the native statistics backend (AWStats or Webalizer). The recalculation can be performed using PowerShell scripts for Plesk 17. Download the script to the server, unzip it and right-click the script file, select ""Run with PowerShell"". Alternatively, follow the steps below to recalculate statistics from a given date to the current date: Ensure Log Rotation is enabled and configured
Go to IIS > Sites > example.com > Logging and enable all fields for W3C logging: Verify that domain log files are not compressed and contain data:
Use this command to find the log's location: C:\> ""%plesk_dir%""\admin\bin64\websrvmng.exe --get-vhost-log-dir --vhost-name=example.com C:\Inetpub\vhosts\example.com\logs\W3SVC11
Unzip and place all the log files that should be processed by statistics into the folder above. Make sure they have the .log extension. It also may be a good idea to merge them all into a single .log file. Change the value of LastHttpStatisticsRun for the domain in the registry:
Retrieve the domain ID from Plesk database:
C:\> ""%plesk_bin%""\dbclient.exe --direct-sql --sql=""SELECT id, name FROM domains WHERE name='example.com'"" id name 40 example.com
Change the value of this registry key to the date from which statistics will be recalculated:
HKEY_LOCAL_MACHINE\SOFTWARE\Wow6432Node\PLESK\PSA Config\Config\Statistics\DomainIds\40\LastHttpStatisticsRun
(where ""40"" is the domain ID obtained above from the psa database)
If there is no LastHttpStatisticsRun in the registry, all available log files will be recalculated. If it is needed to recalculate statistics for a part of the current month, edit this file (in this example, the current month is November 2019):
C:\inetpub\vhosts\example.com\.plesk\statistics\example.com\webstat\awstats112019.example.com.txt
Remove the lines starting with the following keywords from the file above: LastLine LastTime LastUpdate If it is needed to recalculate statistics for one or more months, delete the AWStats databases from the very first month for which the statistics need to be recalculated. For example, to recalculate statistics for September 2019 (and it is now November 2019), delete the following files:
C:\inetpub\vhosts\example.com\.plesk\statistics\example.com\webstat\awstats092019.example.com.txtC:\inetpub\vhosts\example.com\.plesk\statistics\example.com\webstat\awstats102019.example.com.txtC:\inetpub\vhosts\example.com\.plesk\statistics\example.com\webstat\awstats112019.example.com.txt
If this step is forgotten, AWStats will ignore all log files as if they only contained old records. Remove the DNS cache file:
C:\inetpub\vhosts\example.com\.plesk\statistics\example.com\webstat\dnscachelastupdate.example.com.txt Calculate the statistics:
C:\> ""%plesk_bin%""\statistics.exe --calculate-one --domain-name=example.com
Alternatively, launch the Plesk Daily Maintenance scheduled task using the Windows Schedule tasks snap-in. If the last step did not result in the statistics update, execute the below command:
C:\> ""%plesk_bin%""\statistics.exe --generate-domain-webstat --domain-name=example.com For cases when u_extend**.log contains full statistics information, but web***.log does not:
- Check particular date when statistics stopped being updated in web***.log file.
- Locate the same date in u_extend**.log file and analyze it's content. If there are some not well-formatted lines, edit them so that they look like the others, for example:
CONFIG_TEXT: #Software: Microsoft Internet Information Services 8.0 #Version: 1.0 #Date: 2015-05-22 00:28:14
The first line is wrongly configured. It should be:
CONFIG_TEXT: #Software: Microsoft Internet Information Services 8.0 #Version: 1.0 #Date: 2015-05-22 00:28:14 "
2,"[FIXED BUG] Unable to remove IP address from Plesk: Cannot remove the IP address because it is the last IP address present on a network interface
Applicable to: Plesk for Linux
Plesk for Windows Symptoms Unable to remove an either IPv4 or IPv6 address from Tools & Settings > IP Addresses with error:
PLESK_ERROR: Cannot remove the IP address 2001:db8:f61:a1ff:0:0:0:80 because it is the last IP address present on a network interface.
OR
PLESK_ERROR: Cannot remove IP, used by DNS template No websites are assigned on the IP address from the error. Cause Product issue: #PPPM-3818 ""Removing an IPv6 IP address registered in Plesk no longer fails with the “Cannot remove the IP address” error.""
Fixed in: Plesk Obsidian 18 February 2020 Resolution
Please consider updating your server: How to install Plesk updates Workaround
Use one of the following workarounds:
Workaround A. Hide the IP address from Plesk UI (click to expand the solution listing) Log into Plesk. Make sure that there is no subscriptions or reseller accounts assigned to this IP address in Plesk > Tools & Settings > IP Addresses (both Resellers and Sites values should be 0). Connect to the server via SSH or RDP. Open /usr/local/psa/admin/conf/panel.ini on Linux or %plesk_dir%\admin\conf\panel.ini on Windows and add the following line:
CONFIG_TEXT: [ip]blacklist=""IP_addresses_to_be_hidden"" Open Tools & Settings > IP Addresses and click Reread IP button: Note: Hiding an IP address already assigned to one or more subscriptions will result in the The IP address is already used for hosting error. The IP address will be marked as blacklisted in Tools & Settings > IP Addresses , but will be available in the Plesk interface. Workaround B. Remove the IP from network interface by means of an operating system (click to expand the solution listing) Log into Plesk and make sure that there is no subscriptions or reseller accounts assigned to this IP address in Plesk > Tools & Settings > IP Addresses (both Resellers and Sites values should be 0). Remove IP address manually from network interface by means of the operating system installed on the server.
Note: Before removing an IP address double check that there is no websites assigned to this IP address in Plesk. If IP address is not in use, in Plesk > Tools & Settings > IP Addresses values ""Resellers"" and ""Sites"" of this IP address will be ""0"". Open Plesk > Tools & Settings > IP Addresses and click Reread IP button: Select IP address that needs to be removed (it will be marked as broken ) and click Remove button: "
0,"How to track file changes on a Plesk for Linux server
Applicable to: Plesk for Linux Question
Files get modified/deleted from the server for some reason.
How to track file changes on a Plesk for Linux servers?
Answer
There is no such functionality in Plesk.
If you would like to see this feature in Plesk, please vote for it on Plesk UserVoice: Plesk UserVoice: Plugin to view who is the latest in modify files To track who or what modifies/deletes files on the system, use the OS ""audit"" utility.
For more information about this utility and its configuration, see: Red Hat Customer Portal: Chapter 6. System Auditing
Ubuntu Manpage: auditd - The Linux Audit daemon
"
0,"What is the difference between Domain disk space and Hard disk quota?
Applicable to: Plesk for Linux
Plesk for Windows Question
What is the difference between Domain disk space and Hard disk quota?
Answer Domain disk space Domain disk space indicates how much disk space is used by the entire domain. It is calculated by the Plesk statistics utility and includes the amount of disk space taken up by webpages, mail accounts, databases, and other domain data.
It is possible to select object types that Panel will consider when calculating disk space usage on Tools & Settings > Server Settings.
The Disk Space is configured under Plesk > Service Plan > service_plan_name > Resources. Hard disk quota Hard disk quota is a file system feature that limits how much disk space can be taken up by files that are owned by a specific system account (either a domain FTP user or a webuser). This file system quota cannot be exceeded, and if the limit is reached, the system user will not be able to create files anymore and the error ""no more space left on device"" will appear.
Note: (Linux hosting) Confirm that the operating system supports hard disk quota before setting any value other than Unlimited. In case of definition a hard quota when it is not supported, a synchronization conflict occurs on all the plan's subscriptions.
Hard quotas may be adjusted using the following steps: Log into Plesk. Allow permission Hard disk quota assignment in Service Plans > select a plan > Permissions. Go to Subscriptions > select a subscription > Websites & Domains -> Web Hosting Access type the desired value in megabytes into the Hard disk quota box. Additional information
How disk usage is calculated by Plesk
About Disk Space Usage Calculation"
0,"After installing certificate in Plesk message appears: SSL CA is not correct. Intermediate certificate missing
Applicable to: Plesk for Linux
Plesk for Windows Symptoms Online SSL checker (such as thawte CryptoReport, Qualsys SSL Labs, SSL Shopper) shows an error like:
CONFIG_TEXT: Intermediate certificate missing CONFIG_TEXT: The certificate is not trusted in all web browsers. You may need to install an Intermediate/chain certificate to link it to a trusted root certificate. CONFIG_TEXT: This server's certificate chain is incomplete A browser can show:
CONFIG_TEXT: Your connection is not private NET::ERR_CERT_AUTHORITY_INVALID Browser is rejecting certificates based on the intermediate one When trying to log in via an e-mail client, one of the following errors is shown:
CONFIG_TEXT: The server you are connected to is using a security certificate that cannot be verified. The target principal name is incorrect. CONFIG_TEXT: Could not verify this certificate because the issuer is unknown Cause
The certificate consists of 3 parts: *.key file private key; *.crt - certificate itself; *-ca.crt - certificate of Certificate Authority. The error means Certificate Authority (ca.crt) part of a certificate is missing.
Resolution
*.key / *.crt / *-ca.crt parts of the certificate should be provided by your Certificate Authority.
Contact the certificate issuer and ask to provide CA part of the certificate: Comodo
IdenTrust
Symantec
GoDaddy
GlobalSign Rename the existing certificate under Plesk > Domains > example.com > SSL/TLS Certificates > certificate _name > Rename.
Then, install the certificate again. All three parts should be uploaded/filled for the certificate: Additional information
How to install SSL certificate for a domain in Plesk
How to generate certificate signing request (CSR) for a domain in Plesk "
8,"[Troubleshooting] Mail users on Plesk server are unable to receive or send messages: 454 4.7.1 Relay access denied
Applicable to: Plesk for Linux Symptoms Unable to send or receive email messages on Plesk server. The following error appears in log file /usr/local/psa/var/log/maillog:
CONFIG_TEXT: NOQUEUE: reject: RCPT from unknown[203.0.113.2]: 454 4.7.1 <mail@example.com>: Relay access denied; /usr/lib64/plesk-9.0/psa-pc-remote[9425]: Message aborted. /usr/lib64/plesk-9.0/psa-pc-remote[9425]: Message aborted. The following error is shown in Horde webmail interface when trying to send an email:
PLESK_INFO: There was an error sending your message: Could not open secure TLS connection to the server Cause
Mail relay is disabled server-wide / mail service is disabled for specific subscription / the subscription is disabled in Plesk UI.
Resolution Log in to Plesk GUI Check if mail relay is enabled at Plesk > Tools & Settings > Mail Server Settings > Relay options and enable it if it is disabled: Make sure that affected subscription is enabled at Plesk > Subscriptions > example.com: Make sure that mail service is enabled for the affected subscription at Plesk > Subscriptions > example.com > Mail > Change Settings > Activate mail service on this domain: "
8,"MailEnable mail stuck in outgoing queue: Could not resolve MX list for domain
Applicable to: Plesk Onyx for Windows
Plesk for Windows Symptoms Mail could not be delivered to remote server from Plesk, it is stuck in the outgoing queue. %plesk_dir%\Mail Servers\Mail Enable\LOGGING\SMTP\SMTP-Debug-<datetime>.log file contains the following errors:
CONFIG_TEXT: ME-E0124: Error (1460): Could not resolve MX list for domain [example.com] CONFIG_TEXT: ME-E0042: - SMTP Connection DNS Server could not resolve domain name (example.com) in a timely fashion. Check DNS Server settings. CONFIG_TEXT: ME-E0042: [71F2BE266CCF446CA0B9225A0DD2D496.MAI] - SMTP Connection DNS Server could not resolve domain name (example.com) in a timely fashion. Check DNS Server settings. ME-E0059: [71F2BE266CCF446CA0B9225A0DD2D496.MAI] Message Delivery Failure. Attempt (0): Could not connect to mail server for domain (example.com). The remote mail server could not be contacted at this time. Message has been requeued. The recipient's domain name example.com can be resolved externally. For instance:
C:\> nslookup example.com Address: 203.0.113.2
and its MX record can be verified as described in this article. Cause
DNS server configured in MailEnable could not resolve recipient domain IP address.
Resolution Connect to the server via RDP. Go to MailEnable console > Servers > localhost > Services and Connectors > SMTP > Properties > General tab. Configure DNS servers IP addresses. For example, Google DNS servers IP could be added: 8.8.8.8 or 4.4.4.4: Note: SMTP server must be restarted to apply changes, if any (Servers > localhost > Services and Connectors > SMTP > Stop/Start). "
8," Unable to receive or send e-mails in Plesk hosted on AWS or LightSail: port 25 is blocked
Applicable to: Plesk for Linux Symptoms Unable to receive/send e-mails from Plesk hosted on Amazon Lightsail or AWS EC2 instance The following error can be found in /var/log/maillog when sending emails to an external domain:
CONFIG_TEXT: dsn=4.4.1, status=deferred (connect to alt2.gmail-smtp-in.l.google.com[142.250.4.26]:25: Connection timed out) Outgoing mail connections via 25 port are not possible:
# telnet mail.example2.com 25 Trying 203.0.113.2... telnet: connect to address 203.0.113.2: Connection timed out Trying 2001:db8:f61:a1ff:0:0:0:80... telnet: connect to address 2001:db8:f61:a1ff:0:0:0:80 Network is unreachable. It is possible to send out an email message locally using the command:
# telnet localhost 25 Notifications are received in regards to this port:
CONFIG_TEXT: You cannot send emails from Plesk because outbound connections on TCP port 25 is blocked. Check the firewall settings or contact your hosting provider. Cause
SMTP ports are blocked by a firewall from Amazon side or on the server.
Resolution For AWS instance, submit a request to AWS support to have port 25 unblocked in accordance with Amazon documentation or setup mail relay as shown in our free Udemy course.
Warning: If you have Amazon Lightsale please explicitly mention in the link above that you need to remove the port block for LightSale, otherwise AWS team will remove it for EC2 only. If the Plesk Firewall is used, open mail port under Plesk > Tools & Settings > Firewall; If the system or a third party firewall is active on the server, make sure that it is not blocking the connection to the 25,465,995 ports. In case of an intermediate firewall, it is required to contact the service provider. Additional information
Unable to send emails using Plesk local mail server: Connection timed out or connection refused. (#4.4.1) Which Ports Need To Be Opened for all Plesk Services to Work with a Firewall?"
2,"Unable to open domain file manager in Plesk: Full path is undefined
Applicable to: Plesk for Linux
Plesk for Windows Symptoms
One of the following errors is displayed when opening Domains > example.com > Hosting Settings or Domains > example.com > File Manager after Plesk upgrade:
PLESK_ERROR: Internal error: Full path is undefined. Message Full path is undefined. File Webspace.php Line 374 Type PleskFatalException
Or:
PLESK_ERROR: ERR (3) [panel]: PleskFatalException: Full path is undefined. file: C:\plesk\admin\plib\Webspace.php line: 374 code: 0
Or:
PLESK_ERROR: Error: New configuration files for the Apache web server were not created due to the errors in configuration templates: Template processing failed: file = /usr/local/psa/admin/conf/templates/default/domainVhost.php, error = Template_Exception: No data. file: /usr/local/psa/admin/plib/Template/Processor.php line: 28 code: 0 Previous error: Template_Variable_Exception: No data. file: /usr/local/psa/admin/plib/Template/Variable/AbstractCachedData.php line: 67 code: 0. Search in KB
Cause
Entries from the hosting table were removed due to the Plesk upgrade failure.
Resolution For Linux Connect to the server via SSH Create Plesk database backup. Restore hosting table from pre-upgrade dump.
Note: the dump is located at /var/lib/psa/dumps/*preupgrade*.
# gunzip /var/lib/psa/dumps/mysql.preupgrade.<version and time stamp>.dump.gz # sed -n -e '/DROP TABLE.*`hosting`/,/UNLOCK TABLES/p' /var/lib/psa/dumps/mysql.preupgrade.<version and time stamp>.dump > hosting.sql # MYSQL_PWD=cat /etc/psa/.psa.shadow mysql -u admin psa < hosting.sql For Windows Note: the dump is located in %plesk_dir%\\mysql\\backup or (in case if the database provider was different fom MySQL) at%plesk_dir%\\admin\\db\ folder. Connect to the server via RDP Create Plesk database backup. On Windows the corresponding entries should be extracted manually using Notepad/Notepad++ utility and saved in a separate file, e.g. C:\\hosting.sql. Then use the saved file to restore the table:
Plesk Onyx: Open CMD and run the following command:
C:\> plesk db < hosting.sql For Plesk 12.5 and previous releases: Open CMD and run the following command:
C:\> ""%plesk_dir%\Mysql\bin\mysql.exe"" -uadmin -p<plesk_admin_password> -P8306 psa < C:\hosting.sql
Note: replace <plesk_admin_password> with the current MySQL password "
3,"Apache restarts frequently on a Plesk server: Caught SIGTERM, shutting down
Applicable to:
Plesk Onyx for Linux
Symptoms Apache log file ( CentOS based: /var/log/httpd/error_log or Ubuntu based: /var/log/apache2/error.log) might show one of the following messages:
CONFIG_TEXT: [notice] caught SIGTERM, shutting down CONFIG_TEXT: [mpm_event:notice] [pid 665:tid 140662910175360] AH00492: caught SIGWINCH, shutting down gracefully CONFIG_TEXT: [mpm_prefork:notice] [pid 12450] AH00169: caught SIGTERM, shutting down CONFIG_TEXT: [error] 34053#0: *190501 upstream prematurely closed connection while reading response header from upstream, client: 203.0.113.101, server: example.com, request: ""POST /wp-admin/admin-ajax.php HTTP/2.0"", upstream: ""https://203.0.113.2:7081/wp-admin/admin-ajax.php"", host: ""example.com"", referrer: ""https://example.com/"" System journal for Apache service contains multiple messages about Apache restart:
CONFIG_TEXT: Nov 27 08:13:00 servername systemd[1]: Stopping The Apache HTTP Server... Nov 27 08:13:03 servername systemd[1]: Stopped The Apache HTTP Server. Nov 27 08:13:03 servername systemd[1]: Starting The Apache HTTP Server... Nov 27 08:13:05 servername systemd[1]: Started The Apache HTTP Server. Nov 27 08:13:54 servername systemd[1]: Stopping The Apache HTTP Server... Nov 27 08:13:57 servername systemd[1]: Stopped The Apache HTTP Server. Nov 27 08:13:58 servername systemd[1]: Starting The Apache HTTP Server... Nov 27 08:13:59 servername systemd[1]: Started The Apache HTTP Server. Domains are unavailable with 503 error after issuing an SSL certificate or deleting a domain/subdomain Cause
Plesk restarts Apache service to apply the new configuration when: a domain is created/removed, an SSL certificate has been issued/assigned, PHP Settings or Hosting settings for a domain have been changed.
Resolution
To avoid frequent Apache restarts, consider one of the following options: Upgrade to Plesk Obsidian: By default, Apache service in Plesk Obsidian is reloaded instead to be restarted to avoid such downtimes In Plesk Onyx, configure graceful restart for Apache In Plesk Onyx, increase Apache restart interval by going to Tools & Settings > Apache Web Server > Set the Apache restart interval value to ""300"" or more (value in seconds): "
6,"[Troubleshooting] Unable to add/update/export MS SQL database server or create database on Plesk: Test connection to the database server has failed because of network problems
Applicable to: Plesk for Windows Symptoms Unable to change properties of MS SQL database server or create database in Plesk due to the following error:
PLESK_ERROR: Error: The test connection to the database server has failed because of network problems: Get database server version failed: mssqlmng failed: [DBNETLIB][ConnectionOpen (ParseConnectParams()).]Invalid connection. at (VADOConnection::open line 48) at Unable to ADO conect with connection string: Provider=SQLOLEDB.1;Initial Catalog=master;Data Source=,\localhost(VADODatabaseProvider::connect line 182) at execute console command --get-server-version(vconsoleapp::start line 100) at execute ""C:\Program Files (x86)\Parallels\Plesk\admin\bin\mssqlmng.exe"" --get-server-version ""--server=,\localhost"" ""--login=sa"" ""--password=*""(vconsoleapp::run line 117) (Error code 1) Additionally, it is not possible to create a backup or migrate databases due to the same error. OR Unable to add or update an MS SQL database server in Plesk, it fails with one of the errors below:
PLESK_ERROR: Error: The test connection to the database server has failed because of network problems: Try to establish connection failed
OR
PLESK_ERROR: Get database server version failed: [DBNETLIB][ConnectionOpen (Connect()).]SQL Server does not exist or access denied. (Error code 1) It's not possible to export, import or to manage an MS SQL database, the following message is shown:
CONFIG_TEXT: The server is unavailable. The following error might be shown in the %plesk_dir%\admin\php_error.log file: CONFIG_TEXT: ERR [panel] ""C:\Program Files (x86)\Parallels\Plesk\admin\bin\mssqlmng"" --check ""--server=.\MSSQLSERVER2012"" ""--login=sa"" ""--password=******"" failed with code 1. stdout: Login failed for user 'sa'. at (VADOConnection::open line 48) at Unable to ADO conect with connection string: Provider=SQLNCLI11;Initial Catalog=master;Data Source=.\MSSQLSERVER2012(VADODatabaseProvider::connect line 182) at execute console command --check(vconsoleapp::start line 93) at execute ""C:\Program Files (x86)\Parallels\Plesk\admin\bin\mssqlmng"" --check ""--server=.\MSSQLSERVER2012"" ""--login=sa"" ""--password=*""(vconsoleapp::run line 110) stderr: The following message can be found in Start > Event Viewer > Applications and Services Logs > Plesk:
CONFIG_TEXT: [DBNETLIB][ConnectionOpen (Connect()).]SQL Server does not exist or access denied. at (VADOConnection::open line 62) at Unable to ADO conect with connection string: Provider=SQLOLEDB.1;Initial Catalog=master;Data Source=203.0.113.2\SQL2008(VADODatabaseProvider::connect line 181) at execute console command --check(vconsoleapp::start line 132) at execute ""C:\Program Files (x86)\Parallels\Plesk/admin/bin/mssqlmng"" --check ""--server=203.0.113.2\SQL2008"" ""--login=sa"" ""--password=*""(vconsoleapp::run line 143) Execute file name: C:\Program Files (x86)\Parallels\Plesk\admin\bin\mssqlmng.exe Cause
There are several possible causes: Connection issue. Incorrect login/password credentials. The disabled login. Resolution Connect to the server via RDP. Go to Start > Services and make sure that the SQL Server (MSSQLSERVERXXXX) and SQL Server browser services are running on the server and start them if they are stopped.
Note: The SQL Server (MSSQLSERVERXXXX) can take one of the following values depending on which MSSQL server the issue occurs: SQL Server (MSSQLSERVER) SQL Server (MSSQLSERVER2012) SQL Server (MSSQLSERVER2014) SQL Server (MSSQLSERVER2016) Ensure that the SQL Server and Windows Authentication mode and login for the user (usually it is the ""sa"" user) are enabled. Make sure that you can log in to MS SQL server, e.g. via SQL Server Management Studio, with the same username (usually it is the ""sa"" user) and password that was specified in Plesk > Tools & Settings > Database Servers > MS SQL server.
In case the password is incorrect, update it by following this article:
How to change a password for the `sa` user in MS SQL?. Make sure that you can log in to MS SQL server, e.g. via SQL Server Management Studio with the ""hostname\instance"" name mentioned in the Plesk > Tools and Settings > Database Servers > MS SQL server. Open the port for MS SQL instance in the server firewall (by default it is 1433) and make sure it is listening on it:
Note: if another port was specified during the MSSQL server configuration, change the ""1433"" port to this one in the command below.
C:\>netstat -anb | findstr 1433 TCP [::]:1433 [::]:0 LISTENING Run the following query to check if shared memory protocol is being used:
MYSQL_WIN: SELECT SERVERPROPERTY('ComputerNamePhysicalNetBIOS') AS ServerName, @@SERVERNAME AS FullInstanceName, @@SERVICENAME AS InstanceName, local_net_address AS InstanceIPAddress, local_tcp_port AS InstancePort FROM sys.dm_exec_connections WHERE session_id = @@spid ServerName example FullInstance Name example InstanceName MSSQLSERVER InstanceIPAddress NULL InstancePort NULL
If port and IP address values are NULL disable shared memory Make sure that the Named Pipes connection method is enabled in the SQL Server Configuration Manager > SQL Server Network Configuration > Protocols for MSSQLSERVERXXXX.
Note: The Protocols for MSSQLSERVERXXXX can take one of the following values depending on which MSSQL server the issue occurs: Protocols for MSSQLSERVER Protocols for MSSQLSERVER2012 Protocols for MSSQLSERVER2014 Protocols for MSSQLSERVER2016
If it disabled, enable it by performing the following actions: Double-click the Named Pipes directive of the corresponding MSSQL server. Switch the Enabled option to the Yes value and pressing the OK button: Go to Start > Services, right-click the SQL Server (MSSQLSERVERXXXX) and press the Restart button to apply made changes. Additional information
Configure a Server to Listen on a Specific TCP Port (SQL Server Configuration Manager)
Unable to connect to MSSQL database server from Plesk: Unable to load communication module. Driver has not been correctly installed"
0,"How to update PHP version for all domains on Plesk for Windows
Applicable to: Plesk 12.5 for Windows
Plesk Onyx for Windows Question
How to update PHP version for all domains on Plesk for Windows?
Answer Connect to a Plesk server via RDP. Start a command prompt as an Administrator. Get the list of all domains with hosting:
C:\> plesk db -Ne ""select name from domains where htype='vrt_hst'"" > C:\domains.txt Get the list of all available PHP handlers:
C:\> plesk bin php_handler --list Now use the command below. Replace <required_php_handler> with an <id> of required PHP handler from step 4:
C:\> for /f ""tokens=*"" %d in ('type C:\domains.txt') do plesk bin domain -u %d -php_handler_id <required_php_handler> If it is required to switch PHP for all domains that use a particular PHP version (e.g. fastcgi-5.6), use the commands below: Get the list of all domains that use a particular PHP version (e.g. 5.6 FastCGI application):
C:\> plesk db -sNe ""select name from hosting hos,domains dom where dom.id = hos.dom_id and php = 'true' AND php_handler_id LIKE 'fastcgi-5.6'"" > c:\domains.txt Switch these domains to a new PHP handler (e.g. PHP 7.1 FastCGI application):
C:\> for /f ""tokens=*"" %d in ('type C:\domains.txt') do plesk bin domain -u %d -php_handler_id fastcgi-7.1 Additional Information
How to update PHP version for all domains on Plesk for Linux?"
0,"Unable to connect to a server via FTP with ProFTPd installed from Atomicorp repository: Fatal: ScoreboardFile: : unable to use '/var/run/proftpd/scoreboard': No such file or directory
Applicable to: Plesk for Linux Symptoms ProFTPD package is installed from the Atomicorp repository:
# rpm -qa | grep proftpd psa-proftpd-xinetd-1.3.6-11.el7.art.x86_64 psa-proftpd-1.3.6-11.el7.art.x86_64 # rpm -qi psa-proftpd-xinetd-1.3.6-11.el7.art.x86_64 | grep Vendor Vendor : Atomicorp Connection to a server via FTP fails with on of the following error messages:
CONFIG_TEXT: 421 Service not available, remote server has closed connection
OR
CONFIG_TEXT: Status: Connecting to 203.0.113.2:21... Status: Connection established, waiting for welcome message... Error: Could not connect to server The following error appears in the system logfile (/var/log/messages for CentOS/RHEL, /var/log/syslog for Debian/Ubuntu):
CONFIG_TEXT: proftpd[11783]: Fatal: ScoreboardFile: : unable to use '/var/run/proftpd/scoreboard': No such file or directory on line 45 of '/etc/proftpd.conf' xinetd[2312]: EXIT: ftp status=1 pid=11783 duration=0(sec)
OR
CONFIG_TEXT: error: cannot read configuration path '/etc/proftpd.d': Not a directory fatal: Include: error including '/etc/proftpd.d/*.conf': Invalid argument on line 95 of '/etc/proftpd.conf' The directory /var/run/proftpd/ is missing:
# ls -l /var/run/proftpd/ ls: cannot access /var/run/proftpd/: No such file or directory The following error appears when setting up Remote FTP Storage:
PLESK_ERROR: Error: Unable to access the storage: Transport error: unable to list directory: Curl error: (56) Failure when receiving data from the peer: Last FTP request: Last FTP response: Make sure you have entered the correct storage settings. You can check them independently with the command: curl -v --ftp-pasv --ssl -k -u jdoe 'ftp://203.0.113.2/./' Cause
Atomic ProFTPD incorrectly replaces ProFTPD package provided by Plesk.
Resolution
Apply one on the following solutions: Modify the configuration to use the proper file Connect to the server via SSH Change the scoreboard file location to the correct one:
# sed -i 's/ScoreboardFile.*/ScoreboardFile \/var\/run\/proftpd.scoreboard/' /etc/proftpd.conf Add systemd-tmpfiles configuration to create /var/run/proftpd directory Connect to the server via SSH Create the required directory manually:
# mkdir /var/run/proftpd/ Create the /usr/lib/tmpfiles.d/proftpd.conf file to ensure the directory is created on reboot:
# echo 'd /var/run/proftpd 0775 root root -' >> /usr/lib/tmpfiles.d/proftpd.conf "
0,"How to set CAS trust level in Plesk?
Applicable to: Plesk Onyx for Windows Question
How to set CAS trust level in Plesk?
Answer
Server-wide Log into Plesk. Go to Tools & Settings > ASP.NET Settings > Code Access Security.
From the drop-down menu CAS trust level select the required level.
Press the OK button to apply the changes. For particular domain Log into Plesk.
Go to Domains > example.com > ASP.NET Settings > Code access security.
From the drop-down menu CAS trust level select the required level.
Press the OK button to apply the changes. Solution using the RDP access Log into the server via RDP. Open a command prompt as Administrator.
Execute the command below to set CAS trust level: Server-wide
C:\> ""%plesk_bin%""\\aspnetcfg.exe --machine --trust-level=Medium For particular domain
C:\>""%plesk_bin%""\\aspnetcfg.exe --domain-name=example.com --trust-level=Minimal Note: the trust level can be Full, High, Medium, Low and Minimal. "
6,"[BUG] Unable to access PHPMyAdmin: Access denied for user 'pma_xxxxxxx'
Applicable to: Plesk Onyx for Linux
Plesk Obsidian for Linux Symptoms
When opening phpMyAdmin via Plesk, the following error appears:
PLESK_INFO: #1045 - Access denied for user 'pma_xxxxxxx'@'localhost' (using password: YES)
OR
PLESK_INFO: Cannot connect: invalid settings. Connection for controluser as defined in your configuration failed.
OR
PLESK_INFO: The phpMyAdmin configuration storage is not completely configured, some extended features have been deactivated. Find out why. Or alternately go to 'Operations' tab of any database to set it up there.
OR
PLESK_INFO: #1142 - SELECT command denied to user 'plesktest'@'localhost' for table 'pma_recent'<b/p>
OR
phpMyAdmin login screen is opened without errors, but with empty credential fields. No auto-login is performed.
Cause
Mismatch between user login credentials stored in the phpMyAdmin configuration and the database.
This is a Plesk bug with ID PPPM-11253, which will be fixed in future product updates.
Resolution
Apply one of the following workarounds: Clear cookies in your web-browser.
OR Remove phpMyAdmin session files: Connect to the Plesk server via SSH. Clean the phpMyAdmin session directory:
# rm -rf /usr/local/psa/var/phpMyAdmin/session/* If the phpMyAdmin session directory has been customized, run the command below to find the actual directory:
# egrep ""'SessionSavePath'"" /usr/local/psa/admin/htdocs/domains/databases/phpMyAdmin/libraries/config.default.php If neither of the workarounds above help, reinstall phpMyAdmin (users' data will not be affected): Remove the phpMyAdmin package: on CentOS/RHEL-based distributions
# rpm -e --nodeps psa-phpmyadmin on Debian/Ubuntu-based distributions
# dpkg -r --force-depends ""psa-phpmyadmin"" Run the Plesk Installer update command to install phpMyAdmin:
# plesk installer update --repatch "
8,"Unable to save settings in Plesk Horde webmail: There was an error activating the script. The driver said: Failed to establish TLS connection
Applicable to: Plesk Onyx for Linux Symptoms Unable to change settings such as Filters, blacklists, whitelists in Horde webmail, it fails with the following errors: In Horde webmail:
CONFIG_TEXT: Script not updated: There was an error activating the script. The driver said: Failed to establish TLS connection In /var/log/maillog:
CONFIG_TEXT: dovecot: managesieve-login: Disconnected (no auth attempts in 0 secs): user=<>, rip=127.0.0.1, lip=127.0.0.1, TLS handshaking: SSL_accept() failed: error:14094418:SSL routines:SSL3_READ_BYTES:tlsv1 alert unknown ca: SSL alert number 48, session=<fS90ehgtnAB/AAAB> Dovecot server is selected at Plesk > Tools & Settings > Mail Server Settings > IMAP/POP3 server. Cause
A self-Signed SSL certificate is used along with PHP 5.6 to run the Horde webmail.
Resolution
As a workaround, disable TLS encryption for sieve in the Horde configuration file: Log in to the Plesk server via SSH. Open the file /usr/share/psa-horde/ingo/config/backends.php in a text editor. Find the section $backends['sieve'] = array( Change the record:
CONFIG_TEXT: 'usetls' => true
to
CONFIG_TEXT: 'usetls' => false Save the file with changes. Create the additional Dovecot configuration file to specify ""ssl=no"" inside the ""protocol sieve {}"" section:
# cat /etc/dovecot/conf.d/99-horde-sieve-tlsfix.conf protocol sieve { ssl = no } Restart Dovecot service:
# service dovecot restart "
3,"Nginx fails to start: 99: Cannot assign requested address Applicable to: Plesk for Linux Symptoms nginx fails to start with the following error:
CONFIG_TEXT: Cannot assign requested address There are some mismatches between IP set up on server and registered in Plesk. For example, the number of IPs registered in Plesk is higher then the actual number of IPs on the server: IP addresses in Plesk:
# plesk bin ipmanage -l...203.0.113.2... ...203.0.113.3...
IP addresses on the server:
# ip a <...> inet 203.0.113.2/32 A website may show ourdated/old SSL certificate. Cause
Unsynced IP address between Plesk and OS or IP address was removed/changed manually on the server directly.
Resolution
Sync IP addresses between Plesk and OS: Log into Plesk. Go to Plesk > Tools & Settings > IP Addresses and press Reread IP: Select the appeared IP addresses and click on the Repair button to fix them or click the Remove button if they are no longer required. Connect to the server via SSH; Re-enable nginx service:
# /usr/local/psa/admin/bin/nginxmng -d # /usr/local/psa/admin/bin/nginxmng -e "
2,"Unable to log in to Plesk or to upload files via Plesk File Manager: The file is too big Applicable to: Plesk for Linux Symptoms Unable to log in to Plesk: Plesk login page is returned in a browser without any errors or warnings. When uploading a file via Plesk File Manager, one of the following error messages appears:
PLESK_ERROR: The file ""picture.jpg"" is too big. Try to upload this file via FTP.
OR
PLESK_ERROR: No upload response Cannot upload files in applications, e.g WordPress, Joomla, etc:
PLESK_INFO: The uploaded file exceeds the upload_max_filesize directive in php.ini Extension update fails, e.g Joomla:
CONFIG_TEXT: An error has occurred uploading this file to the server. The maximum allowed size of PHP to upload files is too low: This is configured from the PHP directives 'upload_max_filesize' and 'post_max_size' (locatable and configurable in your file 'php.ini' or '.htaccess'). Unable to find the installation package In some cases, the following error messages might appear in /usr/local/psa/admin/logs/panel.log:
CONFIG_TEXT: PHP Warning: POST Content-Length of 90378782 bytes exceeds the limit of 67108864 bytes in Unknown on line 0 ERR (3) [panel]: Forgery protection token check failed. ERR (3) [panel]: Permission denied.#0 Cause
Low values of directives post_max_size and upload_max_filesize is specified either in Plesk php.ini or in the domain settings.
Resolution Connect to the Plesk server via SSH. On server-wide level - increase post_max_size and upload_max_filesize values.
Open the file /usr/local/psa/admin/conf/php.ini in a text editor and specify limits for post_max_size and upload_max_file size in bytes. The default value is 2147483647 (2GB):
# egrep 'post_max_size|upload_max_filesize' /usr/local/psa/admin/conf/php.ini post_max_size = 2147483647 upload_max_filesize = 2147483647 Restart ""psa"" service:
# service psa restart Log out from Plesk UI and log in again to apply changes. For specific domain - log into Plesk and open the tab Domains > exmaple.com > PHP Settings and adjust upload_max_filesize and post_max_size values: "
6,"How to manually back up or restore client MySQL database in Plesk for Windows
Applicable to: Plesk for Windows Question
How to manually back up or restore client MySQL database in Plesk for Windows?
Answer Connect to Plesk server via RDP; Open command prompt as Administrator
Back up client database:
C:\> ""%plesk_dir%""MySQL\bin\mysqldump -uadmin -p -P3306 client_base > client_base.dump
where: 3306 - port for MySQL server; client_base - database name; client_base.dump - name of database backup.
Note: MySQL admin password will be asked during the commands execution. In case it is not known, it can be safely changed at Tools & Settings > Database Servers > localhost (default for MySQL) on port 3306. Restore the database:
C:\> ""%plesk_dir%""MySQL\bin\mysql -uadmin -p -P3306 client_base < client_base.dump WARNING: just copying folder with database name from '%plesk_dir%Databases\MySQL\data\' directory is not correct way of backing up. "
5,"Remote MS SQL backup failed
Applicable to: Plesk Onyx for Windows Symptoms Backup of MS SQL database from remote MS SQL server cannot be made. Backup process fails with the error below:
CONFIG_TEXT: Error: dbbackup failed: Unable to backup database 'db_name'The backup device 'c:\db_backup\ est_parallels' can not be opened. Operating system error 3 (The system can not find the path specified.).BACKUP DATABASE is terminating abnormally. CONFIG_TEXT: Error: dbbackup failed: Unable to backup database 'db_name' Unable to open connection: A specified logon session does not exist. It may already have been terminated CONFIG_TEXT: Cannot dump database content 'db_name' of type 'mssql'Error: Login failed for user 'NT AUTHORITY\ANONYMOUS LOGON' The following errors are produced upon exporting MSSQL database at Plesk > Domains > example.com > Databases:
PLESK_ERROR: Unable to export a dump of exampledb: - Unable to backup database 'exampledb' - Access to the path '\\203.0.113.2\NetworkTempBackupFolder\exampledb' is denied (Error code 21) \ PLESK_ERROR: Unable to import the exampledb dump: The network name cannot be found. Unable to restore database 'exampledb' The network name cannot be found. (Error code 22) Cause
Database backup settings to access the remote MS SQL server are incorrect.
Resolution
Note: This article refers to the backup of the remote MS SQL servers registered in Plesk. Review the documentation page Configuring Backup Settings for Remote SQL Servers before proceeding.
Ensure that the following requirements are met in the ""Microsoft SQL Server database backup"" settings under Tools & Settings > Database Servers > remote MSSQL server: Temporary directory: local path to the temporary backup folder on the MS SQL server. Temporary network directory: UNC path to the temporary backup folder on the remote MS SQL server. Username: network login to remote MS SQL server. Temporary directory is shared and this location is specified in Temporary network directory User specified in Username has to be present on a remote server and have to have Modify permission to Temporary directory share folder, sub-folders and files as well as to network share. If local account of MS SQL Server is used, server name prefix should be specified, as follows: ""sqlservername\username"" Temporary directory: is accessible for user account that MS SQL server service using to log on. You may find this user account name under ""Log On"" tab in MS SQL server service properties in Windows services. Additional information
Configuring Backup Settings for Remote SQL Servers"
7,"Plesk error after upgrade: MySQL query failed: Unknown column 'external_id' in 'field list'
Applicable to:
Plesk for Linux
Symptoms
After a failed Plesk upgrade, one of the following errors might be shown in an attempt to access Subscriptions or Domains in Plesk:
PLESK_ERROR: Error: MySQL query failed: Unknown column 'id' in 'field list'
PLESK_ERROR: Error: MySQL query failed: Unknown column 'external_id' in 'field list'
Cause
The Plesk database wasn't upgraded successfully.
Resolution Connect to the server via SSH Back up PSA, APSC and MySQL databases:
# plesk db dump psa apsc mysql > /root/psa_apsc_mysql.backup-`date +%F-%s`.sql Modify /usr/local/psa/version and /usr/local/psa/core.version files to contain previous Plesk version. For example, if the server was upgraded from Plesk 11.5.30 to 12.5.30 on CentOS 6, the following commands should be executed:
# echo ""11.5.30 CentOS 6 00000000.00"" > /usr/local/psa/version # echo ""11.5.30 CentOS 6 00000000.00"" > /usr/local/psa/core.version Check where are located the database dumps performed by Plesk:
# grep DUMP_D /etc/psa/psa.conf | grep -v '#' DUMP_D /var/lib/psa/dumps Go to the directory where the pre-upgrade dumps are located (Step 4) and restore the PSA and APSC databases: Warning: Always check carefully at versions and timestamp of pre-upgrade dump files. It is important to restore correct pre-upgrade dumps. There might have been several failed attempts to upgrade and some dumps are containing half-upgraded database.
# cd /var/lib/psa/dumps # zcat mysql.preupgrade.11.5.30-12.5.30.20140723-022543.dump.gz | MYSQL_PWD=`cat /etc/psa/.psa.shadow` mysql -uadmin # zcat mysql.preupgrade.apsc.11.5.30-12.5.30.20140723-022544.dump.gz | MYSQL_PWD=`cat /etc/psa/.psa.shadow` mysql -uadmin Run Plesk Bootstrapper utility provided by the new Plesk version with the rerun option. For example, if the server was upgraded to 12.5.30, the following command should be executed:
# /usr/local/psa/bootstrapper/pp12.5.30-bootstrapper/bootstrapper.sh rerun "
0,"CVE-2015-4000 LOGJAM TLS DH vulnerability on Plesk server Applicable to: Plesk for Linux Plesk for Windows Situation
CVE-2015-4000 LOGJAM TLS DH vulnerability on Plesk server
Impact
The Logjam attack allows a man-in-the-middle attacker to downgrade vulnerable TLS connections to 512-bit export-grade cryptography. This allows the attacker to read and modify any data passed over the connection. Call to Action
Click on a section to expand Plesk for Linux Connect to server over SSH. Run the following command:
# plesk sbin sslmng -vvv --strong-dh --dhparams-size=2048
Note: To change the setting for a particular service, option --services=service_name should be used. Plesk for Windows Connect to server over RDP. Open the Group Policy Object Editor: type gpedit.msc in the Start > Run dialogue window: Expand Computer Configuration > Administrative Templates > Network > SSL Configuration Settings and open the SSL Cipher Suite Order setting: Set up a strong cipher suite order. See this list of Microsoft's supported ciphers and Mozilla's TLS configuration instructions: "
4,"Unable to update Joomla: Non-zero exit status returned by script
Applicable to: Plesk 12.5 for Linux Symptoms Unable to install Joomla update, the following error appears in Plesk:
PLESK_ERROR: Non-zero exit status returned by script The following error can be found in the /var/log/plesk/panel.log:
CONFIG_TEXT: Non-zero exit status returned by script. Output stream: 'PHP Fatal error: Uncaught JDatabaseExceptionExecuting: Table 'joomla_6.#__extensions' doesn't exist in /var/www/vhosts/example.com/httpdocs/libraries/joomla/database/driver/mysqli.php:661Stack trace:#0 /var/www/vhosts/example.com/httpdocs/libraries/joomla/database/driver.php(1691): JDatabaseDriverMysqli->execute()#1 /var/www/vhosts/example.com/httpdocs/libraries/joomla/database/driver/mysqli.php(441): JDatabaseDriver->loadObjectList()#2 /var/www/vhosts/example.com/httpdocs/libraries/src/Table/Table.php(245): JDatabaseDriverMysqli->getTableColumns('#__extensions', false)#3 /var/www/vhosts/example.com/httpdocs/libraries/src/Table/Table.php(164): Joomla\CMS\Table\Table->getFields()#4 /var/www/vhosts/example.com/httpdocs/libraries/joomla/table/extension.php(31): Joomla\CMS\Table\Table->__construct('#__extensions', Array, Object(JDatabaseDriverMysqli))#5 /var/www/vhosts/example.com/httpdocs/libraries/src/Table/Table.php(312): JTableExtension->__construct(Object(JDatabaseDriverMysqli))#6 /var/www/vhosts/example.com/httpdocs/libraries/src/Installer in /var/www/vhosts/example.com/httpdocs/libraries/joomla/database/driver/mysqli.php on line 661 Cause
Incorrect dbprefix defined in configuration.php
of the Joomla instance.
Resolution Log into Plesk; Check which dbprefix is currently in use for the website via Domains > example.com > Databases > click on Joomla database > PhpMyAdmin Go to Domains > example.com > File Manager > configuration.php, find the dbprefix line and change it to the prefix found in the previous step.
"
2,"Site preview doesn't work on Plesk server: Error 404 Not Found
Applicable to: Plesk for Windows Symptoms Unable to open Site Preview, it redirects to another URL with one of the following errors:
CONFIG_TEXT: HTTP Error 404.4 - Not Found The resource you are looking for does not have a handler associated with it. Error Code: 0x8007007b CONFIG_TEXT: HTTP Error 404.0 - Not Found The resource you are looking for has been removed, had its name changed, or is temporarily unavailable. Error Code: 0x80070002 When Default Quick Preview is set in Tools & Settings > Website Preview the following error is shown in Plesk UI:
PLESK_ERROR: ERR [panel] websrvmng failed: Site sitepreview doesn't exist at (WebServerMap::get line 189) at startHosting(sitepreview)(WebServerAdapter::startHosting line 772) at execute console command --start-vhost(vconsoleapp::start line 122) at execute ""C:\Program Files (x86)\Plesk\admin\bin64\websrvmng"" --start-vhost ""--vhostname=sitepreview""(vconsoleapp::run line 139) (Error code 1) Cause
Site preview misconfiguration.
Resolution Connect to the server via RDP. Open Windows Command Prompt (CMD) as Administrator. Reconfigure site preview using the following command:
C:\> ""%plesk_cli%\repair.exe"" --reconfigure-site-preview "
2,"Various actions fail in Plesk: Unable to find service node for ip address with id=XX
Applicable to: Plesk for Linux
Plesk for Windows Symptoms Cannot create subscription or domain in Plesk::
PLESK_ERROR: Error: Unable to find service node for ip address with id=2
PLESK_ERROR: Error: Failed domain creation: Unable to update domain data: IP address with ID '2' does not exist
PLESK_ERROR: ERR [panel] Unable to load object of type BsDomain with id=XX: Domain does not exist. Cannot manage Domains > example.com > Web Hosting Access settings:
PLESK_ERROR: Error: Unable to find service node for ip address with id=2 Cannot select ""Send from domain IP addresses and use domain names in SMTP greeting"" in Mail Server Settings:
PLESK_ERROR: Error: PleskException IP address with ID '2' does not exist Cause
Database inconsistency: the IP_Addresses table has a record(s) with an IP address that does not exist in the ip_pool and dom_param tables.
Resolution
Note: below steps require advanced technical expertise. Consider contacting Plesk Technical support if you find them too complex. Log in to Plesk via SSH or RDP Create Plesk database backup Identify the problematic IP address:
# plesk db ""select * from ip_pool where ip_address_id not in (select id from IP_Addresses);"" +----+---------------+--------+ | id | ip_address_id | type | +----+---------------+--------+ | 1 | 2 | shared | +----+---------------+--------+ 1 row in set (0.00 sec)
# plesk db ""select * from dom_param where param='ip_addr_id' and val not in (select id from IP_Addresses);""+--------+------------+------+ | dom_id | param | val | +--------+------------+------+ | 6 | ip_addr_id | 2 | +--------+------------+------+ 1 row in set (0.00 sec)
# plesk db ""select * from IP_Addresses where id =2;"" Empty set (0.00 sec)
# plesk db ""select id, serviceNodeId, ip_address from IP_Addresses;"" +----+---------------+--------------+ | id | serviceNodeId | ip_address | +----+---------------+--------------+ | 1 | 1 | x.x.x.x | +----+---------------+--------------+ 1 rows in set (0.00 sec)
In this example, the ip_pool and dom_param tables include an entry regarding a non-existent IP address ( ip_address_id = 2 ); Delete this record from the ip_pool table:
# plesk db ""delete from ip_pool where ip_address_id not in (select id from IP_Addresses);"" Query OK, 1 row affected (0.00 sec) If non-empty output was received during dom_param table check on the step 3, contact Plesk Technical support. "
7,"Plesk pre-upgrade checker shows warning: There are custom web server configuration templates
Applicable to: Plesk Obsidian for Linux
Plesk Onyx for Linux Symptoms
Plesk pre-upgrade checker shows a warning:
CONFIG_TEXT: [INFO] STEP 28: Checking for custom web server configuration templates... [WARNING] There are custom web server configuration templates at /usr/local/psa/admin/conf/templates/custom. These custom templates might be incompatible with a new Plesk version, and this might lead to failure to generate web server configuration files. Please check https://support.plesk.com/hc/en-us/articles/213399669 for details. [INFO] Result: WARNING
Or
CONFIG_TEXT: Custom web server templates that may break web server reconfiguration were moved from /usr/local/psa/admin/conf/templates/custom/ to /usr/local/psa/admin/conf/templates/custom_templates_before_17.0_aBoiafPf/
Cause
There are custom templates stored in /usr/local/psa/admin/conf/templates/custom/ directory
Resolution
Depending on the changes that were made in custom templates, an upgrade can be performed safely, or not.
It is recommended to rename /usr/local/psa/admin/conf/templates/custom/ directory and perform the upgrade. Note: During the upgrade to Plesk Onyx custom templates directory is renamed automatically, however, it does not happen when upgrading to Obsidian as the directory is kept Connect to the server over SSH. Review updated default templates in /usr/local/psa/admin/conf/templates/default, make appropriate changes to custom templates in renamed directory. Rename direcory of custom templates:
# mv /usr/local/psa/admin/conf/templates/custom_templates_before_17.0_xxxxxx/ /usr/local/psa/admin/conf/templates/custom/ More information about custom templates can be found in Plesk documentation: For Plesk Obsidian
For Plesk Onyx
For Plesk 12.5 Additional information
To run pre-upgrade checker, download the script from http://autoinstall.plesk.com/<Plesk_version>/examiners/panel_preupgrade_checker.php where is the version of upgraded Plesk.
For example, to check upgrade to Plesk Onyx 17.8.11, the link would be:
# wget http://autoinstall.plesk.com/PSA_17.8.11/examiners/panel_preupgrade_checker.php
Run the script:
# php -d safe_mode=Off panel_preupgrade_checker.php"
0,"How to apply new PHP handler to multiple domains via CLI? Applicable to: Plesk for Linux Question
How to change PHP handler for multiple domains or for certain domains only via CLI?
Answer
Note: webserver configuration will be reloaded every time when the handler is updated. Connect to the server via SSH. Get a list of registered PHP handlers on a Plesk server by execution of the following command:
# plesk bin php_handler --list Get the list of all domains:
# plesk bin domain --list > /root/domains.txt Edit the domains.txt file if some domains should not be changed and execute the command below to change PHP handler for all domains mentioned in the domains.txt file:
Note: change the plesk-php56-fastcgi directive to the required handler (use handler id from step 2) and specify the nginx-serve-php value (it cannot be set to true when any FastCGI handler is used) in command below.
# cat /root/domains.txt | while read i; do plesk bin domain -u $i -php_handler_id plesk-php56-fastcgi -nginx-serve-php false; done If different handlers assigned to the bunch of domains should be replaced with the other appropriate handlers, e.g. all domains which are using PHP 5.6 FastCGI should be switched to PHP 5.6 FPM, perform the following actions: Download the script from article attachments:
# wget https://support.plesk.com/hc/en-us/article_attachments/360007552194/php_change.zip Unzip downloaded file:
# unzip php_change.zipArchive: php_change.zipinflating: php_change.pl Make the script executable:
# chmod +x php_change.pl Open the script via any text editor and navigate to the row 33:
CONFIG_TEXT: if ($handler =~ m/^plesk-php56-fastcgi$/g) {print ""Changing $name hander $handler...\n"";plesk bin domain -u $name -php_handler_id plesk-php56-fpm -nginx-serve-php false;}elsif($handler =~ m/^plesk-php70-fastcgi$/g) {print ""Changing $name hander $handler...\n"";plesk bin domain -u $name -php_handler_id plesk-php70-fpm -nginx-serve-php false;}
Here, the conditions tell which handlers to which one will be switched:
The first condition - all domains assign to the plesk-php56-fastcgi will be switched to the plesk-php56-fpm handler.
The second condition - all domains assign to the plesk-php70-fastcgi will be switched to the plesk-php70-fpm handler.
Specify the correct handlers using handlers' id from step 2 as also as the nginx-serve-php value (it cannot be set to true when any FastCGI handler is used). Run the script:
# ./php_change.pl "
3," Webserver Configurations Troubleshooter detects extra configuration or shows a false positive report on the Home page
Applicable to: Plesk for Linux Symptoms Apache and Nginx (if enabled) web-servers are running fine and their configuration is successful:
# apachectl -t Syntax OK # nginx -t nginx: the configuration file /etc/nginx/nginx.conf syntax is ok nginx: configuration file /etc/nginx/nginx.conf test is successful Webserver Configurations Troubleshooter shows any of the following messages: When checking configurations:
PLESK_INFO: In some cases, extra webserver configuration files remaining after removing domains might cause conflicts with webserver configuration rebuild process. PLESK_INFO: There is an extra configuration with id 6 belongs to the missed domain with id 1 When rebuilding configurations:
PLESK_ERROR: Error: Can not reconfigure web server configurations: Unable to execute httpdmng: Domain with name '' does not exist PLESK_ERROR: Error: New configuration files for the Apache web server were not created due to the errors in configuration templates: Can not restart web server One of the following messages might appear on Plesk Home:
PLESK_ERROR: Error: New configuration files for the Apache web server were not created due to the errors in configuration templates: ... PLESK_ERROR: WARNING! Some problems are found during start service apache2(see log file: /var/log/plesk/rc_actions.log) Continue... /opt/psa/admin/sbin/pleskrc execution failed: PLESK_ERROR: Due to the following errors in the configuration templates, no new configuration files could be created for the Apache webserver: Can not restart web server: graceful restart failed, perform full restart httpd stop failed 9 / usr / sbin / httpd processes are killed INFO: Service: Some problems are found during attempt to graceful service httpd - control script does not exist or is not executable (see log file: /var/log/plesk/rc_actions.log) PLESK_ERROR: nginx: [emerg] duplicate listen options for [2001:db8:f61:a1ff:0:0:0]:80 in /etc/nginx/plesk.conf.d/server.conf:189 nginx: configuration file /etc/nginx/nginx.conf test failed. PLESK_ERROR: AH00526: Syntax error on line 47 of /etc/httpd/conf/httpd.conf: KeepAlive must be On or Off PLESK_ERROR: Template processing failed: file = /usr/local/psa/admin/conf/templates/default/domainVhost.php, error = Template_Exception: No data. file: /usr/local/psa/admin/plib/Template/Processor.php line: 28 code: 0 Previous error: Template_Variable_Exception: No data. file: /usr/local/psa/admin/plib/Template/Variable/AbstractCachedData.php line: 67 code: 0 When opening Tools & Settings > Webserver Configurations Troubleshooter, it shows records with ""File Path: N/A"" and ""Related domain: Deleted"". The following command returns multiple orphan records (non-empty result):
# plesk db ""select description from Configurations where status <> 'ok'\G"" Plesk Administrator may receive an email notification containing one of the messages shown in this article Cause
The issue with web-server configuration has been previously fixed, but the Plesk database still contains records about non-existent configuration files or old error messages.
Resolution
Click on a section to expand Via Plesk Log in to Plesk. Go to Tools & Settings > Webserver Configurations Troubleshooter
Note: If the Webserver Configurations Troubleshooter option is not shown, install it following the instructions available in this KB article. Click the button > Set Status search filter to Error from the drop-down menu: The list of broken configuration files will appear. Select all, then click Rebuild > Selected. If configuration files could not be repaired, select them and click Remove. Click Check configuration to make sure there is no broken configuration left. Via SSH Connect to the server via SSH Back up the Plesk database:
# plesk db dump psa > /root/psa_dump.sql Remove broken configuration entries from the Plesk database:
# plesk db ""delete from Configurations where status <> 'ok'\G"" Validate configuration files:
# plesk repair web -validate-configuration If errors are found, fix them with the command:
# plesk repair web -y Additional Information
Plesk Webserver Configuration Troubleshooter"
3,"Websites running slow and Apache shows error: server reached MaxClients setting on Plesk for Linux
Applicable to: Plesk for Linux Symptoms
Loading the website takes too much time or finishes with ""504 Gateway Time-out"" error. The following error appears in the /var/log/httpd/error_log:
CONFIG_TEXT: [error] server reached MaxClients setting, consider raising the MaxClients setting [warn] mod_fcgid: process 2968 graceful kill fail, sending SIGKILL
Cause
The connections limit defined by MaxClients is reached.
Resolution Connect to the server via SSH. By default, Apache in Plesk is not configured for high-loaded sites. It is recommended to tune Apache performance as it described here: http://httpd.apache.org/docs/2.2/misc/perf-tuning.html or https://httpd.apache.org/docs/2.4/misc/perf-tuning.html To resolve the issue with the MaxClients limit, adjust the /etc/httpd/conf/httpd.conf(/etc/apache2/conf/apache2.conf for Debian 7/Ubuntu 12/14) file on SystemV OSes (CentOS 6 or lower), increasing the MaxClients value (e.g., to 100):
CONFIG_TEXT: <IfModule prefork.c> StartServers 5 MinSpareServers 10 MaxSpareServers 25 MaxClients 100 MaxRequestsPerChild 10000 </IfModule>
CONFIG_TEXT: <IfModule worker.c> StartServers 5 MinSpareThreads 10 MaxSpareThreads 25 ThreadsPerChild 50 MaxClients 100 MaxRequestsPerChild 10000 </IfModule> Note: For CentOS 7, file /etc/httpd/conf.d/mpm_prefork.conf should be edited instead of <IfModule prefork.c> section. If the error persists, consider increasing MaxClients limit again until the issue is fixed. For Debian 8 and 9/Ubuntu 16 and 18, use the following files /etc/apache2/mods-available/mpm_prefork.conf and /etc/apache2/mods-available/mpm_worker.conf
If the error is still shown, check all files where MaxClients directive defined. It can be done with the following command:
# grep -iRl ""MaxClients"" /etc/
If there is no such option at all, add it manually to files listed above. Additional Information
The MaxClients directive was the name for MaxRequestWorkers directive before version Apache 2.3.13:
CONFIG_TEXT: * MaxClients has been renamed to MaxRequestWorkers, which describes more accurately what it does. For async MPMs, like event, the maximum number of clients is not equivalent than the number of worker threads. The old name is still supported."
9,"Whois information is shown instead of DNS Settings
Applicable to: Plesk for Windows
Plesk for Linux Symptoms
DNS Settings are not present under website options, I have Whois Information button instead.
Cause
DNS server is not installed on Plesk or DNS Management is not granted.
Resolution
Install DNS Server service via Tools & Settings > Updates & Upgrades and grant DNS zone management permission for the subscription.
According to documentation :
Note: If your Panel does not use its own DNS service and does not allow configuring DNS settings on a remote DNS server, you can only view the information about your registered domain name. The link DNS Settings in Websites & Domains will be replaced with Whois Information."
3,"Website hosted in Plesk displayed incorrectly or shows 503 Internal Server Error or showing the PHP warning: Failed to read session data: files
Applicable to: Plesk for Linux Symptoms Website hosted in Plesk displayed incorrectly, showing HTTP ERROR 500 or return the following PHP warning:
CONFIG_TEXT: PHP Warning: Unknown: Failed to write session data (files). Please verify that the current setting of session.save_path is correct (/var/lib/php/sessions) in Unknown on line 0 The following errors are found in Apache /var/www/vhost/system/example.com/logs/error_log for the website:
CONFIG_TEXT: # mod_fcgid: stderr: PHP Warning: session_start(): open(/var/lib/php/sessions/sess_g0u8u3b1j8t98v0jpjmh0gmp84, O_RDWR) failed: No such file or directory (2) in /opt/www/vhost/example.com/httpdocs/wp-content/plugins/custom-sidebars/inc/external/wpmu-lib/inc/class-thelib.php on line 114, referer: http://example.com/ ... mod_fcgid: stderr: PHP Warning: Unknown: Failed to write session data (files). Please verify that the current setting of session.save_path is correct (/var/lib/php/sessions) in Unknown on line 0 CONFIG_TEXT: AH01071: Got error 'PHP message: PHP Warning: session_start(): open(/var/lib/php/session/sess_d3deadbeef8i0455babecafeuo, O_RDWR) failed: Permission denied (13) in /home/www-data/example.com/httpdocs/index.php on line 2\nPHP message: PHP Warning: session_start(): Failed to read session data: files (path: /var/lib/php/session) in /home/www-data/example.com/httpdocs/index.php on line 2 Cause
The permissions for PHP session directory are incorrect or directory does not exist.
Resolution Log in to Plesk and check the current session.save_path for domain in Domains > example.com > PHP Settings.
Note: On Ubuntu or Debian, if session.save_path is not set, then session files are saved in /var/lib/php7, on RHEL and CentOS systems, if session.save_path is not set, session files will be saved in /var/lib/php/session. Connect to the server via SSH and make sure the directory exists and have proper permissions (1733). If path is /var/lib/php/session:
# stat /var/lib/php/session | grep Access Access: (1733/drwx-wx-wt) Uid: ( 0/ root) Gid: ( 0/ root)
If directory does not exists create it and set valid permissions:
# mkdir -p /var/lib/php/session && chmod 1733 /var/lib/php/session
If directory exists but permissions are different, set the correct ones:
# chmod 1733 /var/lib/php/session "
0,"How to test connection speed between two Windows servers
Applicable to: Plesk for Windows Question
How to test connection speed between two Windows servers?
Answer
Connect to your Windows servers via RDP and follow these steps for each server: Download the latest version of the iPerf utility.
Note: The utility uses port 5201 for a connection. Make sure that port 5201 is opened in Windows firewall. Alternatively, disable firewall on both servers temporary. Put the content of the iPerf folder (files iperf3.exe and cygwin1.dll) to C:\ drive. Start a command prompt as an Administrator and switch to C:\ drive:
C:\> cd C:\ Start the iPerf utility: On the source server, run:
C:\> iperf3.exe -s On the destination server, run:
C:\> iperf3.exe -s -c ""ip_address_of_source"" On both servers, the iPerf utility will output stats regarding throughput speed. It is advised to use this utility to determine connection problems. "
6,"Cannot open phpMyAdmin for the database in Plesk: Access denied for user
Applicable to: Plesk for Linux
Plesk for Windows Symptoms phpMyAdmin shows the following errors on attempt to access the database through Plesk at Domains > example.com > Databases > exampledb > phpMyAdmin:
CONFIG_TEXT: Connection for exampleuser as defined in your configuration failed CONFIG_TEXT: You probably did not create a configuration file. You might want to use the setup script to create one. Error MySQL said: #1045 - Access denied for user 'exampleuser'@'localhost' (using password: YES) mysqli_real_connect(): (HY000/1045): Access denied for user 'exampleuser'@'localhost' (using password: YES) Cause
Password for the database user was modified directly in the database server, therefore Plesk has outdated password stored for the phpMyAdmin connections.
Resolution
Password for the database user must be updated in Plesk:
Note: In case any applications are using this database, the new password must match the one specified in the next steps. Updating the password using Plesk UI: Log into Plesk
Navigate to the Domains > example.com > Databases > User Management > exampleuser Specify a new password, or click on the Generate button
Click on Ok Updating the password using Plesk CLI: Connect to the server via SSH or RDP Run the following command in the console:
# plesk bin database --update-dbuser exampleuser -passwd 'new_password' -server localhost:3306
Note: In case password for the remote database user should be updated, its host and port should be specified instead in the -server option. "
9," How to integrate Plesk with a secondary (slave) DNS server?
Applicable to: Plesk Onyx for Linux
Plesk Onyx for Windows Question
How to setup Plesk that is running as a primary DNS server for integrating it with a secondary (slave) DNS server?
Answer Plesk as Master DNS + external Linux-based DNS server The integration can be performed using Slave DNS Manager extension available in Extensions Catalog in Plesk: Plesk > Extensions > install Slave DNS Manager > Add Slave > specify Slave DNS IP Address
Visit Plesk Administrator's Guide for instructions on setting up a secondary DNS.
How it works: It registers a slave server in the extension settings
The slave server’s IP address is automatically added to the list of addresses allowed to transfer domain zones from the Plesk server
When creating, modifying, or deleting an active domain zone in Plesk, Plesk creates, modifies, or deletes the domain zone in the local DNS service
The script starts and receives the domain name and the command to create, modify, or delete a domain zone
The script initiates rndc command for each connected slave server
Slave servers synchronize domain zones with the ones on the Plesk server Plesk as Master DNS + DNS on a cloud service Use one of the following Plesk extensions: DigitalOceanDNS
Microsoft Azure DNS
Amazon Route 53 Plesk as Master DNS + another Plesk as slave DNS (not recomended) If the Slave server has Plesk installed, no need to install Slave DNS Manager extension. Instead, IP address of the Slave DNS should be specified on the Master, in Tools & Settings > DNS Template > Transfer Restrictions Template.
Warning: The same domains should exist on both master and slave Plesk servers. It prevents DNS data from getting corrupted.
Note: Add the IP address of the Master server in Tools & Settings > DNS Template > Transfer Restrictions Template and change DNS to Slave mode on Slave server side, as well. "
9,"How to add a new record to several domains in Plesk for Windows? Applicable to: Plesk for Windows Question How to add a DNS record to several existing domains? How to apply changes made in server-wide DNS template to several existing domains? Answer
In Plesk for Windows, changes in the server-wide DNS template are applied only to newly created domains.
To make changes in DNS records of multiple domains use one of the following scenarios:
Note: Before performing the below actions, create a backup of the psa database:
C:\> plesk db dump psa > C:\psa_dump.sql To add one record to several domains: Save a list of domains to the domains.txt text file:
C:\> plesk db -N -e ""select name from domains"" > C:\domains.txt
Note: edit the domains.txt file according to the requirements. To leave separate domains unchanged, remove them from the list. Add the required DNS record, e.g. the TXT record, for each domain listed in the C:\domains.txt file:
C:\> for /f %i in (C:\domains.txt); do @(""%plesk_cli%\dns.exe"" -a %i -txt ""Text_Record""); SUCCESS: Creation of DNS record in Domain 'example.com' complete.SUCCESS: Creation of DNS record in Domain 'example.org' complete.
Note: Additional information about the dns.exe utility and its syntax can be found here. To apply server-wide DNS templates to several existing domains: Save a list of domains and their IP addresses to the domains_ip.txt text file:
C:\> plesk db -N -e ""select domains.name as domain, IP_Addresses.ip_address from domains, dom_param, IP_Addresses where domains.id=dom_param.dom_id and dom_param.val=IP_Addresses.id and dom_param.param='ip_addr_id'"" > C:\domains_ip.txt
Note: edit the domains_ip.txt file according to the requirements. To leave separate domains unchanged, remove them from the list. Restore DNS records for all domains listed in the domains_ip.txt file to their DNS template values:
Warning: All custom DNS records will be removed.
C:\> for /f ""tokens=1,2"" %a in (C:\domains_ip.txt) do @""%plesk_cli%\dns.exe"" --reset %a -ip %b SUCCESS: Restoring the DNS zone by the template for Domain 'example.com' complete.SUCCESS: Restoring the DNS zone by the template for Domain 'example.org' complete.
Note: Additional information about the dns.exe utility and its syntax can be found here. "
3,"Website is continuously loading without any errors or fails with 500 - Internal Server Error after long time
Applicable to: Plesk Onyx for Windows
Plesk for Windows Symptoms Website is loading continuously without showing any errors. After a huge amount of time, loading can fail with the following error:
CONFIG_TEXT: 500 - Internal Server Error No other errors can be observed. Cause
Application Pool misconfiguration that leads to an inability to spawn the worker process.
Resolution
Re-create the application pool: Log in to Plesk Go to Domains > example.com > Dedicated IIS Application Pool for Website Click on Switch Off, and then to Switch On to recreate the pool
Note: In case Application Pool is shared between all domains of the subscription, apply the steps above to the primary domain of the subscription. In case the issue persists, it is also required to re-create the site in IIS: Log in to the server via RDP. Identify what Application Pool is the website assigned to via IIS > Sites > example.com > View Applications > Application Pool: Remove the site from IIS by right click on it and press Remove.
Warning: in case the site was using plesk(default) application pool, skip step 4 and proceed with step 5. Remove the application pool that was identified on step 2 via IIS > Application Pools > example.com(domain). Re-create the site and application pool, on Plesk server it is possible with the following command executed via the command line:
C:\> plesk repair web example.com "
3," Error in domain's Apache error log: AH01068: Got bogus version Applicable to: Plesk for Linux Symptoms Apache version is 2.4.15 or older. The following error messages appear in Plesk at Domains > example.com > Logs or in domain's error log file /var/www/vhosts/system/example.com/logs/error_log:
CONFIG_TEXT: AH01068: Got bogus version 111, referer: (22)Invalid argument: AH01075: Error dispatching request to :, referer: Cause
This is the Apache bug 49671, which has been fixed in Apache version 2.4.16.
Resolution
Note: Apache 2.4.16 is not available in default repositories of CentOS/RHEL 7.x.
These error messages can be safely ignored - there are no consequences for the website.
To get rid of these messages, switch PHP to FPM served by nginx in Plesk at Domains > example.com > PHP Settings. "
7,"Which ports should be open in firewall on a Plesk server Applicable to: Plesk for Linux
Plesk for Windows Question
Which ports should be open in firewall on a Plesk server?
Answer
Ports that need to be opened depend on the services that are running on a server.
Plesk interface port is 8443 for HTTPS connection and 8880 for HTTP connection.
The possible ports that can be used by Plesk and its related services are listed below: 20 - ftp-data (TCP) 21 - ftp (TCP) 22 - ssh (TCP) 25 - smtp (TCP) 53 - dns (TCP and UDP) 80 - http (Web server and Plesk updater) (TCP) 106 - poppassd (for localhost only) (TCP) 110 - pop3 (TCP) 113 - auth (TCP) 143 - imap (TCP) 443 - https (TCP) 465 - smtps (TCP) 587 - mail message submission (TCP) 953 - rndc (TCP) 990 - ftps (TCP) 993 - imaps (TCP) 995 - pop3s (TCP) 1433 - mssql (TCP) - Windows Only 3306 - mysql (TCP) 3389 - rdp (TCP) - Windows Only 5224 - (outgoing connections only) plesk-license-update (TCP) 5432 - postgres (TCP) - Linux Only 8401 - sqladmin (TCP) - Windows Only 8443 - plesk-https (TCP) 8447 - autoinstaller (TCP) 8880 - plesk-http (TCP) 12768 - psa-pc-remote (for localhost only) (TCP) - Linux only, Postfix 135, 139, 445 - (TCP) ports for migration - Windows Only 137, 138 - (UPD) ports for migration - Windows Only 10155 - (TCP) for a custom Plesk Migrator service performing miscellaneous tasks - Windows Only 10156 - (TCP) for rsync server (migration) - Windows Only 49152-65535 - (TCP) for passive mode (incoming connections only) Additional Information On Linux servers, access to none of these ports must be denied in /etc/hosts.deny. If /etc/hosts.deny includes general access rules, then explicit allowing rules should be put to /etc/hosts.allow for all the ports mentioned (only the ports that accept incoming connections). The same rules also should be applied on any intermediate firewall/router that is between the Plesk server and an external network. "
4,"If Plesk Firewall is enabled, rules manually added in CLI are removed
Applicable to: Plesk for Linux Symptoms The extension Plesk Firewall is installed on a Plesk server. Firewall rules management is enabled in it in Tools & Settings > Firewall > Enable Firewall Rules Management. Firewall rules which were added manually in the server console using the utility iptables are removed. Cause
All custom firewall rules are replaced with the rules defined in Plesk Firewall in Tools & Settings > Firewall.
Resolution Log into Plesk. Go to Tools & Settings > Firewall. Add custom rules as described in Plesk Administrator's Guide. Alternatively, custom rules can be added using CLI as described in the article How to manage Plesk Firewall via CLI?
Please vote for the feature request on Plesk Uservoice https://plesk.uservoice.com/forums/184549-feature-suggestions/suggestions/12301677-improve-firewall-module-to-allow-editing-outside-o. The top-ranked suggestions are likely to be included in future product updates."
7,"Unable to install or update Plesk for Linux, unable to download Plesk packages from autoinstall.plesk.com
Applicable to: Plesk for Linux Symptoms
Unable to install or update Plesk for Linux with one of the following errors:
PLESK_ERROR: Getting new version of Parallels Installer... ERROR: The required version '3.11.0' was not found on the server. This could happen because of configuration error at the download site. Failed to download the package http://autoinstall.plesk.com/Paralle...x86_64.md5sum: The requested URL returned error: 404
PLESK_ERROR: http://autoinstall.plesk.com/PHP_5.3.29/dist-rpm-CentOS-7-x86_64/packages/plesk-php53-ioncube-loader-4.7.2-centos7.15020319.x86_64.rpm: [Errno -1] Package does not match intended download. Suggestion: run yum --enablerepo=PHP_5_3_29-dist clean metadata Trying other mirror. centos7.15020319.x86_64: [Errno 256] No more mirrors to try.', u'plesk-php53-ioncube-loader-4.7.2-centos7.15020319.x86_64: [Errno 256] No more mirrors to try.'
PLESK_ERROR: curl: (7) Failed connect to installer.plesk.com:443; Connection timed out --2017-07-26 15:41:12-- https://installer.plesk.com/one-click-installer Resolving installer.plesk.com (installer.plesk.com)... 185.59.221.16 Connecting to installer.plesk.com (installer.plesk.com)|185.59.221.16|:443... failed: Connection timed out. Retrying.
PLESK_ERROR: http://autoinstall.plesk.com/PSA_17.5.3/dist-rpm-CentOS-7-x86_64/contrib/log4cpp4] HTTP Error 504 - Gateway Timeout Trying other mirror. http://autoinstall.plesk.com/PSA_17.5.3/dist-rpm-CentOS-7-x86_64/common/plesk-ba] curl#18 - ""transfer closed with 52612 bytes remaining to read"" Error while preparing to install packages: [u'Errors were encountered while downbuild1705171011.15.x86_64: [Errno 256] No more mirrors to try.', u'plesk-core-ore mirrors to try.', u'plesk-l10n-17.5.3-cos7.build1705170615.09.noarch: [Errno Delta RPMs disabled because /usr/bin/applydeltarpm not installed. Number of retries is exceeded. YumDownloadError: [u'Errors were encountered while downloading packages.', u'log56] No more mirrors to try.'] sh: /etc/init.d/psa: No such file or directory
PLESK_ERROR: (try:20) http://autoinstall.plesk.com/Parallels_Installer/parallels_installer_CentOS_7_x86_64 Connecting to autoinstall.plesk.com (autoinstall.plesk.com)|195.181.174.6|:80... connected. HTTP request sent, awaiting response... Read error (Connection reset by peer) in headers.
PLESK_ERROR: Resolving autoinstall.plesk.com (autoinstall.plesk.com)... 185.59.220.21 Connecting to autoinstall.plesk.com (autoinstall.plesk.com)|185.59.220.21|:80... connected. HTTP request sent, awaiting response... 503 Service Unavailable ERROR 503: Service Unavailable.
Cause
Plesk uses a content delivery network (CDN) to distribute Plesk packages. This technology uses several cache servers which are distributed across different parts of the internet. All of the servers share a common domain name, autoinstall.plesk.com, which resolves to different IP addresses depending on the network segment that a request comes from. Sometimes, a server becomes out of sync with the main replica and files go missing.
Resolution
Warning: Consider this solution as temporary. Revert the changes as the CDN server will up and operable.
Use another replica of the Plesk repository until the local CDN server synchronizes with it. To do this perform the following: Visit any 3rd-party DNS checker (for example https://dnschecker.org/#A/autoinstall.plesk.com) to determine the IP address of the nearest available host to the Plesk server.
Connect to the server via SSH Configure a static resolution rule in the file /etc/hosts. Open file for editing
# vi /etc/hosts Insert IP address from step #1 to forcefully resolve Plesk installer to another replica, for example:
CONFIG_TEXT: 185.93.1.5 autoinstall.plesk.com If this does not help, contact the network administrator to check why the server cannot reach autoinstall.plesk.com."
8,"What will happen to emails that are sent over the limitations on outgoing email messages Applicable to: Plesk 12.0 for Linux
Plesk 12.5 for Linux Plesk Onyx for Linux Question
What will happen to emails that are sent over the limitations on outgoing email messages? For example, if the limit on outgoing email messages for a mailbox is set to 100 per hour?
Answer
The first 100 messages will be sent successfully, but 101 message for the same hour webmail will show the following error:
If a message was blocked by the outgoing mail control, it does not get queued or saved, it just gets rejected (dropped) without the ability to resend it. This is done to prevent spamming on a server.
The following record will appear in the mail logfile /usr/local/psa/var/log/maillog:
CONFIG_TEXT: /usr/lib64/plesk-9.0/psa-pc-remote[5977]: REJECT during call 'limit-out' handlerpostfix/cleanup[7018]: AE16288F80: milter-reject: END-OF-MESSAGE from localhost[::1]: 5.7.0 Your message could not be sent. The limit on the number of allowed outgoing messages was exceeded. Try again later.; from=<user1@example.com> to=<user2@example.net> proto=ESMTP helo=<webmail.example.com>postfix/smtpd[7015]: disconnect from localhost[::1] If the option Allow users and scripts to use Sendmail is enabled at Tools & Settings > Mail Server Settings, then system users of subscriptions will be able to send email messages using the ""sendmail"" utility even if the limits for a mailbox and domain are exceeded.The maximum number of messages that scripts can send will be defined by the limit for a corresponding subscription.Users can use Sendmail through SSH on behalf of a subscription's system user.
Additional Information Plesk Documentation: Custom Limits Related Articles How to disable PHP mail() function for a spamming domain on Plesk server
"
6,"MSSQL user can see all databases on Plesk for Windows server
Applicable to: Plesk for Windows Symptoms
MS SQL database users are able to see names of MS SQL databases which are not owned by them.
Cause
Default MS SQL server behavior.
Resolution
Warning: User's databases will not be listed in MS SQL Management Studio after the solution below.
Note: 'MASTER' and 'TEMPDB' databases will always be visible to all users. It is not possible to make them invisible.
To revoke the permissions, do the following: Connect to the server via RDP. Open SQL Server Management Studio either locally, or via remote connection. Or use any web admin like MyLittleAdmin to access the database (Tools & Settings > Database Servers > Web admin). Select the master database from the list of databases. Once the database is selected, click the button New Query. Run the following SQL query to hide databases for all users:
CONFIG_TEXT: USE master; REVOKE VIEW ANY DATABASE TO PUBLIC; GO
It is possible to revert changes using the following query:
CONFIG_TEXT: USE master; GRANT VIEW ANY DATABASE TO PUBLIC; GO "
5,"Migration cannot be started: Panel Migrator failed to install RPC Agent
Applicable to: Plesk for Windows Symptoms Migration to Plesk cannot be started with the following errors:
PLESK_ERROR: [ERROR] Failed to perform action: Check connections Cause: Error while checking connection settings: 'Panel Migrator failed to install RPC Agent to '203.0.113.2' server. RPC Agent is required for communication between current server and '203.0.113.2' server CONFIG_TEXT: Connection to the host is not available or the migration agent is not running on the source host. Migration got stuck on Retrieving Information from Host step. Migration hangs with the following message in Plesk UI:
CONFIG_TEXT: Check that specified source servers accounts are built-in Windows administrators Cause
RPC agent that is required for migration is missing or it is run under a non-administrator user on a source server.
Resolution Log into Plesk on the target server. Browse to Tools & Settings > Migration & Transfer Manager > Start a New Migration In Setup section select Manual migration type and download RPC Agent installation package using the link from that screen: Connect to the source server via RDP and upload run-panel-migrator-rpc-agent.exe file to any location, e.g. C:\plesk_migrator Run the downloaded .exe file as Administrator on the source server. For that right click on the run-panel-migrator-rpc-agent.exe file and choose Run as administrator:
Note: Do not close opened terminal window. Restart, or continue the migration on a target server. Additional Information
Migration fails: Panel Migrator failed to connect to RPC Agent"
2,"Cannot change domain's hosting type: No [Change] button is rendered
Applicable to: Plesk for Linux
Plesk for Windows Symptoms Cannot change hosting type of the main domain of subscription: the button Change is not available in Domains > example.com > Hosting Settings > Hosting type: It is not possible to switch the type from CLI also:
# plesk bin site -u example.com -hst_type std -target_url example.net Subscription contains sites, therefore, you cannot change hosting type or delete it. exit status 1 There are additional domains available in the subscription: # plesk db -Ne 'SELECT count(*) FROM domains d1 LEFT JOIN domains d2 ON d1.id = d2.webspace_id WHERE d1.name = ""example.com"";' 1 Cause
It is not possible to change the hosting type of the subscription's main domain due to the internal limitations, as the additional domains have the content hosted within the main subscription's domain.
Resolution
Consider voting for the corresponding feature request.
As a workaround, configure the forwarding type manually on the domain: Forwarding with 301/302 code For Linux Log into Plesk Disable the Permanent SEO-safe 301 redirect from HTTP to HTTPS option in the Domains > example.com > Hosting Settings Navigate to Domains > example.com > Apache & nginx Settings Add the following directives to both Additional directives for HTTP and Additional directives for HTTPS:
CONFIG_TEXT: Redirect 301 / https://example.net/
Note: Replace the https://example.net/ with the desired target location. In case 302 redirect is required, change 301 to 302. Add the following directives to Additional nginx directives, if it is present:
CONFIG_TEXT: return 301 $scheme://example.net/$request_uri;
Note: The directives above can only be modified by Plesk Administrator. In case they are absent, contact service provider and ask to apply this article. For Windows Log into Plesk Navigate to Domains > example.com > File Manager Open web.config file and add the following content right below the <system.webServer> declaration:
CONFIG_TEXT: <httpRedirect enabled=""true"" destination=""https://example.net/"" httpResponseStatus=""Permanent"" />
Note: Replace the https://example.net/ with the desired target location. In case 302 redirect is required, change Permanent status to Found. Frame forwarding Log into Plesk Navigate to Domains > example.com > File Manager and create an index.html file with the following content:
CONFIG_TEXT: <html><head><title>Title</title></head><style>body { margin: 0; padding: 0;}body, iframe { width: 100%; height: 100%;}iframe { border: 0;}</style><body> <iframe src=""https://example.net""/></body></html>
Note: Replace the http://example.net/ with the desired target location. The target domain must allow iframes: Domain that has frame forwarding hosting type shows blank page Set the index.html as the main index document: How to set default index file for a domain in Plesk Onyx Note: It will not be possible to set the ""No hosting"" type that way"
5,"Plesk migration error: Failed to copy mail content of subscription because of a network related issue
Applicable to: Plesk for Windows
Plesk for Linux Symptoms Plesk migration error:
PLESK_ERROR: Failed to copy mail content of subscription. Most probably that happens because of a network-related issue. Please check network connections between source and target servers, then re-copymail content with the help of 'copy-mail- content' command
or:
PLESK_ERROR: Failed to copy web files for subscription. Migration tools tried to perform operation in 3 attempts: Rsync failed to copy files from the source (the source server 'source') to the target server (target Plesk server). This could happen because of a network connection issue. Retry copying the files with the help of the ""copy-content"" command. Errors in %plesk_dir%var\modules\panel-migrator\sessions\YYYYMMDDHHMMSS\debug.log on Windows or /usr/local/psa/var/modules/panel-migrator/sessions/YYYYMMDDHHMMSS/debug.log on Linux:
PLESK_INFO: |E|ST1|core.windows_rsync|example.com|Interaction via rsync with server at 203.0.113.2 and client at 203.0.113.3 was failed, retry in 10 seconds rsync error: error in socket IO (code 10) rsync: failed to connect to 203.0.113.2: Connection timed out (116) Cause
Rsync utility cannot communicate with mail server. It can be source Plesk server or remote mail server.
Resolution Run RPC Agent manually on the source server or remote mail server. The instructions can be found in this article Temporarily disable firewall and antivirus on the source server or adjust settings to allow connections to the target server. The list of ports to allow can be found here. "
0,"Error while accessing Plesk from WHMCS via API: Customer with external id 'whmcs_plesk_XX' is not found in panel
Applicable to: Plesk Onyx for Linux
Plesk Onyx for Windows Symptoms
Cannot access Plesk from WHMCS via API as a customer or cannot change password:
CONFIG_TEXT: Error code: 1013. Error message: Customer with external id 'whmcs_plesk_XX' is not found in panel.
CONFIG_TEXT: Error code: 1013. Error message: Customer with email 'johndoe@example.com' is not found in panel. Please contact your service provider.
Cause
The external_id entry is missing in psa.clients MySQL table.
Resolution
Note: In case it happens during a migration, refer article: Cannot login to Plesk via WHMCS after migration: Customer with external id 'whmcs_plesk_XX' is not found in panel
Note: if the issue appears on WHMCS integrated with Plesk Multi Server, this database update should be done on the management node side. Log in to the server via SSH Create a backup of psa database:
# plesk db dump > psa.current.sql Access Plesk database from command line:
# plesk db Update the following value:
MYSQL_LIN: mysql> update clients set external_id='whmcs_plesk_XX' where login='johndoe';
where whmcs_plesk_XX - should be replaced with ID from the error johndoe - should be replaced with login of the customer affected by the issue. For several accounts List all orphaned client accounts (which has no external_id or it is invalid):
MYSQL_LIN: select id,cname,pname,login from clients where parent_id = 1 and (external_id = NULL or external_id = '0' or external_id = '') and clients.type <> 'reseller'; Create a file with all external_id extracted from WHMCS database. Log in to WHMCS database via PHPMyAdmin or via MySQL CLI and list all external_id:
CONFIG_TEXT: SELECT tblhosting.username, mod_pleskaccounts.panelexternalid FROM mod_pleskaccounts, tblhosting where mod_pleskaccounts.userid = tblhosting.userid and tblhosting.username <> ''; Further steps for Linux Back up Plesk database:
# plesk db dump psa > psa.current.sql Prepare a file with logins of the customers and external IDs separated by spaces:
# cat customers.txt cus1 f8fc8a02-870a-483a-8de7-2f2cf6d16ace edjhlbrh 1d0fa7bc-ecd8-4689-9931-99146b22a657 Take the ID and customer login from the customers.txt file and set IDs for clients with the appropriate logins:
# while read i j; do plesk db ""update clients set external_id='$j' where login='$i'""; done < customers.txt Check the result in psa.clients table:
# plesk db ""select pname,login,external_id from clients"" +-------------------+----------+--------------------------------------+ | pname | login | external_id | +-------------------+----------+--------------------------------------+ | Administrator | admin | NULL | | SomeCustomer | cus1 | f8fc8a02-870a-483a-8de7-2f2cf6d16ace | | whmcsReseller | res | 1d0fa7bc-ecd8-4689-9931-99146b22a657 | +-------------------+----------+--------------------------------------+ Further steps for Windows Back up Plesk database:
C:\> plesk db dump psa > psa_backup.sql Prepare a file with logins of the customers and external IDs separated by spaces:
C:\> more customers.txt cus1 f8fc8a02-870a-483a-8de7-2f2cf6d16ace edjhlbrh 1d0fa7bc-ecd8-4689-9931-99146b22a657 Take the ID and customer login from the customers.txt file and set IDs for clients with the appropriate logins:
C:\> for /f ""usebackq tokens=1,2"" %a in (customers.txt) do plesk db ""update clients set external_id='%b' where login='%a'"" Check the result in psa.clients table:
C:\> plesk db ""select pname,login,external_id from clients"" +-------------------+----------+--------------------------------------+ | pname | login | external_id | +-------------------+----------+--------------------------------------+ | Administrator | admin | NULL | | SomeCustomer | cus1 | f8fc8a02-870a-483a-8de7-2f2cf6d16ace | | whmcsReseller | res | 1d0fa7bc-ecd8-4689-9931-99146b22a657 | +-------------------+----------+--------------------------------------+ "
3,"Warnings on Apache restart in Plesk: DocumentRoot does not exist
Applicable to: Plesk for Linux Symptoms Warning appear on Apache restart or configuration syntax checking:
CONFIG_TEXT: Warning: DocumentRoot [/var/www/vhosts/example.com/httpdocs/test1] does not exist: bad user name. Website is not accessible:
CONFIG_TEXT: 502 Bad Gateway Error in Plesk panel:
PLESK_ERROR: New configuration files for the Apache web server were not created due to the errors in configuration templates: Warning: DocumentRoot [/var/www/vhosts/example.com/httpdocs/test1] does not exist Cause
Non-existent directory is specified as Document Root for a domain/subdomain in Plesk. Resolution
Note: if you don't have access to the server via SSH, contact your hosting provider regarding the issue.
Apply one of the following solutions: Solution I Log in to Plesk
Correct the site location for the mentioned domain at Domains > example.com > Hosting Settings. Solution II Log in to Plesk server via SSH Identify the correct directory ownership:
# ls -ld /var/www/vhosts/example.com Create the directory mentioned in the warning:
# mkdir -p /var/www/vhosts/example.com/httpdocs/test1 Assign correct ownership:
# chown exampleuser:psaserv /var/www/vhosts/example.com/httpdocs/ && chown exampleuser:psaserv /var/www/vhosts/example.com/httpdocs/test1 "
9,"DNS records for domain were not updated: Unable to manage service by dnsmng
Applicable to: Plesk for Linux Symptoms DNS records for a domain failed to update with the following error:
PLESK_ERROR: Unable to make action: Unable to manage service by dnsmng: ('start', 'dns'). Error: : The following error appears in /var/log/plesk/panel.log:
CONFIG_TEXT: ERR [panel] Unable to make action: Unable to manage service by dnsmng: ('start', 'dns'). Error: : 0: /usr/local/psa/admin/htdocs/server/restart_services.php:27 require() 1: /usr/local/psa/admin/htdocs/plesk.php:44 ERR [util_exec] proc_close() failed ['/usr/local/psa/admin/bin/dnsmng' '--start'] with exit code [1] ERR [1] '/usr/local/psa/admin/bin/dnsmng' '--start' failed with code 1. Cause
DNS service was not reloaded because named service is used instead of named-chrooted.
Resolution Connect to the server via SSH; Disable named.service:
# systemctl disable named.service Enable named-chroot.service:
# systemctl enable named-chroot.service # ln -s '/usr/lib/systemd/system/named-chroot.service' Start the named-chroot.service:
# systemctl start named-chroot.service # systemctl status named-chroot.service named-chroot.service - Berkeley Internet Name Domain (DNS) Loaded: loaded (/usr/lib/systemd/system/named-chroot.service; enabled) Active: active (running) since Wed 2015-01-07 22:57:33 CST; 27min ago Main PID: 12682 (named) CGroup: /system.slice/named-chroot.service └─1035 /usr/sbin/named -u named -t /var/named/chroot -c /etc/named.conf -u named -n 2 "
8,"Unable to access Horde webmail after upgrading Plesk: Base table or view not found: 1051 Unknown table Applicable to: Plesk for Linux Symptoms After a Plesk upgrade, it is not possible to access Horde webmail with the following error message in a web-browser:
PLESK_INFO: Base table or view not found The following error messages appear in the Horde logfile /var/log/psa-horde/psa-horde.log:
CONFIG_TEXT: HORDE [horde] SQL QUERY FAILED: SQLSTATE[42S02]: Base table or view not found: 1146 Table 'horde.rampage_types' doesn't exist SELECT type_id, type_name FROM `rampage_types` WHERE type_name IN ('calendar','event') [pid 54636 on line 815 of ""/usr/share/psa-pear/pear/php/Horde/Db/Adapter/Base.php""] Base table or view not found: 1051 Unknown table 'horde_vfs_seq' Base table or view not found: 1051 Unknown table 'horde_muvfs_seq' Base table or view not found: 1051 Unknown table 'kronolith_shares_seq' Base table or view not found: 1051 Unknown table 'kronolith_resources_seq'
OR
CONFIG_TEXT: HORDE [horde] SQLSTATE[42S22]: Column not found: 1054 Unknown column 'attribute_color' in 'field list' [pid 21827 on line 1601 of ""/usr/share/psa-pear/pear/php/Horde/Registry.php""] The following messages appear in the Plesk Installer logfile /var/log/plesk/install/autoinstaller3.log:
CONFIG_TEXT: Trying to upgrade Horde webmail configuration... Unable to upgrade 'horde' to the latest version, since its configuration is in broken state. Run bootstrapper repair to fix. Some problems are found during upgrade Horde webmail configuration(see log file: /tmp/plesk_11.5.30_installation.log) tac: write error ERROR while trying to act on PEAR packages - description directory is not specified or does not exist Cause
The database of Horde webmail is corrupted.
Resolution Connect to the Plesk server via SSH. For security reasons, create a backup of the Horde database:
# MYSQL_PWD=`cat /etc/psa/.psa.shadow` mysqldump -u admin horde > /root/horde_dump.sql Reinstall Horde using this KB article. "
7,"Plesk autoinstaller fails on yum operations and there are many components marked as not installed
Applicable to: Plesk for Linux Symptoms The following error appears when accessing Plesk Installer via Plesk > Tools & Settings > Updates & Upgrades:
CONFIG_TEXT: error: rpmdb: BDB0113 Thread/process 19176/139826746189824 failed: BDB1507 Thread died in Berkeley DB library error: db5 error(-30973) from dbenv->failchk: BDB0087 DB_RUNRECOVERY: Fatal error, run database recovery error: cannot open Packages index using db5 - (-30973) error: cannot open Packages database in /var/lib/rpm YumBaseError: Error: rpmdb open failed
OR
CONFIG_TEXT: ERROR: The Yum utility failed to install the required packages. Attention! Your software might be inoperable. Please, contact product technical support. RepoError: database disk image is malformed Execute command /usr/local/psa/admin/bin/send-error-report install Error: The Yum utility failed to install the required packages. Plesk update/upgrade fails:
PLESK_ERROR: rpmdb: BDB0641 __db_meta_setup: /var/lib/rpm/Name: unexpected file type or format error: cannot open Name index using db5 - Invalid argument (22)
PLESK_ERROR: Error while preparing to install packages: pkgKey 3976 doesn't exist in repo base. Trying again. Error while preparing to install packages: pkgKey 3976 doesn't exist in repo File ""/usr/lib/python2.4/site-packages/yum/sqlitesack.py"", line 432, in _packageByKey raise Errors.RepoError, msg RepoError: pkgKey 3976 doesn't exist in repo base Error: The Yum utility failed to install the required packages. Going to Plesk > Tools & Settings > Updates and Upgrades page returns one of the following errors:
CONFIG_TEXT: Can't connect to backend: No such file or directory Going to Plesk > Tools & Settings > Server Components, there might be many components marked as not installed:
CONFIG_TEXT: httpd The component was not installed It might be possible that some components are missing in Plesk GUI, for example, SSL/TLS Certificate. The rpm and yum commands may stuck/fail with one of the following errors: Click to expand # rpm -qa | grep php rpmdb: unable to join the environment error: db4 error(11) from dbenv->open: Resource temporarily unavailable error: cannot open Packages index using db3 - Resource temporarily unavailable (11) error: cannot open Packages database in /var/lib/rpm
# rpm -qa | grep php rpmdb: Thread/process 17910/140497668032480 failed: Thread died in Berkeley DB library error: db3 error(-30974) from dbenv->failchk: DB_RUNRECOVERY: Fatal error, run database recovery error: cannot open Packages index using db3 - (-30974) error: cannot open Packages database in /var/lib/rpm rpmdb: Thread/process 17910/140497668032480 failed: Thread died in Berkeley DB library error: db3 error(-30974) from dbenv->failchk: DB_RUNRECOVERY: Fatal error, run database recovery error: cannot open Packages database in /var/lib/rpm
# yum check error: rpmdb: BDB0641 __db_meta_setup: /var/lib/rpm/Name: unexpected file type or format error: cannot open Name index using db5 - Invalid argument (22) Loaded plugins: fastestmirror check all
# yum check rpmdb: Thread/process 17910/140497668032480 failed: Thread died in Berkeley DB library error: db3 error(-30974) from dbenv->failchk: DB_RUNRECOVERY: Fatal error, run database recovery error: cannot open Packages index using db3 - (-30974) error: cannot open Packages database in /var/lib/rpm CRITICAL:yum.main: Error: rpmdb open failed Cause
RPM database is corrupted.
Resolution Connect to the server via SSH Backup RPM database files:
# cp -a /var/lib/rpm /root/rpm_backup Rebuild RPM database:
# rpm --rebuilddb Refresh server components:
# plesk sbin packagemng -sdf
Note: if Plesk interface is not accessible due to a failed update or upgrade, re-run Plesk update:
# plesk installer update --repatch "
3,"Unable to open website hosted on Plesk: HTTP Error 404.3 - Not Found
Applicable to: Plesk for Windows Symptoms
The following error appears in an attempt to open a PHP-based website:
CONFIG_TEXT: HTTP Error 404.3 - Not Found The page you are requesting cannot be served because of the extension configuration. If the page is a script, add a handler. If the file should be downloaded, add a MIME map.
Cause
Handlers mapping for PHP is not configured.
Resolution Log in to Plesk server via RDP as Administrator. Go to IIS manager > Sites > example.com > Handler Mappings and add the missing handler manually to IIS Click the Add Module Mapping... button and specify the following parameters: Request path:
CONFIG_TEXT: *.php Module:
CONFIG_TEXT: FastCgiModule Executable: Click the icon near the empty field and select %plesk_dir%Additional\PleskPHPXX folder.
Note: specify the required PHP version instead of XX which can be found on the Plesk > Domains > example.com > PHP Settings. Choose the php-cgi.exe file and press the Open button. Name:
Specify a handler name, e.g. PHP-php. Click the Request Restrictions... > Mapping tab, mark the Invoke handler only if request is mapped to and select the File or folder option. Go to the Verbs tab, select the One of the following verbs and specify the GET,HEAD,POST value Go to the Access tab and select the Script value. Press OK > OK > Yes buttons. "
8," Mail to external mail service is delivered locally on Plesk server
Applicable to: Plesk for Linux
Plesk for Windows Symptoms The domain example.com is hosted on Plesk server; Mail for example.com is hosted on an external mail server/service; Plesk emails notifications are not delivered; An attempt to send a message through Plesk server to a mailbox on example.com fails with
# tail -f /usr/local/psa/var/log/maillog | grep 'unknown in virtual mailbox' 550 5.1.1 jdoe@example.com: Recipient address rejected: User unknown in virtual mailbox table; from=test@pleskdomain2.com to=jdoe@example.com
And/or:
CONFIG_TEXT: example.com postfix-local[23040]: cannot chdir to mailname dir contact: No such file or directory example.com postfix-local[23040]: Unknown user: jdoe@example.com The bounce message shows that there was a failed delivery attempt within the Plesk server, without an attempt to contact the external mail server that hosts the example.com mail service. In webmail, the following error can occur:
CONFIG_TEXT: Could not send message to SMTP server. Check you have access to send messages via the server and that all To/CC/BCC addresses are valid Error: SMTP Server rejected email. Returned:550 sorry, no mailbox here by that name. (#5.7.17) CONFIG_TEXT: Error SMTP (500): The following recipient could not be reached ""info@example.com"" (sorry, no mailbox here by that name. (#5.7.17)). CONFIG_TEXT: There was an error sending your message: Message could not be delivered - the address was not found, is unknown, or is not receiving messages. CONFIG_TEXT: 550 5.1.1 jdoe@example.com ... User unknown (in reply to MAIL FROM command)) Cause
Mail server treats example.com as a local domain and sends the mail locally.
Resolution Windows Disable the mail service per domain or subscription: Log in to Plesk Go to Domains > example.com > Mail Settings and uncheck Activate mail service on this domain and click OK.
Or disable mail service at the subscription level going to Subscriptions > example.com > Mail tab > Mail Settings tab > Select domains from the subscription > Click on Activate/Deactivate Services.
To disable the mail service on the subscription using command-line utility (run this on the server via CMD):
C:\> plesk bin mail --off example.com Linux Disable the mail service per domain or subscription: Log in to Plesk Go to Domains > example.com > Mail Settings and uncheck Activate mail service on this domain and click OK.
Or disable mail service at the subscription level going to Subscriptions > example.com > Mail tab > Mail Settings tab > Select domains from the subscription > Click on Activate/Deactivate Services.
Mail service on the subscription can also be disabled using the mail utility:
# plesk bin mail --off example.com
To disable the mail service for every subscription on the server, use the following command:
# plesk bin subscription --list | while read i; do plesk bin mail --off $i && echo ""Mail service for $i subscription has been disabled"" ;done If the previous steps did not help, check the postfix configuration: Connect to the server via SSH;
Execute the following command:
# postconf | grep mydomain append_dot_mydomain = yes mydestination = localhost, localhost.localdomain, localhost.$mydomain, $mydomain = example.com mydestination parameter contains the list of domains that are delivered via the $local_transport mail delivery transport. For additional information, see the official postfix documentation .
In case the domain name is there, to process example.com as an external domain, $mydomain removal from the postfix configuration is required: Create a backup of the current Postfix configuration /etc/postfix/main.cf.
# cp /etc/postfix/main.cf{,.bak} Remove $mydomain from the mydestination list in the configuration file /etc/postfix/main.cf using a text editor. Reload the postfix service to apply the changes:
# /etc/init.d/postfix reload Reloading postfix: [ OK ] If the external mail service is used for all subscriptions, it is possible to modify Postfix configuration to exclude domains which exist in Plesk from the local delivery: Create a backup of the current Postfix configuration /etc/postfix/main.cf.
# cp /etc/postfix/main.cf{,.bak} Open file/etc/postfix/main.cf and comment out the following lines by prepending it with '#' sign:
CONFIG_TEXT: #virtual_mailbox_domains = $virtual_mailbox_maps, hash:/var/spool/postfix/plesk/virtual_domains #virtual_alias_maps = $virtual_maps, hash:/var/spool/postfix/plesk/virtual #virtual_mailbox_maps = hash:/var/spool/postfix/plesk/vmailbox Reload the postfix service to apply the changes:
# /etc/init.d/postfix reload Reloading postfix: [ OK ] "
0,"Unable to set the private key in Plesk for Windows: Probably, the private key format is invalid
Applicable to: Plesk for Windows Symptoms Certificate uploading to Plesk fails with error:
PLESK_ERROR: Unable to set the private key: Probably, the private key format is invalid Private Key in the .key file starts with:
CONFIG_TEXT: -----BEGIN PRIVATE KEY----- The following error message appears in the Plesk logfile %plesk_dir%admin\logs\php_error.log:
CONFIG_TEXT: ERR [panel] Unable to set the certificate: Incompatible private key/certificate pair.. In some cases, domain reconfiguration fails with the following error message:
PLESK_INFO: stdout: A specified logon session does not exist. It may already have been terminated. (Exception from HRESULT: 0x80070520) In Microsoft.Web.Administration module Exception type: System.Runtime.InteropServices.COMException at Microsoft.Web.Administration.Interop.IAppHostMethodInstance.Execute() at Microsoft.Web.Administration.BindingManager.Save() at Microsoft.Web.Administration.ServerManager.CommitChanges() at ServerManagerFactory.commit() at IISServerManager.commit(IISServerManager* ) Cause
Certificate Private Key part is encrypted.
Resolution Connect to the Plesk server via RDP. Save the Private Key part in a text file, for example C:\Temp\my_encrypted.key.
Note: Make sure that Private Key starts with -----BEGIN RSA PRIVATE KEY-----: Start a command prompt as an Administrator. Decrypt the key using the openssl utility with these commands:
C:\> cd C:\Temp ""%plesk_bin%\openssl.exe"" rsa -in my_encrypted.key -out my_decrypted.key
where: my_encrypted.key - is an uploaded file from step 2 my_decrypted.key - a decrypted file that will be created Use the new decrypted .key file (In this example, my_decrypted.key) to upload an SSL certificate in Plesk. "
2,"ERROR PleskMainDBException Access denied for user 'admin'@'localhost' (using password: YES)
Applicable to: Plesk for Windows Symptoms
After upgrading Plesk on Windows or after changing the admin password, the following error is shown instead of the Plesk login page:
CONFIG_TEXT: Access denied for user 'admin'@'localhost' (using password: YES)
Cause
An incorrect password is set for the user admin in the MySQL database.
Resolution Connect to the server via RDP Open cmd.exe as Administrator and create the password registry entry, specifying a new password:
C:\> plesk sbin psadb -u --password=""new_password"" Add the skip-grant-tables option in [PleskSQLServer] section of the file %plesk_dir%MySQL\my.ini:
CONFIG_TEXT: . . . [PleskSQLServer] skip-grant-tables . . . restart the Plesk SQL Server service:
C:\> net stop PleskSQLServer && net start PleskSQLServer Change the admin password in the database:
C:\> plesk db ""update mysql.user set authentication_string=password('new_password') where user='admin'"" Remove the skip-grant-tables from %plesk_dir%MySQL\my.iniand restart the service again (repeat step #3). Run the following commands in Command Prompt to update the password in Windows registry:
C:\> plesk sbin psadb -u --password=""new_password"" plesk sbin psadb -s --password=""new_password"" "
8,"Unable to send mail from Plesk server using STARTTLS authentication: 4.7.0 TLS not available due to local problem
Applicable to: Plesk for Linux Symptoms Unable to send an email using the STARTTLS authentication:
CONFIG_TEXT: 454 4.7.0 TLS not available due to local problem The following error can be found in the /var/log/maillog file:
CONFIG_TEXT: postfix/smtpd[26508]: warning: cannot get RSA certificate from file /etc/postfix/postfix_default.pem: disabling TLS support postfix/smtpd[26508]: warning: TLS library problem: 26508:error:02001002:system library:fopen:No such file or directory:bss_file.c:355:fopen('/etc/postfix/postfix_default.pem','r'): postfix/smtpd[26508]: warning: TLS library problem: 26508:error:20074002:BIO routines:FILE_CTRL:system lib:bss_file.c:357: postfix/smtpd[26508]: warning: TLS library problem: 26508:error:140DC002:SSL routines:SSL_CTX_use_certificate_chain_file:system lib:ssl_rsa.c:722: Cause
TLS misconfiguration in Postfix: The postfix_default.pem certificate file does not contain the valid SSL certificate or it is broken. The path to the certificate is incorrect in the /etc/postfix/main.cf file. TLS configuration parameters are missing in the /etc/postfix/main.cf file. Resolution via Plesk Log in to Plesk. Go to Tools & Settings > SSL/TLS Certificates. Click the Change link opposite the Certificate for securing mail option: Specify the correct certificate in Select Certificate drop-down menu. Press the OK button to apply changes. If the initial issue still occurs, go to Plesk > Tools & Settings > Scheduled Tasks > Add Task. Specify the following parameters: Task type:
Run a command Command:
/usr/local/psa/admin/bin/mchk System user:
root Other fields/directive - leave default. Click the Run Now button. If the issue still persists after task finished, compare the current configuration with the steps from the ""via SSH"" section and fix the configuration if it is required. via SSH Connect to the server via SSH. Create the /etc/postfix/tls directory, set correct ownership, group, permissions and create a certificate file:
# mkdir /etc/postfix/tls # chown root:postfix /etc/postfix/tls # chmod u=rwx,go= /etc/postfix/tls # cd /etc/postfix/tls # openssl req -new -x509 -nodes -out smtpd.pem -keyout smtpd.pem -days 3650 Change /etc/postfix/main.cf accordingly:
CONFIG_TEXT: smtpd_tls_CAfile = /etc/postfix/tls/smtpd.pem smtpd_tls_cert_file = /etc/postfix/tls/smtpd.pem smtpd_tls_key_file = /etc/postfix/tls/smtpd.pem smtpd_tls_session_cache_database = btree:${queue_directory}/smtpd_scache smtpd_tls_security_level = may smtpd_use_tls = yes smtp_tls_security_level = may smtp_tls_CAfile = /etc/postfix/tls/smtpd.pem smtp_tls_cert_file = /etc/postfix/tls/smtpd.pem smtp_tls_key_file = /etc/postfix/tls/smtpd.pem smtp_tls_session_cache_database = btree:${queue_directory}/smtp_scache smtp_use_tls = yes smtpd_tls_received_header = yes smtpd_tls_ask_ccert = yes smtpd_tls_loglevel = 1 tls_random_source = dev:/dev/urandom If the smtpd_sasl_auth_enable = yes option is set in the /etc/postfix/main.cf file, make sure that the saslauthd service is started:
# service saslauthd status Reload Postfix configuration:
# service postfix restart "
8,"Unable to add more than 100 email addresses to SpamAssassin Black/White list: Only 100 first unique e-mail addresses will be added
Applicable to: Plesk for Linux
Plesk for Windows Symptoms Unable to add more than 100 email addresses to SpamAssassin White/Black List in Tools & Settings > Spam Filter > Black/White list or in Domains > example.com > Mail > Email Addresses > john.doe@example.com > Spam Filter. One of the following messages are shown in Plesk interface:
PLESK_ERROR: Error: Only %available%% unique email addresses can be added.
or:
PLESK_WARN: Warning: Only 100 first unique e-mail addresses will be added.
or:
PLESK_ERROR: ERR [1] PleskUtilException: spammng failed: file: /usr/local/psa/admin/plib/Service/Agent.php line: 228 code: 0 The error like below can be found in /var/log/plesk/panel.log:
CONFIG_TEXT: Starting: spammng --update --add-to-whitelist *@example.com --max-children 1 --sensitivity 7.00 --modify-header *****SPAM***** '--enable-user-configs' '-c' failed with code 127. stdout: stderr: ERR [panel] spammng failed: Cause
SpamAssassin limitation.
Resolution
NOTE: Large number of addresses in the SpamAssassin white/black lists may significantly reduce server performance. Connect to the server using SSH; Create a backup of Plesk database; Run the following SQL query to set maximum number of addresses. As an example, the maximum number of 150 mail addresses is given: you may choose appropriate number according to your needs.
For Plesk Onyx:
# plesk db ""replace into ServiceNodeConfiguration values (1, 'mailServer', 'spamfilter_max_addr_list_length', 150);""
For Plesk Obsidian: # plesk bin settings --set spamfilter_max_addr_list_length=150 Additional information
SpamAssassin Spam Filter"
10,"Presence Builder product support
Applicable to: Plesk Onyx for Linux
Web Presence Builder Question Will Presence Builder be supported and developed further (new features)? Is there end-of-life (EOL) date for Presence Builder? Answer
Presence Builder continues to be supported and maintained, but is no longer developed. No new features will be added.
There is no EOL for this product so far."
6,"Dump of the MySQL database hosted on the Plesk server fails: mysqldump table doesn't exist when using LOCK TABLES
Applicable to: Plesk for Linux Symptoms Dump of the MySQL database hosted on the Plesk server fails:
CONFIG_TEXT: mysqldump: Got error: 1146: Table '<TABLENAME>' doesn't exist when using LOCK TABLES Backups have the following warning related to the database:
CONFIG_TEXT: WARNING: mysql 'exampleDB' Unable to execute SQL: Table 'exampleDB.<TABLENAME>' doesn't exist in engine. SQL query: SHOW FULL COLUMNS IN `<TABLENAME>` Migration fails with the following error:
PLESK_ERROR: Failed to copy content of database 'exampleDB' Migration tools tried to perform operation in 3 attempts: Command execution failed on the source server 'source' (203.0.113.2) with non-zero exit code. command: MYSQL_PWD=""$(cat /etc/psa/.psa.shadow)"" mysqldump --no-defaults -h localhost -P 3306 -uadmin --quick --quote-names --add-drop-table --default-character-set=utf8 --set-charset --routines --events exampleDB > /root/plesk_migrator/plesk_migrator-dy0onpkt6k9v4ydtwlfpf507xswuqmyh/db-dumps/exampleDB.sql exit code: 2 stdout: stderr: mysqldump: Got error: 1932: ""Table 'exampleDB.table' doesn't exist in engine"" when using LOCK TABLES Cause InnoDB tablespace might have been deleted and recreated but corresponding .frm files of InnoDB tables from the database directory were not removed, or .frm files were moved to another database
Incorrect permissions and ownership on table's files in MySQL data directory
The table data has been corrupted Resolution
Note: The steps below cover only most common use cases for Plesk on Linux installations. This administrative task might be done by Plesk Professional Services team on your behalf. For more information, contact Plesk Professional Services team. Connect to the server using SSH Try to use --skip-lock-tables parameter with mysqldump to skip lock tables, like in the example below:
# mysqldump --skip-lock-tables -u<db_user> -p<db_user_password> database_name > /root/database_dump.sql If the step above does not help, check permissions and ownership on table's files in MySQL data directory for the database that fails to dump (e.g. example_db), it should be mysql for both owner and group: Find data dir location:
RHEL/CentOS
# grep datadir /etc/my.cnf datadir=/var/lib/mysql
Debian/Ubuntu
# grep -iR datadir /etc/mysql* /etc/mysql/mysql.conf.d/mysqld.cnf:datadir = /var/lib/mysql Check permissions:
# ls -la /var/lib/mysql/example_db/ Fix permissions:
# chown -R mysql:mysql /var/lib/mysql/example_db/ If it is still not possible to dump database try to repair the table in the error using native MySQL repair tool:
# plesk db
MYSQL_LIN: mysql> use example_db; mysql> REPAIR TABLE <TABLENAME>;
Note: <TABLENAME> in the command above is a placeholder and should be replaced with the table name in the error message If the issue is still persists, the most probably ibdata* file does not have the info about the table, however the orphaned .frm files still persists on the file system. Remove .frm files as below: Verify that table is corrupted:
# plesk db
MYSQL_LIN: mysql> use database example_db; mysql> desc <TABLENAME>;
If the command above fails with the error, it means that ibdata* does not have the information about the table and the .frm file have to be removed. Browse to database directory /var/lib/mysql/example_db/ and move .frm file:
# cd /var/lib/mysql/example_db/ # mv <TABLENAME>.frm /root/<TABLENAME>.frm If none of the steps above helps and there are no valid backups to restore, the only available option to save database is dump it with innodb_force_recovery option: How to fix InnoDB corruption cases for the MySQL database? – I. Force InnoDB Recovery "
2,"Unable to load object of type BsDomain with id=3: Domain does not exist.
Applicable to: Plesk for Linux
Plesk for Windows Symptoms
The following error appears in Plesk UI during an attempt to open a domain control panel in Plesk, or open the Home > Domains link in the left navigation bar, or login to Plesk:
PLESK_INFO: Internal error: Unable to load object of type BsDomain with id=3: Domain does not exist.
Cause
The issue is caused by a psa database inconsistency. It occurs if a record in the domains.webspace_id or domain_aliases.dom_id columns of a psa database points to a non-existing domain ID.
Resolution
Solution 1
For Plesk 12.5 or higher try ""plesk repair db"" utility first. Refer to the documentation for details.
Solution 2
If Solution 1 did not help use the solution below, login to the server via SSH and do the following: Create Plesk database backup:
# plesk db dump psa > psa_backup.$(date +%F_%R).sql Check the links to <id from error> in the psa.domains table:
# plesk db ""SELECT * FROM domains WHERE webspace_id=<id from error>""
The above query will return a list of domains that belong to a broken webspace, if there are any. Check the domain-related tables and domain aliases:
# for table in domain_aliases hosting dom_param DomainServices subdomains;do echo TABLE: $table; plesk db ""select * from $table where dom_id=<id from error>"";done
This query will return domain aliases that belong to the missing dom_id and also entries in related tables that contain information about the domain. If the hosting and DomainServices tables returned a non-empty result on step 3, check whether the actual domain content folder exists (www_root value from hosting table) :
# ls -la /var/www/vhosts/example.com/httpdocs
If it does, the domain entry in the database should be recreated. Fetch it from Plesk database dumps using the below command:
# export dom_id=<dom_id that you got from hosting table>
# find /var/lib/psa/dumps/ -name mysql.daily.dump.*|sort -n |while read dump_file;do zcat $dump_file|grep '^INSERT INTO `domains'|sed 's/INSERT INTO `domains` VALUES //g'|sed 's/),(/)\n(/g'|grep ""($dom_id,"";if [ $? == 0 ];then echo;echo Dump file $dump_file contains the entry;exit 0;fi;done (2,'2013-11-21','domain.com','domain.com',3,0,'vrt_hst',760319296,1,0,NULL,NULL,'53238f70-4818-49a3-8d7e-1a5220e0e06e','','false','on',1,0,0,0,0) Dump file /var/lib/psa/dumps/mysql.daily.dump.8.gz contains the entry
The above command will return the domain entry from Plesk database dumps if it exists there. Re-insert the entry into the domains table:
# plesk db ""INSERT INTO domains VALUES (2,'2013-11-21','domain.com','domain.com',3,0,'vrt_hst',760319296,1,0,NULL,NULL,'53238f70-4818-49a3-8d7e-1a5220e0e06e','','false','on',1,0,0,0,0);"" If the domain entry is missing in the dumps and the content folder does not exist, set the dom_id to 0 for all the domains that have webspace_id pointing to the missing domain. Also, remove entries from the following tables:
MYSQL_LIN: mysql> begin; mysql> DELETE FROM hosting WHERE dom_id = <id from error>; mysql> DELETE FROM dom_param WHERE dom_id = <id from error>; mysql> DELETE FROM DomainServices WHERE dom_id = <id from error>; mysql> DELETE FROM domain_aliases WHERE dom_id = <id from error>; mysql> DELETE FROM subdomains WHERE dom_id = <id from error>; mysql> commit; If the content folder is in place but the domain entry is missing in dumps, create a support request in order to resolve the issue. "
2,"Operations in Plesk fail: Allowed memory size of X bytes exhausted (tried to allocate Y bytes)
Applicable to: Plesk for Linux
Plesk for Windows Symptoms Any of the following operations in Plesk: Accessing Plesk inteface
Opening WordPress Toolkit
Opening an extension
Running a scheduled task
Installing updates for Plesk or extensions
Let's Encrypt certificates are not updated automatically fails with a blank page or one of the following error messages in Plesk:
PLESK_INFO: PHP Fatal error: Allowed memory size of 268435456 bytes exhausted (tried to allocate 16384 bytes) in /usr/local/psa/admin/plib/vendor/plesk/zf1/library/Zend/Db/Statement/Pdo.php on line 228 PLESK_INFO: Out of memory (allocated 23855104) (tried to allocate 12975879 bytes) (Abstract.php:41) PLESK_INFO: Error 500 The following error messages appear in the Plesk logfile with debug mode enabled: On Linux: /var/log/plesk/panel.log On Windows Server: %plesk_dir%\admin\log\php_error.log CONFIG_TEXT: PHP Fatal error: Allowed memory size of 268435456 bytes exhausted (tried to allocate 52198551 bytes) in C:\Program Files (x86)\Parallels\Plesk\admin\plib\CommonPanel\Exception.php on line 58 ERR [1] ERROR: Allowed memory size of 268435456 bytes exhausted (tried to allocate 52198551 bytes) (Exception.php:58) Cause
Memory limit is exceeded by Plesk PHP back-end. This may happen if an object, over which the operation was performed, has a complex structure.
Resolution For Plesk on Linux Connect to the Plesk server via SSH. Open the Plesk PHP configuration file php.ini in a text editor. In this example, we are using the vi editor:
# vi /usr/local/psa/admin/conf/php.ini Increase the memory_limit limit to 512. Save the changes and close the file. Restart the Plesk management service:
# service sw-engine restart && service sw-cp-server restart Redo the previously failed operation. If it fails with the same error, increase the memory_limit limit to a greater value and restart the services. To prevent the changes from being reverted during Plesk update, replace the following line in /etc/cron.daily/50plesk-daily: For Debian/Ubuntu:
CONFIG_TEXT: /usr/local/psa/bin/sw-engine-pleskrun /opt/psa/admin/plib/DailyMaintainance/script.php >/dev/null 2>&1
With:
CONFIG_TEXT: /usr/local/psa/bin/sw-engine-pleskrun /opt/psa/admin/plib/DailyMaintainance/script.php >/dev/null 2>&1 && sed -i '/memory_limit/c\memory_limit = 512M' /usr/local/psa/admin/conf/php.ini For CentOS:
CONFIG_TEXT: /usr/local/psa/bin/sw-engine-pleskrun /usr/local/psa/admin/plib/DailyMaintainance/script.php >/dev/null 2>&1
With:
CONFIG_TEXT: /usr/local/psa/bin/sw-engine-pleskrun /usr/local/psa/admin/plib/DailyMaintainance/script.php >/dev/null 2>&1 && sed -i '/memory_limit/c\memory_limit = 512M' /usr/local/psa/admin/conf/php.ini For Plesk on Windows Server Connect to the Plesk server via RDP. Open the Plesk PHP configuration file %plesk_dir%admin\conf\php.ini in a text editor. Increase the memory_limit limit to 512. Save the changes and close the file. Restart the Plesk management service:
Start PowerShell and run the commands one by one:
PS import-module WebAdministration net stop ""Plesk PopPass Service"" net stop ""Plesk Management Service"" net start ""Plesk Management Service"" net start ""Plesk PopPass Service"" Restart-WebAppPool PleskControlPanel Redo the previously failed operation. If it fails with the same error, increase the memory_limit limit to a greater value and restart the services. "
7,"Plesk installation or packages update fails: Yum repository 'base' is absent, corrupted, or not enabled, installation may fail: There are no enabled Yum repositories
Applicable to: Plesk for Linux Symptoms Unable to install any or some packages using Plesk autoinstaller; Plesk update fails with the following error:
CONFIG_TEXT: There are no enabled Yum repositories. Installation is not possible. Operation system is CentOS 6 or CentOS 7. Cause
The standard CentOS repository files are missing in the /etc/yum.repos.d/ directory or base repositories are disabled.
Resolution
The easiest way to fix base repositories is to reinstall centos-release package. Log into the server via SSH. Remove centos-release without dependencies:
# rpm -e centos-release --nodeps Install the packages: on CentOS 6:
# rpm -Uvh http://mirror.centos.org/centos/6/os/x86_64/Packages/centos-release-6-10.el6.centos.12.3.x86_64.rpm on CentOS 7:
# rpm -Uvh http://mirror.centos.org/centos/7/os/x86_64/Packages/centos-release-7-5.1804.el7.centos.x86_64.rpm "
5,"Migration or backup failed: mysqldump: Got error: 145 Applicable to: Plesk for Linux Symptoms Plesk full backup task got failed with an error in %plesk_dir%/PMM/sessions/<timestamp>/migration.result file:
PLESK_ERROR: <execution-result status=""error"" log-location=""/usr/local/psa/PMM/sessions/<timestamp>/migration.result""> <object name=""019"" type=""client""> <object name=""domain.tld"" type=""domain""> <object name=""db_name"" type=""mysql""> <message id=""dddba294-8e17-4d09-88c2-939270aef116"" severity=""error <description>Failed to execute backup of mysql database &#39;lap </message> <message id=""78afa08d-35e6-464a-8d7a-88c7ffdf69c7"" severity=""error <description>Failed to pack files backup_database_1_1401080148 i 412864 bytes free of 492248408064 bytes total on mount point 0]</description Manual backup of domain's database results in error:
# MYSQL_PWD=`cat /etc/psa/.psa.shadow` mysqldump -u admin database > database_backup.sqlmysqldump: Got error: 145: Table './db_name/toc_whos_online' is marked as crashed and should be repaired when using LOCK TABLES The following error appears during a migration process:
PLESK_ERROR: WARNING: (mysql object 'db_name') Not all the data was backed up into /var/cache/<timestamp>/clients/ccia/domains/domain.tld/databases/db_name_1 successfully. Use of chdir('') or chdir(undef) as chdir() is deprecated at Storage/Bundle.pm line 39, <STDIN> line 5.mysqldump: Got error: 145: Table './db_name/Logs' is marked as crashed and should be repaired when using LOCK TABLES
Or
PLESK_ERROR: stderr: mysqldump: Got error: 144: ""Table './db_name/table_name' is marked as crashed and last (automatic?) repair failed"" when using LOCK TABLES Cause
Database table corruption.
Resolution
Note: if the solutions below don't help, affected database should be restored from a backup.
Repair the corrupted database using one of the following methods: Via Plesk GUI Log in to Plesk Navigage to Plesk > Domains > example.com > Databases > db_name and click Check and Repair: Via phpMyAdmin Log in to Plesk; Navшgate to Plesk > Domains > example.com > Databases > db_name and click phpMyAdmin: Click SQL button and run the following query:
CONFIG_TEXT: REPAIR TABLE table_name;
Where table_name is the name of the table to repare Via SSH Connect to the server via SSH; Execute the command:
# MYSQL_PWD=cat /etc/psa/.psa.shadow mysqlcheck -uadmin -r db_name table_name
Where db_name is the name of the database where table table_name to be repaired. "
8,"MailEnable webmail page is not available for a domain in Plesk: HTTP Error 404.4 - Not Found
Applicable to:
Plesk Onyx for Windows
Symptoms When accessing Mailenable webmail page it fails with the error:
CONFIG_TEXT: HTTP Error 404.4 - Not Found Mail service is disabled for the domain in Plesk > Domains > example.com > Mail Settings. Cause
Webmail is not enabled on the domain.
Resolution Log into Plesk Make sure that webmail is enabled in Plesk > Domains > example.com > Mail Settings: "
0,"How to prevent filesystem browsing with php shell scripts?
Applicable to: Plesk for Linux Question
PHP shell script was uploaded under the home directory of subscription.
How to prevent filesystem browsing with php shell scripts?
Answer
It's possible to disable shell_exec and other functions in PHP by using the disable_functions directive:
Warning: Applications may rely on these functions and may not work properly when restrictions are applied. For Plesk Onyx 17.8 and newer Login to Plesk Navigate to Domains > example.com > PHP Settings Set the following value to the disable_functions:
CONFIG_TEXT: opcache_get_status,exec,passthru,shell_exec,system,proc_open,popen
Note: To set the restriction to multiple domains at once, this value can be specified in Service Plans > <service_plan> > PHP Settings > disable_functions, or to apply it server-wide, in panel.ini as settings.performance.disable_functions For Plesk Onyx 17.5 and older Login to Plesk Navigate to Domains > example.com > PHP Settings Add the following line under Additional configuration directives and apply the changes:
CONFIG_TEXT: disable_functions=opcache_get_status,exec,passthru,shell_exec,system,proc_open,popen "
7,"Does Plesk support any cluster solutions?
Applicable to: Plesk for Linux
Plesk for Windows Question
Redundancy or multi-hosting is required.
Is it possible to synchronize Plesk servers (Failover)? Does Plesk support any cluster solutions?
Answer
Currently, Plesk does not support any high availability cluster solutions as Plesk is not clustered system.
Vote for this feature on Plesk User Voice. The top-ranked suggestions are likely to be included in the next versions of Plesk."
2,"Unable to install certificate for domain in Plesk: SSL/TLS Certificates option is missing
Applicable to: Plesk for Linux Symptoms SNI support is disabled:
# grep SNI_SUPPORT /etc/psa/psa.conf SNI_SUPPORT false Website is hosted on shared IP address.
SSL support is enabled for website, but SSL Cerificates option is missing under Domains > example.com > Hosting Settings. Cause
SNI support is not enabled.
Resolution
Note: if you don't have administrative access to Plesk via SSH or RDP, contact your hosting provider regarding the issue Connect to the server using SSH. Edit /etc/psa/psa.conf file and change SNI_SUPPORT value to true:
CONFIG_TEXT: SNI_SUPPORT true Restart psa service:
# service psa restart Log into Plesk. Reload server components under Tools & Settings > Server Components > Refresh. "
0,"How to change CloudLinux LVE limits in Plesk?
Applicable to: Plesk for Linux Question
How to change CloudLinux LVE limits in Plesk?
Answer
CloudLinux LVE limits can be changed by using LVE Manager Plesk extension developed by CloudLinux.
To install it, connect to the server via SSH and run the following:
# yum install lvemanager
Note: Limits also can be changed using lvectl utility. Additional information on lvectl is available in CloudLinux Documentation "
3,"Unable to create website configuration with the error: Unable to load object of type SysUser with id
Applicable to: Plesk 12.5 for Linux
Plesk Onyx for Linux Symptoms The following error message is shown on the home page in Plesk:
PLESK_ERROR: New configuration files for the Apache web server were not created due to the errors in configuration templates: Template processing failed: file = /opt/psa/admin/conf/templates/default/domainVhostIpDefault.php, error = Template_Exception: Unable to load object of type SysUser with id=26: SysUser: unable to select: no such row in the table file: /opt/psa/admin/plib/Template/Processor.php line: 28 code: 0 Previous error: Template_Exception: Unable to load object of type SysUser with id=26: SysUser: unable to select: no such row in the table file: /opt/psa/admin/plib/Template/Processor.php line: 28 code: 0 Previous error: PleskDBException: Unable to load object of type SysUser with id=26: SysUser: unable to select: no such row in the table file: /opt/psa/admin/plib/functions.php line: 1627 code: 0. Detailed error descriptions were sent to you by email. In the Subscriptions list, one subscription is marked as broken. The utility plesk repair web returns an error:
# plesk repair web example.com Unable to load object of type SysUser with id=26: SysUser: unable to select: no such row in the table Cause
Database inconsistency: there is an orphaned record in the table sys_user_id .
Resolution Connect to the server via SSH. Create a backup of psa database:
# MYSQL_PWD=cat /etc/psa/.psa.shadow mysqldump -uadmin psa > /root/psa_backup.sql Run plesk repair db to fix the database inconsistency:
# plesk repair db -n
OR Proceed with the below steps: List all web users from the table web_users that are under the domain example.com :
MYSQL_LIN: select w.id, w.dom_id, w.sys_user_id from web_users as w join domains as d where d.id=w.dom_id and d.name='example.com'; +----+--------+-------------+| id | dom_id | sys_user_id |+----+--------+-------------+| 1 | 5 | 26 || 2 | 5 | 30 || 3 | 5 | 31 |+----+--------+-------------+ List all web users from the table sys_users that are under the domain example.com :
MYSQL_LIN: mysql> select id, login from sys_users where id in (select w.sys_user_id from web_users as w join domains as d where d.id=w.dom_id and d.name='example.com');+----+-----------+| id | login |+----+-----------+| 30 | web_user1 || 31 | web_user2 |+----+-----------+2 rows in set (0.00 sec) Check current web users in Plesk at Domains > example.com > Web Users - there are only two of them: web_user1 and web_user2. Remove the invalid record:
MYSQL_LIN: delete from web_users where id=1; Repair the website example.com :
# plesk repair web example.com Repairing web server configuration Repairing web server configuration for the domain example.com ........................................... [OK] Error messages: 0; Warnings: 0; Errors resolved: 0 "
8,"Mail tab is missing for all domains
Applicable to: Plesk 11.x for Linux
Plesk 12.0 for Linux
Plesk 12.5 for Linux Symptoms
The mail tab is not present in all domains menu. Due to this it is not possible to set up mail accounts and manage mail-related services. Cause
There could be two possible reasons: Mail service is disabled on the server
Mail service is not installed on the server Resolution Log into Plesk; If there is Mail Server settings in Tools & Settings menu, mail servers are installed: To enable it go to Tools & Settings > Mail > Mail Server Settings and enabling the option Enable mail management functions in Plesk: If the the Mail section looks similar to this, mail servers are not installed: Install mail components; "
9,"AWStats web statistics page does not work as expected
Applicable to: Plesk for Linux Symptoms One or several symptoms from listed below may be applicable: Web statistics page is not available for a domain:
PLESK_INFO: 404 Not FoundThe requested URL /plesk-stat/webstat/current/index.html was not found on this server. /usr/local/psa/admin/sbin/web_statistic_executor utility fails with the following error:
# /usr/local/psa/admin/sbin/web_statistic_executor --calculate-domain example.comStdout is forkExecvPipes: execv() failed: No such file or directory System error 2: No such file or directory The log will not be truncated because of errors above: /var/www/vhosts/system/example.com/logs/access_log.webstat Stat_ttl for the domain is 3. sh: /usr/share/awstats/awstats_buildstaticpages.pl: No such file or directory popen_exec: command failed code: 127 , error: none Unable to open Web Statistics page for a domain:
PLESK_ERROR: Error: Not same number of records of BrowsersSearchIDOrder (202 entries) and BrowsersHashIDLib (203 entries without firefox,opera,chrome,safari,konqueror,svn,msie,netscape) in Browsers database. May be you updated AWStats without updating browsers.pm file or you made changed into browsers.pm not correctly. Check your file /usr/share/awstats/lib/browsers.pm is up to date.Setup ('/usr/local/psa/etc/awstats/awstats.example.com-http.conf' file, web server or permissions) may be wrong. Check config file, permissions and AWStats documentation (in 'docs' directory). The file access_log.webstat does not get rotated and can consume a lot of disk space Several images on https://www.example.com/plesk-stat/webstat/ page are not loaded with 404 error AWStats was installed from a third-party repository:
On Debian-based:
# dpkg -l | grep awsii awstats 7.4+dfsg-1ubuntu0.3 all powerful and featureful web server log analyzer
On RHEL-based:
# rpm -qa | grep awsawstats-7.4-1.el7.noarch
# rpm -qi awstats-7.4-1.el7.noarch... Packager : Fedora Project Statistics are calculated hourly:
# grep awstats /var/log/cronrun-parts(/etc/cron.hourly)[20967]: starting awstats run-parts(/etc/cron.hourly)[21179]: finished awstats run-parts(/etc/cron.hourly)[24752]: starting awstats run-parts(/etc/cron.hourly)[25094]: finished awstats run-parts(/etc/cron.hourly)[25156]: starting awstats run-parts(/etc/cron.hourly)[25497]: finished awstats run-parts(/etc/cron.hourly)[25591]: starting awstats run-parts(/etc/cron.hourly)[25929]: finished awstats ...
# ls /etc/cron.hourly/ | grep awstatsawstats Cause
Third-party AWStats packages are not supported by Plesk.
Resolution
Re-install AWStats from Plesk repository: Connect to the server using SSH. Create a backup of AWStats configuration:
# mkdir awstats_backup# cp -r /etc/awstats/ awstats_backup Exclude awstat packages from all third-party repositories in /etc/yum.repos.d directory. Add the following line into the .repo files, and inside each repo block, for example:
# cat /etc/yum.repos.d/epel.repo... exclude=awstats* [epel-debuginfo] ... exclude=awstats* [epel-source] ... exclude=awstats* Remove AWStats package:
# yum remove awstats Install AWStats using Plesk installer:
# plesk installer Recalculate statistics using:
# /usr/local/psa/bin/sw-engine-pleskrun /usr/local/psa/admin/plib/DailyMaintainance/script.php -f ExecuteStatistics# /usr/local/psa/bin/sw-engine-pleskrun /usr/local/psa/admin/plib/DailyMaintainance/script.php -f ExecuteWebStatistics If webstat data for missing dates still not displayed, check the size of /var/www/vhosts/system/example.com/logs/access_log.webstat file:
# ls -l /var/www/vhosts/system/example.com/logs/access_log.webstat-rw-------. 1 root root 29960770 Jun 27 07:24 /var/www/vhosts/system/example.com/logs/access_log.webstat
If the size is not 0, follow instructions from the following article: Unable to open a web statistics page: 404 Not Found The requested document was not found on this server And repeat 6 step to recalculate statistics "
2,"Buttons like Subscriptions, Service Plans or Resellers are not shown in Plesk
Applicable to: Plesk for Linux
Plesk for Windows Symptoms In the Plesk interface, there are no buttons like Subscriptions, Service Plans or Resellers.
Web Pro or Web Host edition license is installed on the server. Power User view is used.
Reseller is unable to see available resources taken from the service plan. Cause
Plesk is in Power User View, which does not allow managing service plans, subscriptions, resellers, and customers.
Resolution Log into Plesk. Switch view to Service Provider view by clicking the button Change View at the bottom-left corner: Note: it is also possible to do that in CLI with the command plesk bin poweruser --off.
Additional Information
In case there is no option to change the view or the following error occurs on an attempt to switch view:
CONFIG_TEXT: Unable to switch to the Service Provider view due to license restrictions.
Then, this is the licensing or service provider limitations as described in the article Service provider view is unavailable"
4,"[BUG] Let's Encrypt auto renew is not working for domains or Plesk with renamed certificates
Applicable to: Plesk for Linux Symptoms Let's Encrypt auto-renew task is not working for Plesk or a domain. Plesk log /var/log/plesk/panel.log contains following entries with debug being enabled:
CONFIG_TEXT: INFO [extension/letsencrypt] Check if Panel or Mail Server is secured by Let's Encrypt certificate... INFO [extension/letsencrypt] Panel or Mail Server is not secured by Let's Encrypt certificate. The certificates on affected domains or Plesk itself were renamed previously. Cause
Let's Encrypt extension bug #EXTLETSENC-483, which is planned to be fixed in future product updates.
Let's Encrypt auto-renew feature relies on certificate names and does not recognize certificate names other than Lets Encrypt example.com.
Resolution
Until a fix became available, renew the certificate manually as workaround:
for securing Plesk: Log into Plesk.
Renew the certificate manually in Tools & Settings > SSL/TLS Certificates > + Let's Encrypt: for securing a particular domain: Log into Plesk.
Renew this certificate manually from Domains > example.com > SSL/TLS Certificates > Get it free. "
7,"How to install Mailman with Plesk
Applicable to: Plesk for Linux Question
How to install Mailman with Plesk? What version is recommended? Are there any other steps needed to configure Mailman?
Answer
Plesk uses Mailman version that comes with operating system.Mailman can be installed via Plesk GUI and command line.To install Mailman using Plesk GUI go to Tools & Settings > Updates and Upgrades > Add/Remove Components > Mail hosting section > Mailman > Continue.To install Mailman via command line execute below command:
CONFIG_TEXT: # /usr/local/psa/admin/bin/autoinstaller --select-release-current --install-component mailman
Check the following articles to find how to configure and manage Mailman: Plesk Administrator's Guide - Mailing Lists Plesk Administrator's Guide - Mailing Lists Management System "
2,"[BUG] Overuse policy does not apply to mailbox size if and only if ""Default"" mailbox size is specified
Applicable to:
Plesk Onyx for Linux
Symptoms Option Overuse policy is set to Overuse is allowed or Overuse of disk space and traffic is allowed in Plesk in Service Plans > example_plan > Resources.
In Service Plans > example_plan > Resources, Mailbox size is limited to some size, for example to 1GB.
Affected subscription example.com is assigned to Service Plan example_plan.
Email addresses from subscription example.com are set to Unlimited despite the fact that subscription example.com has a Mailbox size limit in its assigned Service Plan.
# plesk bin mail --info info@example.comMailname: infoDomain: example.comMbox quota: Unlimited Cause
This has been considered as a software issue with bug ID #PPPM-9140 that will be fixed in upcoming updates.
Resolution
Note: The overuse policy does not apply to the limits set on size of mailboxes. Therefore, even if you enable overuse, be sure to allocate enough disk space to mailboxes. See Plesk Official documentation for more information.
As a workaround, it is possible to apply Mailbox limit manually per mailbox: Log into Plesk. Navigate to Domains > example.com > Email Addresses > info@example.com > Another size, set a custom size, for example 1GB. Verify via CLI Mailbox size limit was applied correctly:
# plesk bin mail --info info@example.comMailname: infoDomain: example.comMbox quota: 1073741824 Solution for all mailboxes is available in spoiler below. Click here to see the additional information. Connect into the server via SSH Prepare a list with all mailboxes on the server:
# plesk bin mail --list > /root/all_mailboxes.txt Remove unnecessary characters from file /root/all_mailboxes.txt:
# sed -i 's/Mail name//' /root/all_mailboxes.txt If required, modify email addresses list from file /root/all_mailboxes.txt with a text editor.
Execute the following command to update Mailbox size for all mailboxes mentioned in the /root/all_mailboxes.txt file to 1GB:
# cat /root/all_mailboxes.txt | while read line; do plesk bin mail --update $line -mbox_quota 1G; done "
2,"How to increase FTP server timeouts on Plesk for Linux?
Applicable to: Plesk for Linux Question
How to configure timeouts for FTP server on Plesk for Linux?
Answer
1. Connect to the server via SSH;
2. Increase the following parameters in /etc/proftpd.conf using text editor. For example:
CONFIG_TEXT: TimeoutNoTransfer 2400 TimeoutStalled 2400 TimeoutIdle 3800
3. Apply new settings by restarting FTP service with the following command:
# service xinetd restart
Additional information
How to configure timeouts for FTP site on Windows? "
3,"Nginx/Apache are not running after server reboot on a Plesk server: service start operation timed out. Terminating
Applicable to: Plesk for Linux Nginx, Apache or other services do(es) not start automatically after a server reboot; Service(s) can be started manually without issues:
# service nginx start Starting nginx (via systemctl): [ OK ] Apache service is in failed status:
# service httpd status httpd.service - The Apache HTTP Server Loaded: loaded (/usr/lib/systemd/system/httpd.service; enabled; vendor preset: disabled) Drop-In: /usr/lib/systemd/system/httpd.service.d L-limit_nofile.conf Active: failed (Result: signal) since Thu 2017-07-22 13:44:27 CEST; 58s ago Process: 55266 ExecStart=/usr/sbin/httpd $OPTIONS -DFOREGROUND (code=killed, signal=KILL) Main PID: 55266 (code=killed, signal=KILL) ... systemd[1]: Starting The Apache HTTP Server... systemd[1]: httpd.service start operation timed out. Terminating . systemd[1]: httpd.service stop-final-sigterm timed out. Killing. \ The following can be found in journalctl:
# journalctl -u httpd.service -u nginx.service -b systemd[1]: Starting Startup script for nginx service... systemd[1]: Starting The Apache HTTP Server... ..... systemd[1]: httpd.service start operation timed out. Terminating. systemd[1]: nginx.service start-pre operation timed out. Terminating. Cause
Not sufficient timeout value for starting nginx or/and Apache.
Resolution
Note: This article may require additional administrative knowledge to apply. If any help required, contact server’s administrator or hosting support.
Add/increase TimeoutStartSec value in the [Service] section of Nginx or/and Apache init scripts: for CentOS/RedHat 7 Connect to the server using SSH; Backup a required init script using the command like:
# cp -a /usr/lib/systemd/system/httpd.service{,.bak}
# cp -a /usr/lib/systemd/system/nginx.service{,.bak} Open the init script with any text editor: For Apache: /usr/lib/systemd/system/httpd.service For nginx: /usr/lib/systemd/system/nginx.service Increase value for TimeoutStartSec parameter:
CONFIG_TEXT: [Service] ... TimeoutStartSec=600 for Debian 8/Ubuntu 16: Connect to the server using SSH; Backup a required init script using the command like:
# cp -a /usr/lib/systemd/system/apache2.service{,.bak}
# cp -a /usr/lib/systemd/system/nginx.service{,.bak} Open the init script with any text editor: For Apache: /usr/lib/systemd/system/apache2.service For nginx: /usr/lib/systemd/system/nginx.service Increase value for TimeoutStartSec parameter:
CONFIG_TEXT: [Service] ... TimeoutStartSec=600
Note: In case the apache2.service file does not exist, the TimeoutStartSec value should be set in the /lib/systemd/system/apache2.service.d/apache2-systemd.conf file for Debian9/Ubuntu18: Connect to the server via SSH; Backup the required init scripts with the commands:
# cp -a /lib/systemd/system/apache2.service{,.bak} # cp -a /lib/systemd/system/nginx.service{,.bak}
Note: The exact files can be found using:
# systemctl status apache2.service | grep loaded # systemctl status nginx.service | grep loaded Open the init script with any text editor (for example vi): For Apache: /lib/systemd/system/apache2.service For nginx: /lib/systemd/system/nginx.service Increase value for TimeoutStartSec parameter or set one if not set:
CONFIG_TEXT: [Service] ... TimeoutStartSec=600
Note: In case the apache2.service file does not exist, the TimeoutStartSec value should be set in the /lib/systemd/system/apache2.service.d/apache2-systemd.conf file Additional info
Nginx service does not started after server reboot
Apache does not start automatically after a server reboot on CentOS 7
After server reboot services can not be started: A timeout was reached (30000 milliseconds) on Windows
Nginx configuration test failed after server reboot"
8,"How to remove emails from the queue in Plesk
Applicable to: Plesk for Linux Question
How to remove emails from the queue in Plesk?
Answer
Note: The following commands will remove emails from mail queue, not send them. There are two ways of doing this:
Click on a section to expand Using Plesk interface Log into Plesk. Go to Tools & Settings > Mail Server Settings > Mail Queue > Clear Click on a section to expand From the server Connect to the server via SSH
Note: if direct SSH access to the server is not possible, contact server administrator for further assistance. Run the command:
# /usr/local/psa/admin/sbin/mailqueuemng --clean Additional information:
How to resend deferred emails in Plesk for Linux"
2,"[BUG] Unable to add a subscription user or open Plesk File Manager in Plesk for Windows with the error ""attempt to write a readonly database"" or ""no such table: ImpersonationUsers"" Applicable to: Plesk for Windows Symptoms It is not possible to create a subscription user or open Plesk File Manager with one of the following error messages in Plesk:
PLESK_ERROR: Error: System user update is failed: Unable to create system user: Unable to execute usermng: no such table: ImpersonationUsers (Error code 1)
OR
PLESK_ERROR: Error: System user update is failed: Unable to create system user: Unable to execute usermng: attempt to write a readonly database at execute console command --add(vconsoleapp::start line 93) at execute ""C:\Program Files (x86)\Parallels\Plesk\admin\bin\usermng"" --add ""--name=plesktest"" ""--password=*"" ""--home=C:/Inetpub/vhosts/example.com""(vconsoleapp::run line 110) (Error code 1) Manual synchronization of impersonation storage with the Plesk database may fail:
C:\> ""%plesk_cli%\repair.exe"" --synchronize-impersonation-storage usermng failed: attempt to write a readonly database at execute console command --sync-impersonation-cache(vconsoleapp::start line 93) at execute ""C:\Program Files (x86)\Parallels\Plesk\admin\bin\usermng"" --sync- impersonation-cache ""--config=usrC195.tmp""(vconsoleapp::run line 110) (Error code 1) Migration may fail with one of the mentioned errors. Cause
The impersonation storage file is missing or corrupted. Plesk bug #PPPM-11384.
Resolution Connect to the Plesk server via RDP. Download the empty database scheme. Go to %plesk_dir%admin\db (just paste this path in Windows Explorer to open) and create a copy of the original ImpersonationCache.db file. Replace the original ImpersonationCache.db file with the downloaded. Start a command prompt as an Administrator and run the following command to sync impersonation storage with the Plesk database:
C:\> ""%plesk_cli%\\repair.exe"" --synchronize-impersonation-storage "
8,"Unable to send mail via SSL: warning: TLS library problem: 31990 Applicable to: Plesk for Linux Symptoms Unable to connect mail client on SMTPS port 465/993 SSL/TLS connection. Mail client displays the error:
Your server has unexpectedly terminated the connection. Possible causes for this include server problems, network problems, or a long period of inactivity. Account: 'my email', Server: '3.4.5.6', Protocol: SMTP, Port: 465, Secure(SSL): Yes, Error Number: 0x800CCC0F Following error message is present in /usr/local/psa/var/log/maillog:
postfix/smtpd[31990]: warning: TLS library problem: 31990:error:14094418:SSL routines:SSL3_READ_BYTES:tlsv1 alert unknown ca:s3_pkt.c:1197:SSL alert number 48: postfix/smtpd[31990]: lost connection after CONNECT from unknown[1.2.3.4] postfix/smtpd[31990]: disconnect from unknown[1.2.3.4] Mail client displays the following error:
Your server has unexpectedly terminated the connection. Possible causes for this include server problems, network problems, or a long period of inactivity. Account: 'my email', Server: '3.4.5.6', Protocol: SMTP, Port: 465, Secure(SSL): Yes, Error Number: 0x800CCC0F Cause
SSL CA certificates bundle is missing or corrupted.
Resolution Install a valid certificate using the article Plesk following the instructions here: How to secure mail server with Let's Encrypt certificate Connect to the server via SSH. Run the following command:
# plesk repair mail In case this issue still persists, reinstall ca-certificates package.
For example, for CentOS 6:
# rpm -Uhv ca-certificates-2010.63-3.el6_1.5.noarch "
8,"TLS encryption in Plesk with Postfix 2.8 and higher
Applicable to: Plesk for Linux Symptoms
When Postfix 2.8 or higher on submission port 587 is used as mail server some mail messages cannot be delivered to the server due to the fact that sender does not use TLS encryption and uses, for example, STARTTLS.
Cause
Since submission port is always required to be encrypted, in Plesk with Postfix 2.8 and higher versions, smtpd_tls_security_level is set to encrypt, which forces TLS encryption when communicating with the mail server. It was done to correspond with security protocol requirements. Resolution
Functionality when TLS encryption on port 587 is optional is not yet implemented in Plesk. Take part in our product improvement and vote for this feature on Plesk User Voice portal.
As workaround proceed with the following: Connect to the server via SSH Open /etc/postfix/master.cf file in any text editor and change these lines from:
CONFIG_TEXT: submission inet n - n - - smtpd -o smtpd_enforce_tls=yes -o smtpd_tls_security_level=encrypt -o smtpd_sasl_auth_enable=yes -o smtpd_client_restrictions=permit_sasl_authenticated,reject -o smtpd_sender_restrictions=
to
CONFIG_TEXT: submission inet n - n - - smtpd -o smtpd_enforce_tls=yes -o smtpd_tls_security_level=may -o smtpd_sasl_auth_enable=yes -o smtpd_client_restrictions=permit_sasl_authenticated,reject -o smtpd_sender_restrictions= NOTE: These changes may be overwritten by any Plesk update. "
3,"How to enable or disable additional PHP version available in Plesk?
Applicable to: Plesk for Linux
Plesk for Windows Question
How to enable/disable additional PHP version available in Plesk?
Answer
PHP 5.2 version and earlier are available via Plesk installer.
Note: The most recent ones depend on the Plesk version in use.
In order to enable an additional PHP version, perform the following: Install the desired PHP version according to this article: How to install/remove additional PHP versions provided by Plesk Log into Plesk;
Go to Tools & Setting > PHP Settings;
Enable the desired PHP version: To disable the desired PHP version: The same can be achieved via Command Line Interface: Plesk for Linux Connect to the server via SSH;
Check the list of available PHP handlers for installation:
# plesk installer --select-release-current --show-components | grep PHP Detecting installed product components. php7.4 [upgrade] - PHP 7.4 php7.3 [upgrade] - PHP 7.3 php7.2 [install] - PHP 7.2 php7.1 [install] - PHP 7.1 php7.0 [install] - PHP 7.0 php5.6 [install] - PHP 5.6 php5.5 [install] - PHP 5.5 php5.4 [install] - PHP 5.4 php5.3 [install] - PHP 5.3 php5.2 [install] - PHP 5.2 phpgroup [install] - PHP 5 from OS vendor Install the desired PHP version. For example, for PHP 7.2:
# plesk installer --select-release-current --install-component php7.2 Check the list of installed handlers and enable the required with the plesk bin php_handler --list command. An excerpt from its output is shown below, with the disabled PHP handlers highlighted: Enable the desired PHP version/handler by passing its id, taken from the previous step. For example:
# plesk bin php_handler --enable -id plesk-php72-cgi To disable the desired PHP version/handler:
# plesk bin php_handler --disable -id plesk-php72-cgi Note: in order to add custom PHP handler, refer to Plesk documentation. Plesk for Windows Connect to the server via RDP;
Open CMD;
Check the list of available PHP handlers for installation:
C:\> plesk installer --select-release-current --show-components | findstr PHP ... php5 [install] - PHP 5.2 script engine (outdated) php53 [install] - PHP 5.3 script engine (outdated) php54 [install] - PHP 5.4 script engine (outdated) php55 [install] - PHP 5.5 script engine (outdated) php56 [up2date] - PHP 5.6 script engine php70 [up2date] - PHP 7.0 script engine php71 [up2date] - PHP 7.1 script engine php72 [install] - PHP 7.2 script engine php73 [install] - PHP 7.3 script engine php74 [install] - PHP 7.4 script engine Install the desired PHP version. For example, for PHP 7.2:
C:\> plesk installer --select-release-current --install-component php72 Check the list of installed handlers and enable the required with the plesk bin php_handler --list command. An excerpt from its output is shown below, with the disabled PHP handlers highlighted: Enable the desired PHP version/handler by passing its id, taken from the previous step. For example:
C:\> plesk bin php_handler --enable -id cgi-7.2 To disable the desired PHP version/handler:
C:\> plesk bin php_handler --disable -id cgi-7.2 "
3,"The incorrect SSL certificate is shown for a domain
Applicable to: Plesk Onyx for Linux Symptoms The SSL certificate is set in Domains > example.com > Hosting Settings.
In an attempt to access example.com another SSL certificate is shown.
The 203.0.113.2 IP address is set in Domains > example.com > Web Hosting Access > IP address,
Globally example.com website resolves to the 203.0.113.3 IP address:
# dig +short example.com 203.0.113.3 Cause
Incorrect A record is set for the example.com domain on a DNS Registrar side.
Resolution
Contact DNS Registrar with the request to change A record of the example.com from 203.0.113.3 to 203.0.113.2 IP address.
Note: the process of DNS propagation can take up to 48 hours. "
8,"Unable to send emails from Plesk Server: Temporary lookup failure
Applicable to:
Plesk for Linux
Symptoms It is not possible to send mails from the Plesk Server In logfile /var/log/maillog the following records are found:
CONFIG_TEXT: Jan 20 16:47:45 test_vm postfix/trivial-rewrite[5708]: warning: transport_maps lookup failure Jan 20 16:47:45 test_vm postfix/trivial-rewrite[5708]: warning: hash:/var/spool/postfix/plesk/transport is unavailable. open database /var/spool/postfix/plesk/transport.db: Invalid argument Jan 20 16:47:45 test_vm postfix/trivial-rewrite[5708]: warning: hash:/var/spool/postfix/plesk/transport lookup error for ""jdoe@example2.com"" Jan 20 16:47:45 test_vm postfix/trivial-rewrite[5708]: warning: transport_maps lookup failure Jan 20 16:47:45 test_vm postfix/smtpd[5877]: NOQUEUE: reject: RCPT from localhost[127.0.0.1]: 451 4.3.0 mailbox@example.com: Temporary lookup failure; from=mailbox@example.com to=jdoe@example2.com proto=ESMTP helo=<testserver.test> Cause
Corrupted Postfix package.
Resolution Connect to the server via SSH Backup Postfix configuration files:
# mv /etc/postfix/main.cf /root/main.cf.saved # mv /etc/postfix/master.cf /root/master.cf.saved Switch Mail Transfer Agent(MTA) from Postfix to Qmail and back to Postfix that is described in [How to] How to define which MTA is used in Plesk and how to switch from QMail to Postfix and back Restore mail configuration:
# /usr/local/psa/admin/sbin/mchk --with-spam "
7,"The Python support is missed in domain Hosting Settings page on CentOS 7/RHEL 7/CloudLinux 7 OS
Applicable to: Plesk for Linux Symptoms
The Python support option is missing in Plesk > Domains > example.com > Hosting Settings, as result, it is not possible to execute Python scripts on a server with CentOS 7/RHEL 7/CloudLinux 7 OS. Cause
Python modules for Apache are no longer supported by httpd project according to the Apache official website.
Resolution
Note: since python officially is not supported by CentOS 7/RHEL 7/CloudLinux 7 OS, we cannot guarantee the stability of the workaround below. Log into the server via SSH. Install mod_python from third-party resource:
# wget http://repo.iotti.biz/CentOS/7/noarch/lux-release-7-1.noarch.rpm # rpm -Uvh lux-release*rpm # yum install mod_python -y Restart the Apache service:
# service httpd restart Log into Plesk. Refresh Plesk components by pressing the Refresh button in Tools & Settings > Server Components. Enable the Python support checkbox in Service Plans > Hosting Plans > ServicePlanName > Hosting Settings. Scroll down and press the Update & Sync button. Enable the Python support checkbox in Domains > example.com > Hosting Settings. Scroll down and press the OK button to apply the changes.
"
5,"Unable to start Plesk migration: Failed to fetch basic information about resellers, clients and domains data from source servers
Applicable to: Plesk for Linux Symptoms Unable to start migration with one of the following error messages:
PLESK_ERROR: Unable to login to the source server 'source' (203.0.113.2) by SSH service: administrator login and/or password are not correct. Set valid SSH credentials for the server and click ""Prepare migration"". PLESK_ERROR: SSH connection to the source server can not be used: there is unexpected output when executing commands. Migration fails with one of the following error messages:
PLESK_ERROR: Cannot request remote agent status using command line PLESK_ERROR: Failed to fetch basic information about resellers, clients and domains data from source servers. Cause: Command execution failed on the local server with non-zero exit code. Cause
Plesk Migrator cannot log in to the source server using SSH key.
Resolution Connect to the source server via SSH.
Note: if direct SSH access to the server is not possible, contact server administrator for further assistance. Open the /etc/ssh/sshd_config file in a text editor. In this example, we are using the vi editor:
# vi /etc/ssh/sshd_config Set the PermitRootLogin and PasswordAuthentication settings to 'yes' and remove '#' at the beginning of each line as shown below:
CONFIG_TEXT: PermitRootLogin yes PasswordAuthentication yes Save the changes and close the file. Restart the SSH service:
# service sshd restart
Note: If you doubt that the root password is correct, reset it with the command 'passwd'. Restart migration. Additional Information
To migrate with a non-root user, visit: Migrating From a Linux Server With Custom Hosting - Plesk Migration Guide To learn more about Plesk migration, visit: Migrating via the Plesk Interface - Plesk Migration Guide "
3,"Unable to reconfigure domain: Invalid argument supplied for foreach()
Applicable to: Plesk for Linux
Plesk for Windows Symptoms It is not possible to reconfigure a domain:
# /usr/local/psa/admin/sbin/httpdmng --reconfigure-domain example.com PHP Warning: syntax error, unexpected '""' in Unknown on line 8 ; File: /usr/local/psa/admin/plib/Db/Table/Row/PhpSettings.php, Line: 191 file: /usr/local/psa/admin/smb/application/library/Smb/Exception/Syntax.php line: 55 code: 0 PHP Warning: Invalid argument supplied for foreach(); File: /usr/local/psa/admin/plib/Db/Table/Row/PhpSettings.php, Line: 475 Exception: PHP Warning: Invalid argument supplied for foreach(); File: /usr/local/psa/admin/plib/Db/Table/Row/PhpSettings.php, Line: 475
OR
# /usr/local/psa/admin/sbin/httpdmng --reconfigure-domain example.com ERR [1] PHP Warning: syntax error, unexpected '""' in Unknown on line 4 ; File: /usr/local/psa/admin/plib/Db/Table/Row/PhpSettings.php, Line: 280 PHP Warning: Invalid argument supplied for foreach(); File: /usr/local/psa/admin/plib/api-rpc/AgentHosting.php, Line: 855 ERR [1] PHP Warning: Invalid argument supplied for foreach(); File: /usr/local/psa/admin/plib/api-rpc/AgentHosting.php, Line: 855 Attempts to add a sub-domain fail with a similar error:
PLESK_ERROR: Error: phpinimng failed: Cannot parse php.ini: (, PhpIniSyntaxError('[:16] Invalid configuration line. Are there excessive leading spaces?',)) Cause
Incorrect INI syntax in PHP Settings > Additional Directives for a domain.
Resolution
Remove additional PHP directives: Log into Plesk Navigate to Domains > example.com > PHP Settings Remove custom configuration from the Additional configuration directives field "
3,"Apache fails to start after disabling SSLv3
Applicable to:
Plesk for Linux
Symptoms After manually disabling SSLv3 Apache fails to start:
CONFIG_TEXT: /etc/init.d/httpd start Actual result that you got : [Failed] The following error found in apache error log /var/log/httpd/error_log :
CONFIG_TEXT: [notice] suEXEC mechanism enabled (wrapper: /usr/sbin/suexec) [notice] suEXEC mechanism enabled (wrapper: /usr/sbin/suexec) Strace output contains:
# strace -tvfs4096 /etc/init.d/httpd start ... [pid 22542] 11:00:43 write(10, ""[Fri Oct 09 11:00:43 2015] [error] Unable to configure permitted SSL ciphers\"", 77) = 77 [pid 22542] 11:00:43 write(10, ""[Fri Oct 09 11:00:43 2015] [error] SSL Library Error: 336486680 error:140E6118:SSL routines:SSL_CIPHER_PROCESS_RULESTR:invalid command\"", 135) = 135 ... Cause
Missing SSLCipherSuite variable in /etc/httpd/conf.d/ssl.conf and /etc/httpd/conf/httpd.conf file.
Resolution Connect to the server via SSH. Check apache configuration file and make sure the records bellow are present:
# grep SSLCipherSuite /etc/httpd/conf.d/ssl.conf SSLCipherSuite ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-AES256-GCM-SHA384:DHE-RSA-AES128-GCM-SHA256:DHE-DSS-AES128-GCM-SHA256:kEDH+AESGCM:ECDHE-RSA-AES128-SHA256:ECDHE-ECDSA-AES128-SHA256:ECDHE-RSA-AES128-SHA:ECDHE-ECDSA-AES128-SHA:ECDHE-RSA-AES256-SHA384:ECDHE-ECDSA-AES256-SHA384:ECDHE-RSA-AES256-SHA:ECDHE-ECDSA-AES256-SHA:DHE-RSA-AES128-SHA256:DHE-RSA-AES128-SHA:DHE-DSS-AES128-SHA256:DHE-RSA-AES256-SHA256:DHE-DSS-AES256-SHA:DHE-RSA-AES256-SHA:AES128-GCM-SHA256:AES256-GCM-SHA384:AES128-SHA256:AES256-SHA256:AES128-SHA:AES256-SHA:AES:CAMELLIA:DES-CBC3-SHA:!aNULL:!eNULL:!EXPORT:!DES:!RC4:!MD5:!PSK:!aECDH:!EDH-DSS-DES-CBC3-SHA:!EDH-RSA-DES-CBC3-SHA:!KRB5-DES-CBC3-SHA
# grep SSLCipherSuite /etc/httpd/conf/httpd.conf SSLCipherSuite EECDH+AES128:RSA+AES128:EECDH+AES256:RSA+AES256:EECDH+ "
2,"How to set another default PHP version for new subscriptions in Plesk?
Applicable to: Plesk for Linux
Plesk for Windows Question
Currently, new domains are being created with an unwanted PHP version. How to set another default PHP version for new subscriptions? How to change the default PHP version/handler assigned for newly created service plans? Answer
Plesk Change the PHP version for one existing subscription: Log into Plesk. Go to Subscriptions > example.com > Websites & Domains > Hosting Settings > PHP version. Now select the wanted PHP Version, for example, 7.2.11, then scroll down and press OK: Change the PHP version for all newly created Subscriptions using some Service Plan: Note: This method will also change the PHP Versions of existing subscriptions if the Common PHP settings management permission is not set. Log into Plesk. Go to Service Plans select the wanted Service Plan, for example, Unlimited and select the tab PHP Settings. Now select the wanted PHP Version, for example, 7.2.11, then scroll down and press OK: Note: The steps have to be repeated for each Service Plan, in which the PHP Handler should be updated. Change the PHP version for all newly created Service Plans: This functionality is yet to be implemented in Plesk.
However, a corresponding request already exists on Plesk User Voice. Leave a vote there - top-ranked suggestions are likely to be included in next versions of Plesk.
As a workaround it is possible to create 2 event handlers (for service plans created by the administrator and by resellers), which will setup wanted PHP version and handler for future service plans: In Plesk go to Tools & Settings > Event Manager and click Add Event Handler Select the event Service plan of administrator created and paste the command below to the Command field:
CONFIG_TEXT:/usr/local/psa/bin/service_plan -u ""$(plesk db -Ne'select name from Templates ORDER BY id DESC LIMIT 1;')"" -owner $(plesk db -Ne'select login from clients where id = (select owner_id from Templates ORDER BY id DESC LIMIT 1);') -php_handler_id plesk-php71-fpm Create an additional event handler for Service plan of reseller created and paste the command below to the Command field:
CONFIG_TEXT:/usr/local/psa/bin/service_plan -u ""$(plesk db -Ne'select name from Templates ORDER BY id DESC LIMIT 1;')"" -owner ""$(plesk db -Ne'select login from clients where id = (select owner_id from Templates ORDER BY id DESC LIMIT 1);')"" -php_handler_id plesk-php71-fpm
Note: Instead of plesk-php71-fpm it is possible to use a different PHP handler, which is displayed in the PHP Handler list, which can be viewed by following the steps in Retrieve the PHP Handler table Note: It might be possible, that Plesk does not allow managing service plans via the web interface, this can be the case for example for Web Admin Edition or Web App Edition, it is possible to manage them via command line utilities, as described below.
Command Line Retrieve the PHP Handler table: Connect to the server via SSH. Retrieve the PHP Handler table:
# [root@host ~]# plesk bin php_handler --list id: display name: full version: version: type: cgi-bin: php-cli: php.ini: custom: status: cgi 5.4.16 by OS vendor 5.4.16 5.4 cgi /usr/bin/php-cgi /usr/bin/php /etc/php.ini false disabled fastcgi 5.4.16 by OS vendor 5.4.16 5.4 fastcgi /usr/bin/php-cgi /usr/bin/php /etc/php.ini false enabled fpm 5.4.16 by OS vendor 5.4.16 5.4 fpm /usr/sbin/php-fpm /usr/bin/php /etc/php.ini false enabled plesk-php56-cgi 5.6.38 5.6.38 5.6 cgi /opt/plesk/php/5.6/bin/php-cgi /opt/plesk/php/5.6/bin/php /opt/plesk/php/5.6/etc/php.ini true disabled plesk-php56-fastcgi 5.6.38 5.6.38 5.6 fastcgi /opt/plesk/php/5.6/bin/php-cgi /opt/plesk/php/5.6/bin/php /opt/plesk/php/5.6/etc/php.ini true disabled plesk-php56-fpm 5.6.38 5.6.38 5.6 fpm /opt/plesk/php/5.6/sbin/php-fpm /opt/plesk/php/5.6/bin/php /opt/plesk/php/5.6/etc/php.ini true disabled plesk-php70-cgi 7.0.32 7.0.32 7.0 cgi /opt/plesk/php/7.0/bin/php-cgi /opt/plesk/php/7.0/bin/php /opt/plesk/php/7.0/etc/php.ini true disabled plesk-php70-fastcgi 7.0.32 7.0.32 7.0 fastcgi /opt/plesk/php/7.0/bin/php-cgi /opt/plesk/php/7.0/bin/php /opt/plesk/php/7.0/etc/php.ini true disabled plesk-php70-fpm 7.0.32 7.0.32 7.0 fpm /opt/plesk/php/7.0/sbin/php-fpm /opt/plesk/php/7.0/bin/php /opt/plesk/php/7.0/etc/php.ini true disabled plesk-php71-cgi 7.1.23 7.1.23 7.1 cgi /opt/plesk/php/7.1/bin/php-cgi /opt/plesk/php/7.1/bin/php /opt/plesk/php/7.1/etc/php.ini true disabled plesk-php71-fastcgi 7.1.23 7.1.23 7.1 fastcgi /opt/plesk/php/7.1/bin/php-cgi /opt/plesk/php/7.1/bin/php /opt/plesk/php/7.1/etc/php.ini true disabled plesk-php71-fpm 7.1.23 7.1.23 7.1 fpm /opt/plesk/php/7.1/sbin/php-fpm /opt/plesk/php/7.1/bin/php /opt/plesk/php/7.1/etc/php.ini true enabled plesk-php72-cgi 7.2.11 7.2.11 7.2 cgi /opt/plesk/php/7.2/bin/php-cgi /opt/plesk/php/7.2/bin/php /opt/plesk/php/7.2/etc/php.ini true disabled plesk-php72-fastcgi 7.2.11 7.2.11 7.2 fastcgi /opt/plesk/php/7.2/bin/php-cgi /opt/plesk/php/7.2/bin/php /opt/plesk/php/7.2/etc/php.ini true disabled plesk-php72-fpm 7.2.11 7.2.11 7.2 fpm /opt/plesk/php/7.2/sbin/php-fpm /opt/plesk/php/7.2/bin/php /opt/plesk/php/7.2/etc/php.ini true enabled
Note: These PHP handler ids may vary on your server, thus it is advised to check. Change the default PHP version for all newly created Subscriptions using some Service Plan: Connect to the server via SSH. Change the PHP handler for the Unlimited service plan.
# plesk bin service_plan -u ""Unlimited"" -php_handler_id plesk-php70-fpm The hosting plan 'Unlimited' was successfully updated.
If the service plan belongs to a receller, specify the receller's name in the -owner option:
# plesk bin service_plan -u ""Unlimited"" -php_handler_id -owner ""reseller"" plesk-php70-fpm The hosting plan 'Unlimited' was successfully updated. Additional information
How to change the default PHP version/handler assigned for newly created service plans?"
0,"Hardware changes are not reflected/updated in the Plesk Health Monitor
Applicable to: Plesk for Linux
Plesk for Windows Symptoms
Hardware changes are not reflected/updated in the Plesk Health Monitor after applying the following actions: adding a new hard drive
increasing disk space
allocating additional RAM and Swap
replacing the CPU with a more powerful one Cause
This behavior is expected: New hardware configuration values are not automatically re-calculated by Health Monitor. For more information, visit: Plesk Documentation: Updating Health Parameters After Hardware Change Resolution
Note: If a cloud server is running, resize the filesystem after increasing space from the management console: - Adding or resizing zonal persistent disks | Compute Engine Documentation | Google Cloud - Extending a Linux File System After Resizing a Volume - Amazon Elastic Compute Cloud Update system information manually:
In Plesk, go to Health Monitoring and click Detect Hardware Changes. Related Articles How to install Plesk Health Monitor
"
8,"Outgoing mail control does not work in Plesk: Unable to execute mailmng-outgoing: no such table
Applicable to: Plesk Onyx Symptoms When accessing Tools & Settings > Outgoing Mail Control page the following error appears:
PLESK_ERROR: Error: Unable to execute mailmng-outgoing: no such table: OutgoingMessages at execute console command --get-outgoing-messages-domains-stat(vconsoleapp::start line 100) at execute %plesk_dir%\admin\bin\mailmng.exe --get-outgoing-messages-domains-stat ""--stat-time=2016-07-25 08:00""(vconsoleapp::run line 117) (Error code 1) Cannot create a new mail account under a subscription; the account is created, but without a mailbox:
PLESK_ERROR: Error: mailmng-outgoing failed: ERROR:outgoing:mails.domain_id may not be NULL Outgoing mail does not work for one or several domains: PHP scripts may not work, Roundcube webmail returns the following error:
CONFIG_TEXT: SMTP Error (250): Authentication failed Plesk displays the error below when trying to add a new domain:
PLESK_ERROR: Error: mailmng-outgoing failed: ERROR:outgoing:database disk image is malformed The size of the database %plesk_dir%\admin\db\OutgoingMessages.db might equal 0 on Windows based servers. Cause
The outgoing mail database is corrupted.
Resolution For Linux: Connect to the server via SSH. Rename the database:
# mv /var/lib/plesk/mail/outgoing/data.db{,.bak} Rebuild it:
# /usr/lib64/plesk-9.0/remote_mail_restore/mail_outgoing_restore If the domain was was added in the initial attempt - delete it. Add the domain again. For Windows: Connect to the server via RDP. Delete or rename the corrupted database: %plesk_dir%admin\db\OutgoingMessages.db. Run the command to rebuild it:
C:\> ""%plesk_dir%\admin\bin\mailmng.exe"" --init-outgoing-messages-storage "
3,"Unable to open any domain with enabled nginx on Plesk because Apache is not running
Applicable to: Plesk for Linux Symptoms Unable to browse any domain hosted on the Plesk server. The browser displays this error:
CONFIG_TEXT: 502 Bad Gateway Nginx reverse proxy is enabled in Tools & Settings > Services Management. Nginx service is running. Apache is not running: Cause
Apache service is stopped on the server.
Resolution
Click on a section to expand Via Plesk GUI Log in to Plesk GUI Go to Tools & Settings > Services Management > Apache Web Server > Start. If the issue remains the same (or sites are not working with the different error message), go to Extensions > My Extensions > Webserver Configuration Troubleshooter and Rebuild All configuration files: Via command-line interface Connect to the server via SSH Start Apache Web Server: For CentOS based:
# service httpd start For Debian based:
# service apache2 start If the issue remains the same (or sites are not working with the different error message), execute the following command:
# plesk repair web -y "
3,"Website in Plesk shows 503 Service Unavailable: An account failed to log on
Applicable to: Plesk for Windows Symptoms Website is inaccessible with the following error:
CONFIG_TEXT: 503 Service Unavailable Application pool of a website is stopped.
Test Connection in IIS > Sites > example.com > Basic Settings > Test Settings... shows:
CONFIG_TEXT: The user name or password is incorrect. (Exception from HRESULT: 0x8007052E) The credentials used to access the specified physical path are invalid. Verify the credentials and test these settings again. The following ""Audit Failure"" message can be found in Event Viewer > Windows Logs > Security:
CONFIG_TEXT: Account For Which Logon Failed: Security ID: NULL SID Account Name: IWPD_1(john_doe) Account Domain: Failure Information: Failure Reason: Unknown user name or bad password. The following errors can be found in Event Viewer:
CONFIG_TEXT: Application pool example.com(domain)(4.0)(pool) has been disabled. Windows Process Activation Service (WAS) encountered a failure when it started a worker process to serve the application pool. The identity of application pool example.com(domain)(4.0)(pool) is invalid. The user name or password that is specified for the identity may be incorrect, or the user may not have batch logon rights. If the identity is not corrected, the application pool will be disabled when the application pool receives its first request. Cause Misconfiguration of application pool user
Resolution Connect to the server via RDP as Administrator;
Go to Control Panel > Administrative Tools > Computer Management > Local Users and Gropus > Users and find a user from the error in the list. Filter the log as follows to find it faster: Click the right button on the username and choose Set Password..., then click Proceed and set up a new password.
Go to IIS > hostname > Application Pools. Find Application pool of a website, select it and click on Advanced Setting... button: Find an Identity property, click on ... button: In appeared window click Set and enter the same username and password specified in step 3. Close all windows by clicking OK;
Start Application Pool with Start button.
"
8,"How to configure SpamAssassin for Plesk server
Applicable to: Plesk for Linux Question
How to configure SpamAssassin?
Answer
In order to manage spam messages using SpamAssassin configure it as follow:Go to Plesk > Tools & Settings > Spam Filter and select server-wide/individual settings for Spam filter using option Apply individual settings to spam filtering If ""Apply individual settings to spam filtering"" option is disabled Settings will be applied server-wide The maximum number of worker spamd processes to run Set the maximum number of worker spamd processes to run (1-5). We recommend that you use the default value. The score that a message must receive to qualify as spamBy default, the filter sensitivity is set so that all messages that score 7 or more points are classified as spam. If users still receive spam messages with the default sensitivity, increase it by setting a lesser value, for example, 6. If SpamAssassin marks valid messages as spam, decrease the sensitivity by setting a higher value, e.g. 8. Add the following text to the beginning of subject of each message recognized as spamSpecify how to mark messages recognized as spam. If it is not required to modify messages subject, leave this box blank. If it is required to include into the subject line the number of points that messages score, type SCORE in this box: If ""Apply individual settings to spam filtering"" option is enabled SpamAssassin settings can be set for each mailbox. To apply them go to Domains > example.com > Email Addresses > john.doe@example.com > Spam Filter. Switch on spam filtering for this email addressTurn on using the SpamAssassin on this mailbox. What to do with messages classified as spam Allow to select one of three available options:Mark spam messages by adding the following text to message subjectIf it is not required to modify messages subject, leave this box blank. If it is required to include into the subject line the number of points that messages score, type SCORE in this box.Delete all spam messagesSpam messages will be deleted from the mailbox.Move spam to the Spam folderMove all spam messages to the folder called Spam. This folder is accessible from your mail client program or webmail. If an IMAP mail account is used, the Spam folder can be used for training the spam filter. Spam filter sensitivity By default, the filter sensitivity is set so that all messages that score 7 or more points are classified as spam. If users still receive spam messages with the default sensitivity, increase it by setting a lesser value, for example, 6. If SpamAssassin marks valid messages as spam, decrease the sensitivity by setting a higher value, e.g. 8. White ListEmail messages coming from senders in the white list are not checked by the spam filter. Black ListEmail messages coming from senders in the black list are blocked. "
0,"Access to the path is denied error is shown when access .aspx file on Plesk for Windows
Applicable to:
Plesk for Windows Symptoms
Attempt to access http://example.com/testfolder/test.aspx produces the error:
CONFIG_TEXT: Access to the path %plesk_vhosts%example.com\httpdocs\testfolder is denied
Cause
Required system user and/or permissions are not configured properly for the directory %plesk_vhosts%example.com\httpdocs\testfolder in Plesk.
Resolution Connect to the server via RDP.
Repair permissions for the virtual host directory for example.com domain according to this article. If previous steps does not help, set required permissions for subfolder manually: Log in to Plesk.
Go to Domains > example.com > Virtual Directory > testfolder > Directory Access Permissions and verify that all the necessary users have enough rights. As a default it looks like on the picture below: Note: It is possible to compare permissions with the one that can be accessed without any issues or with one created anew
If application pool group is missing and it is not possible to add it via Plesk, add it directly on the file system using Windows functionality. The name of the pool group should be IWPG_<sys_user>, where <sys_user> should be replaced with actual system user of the subscription.
"
7," How to install Plesk updates Applicable to: Plesk for Linux
Plesk for Windows Question
How to install Plesk updates?
Answer
Note: For upgrading Plesk to the next release, see the KB article How to upgrade Plesk to the next release.
By default, Plesk installs updates automatically be means of the Plesk daily task (executed every night), if the option Automatically install Plesk updates is enabled at Tools & Settings > Update and Upgrade Settings. To update Plesk and its components manually, see instructions below. This procedure can be done either via the Plesk interface or a command-line interface directly on a Plesk server.
During the update process: Plesk may go offline for several minutes, if updates require a Plesk restart Websites will stay online
Note: If a service component is going to be updated, its service will be restarted. Table of Contents Updating Plesk via the Plesk interface
Updating Plesk via a command-line interface
What Plesk update is currently installed on the system? Updating Plesk via the Plesk interface Note: Make sure that port 8447 is opened in a firewall. If it is closed and cannot be opened for some reason, use the command-line instructions. In Plesk, go to Tools & Settings and click Updates and Upgrades. On the Updates and Upgrades page, click Update Components. Click Continue to begin the update procedure. Updating Plesk via a command-line interface Connect to a Plesk server via SSH/RDP. Run Plesk Installer (on Windows Server use a command prompt as an Administrator): Plesk Onyx for Linux and Windows
MYSQL_LIN: plesk installer update Plesk 12.5 for Linux and Windows
MYSQL_LIN: plesk installer --select-release-current --reinstall-patch --upgrade-installed-components Plesk 11.x and 12.0 for Linux
# /usr/local/psa/admin/sbin/autoinstaller --select-product-id plesk --select-release-current --reinstall-patch --install-component panel Plesk 11.x and 12.0 for Windows
C:\> ""%plesk_bin%\ai.exe"" --console --select-product-id panel --select-release-current --reinstall-patch --install-component panel What Plesk update is currently installed on the system?
This information can be found in Plesk on the Home page > System Overview.
Alternatively, execute the following command in a command-line interface:
MYSQL_LIN: plesk version Related Articles How to upgrade Plesk to the next release
How to reinstall Plesk micro-updates (MU)
"
7,"Plesk upgrade/installation/migration fails: Access denied for user 'admin'@'localhost'
Applicable to: Plesk Onyx for Linux
Plesk for Linux Symptoms Plesk upgrade or installation fails with one of the following errors in /tmp/autoinstaller3.log :
CONFIG_TEXT: Access denied for user 'admin'@'localhost' (using password: YES)
CONFIG_TEXT: Access denied for user 'horde'@'localhost' (using password: YES)
CONFIG_TEXT: Access denied for user 'pp_sb_db'@'localhost' (using password: yes)
CONFIG_TEXT: EMERGENCY: The file /root/.my.cnf contains a password for the MySQL console client. Please remove this file temporarily and restore it after the upgrade, otherwise the upgrade will fail.
Note: this may also appear as a warning during the pre upgrade checker: Migration fails with the following error:
CONFIG_TEXT: Error: Failed to generate migration list file Cause: Command execution failed on the local server with non-zero exit code. command: MYSQL_PWD=""$(cat /etc/psa/.psa.shadow)"" mysql --silent --skip-column-names -u admin psa -e 'SHOW VARIABLES LIKE '""'""'socket'""'""'' exit code: 1 stdout: stderr: ERROR 1045 (28000): Access denied for user 'admin'@'localhost' (using password: YES) Attempt to connect to Plesk database fails:
# MYSQL_PWD=`cat /etc/psa/.psa.shadow` mysql -u admin psa ERROR 1045 (28000): Access denied for user 'admin'@'localhost' (using password: YES) There is a /root/.my.cnf or /etc/mysql/conf.d/client-mariadb.cnf or /etc/mysql/debian.cnf file on the server containing invalid credentials:
# cat /root/.my.cnf [client] user=root password=mypassword Cause
Invalid MySQL credentials. Additional MySQL configuration files are included.
Resolution Log in to the server over SSH Make sure there are no additional MySQL configuration files like /root/.my.cnf with MySQL password. If it exists, rename it:
# mv /root/.my.cnf /root/.my.cnf.backup
Note: MySQL reads startup options (including credentials, if defined) from the following files, in the below order:
CONFIG_TEXT: /etc/my.cnf /etc/mysql/my.cnf SYSCONFDIR/my.cnf $MYSQL_HOME/my.cnf defaults-extra-file (The file specified with --defaults-extra-file=path, if any) ~/.my.cnf Additionally, if problem persists, check If there is an !include directive make sure it does not refer to invalid credentials.
Note: Since MySQL 5.0.4, it is possible to use !include directives in option files to include other option files and !includedir to search specific directories for option files. For example, to include the /home/mydir/myopt.cnf file use the following directive:
CONFIG_TEXT: !include /home/mydir/myopt.cnf "
6,"Unable to receive email: the recipient email account has an empty password in the Plesk database
Applicable to: Plesk for Linux Symptoms Unable to receive an email for the john.doe@example.com mailbox with the following errors in /var/log/maillog file:
CONFIG_TEXT: dovecot_authdb_plesk[1377]: No such user 'john.doe@example.com' in mail authorization database dovecot: auth: plesk(john.doe@example.com): Mail account information for user='john.doe@example.com' was not found dovecot: auth: Debug: userdb out: NOTFOUND#0111 dovecot: service=lda, user=john.doe@example.com, ip=[]. Debug: auth input: postfix/pipe[14513]: E141A88AA5: to=<john.doe@example.com, relay=plesk_virtual, delay=2, delays=2/0/0/0.06, dsn=4.2.1, status=deferred (Message can not be delivered at this time ) The same errors appear for the messages that are forwarded internally after switching from Courier to Dovecot. Cause
The recipient email account has an empty password in the Plesk database.
Resolution For a single email account Log into Plesk. Go to Domains > example.com > Email Addresses > johndoe@example.com. Set a new password into Password and Confirm password fields and press the OK button: For several email accounts Log into the server via SSH. Create a backup for psa database:
# plesk db dump psa > /root/psa.sql Execute the command below to create a /root/affectedaccounts.txt file that contains all email accounts with the empty passwords:
# MYSQL_PWD=`cat /etc/psa/.psa.shadow` mysql -uadmin psa -Ne ""select concat(m.mail_name,'@',d.name) as mailbox from domains d, mail m, accounts a where m.dom_id=d.id and m.account_id=a.id and m.postbox='true' and a.password =''"" > /root/affectedaccounts.txt Run the following command to set a new password for the email accounts from /root/affectedaccounts.txt file:
# while read i; do /usr/local/psa/bin/mail -u $i -passwd 'PASSWORD'; done < /root/affectedaccounts.txt
Note: in the command above replace PASSWORD with the desired password word that will be set for all affected email accounts from the /root/affectedaccounts.txt file. "
6,"How to access the Plesk psa database in MySQL Applicable to: Plesk for Linux Plesk for Windows Question
How to connect to MySQL and open the Plesk psa database?
Answer
Note: This guide is intended for Plesk administrators with SSH/RDP access to the server. Click on a section to expand Accessing Plesk database on Linux via SSH In Plesk Onyx/Plesk 12.x, use the plesk db utility: To access Plesk database in MySQL:
[root@server]# plesk db
Once you are logged in, start running SQL queries.
Example of an SQL query:
MYSQL_LIN: mysql> select id,name from domains where name='example.com'; +----+-------------+ | id | name | +----+-------------+ | 3 | example.com | +----+-------------+
To exit MySQL, run the command:
MYSQL_LIN: mysql> quit To run a query to Plesk database without logging in to MySQL:
[root@server]# plesk db ""your_query_here""
Example:
[root@server]# plesk db ""select id,name from domains where name='example.com'"" +----+-------------+ | id | name | +----+-------------+ | 3 | example.com | +----+-------------+ In Plesk 11.x and previous releases, use the following command: To access Plesk database in MySQL:
[root@server]# MYSQL_PWD=`cat /etc/psa/.psa.shadow` mysql -u admin psa To run a query to Plesk database without logging in to MySQL:
[root@server]# MYSQL_PWD=`cat /etc/psa/.psa.shadow` mysql -u admin psa -e ""select * from <table>"" Accessing Plesk database on Windows Server via RDP On Windows Server, Plesk uses two MySQL instances: Plesk SQL Server on port 8306: for Plesk databases psa and apsc MySQL server on port 3306: for Horde, Sitebuilder and customers' databases Accessing Plesk SQL Server On Plesk Onyx/Plesk 12.5, use the plesk db utility: To access Plesk database in MySQL:
C:\> plesk db
Once you are logged in, start running SQL queries.
Example of an SQL query:
C:\> mysql> select id,name from domains where name='example.com'; +----+-------------+ | id | name | +----+-------------+ | 3 | example.com | +----+-------------+
To exit MySQL, run the command:
C:\> mysql> quit To run a query to Plesk database without logging in to MySQL:
C:\> plesk db ""your_query_here""
Example:
C:\> plesk db ""select id,name from domains where name='example.com'"" +----+-------------+ | id | name | +----+-------------+ | 3 | example.com | +----+-------------+ In Plesk 12.0/Plesk 11.x and previous releases, use the following command: To access Plesk database in MySQL:
C:\> ""%plesk_dir%\MySQL\bin\mysql"" -P8306 -uadmin -p psa To run a query to Plesk database without logging in to MySQL:
C:\> ""%plesk_bin%\dbclient"" --direct-sql --sql=""select * from <table>"" Accessing MySQL server Run the following command:
C:\> ""%plesk_dir%\MySQL\bin\mysql"" -P3306 -uadmin -p
If the password is unknown, reset it according to this KB article. Accessing Plesk database in Plesk interface on Linux In Plesk, go to Tools & Settings > Database Servers > select MySQL server running on port 3306 > click on the icon:
Click on the picture to enlarge Select Plesk database ""psa"" from the list: Switch to the SQL tab: Type in an SQL query and click Go to execute it: Related Articles How to connect to MySQL on a Plesk for Linux server using MySQL admin password in plain text
How to manage customers' databases in Plesk
How to backup/restore all MySQL databases via a CLI in Plesk for Linux
How to backup/restore Plesk system databases
"
7,"[BUG] PHP handler name is not changed in Plesk GUI after upgrade/downgrade of OS vendor package
Applicable to: Plesk for Linux Symptoms The PHP by OS vendor was upgraded for example from 5.4.16 up to 7.2.31.
The version of PHP by OS vendor still shows as 5.4.16 in Plesk > Tools & Settings > PHP Settings: Note: the PHP handler name is also not changed after the downgrade procedure for the PHP by OS vendor package. Cause
This is the Plesk bug with the ID #PPPM-4764, which will be fixed in the next Plesk update releases.
Resolution
Until the bug will be fixed, apply the following workaround: Log into the server via SSH. Execute the command below to reread PHP handlers:
# plesk bin php_handler --reread Run the command to get list of all hanlders that belong to OS vendor:
# plesk bin php_handler --list | grep vendor | awk {'print $1""\t""$2""\t""$3""\t""$4""\t""$5'} cgi 5.4.16 by OS vendor fastcgi 5.4.16 by OS vendor fpm 5.4.16 by OS vendormodule 5.4.16 by OS vendor Rename the required handler of the PHP by OS vendor by executing the command: For fastcgi:
# plesk bin php_handler --update -id fastcgi -displayname ""7.2.31 by OS vendor"" For fpm:
# plesk bin php_handler --update -id fpm -displayname ""7.2.31 by OS vendor"" For cgi:
# plesk bin php_handler --update -id cgi -displayname ""7.2.31 by OS vendor"" For module:
# plesk bin php_handler --update -id module -displayname ""7.2.31 by OS vendor"" "
7,"Install microupdates/upgrade Plesk fails on Ubuntu/Debian: error processing package bind9
Applicable to:
Plesk for Linux
Symptoms Installation of Plesk MicroUpdates or upgrading Plesk fails with the following errors:
CONFIG_TEXT: dpkg: error processing package bind9 (--configure): subprocess installed post-installation script returned error exit status 1 Errors were encountered while processing: bind9
CONFIG_TEXT: bind9 : Depends: libbind9-80 (= 1:9.8.1.dfsg.P1-4ubuntu0.10) but 1:9.8.1.dfsg.P1-4ubuntu0.12 is to be installed Depends: libdns81 (= 1:9.8.1.dfsg.P1-4ubuntu0.10) but 1:9.8.1.dfsg.P1-4ubuntu0.12 is to be installed Depends: libisc83 (= 1:9.8.1.dfsg.P1-4ubuntu0.10) but 1:9.8.1.dfsg.P1-4ubuntu0.12 is to be installed Also, DNS service is not managable via Plesk. The following error might be shown while trying to start bind9 service or in /var/log/syslog file:
CONFIG_TEXT: named[43159]: loading configuration from '/etc/named.conf' named[43159]: open: /etc/named.conf: permission denied named[43159]: loading configuration: permission denied named[43159]: exiting (due to fatal error) kernel: [257884.045621] type=1400 audit(1453357306.616:35): apparmor=""DENIED"" operation=""open"" profile=""/usr/sbin/named"" name=""/var/named/run-root/etc/named.conf"" pid=43160 comm=""named"" requested_mask=""r"" denied_mask=""r"" fsuid=108 ouid=0 Cause
The issue is caused by bind9 package misconfiguration.
Resolution
It is required to disable apparmor for bind service and try upgrading/updating once again following these steps: Connect to the server via SSH Disable apparmor for bind:
# aa-disable /etc/apparmor.d/usr.sbin.named Restart apparmor:
# service apparmor restart Try to perform upgrade or update once again:
# plesk installer update --repatch If the issue persists, reinstall bind9:
# dpkg -r --force-depends bind9 # apt-get install bind9 Rebuild all DNS zones Try to perform upgrade or update once again:
# plesk installer update --repatch "
7,"Installation or upgrade failed when mysql.servers table is missing on Plesk for Linux
Applicable to: Plesk for Linux
Plesk for Windows Symptoms
Plesk or its components installation / upgrade failed with the error in the/var/log/plesk/install/autoinstaller3.log:
CONFIG_TEXT: ERROR 1146 (42S02) at line 1: Table 'mysql.servers' doesn't existERROR while trying to (to Convert MySQL DB users passwords to new format), the query was: UPDATE mysql.user mINNER JOIN psa.db_users u ON (m.User = u.login)INNER JOIN psa.accounts a ON (u.account_id = a.id)INNER JOIN psa.data_bases d ON (u.db_id = d.id)SET m.Password = PASSWORD(a.password)WHERE d.type = 'mysql' AND a.type = 'plain';FLUSH PRIVILEGES;
Cause
MySQL table mysql.serversdoes not exist.
Resolution
Note: To apply the solution from this article it is required to have SSH access to the server. Please contact your hosting provider support or server's administrator if you don't have SSH access or ask them to apply the solution.
Connect to the server via SSH and run the following command for repairing MySQL table:
# MYSQL_PWD=`cat /etc/psa/.psa.shadow` mysql_upgrade -uadmin mysql
For the versions of MySQL Server below 5.1, use the following method: Update all the mysql privilege tables to be usable by the current version of MySQL
# MYSQL_PWD=`cat /etc/psa/.psa.shadow` mysql_fix_privilege_tables --user=admin --verbose Check for mysql.servers table in the mysql database:
# grep ""servers"" /usr/share/mysql/mysql_system_tables.sqlCREATE TABLE IF NOT EXISTS servers ( Server_name char(64) NOT NULL DEFAULT '', Host char(64) NOT NULL DEFAULT '', Db char(64) NOT NULL DEFAULT '', Username char(64) NOT NULL DEFAULT '', Password char(64) NOT NULL DEFAULT '', Port INT(4) NOT NULL DEFAULT '0', Socket char(64) NOT NULL DEFAULT '', Wrapper char(64) NOT NULL DEFAULT '', Owner char(64) NOT NULL DEFAULT '', PRIMARY KEY (Server_name)) CHARACTER SET utf8 comment='MySQL Foreign Servers table'; Restore the table by executing the following query:
# grep ""servers"" /usr/share/mysql/mysql_system_tables.sql | MYSQL_PWD=`cat /etc/psa/.psa.shadow` mysql -uadmin mysql Additional information
Unable to log in to Plesk: saved admin password is incorrect"
0,"Is it possible to change the main website on a subscription in Plesk?
Applicable to: Plesk for Linux
Plesk for Windows Question
Is it possible to change the main website on a subscription in Plesk?
Resolution
Such functionality is not implemented in Plesk at the moment. Vote for adding this feature on our UserVoice.
Each subscription in the Plesk is referred to by the domain name of the first website created under that subscription. The first website is used as the main domain of the subscription. Its virtual host directory is used for the document root of additional domains in the webspace.
It is not possible to set up an additional website as the main website on the subscription. The main website on the subscription cannot be deleted or replaced with another domain. As a workaround, it is possible to rename the main domain of a subscription Plesk 12.x and above Go to Home > Subscriptions > example.com > Websites & Domains > example.com Click on Hosting Settings tab and specify a new name for the domain. Note: in case of Web Admin license is used, select required webspace(subscription) in the upper right corner and click on Hosting Settings for the required domain. Note: the permission ""Domain creation"" should be enabled on the subscription. The customer cannot rename this domain without this permission. Additional information
Is it possible to move domains between subscriptions?"
2,"Error in Plesk: SWKeyExFatalError error: Cannot open file Applicable to: Plesk for Linux Symptoms When logging in to Plesk or browsing pages in Plesk, one of the following error messages appears:
PLESK_INFO: Internal error: error: Cannot open file: /etc/sw/keys/info Message error: Cannot open file: /etc/sw/keys/info File functions.php Line 3374 Type SWKeyExFatalError
OR
PLESK_INFO: ERROR: SWKeyExFatalError error: Cannot open file 0: common_func.php3:4480 of_get_key_by_product(string 'plesk-unix') 1: common_func.php3:4480 getPleskKey() 2: common_func.php3:4559 getKeyProp(string 'demo') 3: auth.php3:48
OR
PLESK_INFO: ERROR: SWKeyExFatalError error: /etc/sw/keys/lock/repository: cannot create: Permission denied
OR
PLESK_INFO: ERR [1] Exception: Token validation failed: The license key 'PLSK.XXXXXXX' was not verified. Plesk will try to verify license key. Please wait for few minutes and try again. To manually run verification of license key click ""Retrieve Keys"" button in ""License Management"".; ; The license key 'PLSK.XXXXXXX' was not verified. Plesk will try to verify license key. Please wait for few minutes and try again. To manually run verification of license key click ""Retrieve Keys"" button in ""License Management""
OR
PLESK_INFO: Internal error: Repository is not opened Message Repository is not opened File functions.php Line 3374 Type SWKeyExFatalError The following error messages appear in /var/log/plesk/panel.log:
CONFIG_TEXT: ERR [panel] Unable to get key: Repository is not opened
OR
CONFIG_TEXT: ERR [1] Token validation failed: ; ; Plesk operates slow and the following errors can be found in /var/log/plesk/panel.log:
CONFIG_TEXT: mkstemp failed: /etc/sw/keys/tokens/tokenXXXXXX: Permission denied Cause The psaadm user is not in the swkey-data group. Broken permissions on the /etc/sw/keys directory. Resolution Connect to a Plesk server via SSH. Set the correct permissions: Plesk Onyx
# plesk repair fs -system -y Plesk 12.5 and earlier releases
# /usr/sbin/usermod -a -G swkey-data psaadm # chown -R root:swkey-data /etc/sw/keys/ # chmod -R 660 /etc/sw/keys/* # chmod -R 644 /etc/sw/keys/info # find /etc/sw/keys -type d -exec chmod 2770 {} \; # chmod 4510 /etc/sw/keys/restart/* # chown -R psaadm:swkey-data /etc/sw/keys/registry.xml /etc/sw/keys/keys/* /etc/sw/keys/tokens* Restart the Plesk service:
# service psa restart Log in to Plesk and click the Retrieve Key button to restore your Plesk license. If the operation fails, install your Plesk license by clicking Install Key. Related Articles Unable to access/activate Plesk: The license key is invalid. In order to use the Panel, you need to obtain and install a new valid license key
"
4,"Unable to install or update application: ""failed to open stream: No such file or directory"" Applicable to: Plesk for Linux Symptoms When installing an application at Domains > example.com > Applications, the operation fails with the following error message in Plesk:
PLESK_ERROR: Error: Installation of WordPress at http://example.com/wordpress failed. Non-zero exit status returned by script. Output stream: 'PHP Warning: fopen(/var/www/vhosts/example.com/example.com/wordpress//wp-config.php): failed to open stream: No such file or directory in /usr/local/psa/var/apspackages/apscatalogHXU4qx.zip396aca46-916c-79/cache/scripts/file-util.php on line 15 '. Error stream: 'PHP Warning: fopen(/var/www/vhosts/example.com/example.com/wordpress//wp-config.php): failed to open stream: No such file or directory in /usr/local/psa/var/apspackages/apscatalogHXU4qx.zip396aca46-916c-79/cache/scripts/file-util.php on line 15 '. The same error can be seen during an attempt to update an application:
PLESK_ERROR: PHP Warning: copy(/var/www/vhosts/example.com/httpdocs/wp/wp-content/upgrade/wp_5c3d9151c5cc3/wordpress/wp-admin/includes/update-core.php): failed to open stream: No such file or directory in /var/www/vhosts/example.com/httpdocs/wp/wp-admin/includes/class-wp-filesystem-direct.php on line 243Warning: copy(/var/www/vhosts/example.com/httpdocs/wp/wp-content/upgrade/wp_5c3d9151c5cc3/wordpress/wp-admin/includes/update-core.php): failed to open stream: No such file or directory in /var/www/vhosts/example.com/httpdocs/wp/wp-admin/includes/class-wp-filesystem-direct.php on line 243The update cannot be installed because we will be unable to copy some files. This is usually due to inconsistent file permissions. ""wp-admin/includes/update-core.php""{""err_code"":true,""err_message"":""The update cannot be installed because we will be unable to copy some files. This is usually due to inconsistent file permissions. \""wp-admin\/includes\/update-core.php\""""} The following error message appears in the logfile /var/log/plesk/panel.log:
CONFIG_TEXT: stderr:zip I/O error: Disk quota exceededzip error: Output file write failure (write error on zip file)filemng: /usr/bin/zip execution failed:...ERR [panel] Task failed: id=1153, pid=9352, type=ext-wp-toolkit-task\manage, error=Unable to create the restore point. Some files could not be included because of a wrong owner or insufficient access permissions. Please resolve the issue manually and try again.DEBUG [panel] pm_Exception: Unable to create the restore point. Some files could not be included because of a wrong owner or insufficient access permissions. Please resolve the issue manually and try again. Cause
Subscription's hard disk quota limit has been reached.
Resolution Log into Plesk;
Go to Domains > example.com > Web Hosting Access and increase the Hard Disk Quota limit.
"
7,"How to install Plesk on DigitalOcean cloud infrastructure instance
Applicable to: Plesk Onyx for Linux Symptoms
How to install Plesk on DigitalOcean cloud infrastructure instance?
Steps to Deploy Review Software Requirements for Plesk to find what Linux distributions are supported by Plesk. Log into DigitalOcean account and create droplet with supported OS on board as follows: Start with the creation of a droplet: Use available ""One-click app"" with pre-installed Plesk on Ubuntu 18.04
or choose clean image of supported OS from available ones: Choose required CPU/Size options: Choose storage additional options if required: Choose data center region: Choose options and set SSH Key Specify hostname and finalize creation of a droplet: And wait until it will be created: Once the droplet is deployed, log into the instance via SSH under root account:
# ssh root@10.20.30.40The authenticity of host '10.20.30.40 (10.20.30.40)' can't be established.RSA key fingerprint is 9a:ca:bc:1e:ad:07:a4:2f:70:51:33:c3:44:12:95:a1.Are you sure you want to continue connecting (yes/no)? yesWarning: Permanently added '10.20.30.40' (RSA) to the list of known hosts.root@10.20.30.40's password:# If a clean template was selected, install Plesk using One-Click installer or run through Plesk Installation and Upgrade Wizard to deploy custom installation: One-Click installer # sh <(curl https://autoinstall.plesk.com/one-click-installer || wget -O - https://autoinstall.plesk.com/one-click-installer) Custom installation through Plesk Installation and Upgrade Wizard # wget https://autoinstall.plesk.com/plesk-installer# chmod +x plesk-installer# ./plesk-installer Find password for admin Plesk user which is randomly generated during installation with command below:
# plesk login Log into Plesk using the received login link and complete installation. "
3,"Website hosted in Plesk or some of its parts are inaccessible: pcfg_openfile: unable to check htaccess file
Applicable to: Plesk for Linux Symptoms Website hosted in Plesk or some of its parts are inaccessible (for example, directory with css files); Website error log (/var/www/vhosts/example.com/logs/error_log) show the following:
CONFIG_TEXT: AH01071: Got error 'PHP message: PHP Warning: require(/var/www/vhosts/example.com/httpdocs/wp-includes/load.php): failed to open stream: Permission denied in /var/www/vhosts/example.com/httpdocs/wp-settings.php on line 19 PHP message: PHP Fatal error: require(): Failed opening required '/var/www/vhosts/example.com/httpdocs/wp-includes/load.php' (include_path='.:/opt/plesk/php/7.1/share/pear') in /var/www/vhosts/example.com/httpdocs/wp-settings.php on line 19' CONFIG_TEXT: [crit] [client 203.0.113.2] (13)Permission denied: /var/www/vhosts/example.com/httpdocs/css/.htaccess pcfg_openfile: unable to check htaccess file, ensure it is readable, referer: http://www.example.com/index.html
Note: the path in bold may differ, e.g it may point to the WordPress theme like /var/www/vhosts/example.com/httpdocs/wp-content/themes/theme_name/. Cause
Incorrect permissions/ownership for website files/directories:
Resolution
Set default permissions as follows: Login to Plesk > Subscriptions > example.com and determine system user for the subscription: Connect to the server using SSH. Run the following commands:
Note: Substitute ""johndoe"" with the system user name from step #1
# find /var/www/vhosts/example.com/httpdocs/ -type f -exec chmod 644 {} \; # find /var/www/vhosts/example.com/httpdocs/ -type d -exec chmod 755 {} \; # find /var/www/vhosts/example.com/httpdocs/ -type f -exec chown johndoe:psacln {} \; # find /var/www/vhosts/example.com/httpdocs/ -type d -exec chown johndoe:psacln {} \; "
0,"DrWeb notifications are received: The antivirus software failure
Applicable to: Plesk 12.0 for Linux
Plesk 12.5 for Linux
Plesk Onyx for Linux Symptoms Multiple ""The antivirus software failure"" emails from ""DrWeb-DAEMON"" are sent:
CONFIG_TEXT: --- Antivirus report --- Detailed report: The filter fails to pass object to the DrWEB daemon --- Antivirus report --- The original message was stored in archive record named: file was not created Also, the following error can be found:
CONFIG_TEXT: Dear administrator, Your virus bases are not up to date. Please run updating script manually or use cron for this purpose. Interface binding error (/var/drweb/run/.daemon - Addr.... Cause
DrWeb virus bases are outdated.
Resolution Connect to the server using SSH Make sure that content of the /etc/cron.daily/drweb-update cron task is correct. For Plesk Onyx and 12.5: CONFIG_TEXT: #!/bin/sh update_scr=""/opt/drweb/update.pl"" outfile=`mktemp /tmp/drweb-update.XXXXXX` [ -x ""${update_scr}"" ] || exit 0 trap 'rm -f $outfile;' TERM INT EXIT ""${update_scr}"" >$outfile 2>&1 rc=$? [ $rc -eq 0 ] || cat $outfile exit $rc For Plesk 12.0: CONFIG_TEXT: #!/bin/sh update_scr=""/opt/drweb/update.pl"" [ ! -x ""${update_scr}"" ] || ""${update_scr}"" Execute /etc/cron.daily/drweb-update cron task manually:
# bash /etc/cron.daily/drweb-update If it did not help, try to execute /opt/drweb/update.pl DrWeb update script manually.
# perl /opt/drweb/update.pl "
2,"PleskMainDBException Only one usage of each socket address (protocol/network address/port) is normally permitted
Applicable to: Plesk for Windows Symptoms Plesk, as well as webmail and other services, are not accessible, the following error message appears: ERROR: PleskMainDBException Only one usage of each socket address (protocol/network address/port) is normally permitted Migration from another Plesk server hangs with the same error. Backup is created with the same error message. Cause
All available network ports on the machine are exhausted.
TCP/IP port exhaustion can occur on a server if the server is engaging in an unusually high number of TCIP/IP socket connections. This can occur if many client applications are initiating connections.
If all of the available ephemeral ports are allocated to client applications then the client experiences a condition known as TCP/IP port exhaustion. When TCP/IP port exhaustion occurs, client port reservations cannot be made and errors will occur in client applications that attempt to connect to a server via TCP/IP sockets.
TCP/IP port exhaustion is more likely to occur under high load conditions, than under normal load conditions.
Resolution Note: If the following command will show a value close to maximum 65534 netstat -n | find ""WAIT"" /c63448
then it's necessary to configure the firewall to temporarily block IP addresses having the highest connection count and go to step #2 Increase the upper range of ephemeral ports that are dynamically allocated to client TCP/IP socket connections. Browse to, and then click the following key in the registry: HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Services\\Tcpip\\Parameters\\ On the Edit menu, click, New DWORD Value and then add the MaxUserPort - The max by default is 5000 . It can be set up to 65534 (decimal). Close Registry Editor. Note: reboot the operating system for this change to take effect. Note: Increasing the range of ephemeral ports used for client TCP/IP connections consumes Windows kernel memory. Do not increase the upper limit for this setting to a value higher than is required to accommodate client application socket connections so as to minimize unnecessary consumption of Windows kernel memory. Reduce the client TCP/IP socket connection timeout value from the default value of 240 seconds. Length of time that a connection stays in the TIME_WAIT state when the connection is being closed. While a connection is in the TIME_WAIT state, the socket pair cannot be reused Start Registry Editor. Browse to, and then click the following key in the registry:
HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Services\\Tcpip\\Parameters On the Edit menu, click New , DWORD Value , and then add TcpTimedWaitDelay - decimal value between 30 and 240. Close Registry Editor. Note: reboot the operating system for this change to take effect. For more information, refer to the following Microsoft KB articles:https://technet.microsoft.com/en-us/library/cc938196.aspxhttps://technet.microsoft.com/en-us/library/cc938217.aspx "
5,"How to set up IP Mapping during migration using Plesk interface
Applicable to: Plesk for Windows
Plesk for Linux Question
How to set up IP mapping during migration?
Answer
Auto IP mapping:
The best migration practice is to have the same number of dedicated and shared IPs on a destination server as on a source server. Choose Auto IP Mapping in this case.
When there are not enough free dedicated or shared IPs left on the destination server, the default shared IP address will be used instead in case the Auto IP Mapping chosen.
Manual IP mapping:
In simple mode of migration only automatic IP mapping is present, however, advanced mode enables additional features. To use it, List of subscriptions tab should be selected in Plesk Migrator, and then the Switch to advanced mode button must be pressed: Here it is possible to manually set up preferred IP mapping. To do it, some amount of subscriptions should be checked and the button Change IP mapping in IP addresses drop-down menu should be pressed: After that it is possible to change IP mapping in tool-tip: When manually mapping IP addresses keep in mind these best practices:
Mapping a dedicated IP: DEDICATED → DEDICATED
Dedicated IP addresses are mapped one-to-one. DEDICATED → SHARED
Mapping a dedicated IP to a shared one will disable anonymous FTP and HTTPS unless the SNI support is turned on. Mapping a shared IP:
SHARED → SHARED
Several shared IP addresses could be mapped to a single shared IP on the destination server. Note: For more details, visit Plesk Migration Guide."
8,"How to configure SMTP Relay in Qmail server for outgoing messages?
Applicable to: Plesk Onyx for Linux Question
How to configure Qmail server send outgoing messages though relay?
Answer
Plesk does not support configuring relay options in Qmail. Vote to implement possibility to configure relayhost in Plesk Uservoice portal. Top-ranked suggestions is likely to be implemented in new product versions."
8,"How to configure a domain to use an external mail server Applicable to: Plesk for Linux
Plesk for Windows Question
How to configure a domain to use an external mail server in Plesk?
Answer
Note: If you are a domain owner, contact your service provider for assistance. If DNS zone of a domain is hosted on a Plesk server In Plesk, go to Domains > example.com > DNS Settings and point domain's MX record to an external mail server. Set it to high priority. Click OK and then Update. Go to Domains > example.com > Mail Settings and disable the option Activate mail service on this domain. Click OK. Additional step on Plesk for Windows: Remove the domain from MailEnable list via MailEnable Management console. If DNS zone of a domain is hosted on an external DNS server
Contact administrator of a DNS server and ask them to create MX record and point it to an external mail server."
8,"SMTPS connection from Outlook to Plesk for Linux server does not work: SASL authentication failure: realm changed: authentication aborted
Applicable to: Plesk for Linux Symptoms On a Plesk for Linux server, Postfix is used as a mail server.
SMTPS connection from Outlook to the Plesk server fails to be established.
The following errors are found in the file /var/log/maillog:
CONFIG_TEXT: SSL_accept error from unknown[203.0.113.2]: lost connection lost connection after CONNECT from unknown[203.0.113.2]plesk postfix/smtpd[6814]: warning: SASL authentication failure: realm changed: authentication abortedplesk postfix/smtpd[6814]: warning: 203.0.113.2.example.com[203.0.113.2]: SASL DIGEST-MD5 authentication failed: authentication failure Plaintext authorization is disabled in Postfix:
# cat /etc/postfix/main.cf | grep ""smtpd_sasl_security_options"" smtpd_sasl_security_options = noplaintext Cause
Outlook is not compatible with CRAM-MD5 authentication mechanism.
Resolution Connect to the server using SSH.
Open the file /etc/postfix/main.cf for editing.
Comment out the following line by putting ""#"" at its beginning and save the changes:
CONFIG_TEXT: #smtpd_sasl_security_options = noplaintext Restart postfix to apply configuration changes:
# service postfix restart "
0,"How to change the location for virtual hosts in Plesk for Windows Server Applicable to: Plesk for Windows Question
How to change the location for virtual hosts in Plesk for Windows Server?
Answer Connect to a Plesk server via RDP. Launch Plesk Reconfigurator at Windows Start > All Programs > Plesk. In Plesk Reconfigurator, select Change Virtual Hosts location. Specify a new location for virtual hosts and click Next. All existing virtual hosts data will be transferred to the new location as well.
Note: During this operation websites will be stopped. Related Articles How to change a document root for one or several domains only in Plesk for Windows Server
How to change the location for mailboxes in Plesk for Windows Server
How to change the location for backup files in Plesk for Windows Server
"
3,".html files of a domain show white page when Apache PageSpeed module is used
Applicable to: Plesk for Linux Symptoms .html files, including the Default Plesk page (index.html), display a blank page instead of the content. Other static files are also not opened. .php files are opened correctly. nginx reverse proxy is enabled on the server. Check this in Plesk at Tools & Settings > Services Management. Records like the following can be found in the Google Chrome Developer Console:
CONFIG_TEXT: GET https://example.com/A.style.css.pagespeed.cf.IzHunpedlN.css net::ERR_ABORTED 404 (index):45 Uncaught ReferenceError: mod_pagespeed_masdEi5Tr is not defined Apache PageSpeed module is installed and loaded. Check this in Plesk at Tools & Settings > Apache Web Server > pagespeed or via a command-line interface on a server: on CentOS/RHEL-based distributions
# httpd -M | grep pagespeed mod_pagespeed (shared) on Debian/Ubuntu-based distributions
# apache2ctl -M | grep pagespeed mod_pagespeed (shared) Cause
Apache PageSpeed module prevents static files from being served correctly.
Resolution
Apply one of the following solutions: Solution 1: Disable smart static files processing by nginx For best experience, Apache PageSpeed recommends to have static files processed by Apache. To enable this setting, follow the steps: Disabling smart static files processing via Plesk Go to Domains > example.com > Apache & nginx Settings and disable the option Smart static files processing. Click OK to apply the changes.
Note: It is not possible to manage this option via service plan settings. Disabling smart static files processing via a command-line interface
Connect to the server via SSH and disable Smart static files processing using the following command: For a single domain:
# plesk bin subscription --update-web-server-settings example.net -nginx-transparent-mode true For all domains:
# for subs in `plesk bin site --list`; do echo Processing subscription... $subs; plesk bin subscription --update-web-server-settings $subs -nginx-transparent-mode true; done Solution 2: Turn off Apache PageSpeed module If Smart static files processing must remain enabled, turn off Apache PageSpeed module so that it does not interfere with static files processing: Turning off Apache PageSpeed module via Plesk Go to Tools & Settings > Apache Web Server. Uncheck pagespeed (and pagespeed_ap24 if enabled) and click OK. Turning off Apache PageSpeed module via a command-line interface Connect to the Plesk server via SSH. Disable Apache mod_pagespeed: on CentOS/RHEL-based distributions
# mv /etc/httpd/conf.d/pagespeed.conf /etc/httpd/conf.d/pagespeed.conf.bak on Debian/Ubuntu-based distributions
# a2dismod pagespeed Restart Apache web-server: on CentOS/RHEL-based distributions
# service httpd restart on Debian/Ubuntu-based distributions
# service apache2 restart Verify that the module has been disabled - there must be no output in the command below: on CentOS/RHEL-based distributions
# httpd -M | grep pagespeed on Debian/Ubuntu-based distributions
# apache2ctl -M | grep pagespeed Additional Information Plesk Administrator's Guide: Configuring Static Files Processing
"
5," How to restore Plesk Onyx and Obsidian installation on a new Linux server after disaster Applicable to: Plesk for Linux Question
During a disaster recovery, it is necessary to set up a new Plesk instance and migrate all server settings and customers data from the old server. For some reason, it is not possible to use the solution described in this article: How to restore Plesk from a hard disk drive if the Operating System is broken and the HDD with the old installation is mounted to the new server?
Answer
If you prefer to let Plesk professionals handle the migration or upgrade job for you please check out Plesk professional services options on our website: https://www.plesk.com/professional-services/
Connect to the new server using SSH. It is assumed that the hard drive from the old server is mounted to the /old directory on the new server.
Note: on the new server, the same version of Plesk as on the old one should be installed, and it should be licensed properly. Also, the same set of extensions should be installed on the new server. Important: This step is only possible if the version of MySQL server matches for both the original and new server's one. Start the MySQL server with the datadir parameter in /etc/my.cnf pointing to the MySQL database location on the old drive ( /old/var/lib/mysql):
# cat /etc/my.cnf | grep datadir datadir=/old/var/lib/mysql
and dump the databases:
# MYSQL_PWD=`cat /old/etc/psa/.psa.shadow` mysql -u admin psa -Ns -e""select name from data_bases where type = 'mysql'"" | while read dbname ; do MYSQL_PWD=`cat /old/etc/psa/.psa.shadow` mysqldump -u admin --databases $dbname > $dbname.sql ; done Stop MySQL, revert the datadir parameter in /etc/my.cnf to its original value:
# service mysqld stop # cat /etc/my.cnf | grep datadir datadir=/var/lib/mysql Start MySQL and restore the databases:
# service mysqld start # for f in *.sql ; do dbname=$(echo $f | sed -e 's/\(.sql\)$//g'); MYSQL_PWD=`cat /etc/psa/.psa.shadow` mysql -u admin -e ""create database $dbname""; MYSQL_PWD=`cat /etc/psa/.psa.shadow` mysql -u admin -D$dbname < $f; echo ""$dbname restored"" ; done Restore the Plesk databases from the available dump: Stop the Plesk service:
# service psa stopall Import the database dump:
# zcat /old/var/lib/psa/dumps/mysql.daily.dump.0.gz | MYSQL_PWD=`cat /etc/psa/.psa.shadow` mysql -u admin Copy the Plesk database password file:
# cp -rpf /old/etc/psa/.psa.shadow /etc/psa/.psa.shadow Copy the encryption key to the new server, set the correct permissions and restart MySQL service:
# cp /etc/psa/private/secret_key /etc/psa/private/secret_key.save # cp -rpf /old/etc/psa/private/secret_key /etc/psa/private/secret_key # chmod 0600 /etc/psa/private/secret_key # chown psaadm:root /etc/psa/private/secret_key # service mysqld restart
Note: make sure that MySQL is accessible using MYSQL_PWD=`cat /etc/psa/.psa.shadow` mysql -u admin Restore domain content:
# rsync -av /old/var/www/vhosts/ /var/www/vhosts/
Note: Wait until rsync process is finished Restore Plesk system users:
# MYSQL_PWD=`cat /etc/psa/.psa.shadow` mysql -u admin -Dpsa -Ns -e""select s.login, a.password, s.home, s.shell from sys_users s, accounts a where a.id = s.account_id"" | awk '{ print ""PSA_PASSWD=\x27"" $2 ""\x27 /usr/local/psa/admin/sbin/usermng --add-user --user="" $1 "" --homedir="" $3 "" --shell="" ($4?$4:""/bin/false"")}' | sh -x Restore the mailnames directory (mail content):
# rsync -av /old/var/qmail/mailnames/ /var/qmail/mailnames/ # chown -R popuser:popuser /var/qmail/mailnames/* Restore scheduled cron tasks
# rsync -av /old/var/spool/cron /var/spool/cron For Plesk Onyx and Plesk 12.5, run fully automated reconfiguration utility:
# plesk repair all -y Start the Plesk service:
# service psa start "
7,"How to install php-suhosin module on Plesk server
Applicable to: Plesk Question
It is needed to install php-suhosin module on the server. Can php-suhosin module be used in combination with Plesk?
Answer
Suhosin PHP module is the 3rd party extension and it does not come with Plesk out of the box.
Refer to the following documentation to download and install the module: Download Suhosin
Suhosin installation guide"
3,"Apache is not starting: Invalid command 'php_value'
Applicable to: Plesk Onyx for Linux
Plesk for Linux Symptoms Apache is not starting. Executing apachectl configtest or httpd -t show the following error message:
CONFIG_TEXT: AH00526: Syntax error on line 31 of /etc/httpd/conf.d/php.conf:Invalid command 'php_value', perhaps misspelled or defined by a module not included in the server configuration suPHP module is installed. Cause
suPHP does not support the php_value/php_admin_value directive.
Resolution
Warning: suPHP is not supported by Plesk
Disable suPHP module in Tools & Settings > Apache Web Server Settings Or Log in to Plesk server using SSH. Find strings with php_value in Apache config files and comment them:
# grep -ir 'php_value' /etc/httpd/ | cat/etc/httpd/conf.d/php.conf:# php_value session.save_handler ""files""/etc/httpd/conf.d/php.conf:# php_value session.save_path ""/var/lib/php/session"" "
0,"How to add additional PHP option for a domain using command line?
Applicable to:
Plesk Onyx for Linux Question
It is possible to add additional PHP directives via Command line
Resolution Connect to the server via SSH Create the file with all additional settings you need to apply to a domain ( vi can be used or any other text editor, but this simple example shows single-line configuration file). For example, it is required to add the directive 'sendmail_path = ""/dev/null':
# echo 'sendmail_path = ""/dev/null""' > nomail.ini # this directive disables sending mail via PHP Note: any directive, which is valid in php.ini can be specified, using the same format as in php.ini . Apply the settings via the command:
# plesk bin site --update-php-settings example.com -additional-settings nomail.ini
It will give the same effect as if the contents of the specified file were copied to the Additional configuration directives box in Plesk web GUI. Note: Each time this command is run, the previous settings will be overwritten. "
2,"Plesk shows 403 Forbidden on Linux: sw-engine-fpm: WARNING: Nothing matches the include pattern
Applicable to: Plesk for Linux Symptoms Unable to access Plesk. The following error is shown:
PLESK_INFO: 403 Forbidden The sw-engine service can not be started with the following error message:
# service sw-engine start Starting sw-engine-fpm: WARNING: Nothing matches the include pattern '/etc/sw-engine/pool.d/*.conf' from /etc/sw-engine/sw-engine-fpm.conf at line 6. ERROR: No pool defined. at least one pool section must be specified in config file ERROR: failed to post process the configuration ERROR: FPM initialization failed [FAILED] Cause
Plesk packages are not installed properly or removed.
Resolution
Run Plesk Installer and complete the installation.
If the issue persists, recreate the Plesk file manually: Create the plesk.conf file:
# touch /etc/sw-engine/pool.d/plesk.conf Open the created file in any text editor (for example, ""vi"" editor) and put the below content in it:
CONFIG_TEXT: [plesk] user = psaadm group = psaadm listen = /var/run/sw-engine.sock listen.owner = sw-cp-server listen.group = root listen.mode = 0600 pm = ondemand pm.start_servers = 0 ;pm.min_spare_servers = 2 ;pm.max_spare_servers = 8 pm.max_children = 26 pm.process_idle_timeout = 30s ;pm.max_requests = 10 ;slowlog = /var/log/sw-cp-server/slow.log ;request_slowlog_timeout = 10s ;catch_workers_output = yes request_terminate_timeout = 600s security.limit_extensions = .php .php3 env[PATH] = /usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin php_value[auto_prepend_file] = auth.php php_value[error_log] = /var/log/plesk/panel.log Start the sw-engine service:
# service sw-engine start "
0,"How to enable SOAP PHP extension in Plesk?
Applicable to: Plesk for Windows
Plesk for Linux Question
How to enable SOAP PHP extension in Plesk?
Answer For Plesk PHP SOAP classes are shipped and enabled by default in Plesk PHP.
To make sure they are enabled, perform the following actions: Log into Plesk Go to Tools & Settings > PHP Settings and select the required Plesk PHP version (e.g. 7.2.5 FPM application) Mark soap checkbox and press on OK. For OS Vendor PHP (Linux only) SOAP might not be available by default on the OS Vendor PHP Download this script into the server and run it to check whether or not it is enabled. If not, the script will enable it: Connect to the server via SSH Run the following command to download the script:
# wget https://support.plesk.com/hc/en-us/article_attachments/360011967119/213383629 && chmod +x 213383629 && ./213383629 "
0,"How to enable PEAR support for a domain in Plesk?
Applicable to: Plesk for Linux Question
A website application requires PEAR (PHP Extension and Application Repository) but it shows PEAR is not installed.
How to enable PEAR support for a domain in Plesk?
Answer Log in to Plesk GUI Go to Plesk > Domains > example.com > PHP settings > Common settings > Make sure that the include_path directive includes PEAR folder path relative to the selected PHP version. For example, if Plesk PHP 7.3 is selected, the PEAR folder is located in:
CONFIG_TEXT: .:/opt/plesk/php/7.3/share/pear Click here to expand image Copy PEAR folder path from include_path and append it in open_basedir directive as follows:
CONFIG_TEXT: {WEBSPACEROOT}{/}{:}{TMP}{/}:/opt/plesk/php/7.3/share/pear Click here to expand image Finally, check if PEAR was enabled correctly creating the pear.php file in the website public directory with the following content:
CONFIG_TEXT: <?php require_once 'System.php'; if (class_exists('System')) { echo 'PEAR is enabled'; } else { echo 'PEAR is NOT enabled'; }; ?> Additional Information
How to change PHP parameter for all domains on Plesk server?"
6,"Unable to add MS SQL database in Plesk: only MySQL database is available
Applicable to: Plesk Onyx for Windows Symptoms Unable to select MS SQL database under Subscriptions > example.com > Databases > Add Database > Database server: only MySQL database is available.
OR Unable to select MS SQL database under Databases > Add Database > Database server: only MySQL database is available. Cause
The number of MS SQL databases is limited for the webspace, subscription's or reseller's plan.
Resolution Web Admin Edition Log in to Plesk. Go to Tools & Settings > License Management and check if Microsoft SQL Server support enabled or not: If no, then it is required to purchase the MSSQL support first for the subscription.
MSSQL support is included in the Power Pack and Developer Pack. If yes, then proceed to step 3. Run the command below to get the current limit of MSSQL databases for the required webspace:
C:\> plesk bin subscription_settings --info example.com | findstr max_mssql_db max_mssql_db 30 MS SQL databases Increase the number of MSSQL databases for the required webspace (use the ""-1"" to set to the Unlimited value):
C:\> plesk bin subscription_settings -u example.com -max_mssql_db 100 plesk bin subscription_settings -u example.com -max_mssql_db -1 Web Pro and Web Host Editions Log in to Plesk. Go to Subscriptions > example.com > Account > Resources. Find the MS SQL databases number: If it reached its limit, increase it in the following way: Go to Subscriptions > example.com > Customize > Resources page and increase the MS SQL databases limit (changes will affect only this subscription).
OR Go to Subscriptions > example.com > Service Plan: Default > Resources page and increase the MS SQL databases limit (changes will affect all subscriptions assigned to this service plan). If it is not reached the limit, then this limit is set on the reseller's level as also. Follow to the next step. Go to Subscriptions > example.com > Subscriber: John Doe > Provider: Sarah Kerrigan. Click the Change Plan button (to increase the MS SQL databases number for all resellers assigned to this service plan)
OR
the Customize button (to increase the MS SQL databases number only for this reseller). Find the MS SQL databases number and increase it to the required value. Additional information Plesk available editions and difference between them Power Pack Developer Pack "
10,"How to back up and restore a snapshot of Web Presence Builder site through UI
Applicable to: Plesk Onyx for Linux
Plesk Onyx for Windows
Web Presence Builder for Linux Question
How to back up and restore a snapshot of Web Presence Builder site through GUI
Answer
A site snapshot may be created and restored through the main menu in GUI of Web Presence Builder.
To create site snapshot: In the "" Save "" tab click the button "" Save "" to create a site snapshot.
To restore site snapshot: "
8,"Webmail shows Invalid Address in sender field and No Subject in Topic, or Unknown Date of email on Windows
Applicable to: Plesk for Windows Symptoms If Horde is selected in Domains > example.com > Mail Settings > Webmail: in Domains > example.com > Email Addresses > jdoe@example.com > Webmail all emails contain ""Invalid Address"" in sender field and ""No Subject"" in Topic. Or it main contain ""Unknown Date"" of email. Size of all emails is 0 B. If MailEnable is selected in Domains > example.com > Mail Settings > Webmail: Emails are missing from Inbox folder. Emails are present in %plesk_dir%\Mail Servers\Mail Enable\Postoffices\example.com\MAILROOT\jdoe\Inbox. Cause
Corrupted file %plesk_dir%\Mail Servers\Mail Enable\Postoffices\example.com\MAILROOT\jdoe\Inbox\_index.xml
Resolution Connect to the server via RDP. Remove %plesk_dir%\Mail Servers\Mail Enable\Postoffices\example.com\MAILROOT\jdoe\Inbox\_index.xml file. "
3,"How to add domain specific Apache or nginx directives to web server configuration file on Plesk for Linux
Applicable to: Plesk for Linux Question
How to add domain directives (settings) Apache or Nginx directives to web server configuration file on Plesk for Linux?
Answer
To add domain-specific settings for Apache and Nginx web servers: Log into Plesk Go to Home > Subscriptions > example.com > Websites & Domains > Apache & nginx Settings Add required directives for Apache and nginx in Additional Apache directives/Additional nginx directives fields as in the example on the screenshot: Note: After pressing OK button, explicit configuration files will be created automatically in /var/www/vhosts/system/example.com/conf directory and related includes will be added to domain's httpd.conf file.
Additional Information
Additional information for advanced administrators can be found in Plesk Advanced Administrator Guide."
2,"Unable to rename or remove a domain in Plesk: mailmng-outgoing failed: ERROR:outgoing:No backend DB entries were modified
Applicable to: Plesk for Linux Symptoms Unable to manage domain settings (rename a domain, change a hosting type, add an email account, etc.):
PLESK_ERROR: mailmng-outgoing failed: ERROR:outgoing:No backend DB entries were modified. PLESK_ERROR: mailmng-outgoing failed: ERROR:outgoing:domain_aliases.domain_id may not be NULL In /var/lib/plesk/mail/outgoing/data.db SQLite database, there is a record about alias.example.com:
# sqlite3 /var/lib/plesk/mail/outgoing/data.db
MYSQL_LIN: sqlite> SELECT id,name,subscription_id,out_limit FROM domains WHERE name='alias.example.com'; 13|alias.example.com|11|500' There is no alias.example.com record in psa.domains table:
# plesk db 'select id, name from domains where name like ""%alias.example.com%"";' Empty set (0.00 sec) Cause
An inconsistency of internal database: a domain was not renamed.
Resolution Connect to the server using SSH. Create a backup of /var/lib/plesk/mail/outgoing/data.db database:
# cp /var/lib/plesk/mail/outgoing/data.db{,_bk} Log in to SQLite database:
# sqlite3 /var/lib/plesk/mail/outgoing/data.db Get the ID of the domain:
MYSQL_LIN: SELECT id,name,subscription_id,out_limit FROM domains WHERE name='alias.example.com'; 10|alias.example.com|1|130 Rename the domain using the domain ID from the previous step:
MYSQL_LIN: UPDATE domains SET name='example.com' WHERE id=10;
If it is necessary to remove domain, delete the related records from the database:
MYSQL_LIN: DELETE FROM domains WHERE id=10; Verify the directory /var/qmail/mailnames/example.com does not exist. If it exists, perform steps from this article: Unable to swap domain and domain alias names: boost::filesystem::filesystem_error Directory not empty Note: if additional errors occur during the attempt to rename a domain, step 5 should be repeated."
8,"How to check that SpamAssassin service is working fine Applicable to: Plesk for Linux Question
How to check that SpamAssassin is working fine?
Answer
Note: If some interface sections are not visible, contact server's administrator or Hosting Support. To make sure that SpamAssassin is working fine, check the following points: Make sure that the SpamAssassin service is running at Tools & Settings > Services Management. Make sure that the Switch on spam filtering for this email address option is enabled at Domains > example.com > Email Addresses > john_doe@example.com > Spam Filter tab. Test SpamAssassin using the steps from this KB article. When SpamAssasin detects spam, the following messages appears in /usr/local/psa/var/log/maillog (can be checked via an SSH connection only):
CONFIG_TEXT: spamd[1107]: spamd: identified spam (1000.0/7.0) for test@domain.tld:110 in 6.1 seconds, 3926 bytes. If all the above steps are successful - SpamAssassin is working fine. It is possible to improve the accuracy of SpamAssassin spam detection, if SpamAssassin spam filter is switched on for an email account and the access is performed using the IMAP protocol. To improve the accuracy of spam detection: Access your mailbox with webmail or a mail client program on your computer. Review the messages in your Inbox folder. Manually move all spam messages to the Spam folder. This will make the SpamAssassin spam filter recognize spam more efficiently. "
3,"Tomcat application is marked with an orange/yellow circle with an exclamation mark inside
Applicable to: Plesk for Linux
Plesk for Windows Symptoms Tomcat application is marked with an orange/yellow circle with an exclamation mark inside. When hovering over the exclamation mark, the following message is displayed:
CONFIG_TEXT: Actual status of the application does not correspond to the status retrieved from the database Uploading a tomcat application in Domains > example.com > Java Applications fails with an error message:
PLESK_ERROR: Unable to start up Java application: Possible reason - Tomcat Java service is not currently running on the server. Cause
Plesk can't reach the application for one of the following reasons: Tomcat service is not running on a server
Tomcat service is not enabled for a domain
Domain is not resolved to a Plesk IP
Application is not packed into a valid .war package
Incorrect code in the application itself Resolution
Warning: Support for Apache Tomcat is dropped in Plesk Onyx 17.8. In previous Plesk versions, it will be supported until reaching End-of-Life according to the Plesk Lifecycle Policy.
Depending on the cause, use the following solution: Start Tomcat service in Tools and Settings > Services Management: Enable Tomcat service for a domain in Domains > example.com > Java Applications > click Switch On The domain should be properly resolved to correct Plesk IP address: IP address in Domains > example.com > Web Hosting Access should be the same as the IP resulted in pinging domain:
# ping example.com PING example.com (203.0.113.2) 56(84) bytes of data. 64 bytes from 203.0.113.2: icmp_seq=1 ttl=57 time=176 ms The application should be packed into a valid .war package. The application cannot be loaded due to code in the application itself. Additionally, reconfigure Tomcat for Plesk for Windows: Connect to the server using RDP Open Windows Command Prompt (CMD) in a Windows server: Right-click the Start menu, and then click Command Prompt (Admin). Execute the following command:
C:\> ""%plesk_dir%\\bin\\repair.exe"" --reconfigure-tomcat Additional information
Check Tomcat logs in order to get more details about the issue:
Plesk for Linux services logs and configuration files
Plesk for Windows services logs and configuration files
Does Plesk Onyx support Apache Tomcat?"
3,"Plesk Websites are periodically down or displays default domain page - Cannot allocate memory: mod_fcgid: can't run /var/www/cgi-bin/cgi_wrapper/cgi_wrapper
Applicable to: Plesk for Linux Symptoms Apache website(s) on CloudLinux server experience intermittent connection issues or do not allow any new connections. During this time the following errors in the apache /var/log/httpd/error_log can be observed:
CONFIG_TEXT: [Tue Sep 13 02:17:55.901911 2016] [fcgid:error] [pid 372341:tid 139699248486464] (12)Cannot allocate memory: mod_fcgid: can't run /var/www/cgi-bin/cgi_wrapper/cgi_wrapper[Tue Sep 13 02:17:55.901938 2016] [fcgid:warn] [pid 372341:tid 139699248486464] (12)Cannot allocate memory: mod_fcgid: spawn process /var/www/cgi-bin/cgi_wrapper/cgi_wrapper error...mmap() failed: [12] Cannot allocate memory Additionally, failcnt counter in /proc/user_beancounters is increasing for privvmpages limit.
# grep -B2 privvmpages /proc/user_beancountersVersion: 2.5 uid resource held maxheld barrier limit failcnt 10024: kmemsize 0 0 9223372036854775807 9223372036854775807 0 lockedpages 0 0 9223372036854775807 9223372036854775807 0 privvmpages 0 262144 9223372036854775807 262144 197598 Cause
CloudLinux LVE limits are exhausted.
Resolution
Adjust LVE limits accordingly. Please refer to CloudLinux Documentation for additional information about CloudLinux limits.
It is possible to adjust such limits per user using LVE Manager extension in Plesk, which is available under Extensions > My Extensions > LVE Manager."
5,"Unable to start migration in Plesk for Windows: Error: RPC agent on source server '203.0.113.2' is running not under built-in administrator account
Applicable to: Plesk for Linux
Plesk for Windows Symptoms When starting the migration, the following error is shown in Plesk UI:
PLESK_ERROR: Error: RPC agent on source server '203.0.113.2' is running not under built-in administrator account. When starting RPC agent on source server manually, the following warning appears:
CONFIG_TEXT: [WARNING] RPC agent was started by not built-in administrator. Despite that it is ready to accept connections, Plesk Migrator could be unable to interact with it. You should ignore this warning in case of migration from Helm 3: Plesk Migrator will be able to interact with RPC agent, started by Helm Administrator account. Migration is started with the account other than built-in Windows ""Administrator"" account. Cause
Migration is started not under the built-in Administrator account. In this case, Plesk Migrator is unable to perform the different operation in the source server because of lack of permissions.
Resolution
Start migration using built-in Windows Administrator account. Built-in Windows Administrator is configured in Control Panel > Administrative Tools > Computer Management > Local Users and Groups > Users. More information about the migration can be found in the Migration Guide."
7,"Plesk update failed: RPMDB altered outside of yum
Applicable to: Plesk for Linux Symptoms Installing updates either via Plesk panel or on a command line fails with the following error occurs:
CONFIG_TEXT: ERROR: Failed to run the Yum utility. The Yum utility failed to install the required packages. Attention! Your software might be inoperable. Please, contact product technical support. There are the following records in /var/log/plesk/install/autoinstaller3.log file:
CONFIG_TEXT: Warning: RPMDB altered outside of yum. Exception: Scriptlet or other non-fatal errors occurred during transaction. YumDownloadError: [u'Errors were encountered while downloading packages. failure: [Errno 256] No more mirrors to try.'] Cause
Yum cache failed to fetch the required repositories.
Resolution Connect to the server via SSH.
Note: if direct SSH access to the server is not possible, contact server administrator for further assistance. Backup RPM database files:
# cd /var/lib/rpm/ # mv __db.* ~ Clear yum cache by following steps below:
# rm -rf /var/lib/rpm/__db.*
# rpm --rebuilddb
# yum clean all
# yum makecache Start update again. "
7,"How to install myLittleAdmin on Plesk for Windows?
Applicable to: Plesk Onyx for Windows Symptoms
How to install myLittleAdmin on Plesk for Windows?
Resolution Log into Plesk;
Open Plesk Installer in Tools & Settings > Updates and Upgrades;
Click on Add/Remove Components and select myLittleAdmin for installation: Proceed with installation.
"
4,"[FIXED BUG] Unable to edit posts or use plugin dashboard in WordPress dashboard after applying security measures by Plesk WordPress Toolkit
Applicable to: Plesk for Linux Symptoms The security measure Security of the wp-content folder is applied for the WordPress instance at Domains > example.com> WordPress > select a WordPress instance in question > Security Status (Check Security in older WordPress Toolkit versions). When using a 3rd-party editor (e.g. TinyMCE Advanced or Elementor) in WordPress dashboard, the editor's interface is not fully loaded or it is not possible to edit posts. The following error is thrown in a browser:
PLESK_INFO: Forbidden You don't have permission to access /web/wp-includes/js/tinymce/wp-tinymce.php on this server.
In some cases, the ""403 Forbidden nginx"" error is shown after clicking Update/Publish/etc. One of the following error messages appears: in the domain's proxy_error_log file /var/www/vhosts/example.com/logs/proxy_error_log:
CONFIG_TEXT: [error] 23560#0: *5116 access forbidden by rule, client: 203.0.113.2, server: example.com, request: ""GET /wp-includes/js/tinymce/wp-tinymce.php?c=1&ver=4607-20171116-tadv-4.6.7 HTTP/2.0"", host: ""example.com"", referrer: ""https://example.com/wp-admin/post.php?post=198&action=edit"" in the domain's error_log file /var/www/vhosts/system/example.com/logs/error_log:
CONFIG_TEXT: [error] [client 203.0.113.2] client denied by server configuration: /var/www/vhosts/example.com/web/wp-includes/js/tinymce/wp-tinymce.php [error] [client 203.0.113.2] client denied by server configuration: /var/www/vhosts/example.com/web/wp-includes/js/tinymce/wp-tinymce.php Cause
This is a WordPress Toolkit bug with ID EXTWPTOOLK-1102 which was fixed in the Wordpress Toolkit 3.5.0 version
Resolution
Update Wordpress Toolkit extension to the latest version.
In case update is not possible, apply one of the following solutions: Workaround 1: Exclude the sub-directory /wp-content/plugins/ Log in to Plesk Go to Domains > example.com > Apache & nginx settings and add the following directives to the Additional nginx directives field:
CONFIG_TEXT: location ~* wp-config.php { deny all; } location ~* ""^/wp-content/(?!plugins/).*\.php"" { deny all; } Check if the issue has gone. If plugin operability is still broken, revert the changes and apply the solution below. Workaround 2: Revert the security measure Log in to Plesk Go to Domains > example.com > WordPress > select a WordPress instance in question > Security Status (Check Security in older WordPress Toolkit versions). Select Security of the wp-content folder and click Revert (Roll Back in older WordPress Toolkit versions).
Note: If a WordPress plugin still fails to work correctly, additionally revert the security measure Security of the wp-includes folder. "
8,"Mails are not delivered to a local mailbox of a domain in Plesk
Applicable to: Plesk for Linux
Plesk for Windows Symptoms Incoming emails (from @gmail) sent to a Plesk domain (@example.com) are being returned Outgoing e-mails are delivered fine (from Plesk server to other servers) Mail service is enabled for the domain MX record is resolved to another server globally:
# dig mx example.com +short @8.8.8.8 10 mail.example.com. # dig mail.example.com +short 203.0.112.2
or does not resolve at all:
# dig mx example.com +short @8.8.8.8 # Cause
The MX record in the DNS zone of example.com is not set correctly.
Resolution
Click on a section to expand If the DNS zone of example.com is managed in Plesk: Log in to Plesk Domains > example.com > DNS Settings
Make sure that configured MX record is resolved to the correct IP address and mail server. Contact your domain registrar for assistance. If the DNS zone of example.com is not managed in Plesk. Contact the domain name administrator or the domain registrar to perform such change in the DNS zone. Note: In any case, DNS propagation to Internet may take from 24 to 48 hours.
Additional Information
Adding and Modifying DNS Records"
3,"Website configured in Plesk is not accessible: 500 Internal Server Error: Config section already defined
Applicable to: Plesk for Windows Symptoms Website configured in Plesk shows:
PLESK_INFO: 500 Internal Server Error An attempt to reconfigure the website fails:
C:\> plesk repair web example.com Repairing web server configuration Repairing web server configuration for the domain example.com ..... [FAILED] - Filename: \\?\D:\Inetpub\vhosts\example.com\httpdocs\web.config Line number: 8 Error: Config section 'system.web/compilation' already defined. Sections must only appear once per config file. See the help topic for exceptions Accessing IIS > Sites > example.com > ASP results in error message: Cause
Duplicate section in the domain configuration file.
Resolution Log in to Plesk
Go to Domains > example.com > File manager and open web.config file: Remove or comment out the duplicate section mentioned in the error message:
CONFIG_TEXT: <compilation debug=""true"" targetFramework=""4.0""> <assemblies> <add assembly=""Microsoft.Build.Framework, Version=4.0.0.0, Culture=neutral, PublicKeyToken=************"" /> <add assembly=""System.Management, Version=4.0.0.0, Culture=neutral, PublicKeyToken=************"" /> </assemblies> <buildProviders> <add extension="".rdlc"" type=""Microsoft.Reporting.RdlBuildProvider, Microsoft.ReportViewer.WebForms, Version=10.0.0.0, Culture=neutral, PublicKeyToken=***********"" /> </buildProviders> </compilation> Connect to the server over RDP Open Windows command-line and reconfigure the domain:
C:\> plesk repair web example.com "
3,"How to configure PHP handlers in Plesk for Linux? Applicable to: Plesk for Linux Question
How to configure what PHP handler will be used for processing PHP scripts? Answer
The following of PHP handlers can be configured: Apache module
FastCGI
CGI
PHP-FPM The choice should depend on security considerations, script execution speed, and memory consumption.
Log in to Plesk and select PHP handler for a service plan or a website correspondingly in: service plan settings at Service Plans > Example plan > PHP Settings > run PHP as website settings at Hosting Panel > Websites & Domains > example.com > Hosting Settings > Run PHP as Note: switching PHP from Apache module to FastCGI application may impair the functionality of existing PHP scripts. Switching to PHP-FPM by selecting Process PHP by nginx in the website’s web server settings may do the same.
Plesk supports different versions of PHP. For each available handler, one or more PHP versions can be selected. "
8,"Unable to send mail out to certain domain with Qmail: SSL_routines: SSL3_CHECK_CERT_AND_ALGORITHM: dh_key_too_small Applicable to: Plesk for Linux Symptoms Unable to send mail out from Plesk to certain domain with Qmail.
Errors in /var/log/maillog :
CONFIG_TEXT: sendmail[5616]: STARTTLS=client: 5616:error:14082174:SSL routines:SSL3_CHECK_CERT_AND_ALGORITHM:dh key too small:s3_clnt.c:2429:
CONFIG_TEXT: qmail: delivery deferral: TLS_connect_failed:_error:14082174:SSL_routines:SSL3_CHECK_CERT_AND_ALGORITHM:dh_key_too_small;_connected_to_203.0.113.2/ Cause
Different security settings on the servers: destination mail server has a Diffie-Hellman key with size less than 768 bit, but recent versions of OpenSSL in Plesk consider such keys as insecure.
Resolution
Use either of the following solutions: Switch to Postfix
If Qmail still needed, contact administrators of the destination mail server in order to update the keys to the more secure ones.
Log in to Plesk server using SSH and allow it to connect to non-secure remote mail servers:
Warning: this will decrease the server security and might be used only in case of emergency! click here to view the options Option I: Add the remote mail server to trusted hosts list in Qmail:
# mkdir -p /var/qmail/control/notlshosts # touch /var/qmail/control/notlshosts/mail.example.com
Note: Qmail will start sending messages without TLS encryption to such domains.
Option II: Contact system administrator to downgrade openssl package. Option III: Disable DH keys exchange for Qmail outgoing connections to destination mail servers:
# echo 'DEFAULT:!DH' > /var/qmail/control/tlsclientciphers
Note: this solution affects connections to all mail servers and potentially can lead to connection problems to some servers.
Restart Qmail to apply the changes:
# service qmail restart "
3,"How to install the php-mcrypt module on a Plesk server
Applicable to: Plesk for Linux Question
mcrypt module is missing for PHP in Tools & Settings > PHP Settings > <PHP version>. How to install the php-mcrypt module on a Plesk server?
Answer
Plesk PHP handlers up to 7.1 version are shipped with the mcrypt module enabled by default. PHP handlers provided by Plesk can be installed via Plesk Installer and selected at Domains > example.com > PHP settings.
For other PHP handler versions, mcrypt module must be compiled manually: For Plesk PHP 7.2 Note: mcrypt extension was recently updated and now supports PHP 7.2 and newer. Vote for this feature suggestion for mcrypt support out of the box.
Note: the same procedure can be applied for PHP 7.3 Connect to the server via SSH Install the required dependencies: On RHEL, CentOS and CloudLinux:
# yum install -y epel-release
# yum install --enablerepo=epel -y plesk-php72-devel gcc libmcrypt-devel On Debian and Ubuntu:
# apt install -y plesk-php72-dev gcc libmcrypt-dev make Build the mcrypt extension:
# /opt/plesk/php/7.2/bin/pecl install mcrypt-1.0.1
Note: for PHP 7.3 use mcrypt-1.0.2 Enable the extension in PHP configuration:
# echo 'extension=mcrypt.so' > /opt/plesk/php/7.2/etc/php.d/mcrypt.ini Refresh information about installed PHP modules
# plesk bin php_handler --reread To apply changes reload web server Apache and PHP-FPM service: On Ubuntu, Debian:
# service apache2 reload # service plesk-php72-fpm reload
On CentOS:
# service httpd reload # service plesk-php72-fpm reload For PHP provided by OS vendor Connect to a Plesk server via SSH Install the module: On RHEL-based distributions (RHEL, CentOS, CloudLinux):
# yum install -y epel-release # yum install -y php-mcrypt on Debian-based distributions (Debian, Ubuntu):
# apt-get install php5-mcrypt -y || apt-get install mcrypt php7.0-mcrypt -y || apt-get install php-mcrypt -y Refresh information about installed PHP modules
# plesk bin php_handler --reread Reload PHP-FPM and Apache to make the module available for websites:
# systemctl reload php-fpm php7.0-fpm apache2 httpd
OR for CentOS 6:
# service httpd reload # service php-fpm reload Solution to fix ""Autoconf version 2.68 or higher is required"" Note: In case of below the error
CONFIG_TEXT: error: Autoconf version 2.68 or higher is required /usr/bin/m4 failed with exit status: 63
first following steps should be applied to replace Autconf version 2.63 with Autoconf version 2.68 provided by Plesk:
# mv /usr/bin/autoconf{,.bkps} # ln -s /usr/bin/autoconf268 /usr/bin/autoconf # mv /usr/bin/autom4te{,.bkps} # ln -s /usr/bin/autom4te268 /usr/bin/autom4te "
6,"MyLittleAdmin does not show a list of databases on a Plesk for Windows server: Retrieving data Applicable to: Plesk for Windows Symptoms MyLittleAdmin shows ""Retrieving data.."" instead of a list of databases. The following error message appears in Windows Event viewer:
CONFIG_TEXT: URL that was requested does not exist. The page isn't redirecting properly. SQL Server 2008 R2 or newer is installed. Cause
Auto Close option is enabled for databases.
Resolution
It is recommended to disable the 'AUTO_CLOSE' option if a database is used often on a production environment. Connect to the Plesk server via RDP. Start SQL Management Studio. Run the following query:
CONFIG_TEXT: ALTER DATABASE model SET AUTO_CLOSE OFF Run this script to disable AUTO_CLOSE on all databases:
CONFIG_TEXT: USE MASTER declare @isql varchar(2000), @dbname varchar(64) declare c1 cursor for select name from master..sysdatabases where name not in ('master','model','msdb','tempdb') open c1 fetch next from c1 into @dbname While @@fetch_status <> -1 begin select @isql = 'ALTER DATABASE @dbname SET AUTO_CLOSE OFF' select @isql = replace(@isql,'@dbname',@dbname) print @isql exec(@isql) fetch next from c1 into @dbname end close c1 deallocate c1 Additional Information Recommendations and guidelines for setting the AUTO_CLOSE database option in SQL Server "
8,"Mail delivery from Plesk to Gmail account fails: certificate verification failed for *.l.google.com: untrusted issuer
Applicable to: Plesk for Linux Symptoms
Outgoing mail delivery to Gmail (or other servers which has SSL enabled and configured with valid certificate) accounts fails with error in /usr/local/psa/var/log/maillog :
from=<local@example.com>, size=666, nrcpt=1 (queue active)certificate verification failed for gmail-smtp-in.l.google.com: untrusted issuer /C=US/O=Equifax/OU=Equifax Secure Certificate AuthorityF01C9680292: to=<test@gmail.com> Note: There may be another address of Gmail's SMTP server, like aspmx.l.google.com . This solution is valid for any cases where messages contain untrusted issuer string.
Cause
Certificate Authority (CA) certificate is missing in /etc/postfix/main.cf .
The server does not trust valid CAs.
Resolution Connect to the server via SSH. Make sure that file /etc/pki/tls/certs/ca-bundle.crt exists (it contains information about valid CAs).
# ls -l /etc/pki/tls/certs/ca-bundle.crtlrwxrwxrwx. 1 root root 49 Apr 8 00:59 /etc/pki/tls/certs/ca-bundle.crt -> /etc/pki/ca-trust/extracted/pem/tls-ca-bundle.pem Update OpenSSL package if possible in order to get fresh version of CA bundle: For RHEL/CentOS:
# yum update openssl For Debian/Ubuntu:
# apt-get install --only-upgrade openssl Add line smtp_tls_CAfile to /etc/postfix/main.cf file as shown below:
# grep smtp_tls_CAfile /etc/postfix/main.cf smtp_tls_CAfile = /etc/pki/tls/certs/ca-bundle.crt Restart postfix daemon to apply the changes:
# /etc/init.d/postfix restart Stopping postfix: [ OK ] Starting postfix: [ OK ] "
9,"[FIXED BUG] Unable to create a CNAME DNS record with the underscore symbol ""_"": The specified domain name is not valid Applicable to: Plesk for Linux Plesk for Windows Symptoms
Unable to create a CNAME DNS record with the underscore symbol ""_"" in Domains > example.com > DNS Settings > Add Record > CNAME:PLESK_ERROR: The specified domain name is not valid. You need to specify a valid domain name like domain.com.
Cause Product issue: #PPPM-4301 ""Fixed the issue where users could not use the underscore character (_) in domain names and CNAME DNS records.""Fixed in: Plesk Onyx 17.5 23 April 2018 Plesk Onyx 17.8 17 April 2018 Resolution
Please consider updating your server: How to install Plesk updates Workaround
Upgrade Plesk to the latest release:
How to upgrade Plesk to the next release Click on a section to expand
Alternatively, create a DNS record via a command-line interface: Warning: The below workaround was tested only in Plesk 12.5 and Onyx 17.0, 17.5. For Plesk versions prior to 12.5, the only solution is to upgrade or migrate to a Plesk version where the bug is fixed (Onyx 17.5 with the latest updates or Onyx 17.8). Connect to a Plesk server using SSH or RDP. Run the command below. Replace values in bold with actual values:
# plesk bin dns --add example.com -cname _sample -canonical example.org Warning: The above workaround was tested only in Plesk 12.5 and Onyx 17.0, 17.5. For Plesk versions prior to 12.5, the only solution is to upgrade or migrate to a Plesk version where the bug is fixed (Onyx 17.5 with the latest updates or Onyx 17.8).
Once done, the record will appear in DNS Setting of a domain in Domains > example.com > DNS Settings. "
0," How to get/reset lost Plesk Administrator password in Plesk for Linux
Applicable to: Plesk for Linux Question
A password of the Plesk ""admin"" user is lost.
How to get/reset it?
Answer
Connect to a Plesk server via SSH and use the instructions applicable to your Plesk version.
Note: The commands presented below to change the admin user password, do also change the password for MySQL ""admin"" user. To restore the password for MySQL ""admin"" user, visit this KB article. Plesk Obsidian / Plesk Onyx Getting a password
For security reasons, the command to retrieve a Plesk ""admin"" password has been removed starting from Plesk Onyx.
Use a one-time login link to log in to Plesk without a password. To generate a one-time login link: Run the following command to generate two links: One - to access Plesk by its hostname, another - by server IP address:
# plesk login
Note: If a server hostname is not resolvable from the Internet, hostname link will not be generated. Copy one of the generated links and open it in a web-browser. Resetting a password
Run the command below replacing ***** with your new password and keeping ' ' on the sides:
# plesk bin admin --set-admin-password -passwd '*****' Plesk 12.x / Plesk 11.x / Plesk 10.x Getting a password
Run the command below to get a Plesk ""admin"" password: Plesk 12.x
# plesk bin admin --show-password Plesk 11.x / Plesk 10.x
# /usr/local/psa/bin/admin --show-password Resetting a password
Run the command below replacing ***** with your new password and keeping ' ' on the sides: Plesk 12.x
# plesk bin admin --set-admin-password -passwd ""*****"" Plesk 11.x / Plesk 10.x
# /usr/local/psa/bin/init_conf -u -passwd ""*****"" Related Articles How to enable authentication in Plesk via social networks
How to reset a password of a Plesk user account
How to get/reset a Plesk Administrator password in Plesk for Windows Server
Unable to access Plesk on Linux: Access denied for user 'admin'@'localhost' (using password: YES)
"
0,"Which cPanel versions are compatible with Web Presence Builder Standalone? Applicable to: Web Presence Builder for Linux Question
Which cPanel versions are compatible with Web Presence Builder Standalone?
Answer
The latest supported version of cPanel compatible with the latest version of the Web Presence Builder plugin for cPanel is cPanel 78.
The WPB plugin for cPanel was not tested with later cPanel versions."
3,"[BUG] Plesk PHP FPM 7.0 service is down after switching to it from another FPM handler
Applicable to: Plesk for Linux Symptoms Plesk PHP FPM 7.0 service is down after switching website from another FPM handler to Plesk PHP FPM 7.0 The following error is shown in /var/log/plesk-php70-fpm/error.log ERROR: An another FPM instance seems to already listen on /var/www/vhosts/system/example.com/php-fpm.sockERROR: FPM initialization failed File /var/www/vhosts/system/example.com/php-fpm.sock does not exist:
# ls -la /var/www/vhosts/system/example.com/php-fpm.sockls: cannot access /var/www/vhosts/system/example.com/php-fpm.sock: No such file or directory Systemd is installed and enabled. Error in Plesk UI:
phpinimng failed: invoke-rc.d: initscript plesk-php70-fpm, action ""status"" failed. invoke-rc.d: initscript plesk-php70-fpm, action ""status"" failed. Service plesk-php70-fpm is down after attempt to start it Cause
This is a software issue with internal ID #PPPM-4004 which is planned to be fixed in future Plesk updates.
Resolution
Until the fix becomes available, use the following workaround: Connect to the server via SSH; Create a custom systemd unit file with 3 sec timeout on restart using any text editor:
For Debian-based systems:
# cat /etc/systemd/system/plesk-php70-fpm.service .include /lib/systemd/system/plesk-php70-fpm.service [Service] Restart= on-failure RestartSec= 3
For RHEL-based systems:
# cat /etc/systemd/system/plesk-php70-fpm.service .include /usr/lib/systemd/system/plesk-php70-fpm.service [Service] Restart= on-failure RestartSec= 3 "
0,"How to switch a domain to nginx-only hosting in Plesk
Applicable to: Plesk Onyx for Linux Question
How to switch a domain to nginx-only hosting (without Apache) in Plesk?
Answer
Notes: This functionality is available starting from Plesk Onyx with the nginx reverse proxy component enabled.Plesk services (for example, Webmail) continue working using Apache and are not affected by switching to nginx-only hosting. Sites that use rewrite rules from .htaccess files will not work because .htaccess file is not handled by nginx. ModSecurity also doesn't work for sites with nginx-only hosting. After switching a domain to nginx-only hosting, make sure it is working with nginx. For WordPress websites it is required to add additional nginx directives. For more information, visit this KB article. Switching on nginx-only hosting for a domain In Plesk, go to Domains > example.com > Apache & nginx Settings. In the nginx settings section, disable the Proxy mode setting. Apply the changes. Switching on nginx-only hosting for all new domains under a service plan In Plesk, go to Service Plans > Example Plan > Web Server tab. In the nginx settings section, disable the Proxy mode setting. Click Update & Sync. Additional Information Customer's Guide: Nginx-Only Hosting
"
9,"Unable to update web-statistics: ""PHP Fatal error: Allowed memory size of bytes exhausted""
Applicable to: Plesk for Linux Symptoms The web-statistics calculation does not work: The values at Tools & Settings > Traffic Usage by Domains (under Statistics) are not updated. When manually recalculating the statistics for a domain, the operation results in one of the following error messages:
# /usr/local/psa/admin/sbin/statistics --calculate-one --domain-name=example.comPHP Fatal error: Allowed memory size of 134217728 bytes exhausted (tried to allocate 62390354 bytes) in /usr/local/psa/admin/plib/Service/Agent/Transport/Local/Exec.php on line 240
OR
# /usr/local/psa/admin/sbin/statistics --calculate-one --domain-name=example.comWARNING during statistics_collector execution: : statistics_collector: Unable to parse pending domains traffic line: ?:: 2014-10-2 smtp 0System error 11: Resource temporarily unavailable The Daily Maintenance tasks are executed on a daily basis and shown as completed in the cron logfile:
# grep 50plesk-daily /var/log/cronMay 14 13:22:01 server run-parts(/etc/cron.daily)[1287]: starting 50plesk-dailyMay 14 13:25:13 server run-parts(/etc/cron.daily)[2867]: finished 50plesk-daily Cause The statistics_collector processes are not responding. PHP memory limit is exceeded. Resolution Connect to the Plesk server via SSH. Kill all existing statistics_collector processes using their PIDs:
# ps auxww | grep stat*root 7935 0.0 0.0 86568 3676 ? S 09:43 0:00 /usr/local/psa/admin/bin/statistics_collectorroot 7964 0.0 0.0 86568 3140 ? S Dec18 0:00 /usr/local/psa/admin/bin/statistics_collectorroot 11027 0.0 0.0 86568 3676 ? S 09:49 0:00 /usr/local/psa/admin/bin/statistics_collectorroot 11515 0.0 0.0 86716 3668 ? S Dec10 0:01 /usr/local/psa/admin/bin/statistics_collector# kill -15 7935 7964 11027 11515 Increase memory_limit in PHP configuration of Plesk:
3.1. Open the file /usr/local/psa/admin/conf/php.ini in any text editor. In this example, we are using the vi editor:
# vi /usr/local/psa/admin/conf/php.ini
3.2. Navigate to the line memory_limit and increase the value to 1024M.
3.3. Save the changes and close the file. Restart the sw-cp-server service to apply the changes:
# service sw-cp-server restart Recalculate statistics for all domains with the command:
# /usr/local/psa/bin/sw-engine-pleskrun /usr/local/psa/admin/plib/DailyMaintainance/script.php -f ExecuteWebStatistics "
5,"[FIXED BUG] Migration from Plesk 12 fails: not well-formed (invalid token)
Applicable to: Plesk for Linux Symptoms Migration failed with the following errors:
PLESK_INFO: Unable to check the ability to migrate the selected domains. The migration of these domains will likely be blocked. [ERROR] Failed to perform action: Fetch information from target servers Cause: not well-formed (invalid token): line 322, column 33 That is a critical error, migration was stopped. The sourse server uses Plesk 12.5 or older. Cause
Passwords for some users on the source server cannot be encrypted properly. It is Plesk bug #PPPM-3752 which was fixed in Plesk Onyx 17.0.
Resolution
Consider updating the source server to Plesk Onyx 17.0 or higher.
If update is not possible for some reason, use the following workaround for Plesk 12.5: Connect to the server via SSH. Download the attached regenerate-broken-passwords.php file:
# wget https://support.plesk.com/hc/en-us/article_attachments/115004354685/regenerate-broken-passwords.tar Extract it: on Debiab-based systems:
# tar -C /opt/psa/admin/plib/scripts -xvf ./regenerate-broken-passwords.tar# chmod 644 /opt/psa/admin/plib/scripts/regenerate-broken-passwords.php on RHEL-based systems:
# tar -C /usr/local/psa/admin/plib/scripts -xvf ./regenerate-broken-passwords.tar# chmod 644 /usr/local/psa/admin/plib/scripts/regenerate-broken-passwords.php Run the script: on Debiab-based systems:
# /opt/psa/bin/sw-engine-pleskrun /opt/psa/admin/plib/scripts/regenerate-broken-passwords.php --help on RHEL-based systems:
# /usr/local/psa/bin/sw-engine-pleskrun /usr/local/psa/admin/plib/scripts/regenerate-broken-passwords.php --help There are two options: show - Show entities (db users, mail users, ftp users) with passwords which cannot be encrypted Use show option to get the list of users with broken passwords:
# /opt/psa/bin/sw-engine-pleskrun /opt/psa/admin/plib/scripts/regenerate-broken-passwords.php --show run - Regenerate passwords which cannot be encrypted (db users, mail users, ftp users). Use run option to regenerate affected passwords so that migration could be completed:
# /opt/psa/bin/sw-engine-pleskrun /opt/psa/admin/plib/scripts/regenerate-broken-passwords.php --run "
0,"Is ProFTPd 1.3.5 package shipped with Plesk affected by CVE-2015-3306? Applicable to: Plesk Onyx for Linux Question
ProFTPD 1.3.5 is affected by CVE-2015-3306 vulnerability. Does it mean that ProFTPD 1.3.5 shipped with Plesk is vulnerable too? Answer
Note: non-technical guys: no, it is not affected.
Plesk Onyx 17.0 and 17.5 are shipped with ProFTPD package 1.3.5d compiled without ""mod_copy"" module, and therefore, are not vulnerable.
For example, Plesk Onyx 17.5 on CentOS 6:
# rpm -qa | grep psa-proftpdpsa-proftpd-1.3.5d-cos6.build1705170314.14.x86_64# /usr/sbin/proftpd -V | grep -i configure | grep mod_copy# To make sure that ProFTPd is not vulnerable:
# telnet localhost 21Trying ::1...Connected to localhost.Escape character is '^]'.220 ProFTPD 1.3.5 Server (ProFTPD) [::1]site cpfr /etc/passwd500 'SITE CPFR' not understoodquit221 Goodbye.
Note: Plesk Onyx 17.8 and Obsidian are shipped with proFTPd 1.3.6 which are built without ""mod_copy"" module and therefore, are not vulnerable."
2,"How to change IP address for multiple subscriptions using CLI on Linux?
Applicable to:
Plesk for Linux
Question
How to change IP addresses for multiple subscriptions using CLI?
Answer Assign a specific IP to all subscriptions Connect to the server via SSH; Use the subscription utility to change the IP's for all subscriptions available: For IPv4 addresses only:
# for sub in `plesk bin subscription -l`; do plesk bin subscription -u $sub -ip 203.0.113.2; done For both IPv4 and IPv6 addresses:
# for sub in `plesk bin subscription -l`; do plesk bin subscription -u $sub -ip 203.0.113.2,2001:db8:f61:a1ff:0:0:0:80; done Note: the feature of configuring IPv6 addresses separately via CLI is not implemented it Plesk yet. Take part in our product improvement by referring to the following link: https://plesk.uservoice.com/forums/184549-feature-suggestions Change IP for subscriptions currently assigned to a specific IP address Warning: both IP addresses, have to be present in Tools & Settings > IP Addresses list. Connect to the server via SSH; Create the list of all subscriptions on a server, which IP-addresses are equal to 203.0.113.2:
# plesk db -Ne ""select d.name from IP_Addresses ipa join IpAddressesCollections ipac on ipac.ipAddressId=ipa.id join DomainServices ds on ds.ipCollectionId=ipac.ipCollectionId join domains d on d.id=ds.dom_id join Subscriptions s on s.object_id=d.id where ds.type='web' and ipa.ip_address='203.0.113.2'"" > list Use the subscription utility to change the IP's for all subscriptions in the list file to 203.0.113.3:
# while read i; do plesk bin subscription -u $i -ip 203.0.113.3; done< list
Warning: In case there are resellers using IP 203.0.113.2, launching the command above will lock them and they will not be able to synchronize with their Service Plans. In order to avoid this, add new IP address to resellers service plan first.For example, the following command will add the address to ""Default Reseller"" Service Plan pool:
# plesk bin reseller_plan --update 'Default Reseller' -ip_pool add:203.0.113.3 "
2,"Unable to open a subscription/domain in Plesk: Domain Service Web not exists
Applicable to: Plesk for Linux
Plesk for Windows Symptoms Unable to open or search the subscription example.com. The following error message is shown in a browser:
PLESK_INFO: Internal error: Domain Service Web not exists: domain=example.com, id=57 Message Domain Service Web not exists: domain=example.com, id=57 File DSWeb.php Line 76 Type PleskFatalException The domain example.com does not exist physically on the server:
# ls -ld /var/www/vhosts/example.com ls: cannot access /var/www/vhosts/example.com: No such file or directory Cause
Inconsistency in the Plesk database: orphaned records from the domain exist in domains and dns_recs tables.
Resolution Connect to a Plesk server via SSH or RDP Create a backup of the Plesk database Login into Plesk database Remove an orphaned record from the ""psa.domains"" table:
MYSQL_LIN: mysql> select id,name,displayName from domains where name like '%example.com%'\G; *************************** 1. row *************************** id: 57 name: example.com displayName: example.com mysql> delete from domains where name = 'example.com'; Query OK, 1 row affected (0.01 sec) Remove orphaned records from the ""psa.dns_recs"" table:
MYSQL_LIN: mysql> delete from dns_recs where host like ""%example.com%""; "
8,"Unable to open mail account on a Plesk server: The user account was not found
Applicable to: Plesk Onyx Symptoms
Unable to open mail account properties in Plesk interface:
CONFIG_TEXT: Error: The user account was not found. This could happen if the user account was removed by someone else while you were changing its settings.
Cause
Database inconsistency: user associated with mail account belongs to other customer or reseller that owns subscription (that mail account belongs to)
Resolution Login to the server via SSH Backup psa database:
# MYSQL_PWD=`cat /etc/psa/.psa.shadow` mysqldump -uadmin psa > psa_current.sql Login into Plesk database:
# plesk db Find all the users with discrepancy:
MYSQL_LIN: mysql> select domains.cl_id, domains.name, smb_users.login, smb_users.ownerId from domains, smb_users where domains.name = RIGHT(smb_users.login, LENGTH(smb_users.login) - LOCATE('@', smb_users.login)) and domains.cl_id <> smb_users.ownerId and smb_users.login like '%@%' order by cl_id asc; +-------+----------------+----------------------+---------+ | cl_id | name | login | ownerId | +-------+----------------+----------------------+---------+ | 2 | example.com | jdoe@example.com | 1 | +-------+----------------+----------------------+---------+ Correct owner information for such users:
MYSQL_LIN: mysql> update smb_users, domains set smb_users.ownerId = domains.cl_id where domains.name = RIGHT(smb_users.login, LENGTH(smb_users.login) - LOCATE('@',smb_users.login)) and domains.cl_id <> smb_users.ownerId and smb_users.login like '%@%'; "
2,"Unable to delete domain: ""Unable to find service node for web service on domain with id""
Applicable to:
Plesk for Linux Symptoms While deleting a domain Panel throwing the following error:
PLESK_ERROR: Error: Unable to find service node for web service on domain with id=31 Plesk may be not available with the same error. On Windows, after domain deletion the following error may appear under Plesk > Subscriptions > example.com :
PLESK_ERROR: ERR [panel] PleskFatalException: Domain Service Web not exists: domain=example.com.com, id=156 file: C:\Program Files (x86)\Parallels\Plesk\admin\plib\DSWeb.php line: 76 code: 0 Cause
Database inconsistency, domain was not fully removed.
Resolution
Note: Before performing operations with database take psa database backup . Since Plesk 12.5 it's possible to find database inconsistency using a command "" plesk repair db -n -v "" both for Linux and Windows. "" plesk repair db "" fixes known database inconsistencies, but it should be used carefully.
Below queries will fully remove domain from psa database: Connect to the server via SSH, login to Plesk database and make sure that there is no records in ""hosting"" and ""sys_users"" table:
CONFIG_TEXT: mysql> select id,name,htype from domains where id=4; +-----+--------------------------+ | id | name | htype | +-----+--------------------------+ | 4 | example.com | vrt_hst | +-----+--------------------------+ mysql> select * from hosting where dom_id=4; Empty set (0.00 sec) mysql> select * from sys_users where home like ""%example.com%"" Empty set (0.00 sec) Make sure that domain example.com and its mail content doesn't exist physically in /var/qmail/mailnames and /var/www/vhosts directories. Create backup of psa database:
# plesk db dump psa>psa.dump Change type of hosting for domain as without hosting:
CONFIG_TEXT: mysql> update domains set htype='none' where id=4; Query OK, 1 row affected (0.00 sec) Delete domain from Plesk Control panel. "
9,"How to create a custom nameserver in Plesk
Applicable to: Plesk for Linux
Plesk for Windows Question
How to create a custom nameserver in Plesk?
Answer For a single domain Log in to Plesk. Go to Domains > example.com > DNS Settings and create A and NS records. After that, configure the custom nameserver on the domain registrar side. For all domains Log in to Plesk. Go to Tools & Settings& > DNS Template and create A and NS records. On Linux, apply DNS Template changes server-wide (Linux only) to update DNS zone of existing domains. "
8,"Unable to access domain alias's mail account
Applicable to: Plesk Symptoms Domain example.com has alias example-alias.com and Mail service is enabled for the domain: Unable to create or access mailbox for alias domain mailbox@example-alias.com as there is no Email Addresses link Cause
Plesk does not allow creating mailboxes under domain aliases.
Resolution
Mailboxes of the primary domain are used. If the Mail service option is selected, the mailboxes created under the primary domain will also be available under the alias. To enable users to read mail sent to mailboxes under the alias, Plesk redirects it to the corresponding mailboxes under the primary domain.
More details are available in Plesk Administrator Guide ."
2,"[FIXED BUG] Unable to access/activate Plesk Onyx: The license key is invalid. In order to use the Panel, you need to obtain and install a new valid license key
Applicable to: Plesk Onyx for Linux
Plesk Onyx for Windows Symptoms Plesk cannot be accessed/activated One of the following errors on web browser screen: PLESK_ERROR: Error: The license key is invalid. In order to use the Panel, you need to obtain and install a new valid license key. The amount of currently used resources overrides the limits defined by your license.
OR
CONFIG_TEXT: xmlrpc error: Expected <param> to have 1 children, found 0 ---------------------- Debug Info ------------------------------- 0: common_func.php3:4675 of_get_all_keys() 1: common_func.php3:4675 pkey_fetch_key_list() 2: KeyInfoForm.php:171 KeyInfoForm->get_bye_online_url(string 'new', string '') 3: KeyInfoForm.php:77 KeyInfoForm->assign() 4: key_info.php:43 require(string 'C:\Program Files\Parallels\Plesk\admin\htdocs\server\key_info.php') 5: plesk.php:66
OR
CONFIG_TEXT: ERROR: SWKeyExFatalError
OR
CONFIG_TEXT: xmlrpc error: XML parsing failed 0: common_func.php3:4523 of_get_key_by_product(string 'plesk-win') 1: common_func.php3:4523 getPleskKey() 2: common_func.php3:4602 getKeyProp(string 'demo') 3: auth.php3:54
OR
CONFIG_TEXT: Internal error: Repository is not opened Message Repository is not opened File functions.php Line 3330 Type SWKeyExFatalError
OR
CONFIG_TEXT: Unable to get key: Repository is not opened.
OR
PLESK_ERROR: Error: The license key is invalid. In order to use Plesk, you need to obtain and install a new valid license key. The amount of currently used resources overrides the limits defined by your license. The number of websites hosted on the server exceeds the limits defined by your license. You have 5 sites hosted; your license allows hosting only 0 sites. The number of served customer accounts exceeds the limits defined by your license. You have 8 customer accounts currently served; your license allows serving only 0 customer accounts. The number of served email accounts exceeds the limits defined by your license. You have 49 email accounts currently served; your license allows serving only 0 email accounts
OR
CONFIG_TEXT: The amount of resources you operate with has exceeded the limits defined by your current product license. Please contact Plesk sales department and purchase a new license key. Cannot retrieve Plesk license via a command-line interface:
# plesk bin license --retrieve Could not open Repository at ""/etc/sw/keys"": Empty repository file: /etc/sw/keys/registry.xmlERR [panel] Unable to get key: Repository is not openedERR [panel] Unable to get key: Repository is not opened Repository is not opened exit status 3 Cause Plesk bug with ID #PPPM-9001 fixed in Plesk Onyx 17.8 for Windows on April 17th, 2018. Fix for Plesk for Linux is expected in future updates. Resolution
For Plesk Onyx 17.8, install the latest Plesk micro-updates.
For Plesk Onyx 17.5 and 17.0, upgrade to the latest Plesk version.
As a workaround: Plesk for Linux Connect to a Plesk server via SSH Move corrupted registry.xml file to another location so it will not be used and restart the Plesk service:
# mv /etc/sw/keys/registry.xml /root/ # service sw-engine restart Scan and repair file system:
# plesk repair fs -system -y Retrieve a Plesk license with the command:
# /usr/local/psa/bin/license --retrieve Log in to Plesk to re-create the registry.xml file.
NOTE: In some cases, it will require to re-install Plesk license. If you do not have a Plesk license key, contact Customer Success Team If the steps above did not help, apply resolution from this article and re-install license (replace AAAA-BBBB-CCCC-DDDD with your activation key)
# plesk bin license --install AAAA-BBBB-CCCC-DDDD Plesk 17.5 and 17.0 for Windows Connect to a Plesk server via RDP Rename the file registry.xml which is located at %plesk_dir%admin\repository. Start a command prompt as an Administrator and run the command below to renew the Plesk license:
C:\> plesk bin license.exe --retrieve Log in to Plesk to re-create the registry.xml file. In some cases, it will require to install a Plesk license. If you do not have a Plesk license key, contact Customer Success Team. If the steps above did not solve the issue, follow these steps: Move the files from %plesk_dir%admin\repository\keys\ to any other directory. Reinstall a Plesk license with the command below (replace AAAA-BBBB-CCCC-DDDD with your production activation key):
C:\> ""%plesk_dir%bin\license.exe"" -i AAAA-BBBB-CCCC-DDDD "
3,"Unable to upload large files to website hosted on Plesk for Linux server: End of script output before headers
Applicable to: Plesk for Linux Symptoms Uploading large files to a website hosted on a Plesk for Linux server (for example, via WordPress Media Library) fails:
PLESK_INFO: HTTP error The following error is found in Domains > example.com > Logs or in the file /var/www/vhosts/example.com/logs/error_log:
CONFIG_TEXT: [core:error] [pid 4820] [client 203.0.113.2:33236] End of script output before headers: sdn_data.php, referer: All necessary limits are set correctly in Domains > example.com > PHP Settings (they are saved in the domain's PHP configuration file):
# grep -e 'memory_limit' -e 'upload_max_filesize' -e 'post_max_size' -e 'file_uploads' /var/www/vhosts/system/example.com/etc/php.ini file_uploads = on upload_max_filesize = 256M post_max_size = 256M memory_limit = 256M max_file_uploads = 20 The communication timeout limit has a sufficient value in the Apache configuration file /etc/httpd/conf.d/fcgid.conf:
# grep 'FcgidIOTimeout' /etc/httpd/conf.d/fcgid.conf FcgidIOTimeout 320 Cause
The directive LimitRequestBody is define in the Apache configuration, domain's Apache & nginx Settings, or in the file .htaccess.
The directive LimitRequestBody specifies the number of bytes from 0 (meaning unlimited) to 2147483647 (2GB) that are allowed in a request body.
Resolution For one domain Log into Plesk. Increase the value of the parameter LimitRequestBody where it specified: in Apache directives: Domains > example.com > Apache & nginx Settings > Additional Apache directives: in the file .htaccess: Domains > example.com > File Manager > .htaccess: For all domains Connect to the server using SSH. Open the Apache configuration file for editing: /etc/httpd/conf/httpd.conf on CentOS, RHEL, CloudLinux. /etc/apache2/apache2.conf on Ubuntu and Debian. Increase the value of the parameter LimitRequestBody and save the file:
CONFIG_TEXT: LimitRequestBody 2147483647 Restart Apache to apply the changes: on CentOS, RHEL, CloudLinux:
# service httpd reload on Ubuntu and Debian:
# service apache2 reload Additional information
Apache HTTP Server - LimitRequestBody Directive"
0,"Failed to start fail2ban service
Applicable to: Plesk Onyx for Linux Symptoms Fail2Ban fails to start with the following error:
PLESK_ERROR: Internal error: f2bmng failed: ln -s '/usr/lib/systemd/system/fail2ban.service' '/etc/systemd/system/multi-user.target.wants/fail2ban.service' Job for fail2ban.service failed. See 'systemctl status fail2ban.service' and 'journalctl -n' for details. ERROR:f2bmng:Failed to start fail2ban serviceMessage: f2bmng failed: ln -s '/usr/lib/systemd/system/fail2ban.service' '/etc/systemd/system/multi-user.target.wants/fail2ban.service' Job for fail2ban.service failed. See 'systemctl status fail2ban.service' and 'journalctl -n' for details. ERROR:f2bmng:Failed to start fail2ban serviceFile Agent.phpLine 243Type PleskUtilException
OR
# service fail2ban start * Starting authentication failure monitor fail2ban Traceback (most recent call last): File ""/usr/bin/fail2ban-client"", line 472, in <module> if client.start(sys.argv): File ""/usr/bin/fail2ban-client"", line 442, in start return self.__processCommand(args) File ""/usr/bin/fail2ban-client"", line 216, in __processCommand if self.__ping(): File ""/usr/bin/fail2ban-client"", line 153, in __ping return self.__processCmd([[""ping""]], False) File ""/usr/bin/fail2ban-client"", line 185, in __processCmd client.close() File ""/usr/lib/python2.7/dist-packages/fail2ban/client/csocket.py"", line 55, in close self.__csock.sendall(CSPROTO.CLOSE + CSPROTO.END) File ""/usr/lib/python2.7/socket.py"", line 224, in meth return getattr(self._sock,name)(*args) socket.error: [Errno 32] Broken pipe Plesk shows the following error when trying to start Fail2Ban:
PLESK_ERROR: Error: Unable to save the settings: f2bmng failed: Traceback (most recent call last): File ""/usr/bin/fail2ban-client"", line 472, in <module> if client.start(sys.argv): File ""/usr/bin/fail2ban-client"", line 442, in start return self.__processCommand(args) File ""/usr/bin/fail2ban-client"", line 256, in __processCommand if self.__ping(): File ""/usr/bin/fail2ban-client"", line 153, in __ping return self.__processCmd([[""ping""]], False) File ""/usr/bin/fail2ban-client"", line 185, in __processCmd client.close() File ""/usr/lib/python2.7/dist-packages/fail2ban/client/csocket.py"", line 55, in close self.__csock.sendall(CSPROTO.CLOSE + CSPROTO.END) File ""/usr/lib/python2.7/socket.py"", line 224, in meth return getattr(self._sock,name)(*args) socket.error: [Errno 32] Broken pipe ERROR:f2bmng:Command '['/usr/bin/fail2ban-client', 'reload']' returned non-zero exit status 1. Cause
fail2ban service was started manually with –x option.
Resolution Connect to the server using SSH. Kill fail2ban service on the server and remove its socket:
# kill `ps afvvx | grep -v grep | grep fail2ban-server | awk '{print $1}' | xargs` # rm -f /var/run/fail2ban/fail2ban.sock
Note: In case of missing fail2ban process, incorrect command usage message will be shown. Start Fail2Ban service from Tools & Settings -> Services Management -> IP Address Banning (Fail2ban) in Plesk GUI: In case of steps above did not help - reinstall Fail2Ban componensts:
# plesk installer remove --components fail2ban
# plesk installer add --components fail2ban "
9,"Why AWStats do not show Search Keyphrases and Keywords
Applicable to: Plesk for Linux Question
AWStats can be configured to report about request which contains Search Keyphrases/Search Keywords. But sometimes in statistics results both ""Search Keyphrases"" and ""Search Keywords"" are empty.
Answer
AWStats is using a regular expression to find patterns in the log file string. But most search engines do not pass Search Keyphrases/Search Keywords or encrypt them, including Google. Thus AWStats unable to parse such strings in the log file."
8,"Horde webmail error: Could not instantiate PDO. PDOException: SQLSTATE[HY000] [1045] Access denied for user 'horde'@'localhost' (using password: YES)Details have been logged for the administrator
Applicable to: Plesk for Linux
Plesk for Windows Symptoms When trying to access Horde webmail or Horde > Preferences, the following errors are displayed:
CONFIG_TEXT: A fatal error has occurred Could not instantiate PDO with DSN ""mysql:port=3306;protocol=tcp;host=127.0.0.1;dbname=horde"". PDOException: SQLSTATE[HY000] [2002] No connection could be made because the target machine actively refused it. Details have been logged for the administrator.
or:
CONFIG_TEXT: A fatal error has occurred Could not instantiate PDO with DSN ""mysql:port=3306;protocol=tcp;host=127.0.0.1;dbname=horde"". PDOException: SQLSTATE[HY000] [1045] Access denied for user 'horde'@'localhost' (using password: YES) Details have been logged for the administrator.
or:
CONFIG_TEXT: A fatal error has occurredCould not instantiate PDO. PDOException: SQLSTATE[HY000] [1045] Access denied for user 'horde'@'localhost' (using password: YES)Details have been logged for the administrator. Cause
The database user horde cannot access the Horde configuration database with the password saved in the Plesk database.
Resolution Connect to the server via RDP/SSH Get the password for the horde database user in the file For Windows: %plesk_dir%\Webmail\horde\conf\.horde.shadow For Linux: /etc/psa-webmail/horde/.horde.shadow Create Plesk database backup Access Plesk database Run the following queries, replacing <PASSWORD> with the password obtained in Step #2: Windows MYSQL_WIN: UPDATE mysql.user SET password = PASSWORD(""<PASSWORD>"") WHERE user = 'horde'; FLUSH PRIVILEGES; Linux MYSQL_LIN: UPDATE mysql.user SET password = PASSWORD(""<PASSWORD>"") WHERE user = 'horde'; FLUSH PRIVILEGES; "
8,"Unable to send an email using webmail for domain in Plesk: User unknown in virtual alias table
Applicable to: Plesk for Linux Symptoms
While trying to send an email from domain example.com using webmail, one of following errors are shown:
CONFIG_TEXT: User unknown in virtual alias table CONFIG_TEXT: Could not send message to SMTP server. Check you have access to send messages via the server and that all To/CC/BCC addresses are valid CONFIG_TEXT: Error: SMTP Server rejected email. Returned:550 5.1.1 admin@example.com: Recipient address rejected: User unknown in virtual mailbox table
Cause
Local Postfix database file /var/spool/postfix/plesk/virtual.db contains records about domains with mail hosting not from the Plesk server: # postmap -s /var/spool/postfix/plesk/virtual admin@example.com admin@localhost.localdomain
Resolution Connect to the Plesk server via SSH. Recreate/var/spool/postfix/plesk/virtual.db database by executing this command:
# plesk repair mail "
3,"Unable to create subscription: Cannot commit configuration changes because the file has changed on disk
Applicable to: Plesk for Windows Symptoms The Subscription creation fails with the following error in Plesk:
PLESK_ERROR: ""Cannot commit configuration changes because the file has changed on disk"": Error message or request description : Error: WebServerManager::addVhost() failed: websrvmng failed: Filename: \\?\C:\Windows\system32\inetsrv\config\applicationHost.config Error: Cannot commit configuration changes because the file has changed on disk In module Exception type: System.IO.FileLoadException at Microsoft.Web.Administration.Interop.AppHostWritableAdminManager.CommitChanges() at Microsoft.Web.Administration.ConfigurationManager.CommitChanges() at Microsoft.Web.Administration.ServerManager.CommitChanges() at ServerManagerFactory.commit() at IIS7ServerManager.commit(IIS7ServerManager* ) McAfee Antivirus is installed on the server Cause
McAfee Antivirus performs scanning applicationHost.config file during the domain creation, that leads to busy IIS.
Resolution
Add to the McAfee On-Access scan Exclusions the following objects: the %plesk_dir% folder Subdirectories of the %plesk_dir% directory the C:\Windows\System32\inetsrv\config folder "
6,"Unable to repair MySQL using Plesk repair utility: Operation CREATE USER failed
Applicable to: Plesk 12.5 for Linux Symptoms Repairing MySQL using Plesk repair utility fails:
# plesk repair mysql -v The user user is absent from the database server ............... [ERROR] Recreate the user user with default permissions and default hosts? [Y/n] Recreating the user user ..................................... [FAILED] - Operation CREATE USER failed for 'user'@'%' Error messages: 1; Warnings: 0; Errors resolved: 0 exit status 1 It is not possible to create a user manually:
# plesk db mysql> CREATE USER 'user'@'%' IDENTIFIED BY 'password'; mysql> ERROR 1396 (HY000): Operation CREATE USER failed for 'user'@'%' The migration might fail with the following error:
PLESK_ERROR: stderr: Unable to add database user: Operation CREATE USER failed for 'user'@'%' Cause
Such user already exists.
Also, the error can be caused by the MySQL bug: https://bugs.mysql.com/bug.php?id=28331
Resolution Connect to the server using SSH. Create a dump of the database mysql:
# MYSQL_PWD=`cat /etc/psa/.psa.shadow` mysqldump -uadmin mysql > /root/mysql_db_backup_date +%F.%s.sql Access MySQL server and switch to the database mysql:
# plesk db mysql> use mysql Remove the user mentioned in the error message from the table mysql.user:
MYSQL_LIN: mysql> DROP FROM user WHERE User='user'; Remove the permissions for this user from the table mysql.db:
MYSQL_LIN: mysql> SELECT * FROM db WHERE User='user'; If steps above did not help, delete this user as a workaround for the MySQL bug:
MYSQL_LIN: mysql> DROP USER user; "
6,"Unable to create backup in Plesk: Unknown database Applicable to: Plesk for Linux Symptoms Error in /usr/local/psa/PMM/sessions/YYYY-MM-DD-hhmmss.XXX/psadump.log :
CONFIG_TEXT: DBI connect('dbname=db_name;host=localhost;port=3306','admin',...) failed: Unknown database 'db_name' at /usr/local/psa/PMM/agents/shared/Db/DbiBackend.pm line 47 ERROR 1049 (42000): Unknown database 'db_name' /p> Backup creation fail:
CONFIG_TEXT: Error: mysql ""db_name"" Cannot connect to mysql localhost:3306 (database 'db_name') Database connection attempt shows the following:
# plesk db mysql> use db_name; ERROR 1049 (42000): Unknown database 'db_name' Cause
db_name database does not exist in MySQL server. Most likely, it was removed not via Plesk interface, but via MySQL command line.
Resolution
Note: if you don't have root access to Plesk server via SSH, contact your hosting provider regarding the issue Login to Plesk server over SSH Create an empty database with db_name name via MySQL command line:
# plesk db mysql> create database <database_name>; Query OK, 1 row affected (0.00 sec) Remove the database using Plesk utility:
# /usr/local/psa/bin/database -r db_name "
3,"How to enable the Apache server statistics on a Plesk server
Applicable to: Plesk for Linux Question
How to enable the Apache server statistics on a Plesk server?
Answer Connect to the Plesk server via SSH. Check if ""status_module"" is loaded: for CentOS/RHEL-based distributions:
# httpd -M | grep status status_module (shared) for Debian/Ubuntu-based distributions:
# apache2ctl -M | grep status status_module (shared)
If the output is empty, enable the ""status"" module in Plesk at Tools & Settings > Apache Web Server. Find out Apache version: for CentOS/RHEL-based distributions:
# httpd -v | grep version for Debian/Ubuntu-based distributions:
# apache2 -v | grep version To make status reports visible to your IP address (from which you access this page in a browser), add the below code to the Apache configuration file (create a new file, if there is no): CentOS/RHEL-based distributions: CentOS 7: /etc/httpd/conf.modules.d/status.conf CentOS 6: /etc/httpd/conf.d/status.conf Debian/Ubuntu-based distributions: /etc/apache2/mods-enabled/status.conf
In this example, we are allowing status reports to IP addresses 203.0.113.2 and 203.0.113.3: for Apache 2.2:
CONFIG_TEXT: <IfModule mod_status.c> <Location /server-status> SetHandler server-status Order deny,allow Deny from all Allow from 203.0.113.2 203.0.113.3 </Location> ExtendedStatus On </IfModule> for Apache 2.4:
CONFIG_TEXT: <IfModule mod_status.c> <Location /server-status> SetHandler server-status <RequireAny> Require ip 203.0.113.2 203.0.113.3 </RequireAny> </Location> ExtendedStatus On </IfModule> Restart Apache web-server: for CentOS/RHEL-based distributions:
# service httpd restart for Debian/Ubuntu-based distributions:
# service apache2 restart Server statistics will now be available at http://your.server.ip.address/server-status
Warning: Apache server statistics page can contain sensitive information. For security reasons, we recommend to enable authentication/authorization (e.g. HTTP basic authentication) for this URL. Additional Information Apache Documentation: Apache Module mod_status
"
7,"Unable to install Plesk on Red Hat systems: Failed to solve dependencies
Applicable to: Plesk for Linux Symptoms
Plesk installation fails on Red Hat Enterprise Linux with one of the following error messages:
CONFIG_TEXT: Exception: Failed to solve dependencies: php-mbstring-5.4.16-23.el7_0.3.x86_64 requires php-common(x86-64) = 5.4.16-23.el7_0.3 ERROR: The Yum utility failed to install the required packages. Attention! Your software might be inoperable. CONFIG_TEXT: Exception: Failed to solve dependencies: php-imap-5.3.3-46.el6_6.x86_64 requires php-common(x86-64) = 5.3.3-46.el6_6php-mbstring-5.3.3-46.el6_6.x86_64 requires php-common(x86-64) = 5.3.3-46.el6_6 ERROR: The Yum utility failed to install the required packages.Attention! Your software might be inoperable. CONFIG_TEXT: Plesk installation requires 'codeready-builder-for-rhel-8-x86_64-rpms' OS repository to be enabled.
Cause
Optional RedHat repositories are not enabled.
Resolution
Note: To enable the Red Hat repositories, the system has to be registered according to Red Hat instructions Connect to the server via SSH Enable optional packages repository using the following command:
Note: The command may result an error, but the repository will be enabled. for RHEL 8:
# subscription-manager repos --enable=codeready-builder-for-rhel-8-x86_64-rpms for RHEL 7:
# subscription-manager repos --enable=rhel-7-server-optional-rpms for RHEL 6:
# subscription-manager repos --enable=rhel-6-server-optional-rpms Verify that repository has been enabled:
# yum repolist enabled Rerun Plesk installation Additional Information Enabling or disabling a repository using Red Hat Subscription Management - Red Hat Customer Portal
"
3,"Unable to start apache on Plesk for Linux: (98)Address already in use: make_sock: could not bind to address [::]:443
Applicable to: Plesk for Linux Symptoms Domains are not working Unable to recreate configuration files after Plesk update:
PLESK_ERROR: New configuration files for the Apache web server were not created due to the errors in configuration templates: Can not restart web server: httpd stop failed 0 /usr/sbin/httpd processes are killed httpd stop failed 0 /usr/sbin/httpd processes are killed INFO: [Tue Apr 30 06:28:16 EDT 2019]: Service: httpd, Action: start Trying to start service httpd... failed Apr 30 06:28:16 example.com httpd[114545]: (98)Address already in use: AH00072: make_sock: could not bind to address [::]:7080 Apache start from the bash fails with the following error:
Note: Port may be also 80. In case nginx is active, ports may be 7080, 7081.
# service apache2 start * Starting web server apache2 (98)Address already in use: make_sock: could not bind to address [::]:443 no listening sockets available, shutting down The following error may appear when trying to stop Apache:
# service apache2 stop * Stopping web server apache2 * * There are processes named 'apache2' running which do not match your pid file which are left untouched in the name of safety, Please review the situation by hand. Cause
Another process already uses 443 (80, 7080, 7081) port and Apache cannot bind to it.
Resolution Connect to the server via SSH Find what service listens to 443 or 80 port or specify the port displayed in the error:
# netstat -tulpn | grep :443 tcp 0 0 0.0.0.0:443 0.0.0.0:* LISTEN 484 /haproxy It is not expected that ""haproxy"" or another service except ""apache/httpd"" or ""nginx"" listens to 443 port, so it should be stopped:
# service haproxy stop In case any other process is running using this port or ""apache/httpd"" process, it also should be killed:
# kill -9 484 In case ""nginx"" service is using the reported port, try to perform the following: Re-enable ""nginx"" proxy mode at Home > Tools & Settings > Services Management by clicking stop and start: Via CLI:
# /usr/local/psa/admin/sbin/nginxmng -d # /usr/local/psa/admin/sbin/nginxmng -e Inspect server with RKhunter extension if required. "
4,"How to manage automatic WordPress updates for all the existing instances?
Applicable to: Plesk for Linux
Plesk for Windows Question
How to manage automatic WordPress updates for existing instances?
Answer
Note: changes in WordPress updates will take an effect only on the next WordPress update check. Log into Plesk. Go to Plesk > WordPress > Updates: Switch to the All tab, find the required instances (the search bar can be used), mark them and click the Change Settings button: Specify the required option for the Update WordPress automatically directive and click the OK button to apply changes: "
3," How to enable/disable gzip compression in nginx on a Plesk server
Applicable to: Plesk for Linux Question
How to enable/disable gzip compression in nginx on a Plesk server?
Answer
Note: This guide is intended for Plesk administrators. If you are a domain owner, please contact your service provider for assistance. For a domain in Plesk Enabling gzip compression for a domain in Plesk In Plesk, go to Domains > example.com > Apache & nginx Settings. Add the following directives to the Additional nginx directives field:
CONFIG_TEXT: gzip on; gzip_disable ""MSIE [1-6]\\.(?!.*SV1)""; gzip_proxied any; gzip_comp_level 5; gzip_types text/plain text/css application/javascript application/x-javascript text/xml application/xml application/rss+xml text/javascript image/x-icon image/bmp image/svg+xml; gzip_vary on;
Note: This is an example. If needed, add other file types in the gzip_types section, e.g. application/javascript, application/js, etc. The full list of available types can be found on a server in the file /etc/nginx/mime.types. Click Apply to save the changes. Video instructions Disabling gzip compression for a domain in Plesk In Plesk, go to Domains > example.com > Apache & nginx Settings.
Note: To disable gzip compression for a domain/subdomain that does not exist in Plesk (e.g. hostname), create it first. Add the following directive to the Additional nginx directives field:
CONFIG_TEXT: gzip off; Click Apply to save the changes. For all domains via nginx global configuration Enabling gzip compression server-wide Connect to a server via SSH. Create the gzip.conf file inside nginx conf.d directory:
# touch /etc/nginx/conf.d/gzip.conf Open the file in any text editor. In this example, we are using the vi editor:
# vi /etc/nginx/conf.d/gzip.conf Insert the following content in it:
CONFIG_TEXT: gzip on; gzip_disable ""MSIE [1-6]\\.(?!.*SV1)""; gzip_proxied any; gzip_comp_level 5; gzip_types text/plain text/css application/javascript application/x-javascript text/xml application/xml application/rss+xml text/javascript image/x-icon image/bmp image/svg+xml; gzip_vary on;
Note: This is an example. If needed, add other file types in the gzip_types section, e.g. application/javascript, application/js, etc. The full list of available types can be found on a server in the file /etc/nginx/mime.types. Test nginx configuration:
# nginx -t Reload nginx configuration to apply the changes:
# service nginx reload Now gzip compression is enabled for all domains on the server.
To verify that gzip compression is enabled, use the command below. When gzip is enabled you will see 'Content-Encoding: gzip' in the output:
Note: If the website has a www redirection, change the website name to www.example.com. If the website is using HTTP connection:
# curl -s -H ""Accept-Encoding: gzip"" -I http://example.com | grep -i Content-Encoding Content-Encoding: gzip If the website is using HTTPS connection:
# curl -s -H ""Accept-Encoding: gzip"" -I https://example.com --insecure | grep -i Content-Encoding Content-Encoding: gzip Video instructions: Disabling gzip compression server-wide Connect to a server via SSH. Search for the line in ""gzip on"" via all nginx config files:
# grep -Ri ""gzip on"" /etc/nginx/ To disable gzip compression, open the corresponding file in a text editor and change gzip on to gzip off. Save the changes and close the file. Restart nginx to apply the changes:
# service nginx restart Additional Information
To learn more about gzip compression module and gzip types, visit the following nginx documentation page: Module ngx_http_gzip_module - nginx documentation To enable gzip compression in Apache, visit this KB article. "
0,"System users are not able to connect to a Plesk server over SSH/SFTP: No supported authentication methods available
Applicable to: Plesk for Linux Symptoms Access to a Plesk server over SSH/SFTP under a subscription's system user does not work:
# ssh johh_doe@203.0.113.2 Permission denied (publickey).
OR
CONFIG_TEXT: Disconnected: No supported authentication methods available (server sent: publickey,gssapi-keyex,gssapi-with-mic) The PasswordAuthentication method is not enabled on the server:
# grep PasswordAuthentication /etc/ssh/sshd_config PasswordAuthentication no Cause
Password authentication for SSH connections is not enabled on the server.
Resolution Connect to the Plesk server using local server console of your hosting provider panel. Create a backup of the /etc/ssh/sshd_config file:
# cp /etc/ssh/sshd_config /etc/ssh/sshd_config.back Open the /etc/ssh/sshd_config file in a text editor. In this example, we are using the vi editor:
# vi /etc/ssh/sshd_config Enable password authentication for SSH connections:
CONFIG_TEXT: PasswordAuthentication yes Save the changes sand close the file. Restart the SSH service:
# service sshd restart Related Articles Unable to connect to Plesk via SFTP: Failed to connect to system bus: Permission denied
"
2,"Unable to create a new domain or enable mail service on the existing domain: mailmng failed: Loaded Postoffice Configuration Provider (MEAIPO.DLL) MEAOPO.PostOffice.AddPostOffice failed Applicable to: Plesk for Windows Symptoms When creating a new domain or enabling mail service on existing domain, the operation fails with one of the following error messages:
PLESK_ERROR: Error: Unable to update domain data: Failed mail post-configuration: Can't create mail domain servie: mail_Facade->createDomain() failed: mailmng failed: Loaded Postoffice Configuration Provider (MEAIPO.DLL) MEAOPO.PostOffice.AddPostOffice failed for name example.com [example.com]
PLESK_ERROR: Error: mailmng failed: MEAOPO.PostOffice.AddPostOffice failed for name example.com [example.com] at (MailEnable::MailEnableDomain::MailEnableDomain line 25) at execute console command --add-domain(vconsoleapp::start line 122) at execute ""C:\Program Files (x86)\Plesk\admin\bin\mailmng"" --add-domain ""--domain-name=example.com"" ""--disk-quota=-1""(vconsoleapp::run line 139) (Error code 1) Cause
The issue may be caused by previously failed attempt to add or remove domain with the same name, which resulted in domain being absent from Plesk, but MailEnable Postoffice exists due to unsuccessful rollback of domain creation/removal.
Resolution
Connect to a Plesk server via RDP. For MailEnable mail server Remove post office from MailEnable manually:
Note: If this domain has email accounts with data, apply the 2nd solution: Open MailEnable Management console at Windows Start > All Programs > Mail Enable. In MailEnable Management console, expand Messaging manager > Post Offices and remove/rename a post office of the domain that causes the error. Create the domain or activate mail service in Plesk. In case if creation fails for domains with EXISTING mail data, follow the steps: Back up the following folders from C:\Program Files (x86)\Mail Enable (%plesk_dir%Mail Enable\Postoffices in older Plesk releases):
CONFIG_TEXT: Postoffices Config Queues Dictionaries (if exists) Remove post office under MailEnable > Messaging manager > Post Offices > example.com for the affected domain. Create the domain or activate mail service in Plesk. Copy again the backed up folders to MailEnable data directory. Run the following command to synchronize Plesk and MailEnable databases:
C:\> plesk repair mail example.com For IceWarp mail server Open IceWarp Administrator tool. Find and remove domain that causes error in Domains&Accounts section. "
2,"Services management menu returns error: Call to a member function getWebServerPackage() on a non-object Applicable to: Plesk for Linux Symptoms When accessing Tools & Settings > Services Management in Plesk, the below error is displayed:
PLESK_INFO: ERROR: Call to a member function getWebServerPackage() on a non-object (class.ServiceControl.php:76) Several functions in Plesk, including adding a domain and accessing the Web Server Configuration Troubleshooting tool, give PHP errors. Reconfiguring Apache fails with this error:
CONFIG_TEXT: PHP Fatal error: Call to a member function getScheme() on a non-object in /usr/local/psa/admin/plib/WebServerManager/Adapter/Apache.php on line 800 The following MySQL query returns empty set or empty value as below:
MYSQL_LIN: select * from ServiceNodeEnvironment where name='httpd'; Empty set (0.00 sec)
or
MYSQL_LIN: select * from ServiceNodeEnvironment where name='httpd'; +---------------+------------------------+-------+----------------------+ | serviceNodeId | section | name | value | +---------------+------------------------+-------+----------------------+ | 1 | componentsPackages | httpd | | +---------------+------------------------+-------+----------------------+ 1 row in set (0.00 sec) Cause
The issue is caused by database inconsistency.
Resolution For CentOS/RHEL Connect to the server using SSH. Create Plesk database backup.
# MYSQL_PWD=cat /etc/psa/.psa.shadow mysqldump -u admin psa > psadate +%F_%H.%M.sql Delete record from psa database to avoid duplicate entries:
# MYSQL_PWD=`cat /etc/psa/.psa.shadow` mysql -u admin psa -e""delete from ServiceNodeEnvironment where name='httpd';"" Insert record as below:
# MYSQL_PWD=`cat /etc/psa/.psa.shadow` mysql -u admin psa -e""insert into ServiceNodeEnvironment values(1,'componentsPackages','httpd','`rpm -q --qf ""%{VERSION}.%{RELEASE}\"" httpd`')"" For Debian/Ubuntu Connect to the server using SSH. Create Plesk database backup.
# MYSQL_PWD=cat /etc/psa/.psa.shadow mysqldump -u admin psa > psadate +%F_%H.%M.sql Delete record from psa database to avoid duplicate entries:
# MYSQL_PWD=`cat /etc/psa/.psa.shadow` mysql -u admin psa -e""delete from ServiceNodeEnvironment where name='httpd';"" Insert record as below:
# MYSQL_PWD=`cat /etc/psa/.psa.shadow` mysql -u admin psa -e""insert into ServiceNodeEnvironment values(1,'componentsPackages','httpd','`dpkg-query -W -f='${Version} ${Release}\' apache2`')"" Alternative steps: Execute the following command in order to know the apache version and release:
# dpkg-query -W -f='${Version} ${Release}' apache2 2.4.10-1ubuntu1.1~ubuntu14.04.2 Insert the version and release to the database:
# MYSQL_PWD=`cat /etc/psa/.psa.shadow` mysql -u admin psa -e""insert into ServiceNodeEnvironment values(1,'componentsPackages','httpd','2.4.10-1ubuntu1.1~ubuntu14.04.2');"" "
4,"Unable to install/update APS application in Plesk: Unable to change current directory Applicable to: Plesk for Linux Symptoms Unable to install/update APS application;
Unable to change application settings via Plesk.
Unable to update the preferred domain at Plesk > Domains > example.com > Hosting Settings. One of the following errors may be shown:
PLESK_ERROR: Non-zero exit status returned by script. Output stream: 'Unable to change current directory to /opt/psa/var/apspackages/apscataloggDqOIK.zip03123588-b16c-80/cache/scripts'. PLESK_ERROR: Permission denied in /opt/psa/var/apspackages/apscatalogH0al3t.zipfb51bb1f-c2a0-66/cache/scripts/app-util.php on line 61 PLESK_ERROR: Error: The following error has occurred during the installation of application: Installation of magento at http://example.com/ failed. terminate called after throwing an instance of 'boost::filesystem::filesystem_error' what(): boost::filesystem::status: Permission denied: ""/usr/local/psa/var/apspackages/apscatalogH0al3t.zipfb51bb1f-c2a0-66/cache/htdocs"" Cause
Incorrect permissions.
Resolution Connect to the server via SSH;
Note: if direct SSH access to the server is not possible, contact server administrator for further assistance. Set valid file permissions using the following commands:
For RHEL/CentOS/CloudLinux:
# find /usr/local/psa/var/apspackages/ -type f -a -not -perm 644 -exec chmod 644 {} \; # find /usr/local/psa/var/apspackages/ -mindepth 1 -type d -a -not -perm 755 -exec chmod 755 {} \;
For Debian/Ubuntu:
# find /opt/psa/var/apspackages/ -type f -a -not -perm 644 -exec chmod 644 {} \; # find /opt/psa/var/apspackages/ -mindepth 1 -type d -a -not -perm 755 -exec chmod 755 {} \; "
0,"Unable to upload MySQL dump in Plesk phpMyAdmin: You probably tried to upload a file that is too large
Applicable to: Plesk Onyx Symptoms
Unable to upload MySQL dump in Plesk phpMyAdmin > Import > File to import with the following error appear in phpMyAdmin interface:
CONFIG_TEXT: You probably tried to upload a file that is too large. Please refer to the documentation for a workaround for this limit.
Cause
Dump file is too large
Resolution
Increase upload dump size in phpMyAdmin according to How to increase upload dump size in phpMyAdmin?"
2,"A scheduled task set up to run from under a subscription user fails: No such file or directory Applicable to: Plesk for Linux Symptoms A scheduled task set up to run from under a subscription user fails with one of the following error messages:
PLESK_ERROR: Task /opt/plesk/php/5.6/bin/php -q /var/www/vhosts/example.com/wp-cron.php completed with error in 0 seconds, output:-: /opt/plesk/php/5.6/bin/php: No such file or directory
OR
PLESK_ERROR: user with id=11112 and name=`<user_name>` not found in chrooted passwd filesystem error: No such file or directory
OR
PLESK_ERROR: /var/www/vhosts/example.com/httpdocs/app/cake: /usr/bin/env: bad interpreter: No such file or directory
OR
PLESK_ERROR: Task ""php -q /var/www/vhosts/example.com/crons/cron.php"" successfully completed in 0 seconds, output:The file /var/www/vhosts/example.com/crons/cron.php is corrupted. Cause
When running a scheduled task from under a system user using system executable files (for example, ""curl"", ""wget"", ""php""), the command will fail if the system user has no access to the server or is set up to run commands in a limited environment (chrooted).
Resolution
One of the workarounds below may be used: Recreate the task from under a root user at Tools & Settings > Scheduled Tasks:
PLESK_INFO: Task type: Run a commandCommand: /opt/plesk/php/7.2/bin/php -q /var/www/vhosts/example.com/httpdocs/whmcs/crons/cron.php
OR
CONFIG_TEXT: Task type: Run a PHP script Script path: /var/www/vhosts/example.com/httpdocs/whmcs/crons/cron.phpUse PHP version: select any required versionSystem user: root Provide the system user john_doe with an access to the server over SSH (for example, /bin/bash) at Domains > example.com > Web Hosting Access. Change crontab shell for scheduled tasks to /bin/bash at Tools & Settings > Scheduled Tasks > Settings. Add a required command to a chrooted environment. For instructions, see the KB article: How to add new programs to a chrooted shell environment template Additional Information Administrator's Guide: Scheduled Tasks Shell Setting
"
8,"Emails are not being received by MailEnable: ""denied access""
Applicable to:
Plesk for Windows Symptoms Accessing the MailEnable SMTP service produces an error that the connecting IP address has been ""denied access"".
CONFIG_TEXT: 530 mail.mailenable.com.au ESMTP MailEnable Service, Version: 0--1.1 denied access at 09/06/05 17:04:25 Connection to host lost. Connection from outside to server IP address and 25 port does not work:
C:\> telnet 203.0.113.2 25 220 mail.mailenable.com.au ESMTP MailEnable Service, Version: 0--1.1 denied access at 09/26/13 21:53:27 Connection lost The same error can be found in MailEnable Management > Servers > localhost > Services and Connectors > SMTP > Logs > Activity > SMTP-Activity-xxx.log . Cause
The IP address of the inbound connection has the access denied in the SMTP Access Control properties of the MailEnable Administration Program, or has been automatically banned because of too many subsequent invalid commands.
Resolution Log into the server via RDP. Navigate within the MaelEmable Administration console to the following location: Servers > localhost > connectors > SMTP , right click on SMTP and select Properties in the menu. Next navigate to the Inbound tab and click on Access control . Ensure that the Access control option is set to granted access and that the IP address of the incoming connection is not present within the Except those listed below window. Additional Information
The incoming IP address can automatically be added to the inbound Access control list if the SMTP security connection dropping option is enabled.
The SMTP service will drop the connection when the failed number of commands or recipients is exceeded and add the IP address to the inbound Access control list.
"
3,"How to create and use wildcard SSL certificates in Plesk?
Applicable to: Plesk for Windows
Plesk for Linux Question
Is it possible to create and use wildcard SSL certificates in Plesk?
How to configure Plesk to automatically assign a domain wildcard certificate for new subdomains?
Answer
Plesk allows to create and use certificates for wildcard domain names (like *.example.com). Wildcard certificate can be created the same way as usual certificate is generated. The only difference is that the name with ""*"" sign is specified in the left path. For example, ""*.example.com"", will match all subdomains, like mail.example.com, ftp.example.com, etc.
When a subdomain is created within the same subscription, then there is no need to manually add wildcard certificate to the subdomain. The wildcard certificate of main domain is automatically assigned to the newly created subdomain.
Instructions to get a free wildcard certificate are available here.
Additional information
To create Let's encrypt wildcard certificates, see instructions here."
7,"Unable to install/update a package which is excluded in yum config file: Error while downloading packages metainfo: No package(s) available to install
Applicable to: Plesk for Linux Symptoms Plesk Installer fails with one of the following error messages:
CONFIG_TEXT: Error while downloading packages metainfo: No package(s) available to install. Trying again. Failed to install mod_python: Number of retries is exceeded. InstallError: No package(s) available to install ERROR: The Yum utility failed to install the required packages.
OR
CONFIG_TEXT: Exception: Failed to solve dependencies: plesk-web-hosting-18.0-2.centos.7+p18.0.24.0+t200123.1310.x86_64 requires psa-proftpd >= 1.3.6b mod_passenger-5.3.5.1-centos7.19061318.x86_64 requires passenger = 5.3.5.1-centos7.19061318 psa-drweb-configurator-17.5.3-cos7.build1705170317.16.x86_64 requires glibc(x86-32) ERROR: The Yum utility failed to install the required packages. There are packages that are excluded from update in the yum config file:
# grep exclude /etc/yum.conf exclude=apache* httpd* mod_* mysql* MySQL* da_* *ftp* exim* sendmail* php* bind-chroot* grub2* grubby* *.i?86 Cause
Packages that are excluded from update are required by dependency of other packages.
Resolution Connect to the Plesk server via SSH. Open the file /etc/yum.conf in a text editor. In this example, we are using the vi editor:
# vi /etc/yum.conf Comment out the exclude string by putting a hash ""#"" symbol at the beginning of the line:
CONFIG_TEXT: #exclude=apache* httpd* mod_* mysql* MySQL* da_* *ftp* exim* sendmail* php* bind-chroot*
Note: Or alternatively, remove required packages from exclusions. Save the changes and close the file. Rerun Plesk Installer. "
5,"What are known limitations of Plesk Migrator Extension?
Applicable to: Plesk Question
What are known limitations of Plesk Migrator Extension?
Answer
Plesk Migrator Extension was introduced since Plesk 12.5 and is actively developed right now. Below is the list of known limitations for this tool: Plesk Migrator Extention should be installed on the Destination Plesk server (also referenced as Target in some documentation). Plesk Migrator requires a number of Ports to be open in the firewall. Port can be found in Migration Guide Plesk Panel should be accessible locally on the Destination server through localhost (127.0.0.1). Plesk Migrator requires built-in administrator credentials for the Windows Source server and root user credentials for the Linux one. At least 2GB of the free disk space is required on the Source server. ASP.NET 1.1 is not supported on the Destination server. All server-wide settings set up in Tools & Settings menu will not be transferred. PHP settings on the domain level are migrated only in case if PHP handler from source persists on the destination server. Additional PHP directives of the domain are not migrated. Plesk Migrator does not transfer Apache modules and shows a corresponding warning. The most popular warning is regarding mod_perl and mod_python. Custom configuration (e.g. permissions set not via Plesk, web server configuration changes done not via Plesk) are not transferred. Client login should not exceed 16 symbols. Empty passwords on the Source server cause the issues for migration. Database assimilation is possible and works perfectly, but on Destination Plesk, it is required to specify options for remote database server manually (in service plan after migration) as well as switching to the remote database servers. Migration of domains with long names could fail. Migration from Plesk on FreeBSD does not work. Migration from Parallels Small Business Panel does not work. Database mapping is not implemented yet. In case if databases are located on several MS SQL databases, they will be migrated to the default one on the target server. Reseller and customer accounts that do not have any domains are not transferred. The settings of Plesk services, such as installed PHP handlers, Fail2Ban settings, ModSecurity settings, firewall settings, and so on are not transferred. Custom webmail configurations like personal folders, address books and so on are not transferred. Custom templates are not migrated. Mail Enable configuration is not migrated. Each domain from Source Plesk below 10x version (where the new business model had been introduced for the first time) will get a new subscription on the Destination server. Subscription's backups. WordPress Toolkit automatic login link is not migrated. Only SSL certificates installed on domain directly in Domains > example.com > SSL/TLS certificates will be migrated. Certificates from Tools & Settings > SSL/TLS certificates are not migrated. "
8,"How to enable SSL/TLS/STARTTLS for MailEnable on Plesk
Applicable to: Plesk Onyx for Windows Question
SSL is not working for MailEnable. How to enable SSL/TLS/STARTTLS for MailEnable mail server? Answer
Since MailEnable version 9.10, SMTP SSL/TLS encryption is available in free MailEnable Standard edition.
To secure mail server with SSL, follow instructions from Plesk administrator guide
Starting from MailEnable version 9.60, SSL/TLS support can be enabled for IMAP on 143/tcp and SMTP on 25/tcp: Text instructions Connect via RDP Open MailEnableAdmin and navigate to MailEnable Management > Servers > localhost > Services and Connectors Right click on IMAP, open Properties, switch to the Settings tab, check the Enable SSL/TLS support and apply the settings Right click on SMTP, open Properties, switch to the Inbound tab, check the Allow clients to establish secure sessions via STARTTLS and apply the settings Restart IMAP and SMTP services using Plesk services management utility in the system tray: Check if TLS is offered by connecting to Plesk server IP address (from remote workstation or locally from the server):
C:\> telnet 203.0.113.2 25 ehlo example.com ... 250 STARTTLS "
2,"Unable to create new subscription: Domain already existsSymptoms
Unable to create a new subscription, the following error occurs:
PLESK_ERROR: Domain already exists
Cause
Database inconsistency. The number of domains does not match the number of subscriptions.
Resolution Connect to the server via SSH;
Access Plesk database; Check for entries in domains table of psa database that have no related entries in Subscriptions table:
MYSQL_LIN: select id,name from domains where webspace_id=0 and id not in (select object_id from Subscriptions where object_type='domain'); +------+-------------------------+ | id | name | +------+-------------------------+ | 1499 | example.com | +------+-------------------------+ 1 row in set (0.01 sec) If such entries are revealed, check that there are no entries with the same domain ID in hosting table:
MYSQL_LIN: select * from hosting where dom_id=1499; Empty set (0.00 sec) If no related entries in hosting table are found, then create dump of psa database and remove founded orphaned entries from domains table:
MYSQL_LIN: delete from domains where id=1499; "
7,"SmarterMail is not recognized by Plesk as installed Applicable to: Plesk for Windows Symptoms SmarterMail is not recognized by Plesk as installed, or it is recognized, but is marked with ""!"". Cannot create a mail account. Blank error is shown in Plesk. The following error can be found in Event Viewer:
CONFIG_TEXT: SOAP failed. No additional info at (SmarterMail::checkResult line 177) at execute console command --add-mailname(vconsoleapp::start line 100) at execute ""C:\Program Files (x86)\Plesk\admin\bin\mailmng.exe"" --add-mailname ""--domain-name=example.com"" ""--mailname=jdoe"" ""--password=*""(vconsoleapp::run line 117) C:\Program Files (x86)\Plesk\admin\bin\mailmng.exe The following error can be observed on attempt to access SmarterMail administrative interface or webmail in a browser:
CONFIG_TEXT: The server is not responding or cannot be reached. Please try again later. If the problem continues, please check your internet connection or contact your system administrator for assistance. In Tools & Settings > Server Components > Mail Sever the following can be seen:
SmarterMail Server (not installed)
. Cause
SmarterMail is not configured.
Resolution
Note: before proceeding with the resolution, browse to Tools & Settings > Server Components and click 'Refresh' button. There is a probability that the issue will be resolved with this command only. Configure the SmarterMail site in IIS using the instructions from this article. Make sure that SmarterMail service is started and works. services.msc snap-in can be used for it (Start > Run... > services.msc). Enable SmarterMail in the Plesk: Tools & Settings > Server Components > Mail Server. "
0,"Plesk University: Training and Certification
Applicable to: Plesk for Linux
Plesk for Windows Question
I want to learn more about Plesk training and certification.
Answer Trainings Plesk offers the following self-paced e-learning courses: Plesk Professional provides a guide into typical server administration tasks: Installation, Security settings, Service Plans management, Customer & Subscription management and Backups. Plesk Expert provides a detailed guide into advanced server administration tasks: Upgrade, Migration, and Troubleshooting. The course is available for both Plesk for Linux and Plesk for Windows. Each module within a course includes a set practical lab exercises, which students can perform on their test Plesk installations. These trainings are available via the Plesk University free of charge. Certification Plesk certification exams are free of charge.
Each candidate has 2 attempts to pass the exam. First and second attempts are separated by one week waiting period to review the materials and prepare for the retake.
All exams are closed book (meaning no assistance or reference materials are allowed) and are passed via remote proctor software, which uses web camera and microphone to ensure exam rules compliance.
All certification questions are built around real-life scenarios and will challenge candidate's knowledge and experience.
Once earned, the certificate is valid for 2 years. The certification credentials can be verified at https://www.plesk.com/university#verification-uni using either Plesk University username or e-mail.
Learn more
Check the following resources to learn more: Plesk University information Plesk University FAQ
Plesk University Catalog
"
2,"Plesk shows 500 Internal Server Error on Linux: [ERROR]: spawning fcgi failed
Applicable to:
Plesk Onyx for Linux
Symptoms Plesk login page is not available:
CONFIG_TEXT: 500 Internal Server Error The following errors can be found in /var/log/sw-cp-server/error.log :
CONFIG_TEXT: (mod_fastcgi.c.1068) the fastcgi-backend /usr/bin/sw-engine-cgi -c /usr/local/psa/admin/conf/php.ini -d auto_prepend_file=auth.php3 -u psaadm failed to start: (mod_fastcgi.c.1072) child exited with status 1 /usr/bin/sw-engine-cgi -c /usr/local/psa/admin/conf/php.ini -d auto_prepend_file=auth.php3 -u psaadm (mod_fastcgi.c.1075) If you're trying to run your app as a FastCGI backend, make sure you're using the FastCGI-enabled version. If this is PHP on Gentoo, add 'fastcgi' to the USE flags. (mod_fastcgi.c.1171) [ERROR]: spawning fcgi failed. (mod_fastcgi.c.3644) all handlers for /index.php? on .php are down. Cause
The wrong permissions and owner were set for the /tmp directory and suexec binaries.
Resolution Connect to the server via SSH Set valid permissions for system directories:
# chown root:root /tmp # chmod 1777 /tmp
# chown root:apache /usr/sbin/suexec # chmod 4510 /usr/sbin/suexec
# chown root:sw-cp-server /usr/lib64/sw-cp-server/sw-suexec # chmod 4710 /usr/lib64/sw-cp-server/sw-suexec Restart sw-cp-server:
# service sw-cp-server restart "
7,"How to restart the Plesk service Applicable to: Plesk for Linux
Plesk for Windows Question
How to restart the Plesk service?
Answer
Plesk service can be restarted only with the direct access to the server. Plesk for Linux Connect to a Plesk server via SSH. Execute the following command to restart Plesk engine services:
# service sw-engine restart && service sw-cp-server restart Plesk for Windows Server
There are 3 different ways to restart the Plesk Management Service on Windows Server. Restarting via Plesk Services Monitor Connect to a Plesk server via RDP. Start Plesk Services Monitor from the tray > Select Plesk Management Service under the Plesk Run-Time section > Click Restart. Restarting via a command prompt Connect to a Plesk server via RDP. Start a command prompt as an Administrator and run the following commands one by one:
C:\> net stop plesksrv net start plesksrv Restarting via Services MMC Connect to a Plesk server via RDP. Start Services at Windows Start > All Programs > Windows Administrative Tools. In the Services console, right-click on Plesk Management Service and click Restart. "
0,"How to use command-line utility to manage certificates in Plesk?
Applicable to: Plesk 11.x for Linux
Plesk 11.x for Windows
Plesk 12.0 for Linux
Plesk 12.0 for Windows
Plesk 12.5 for Linux
Plesk 12.5 for Windows
Plesk Onyx for Linux
Plesk Onyx for Windows Question
How to use command-line utility to manage certificates in Plesk?
Answer
The certificate utility allows managing client's certificates through CLI. This utility allows performing the following tasks: creating and removing SSL certificates
assigning certificates to IP addresses
editing certain certificate parameters For example, the following command displays the list of SSL certificates stored in administrator's certificate repository:
# plesk bin certificate -l -admin
To displays the list of SSL certificates that can be used by domain example.com:
# plesk bin certificate -l -domain example.com
To see all available parameters, run the following:
# plesk bin certificate --help
Additional information about the utility available in the documentation for Plesk 11.x, Plesk 12.x, Plesk Onyx.
Note: on Linux systems, SSL certificates for Plesk are located in /usr/local/psa/var/certificates/
The following resources can be useful while installing SSL certificates using web interface: Plesk 12.0: Plesk Documentation and Help Portal Plesk 12.5: Plesk Documentation and Help Portal Plesk Onyx: Plesk Documentation and Help Portal "
0,"How to change or check subscription limits if Web admin license is installed in Plesk
Applicable to: Plesk for Linux
Plesk for Windows Question
Web Admin license does not allow managing Subscription limits in administration panel.
How to change subscription limits if Web admin license is installed in Plesk?
Answer
Connect to Plesk server using SSH or RDP and use ""plesk bin subscription_settings"" command:
# plesk bin subscription_settings -h
For example, to set disk usage to Unlimited on Linux:
# plesk bin subscription_settings -u example.com -disk_space -1
Or to set MS SQL databases limit to 50 on Windows:
C:\> plesk bin subscription_settings --update example.com -max_mssql_db 50
To check the results find a corresponding limit in the output of the command (Linux and Windows):
# plesk bin subscription_settings --info example.com
Additional information
To set different limits for a subscription/webspace, refer to CLI guide for Linux and Windows that contain detailed explanation on how to use the commands, what limits can be set and how to set them up."
0,"Unable to access Fail2ban settings: Timeout of 10 seconds has been reached. Lock 'service.fail2ban' is already owned by another process with pid Applicable to: Plesk for Linux Symptoms While accessing Plesk >Tools & Settings > IP Address Banning (Fail2Ban), one of the following errors appear:
PLESK_ERROR: Internal error: f2bmng failed: ERROR:f2bmng:Timeout of 10 seconds has been reached. Lock 'service.fail2ban' is already owned by another process with pid <unknown>
or
PLESK_ERROR: 502 Bad Gateway
or
PLESK_ERROR: ERROR Failure failed to parse timeText Unable to remove subscription in Plesk. The following error appears in panel.log:
CONFIG_TEXT: Internal error: f2bmng failed: ERROR:f2bmng:Timeout of 10 seconds has been reached. Lock 'service.fail2ban' is already owned by another process with pid <unknown> If there are no errors shown at Plesk >Tools & Settings > IP Address Banning (Fail2Ban), the following record appears in /var/log/plesk/panel.log:
CONFIG_TEXT: stderr: ERROR:__main__:Timeout of 10 seconds has been reached. Lock 'service.fail2ban' is already owned by another process with pid <unknown> The license is in grace period even though it was updated/renewed correctly on a licensing server side:
PLESK_WARN: You are currently operating within the grace period of your product license. To update your product license, select the Retrieve Keys option on the License Management page. While trying to retrieve/install keys at the page Plesk > Tools & Settings > License Management it does not load and fails with the following error:
PLESK_ERROR: 504 Gateway Time-out (nginx) Cause
Corrupted Fail2ban packages. When Plesk backend tries to get the service status for fail2ban, the process hangs and returns a timeout error.
Resolution Log into Plesk Stop Fail2Ban service in Plesk > Tools & Settings > Services Management. Connect to the server via SSH Remove all Fail2Ban logs:
# rm -f /var/log/fail2ban* Open Plesk UI, go to Tools & Settings > Updates & upgrades > Add/remove componetns > reinstall Fail2Ban component Additional Information How to install Plesk additional components "
2,"The Plesk interface language was changed or some buttons are absent after the license installation
Applicable to: Plesk Symptoms
The Plesk interface language was changed or some buttons are absent after the license installation.
Cause
The license has custom configuration in Partner Central.
Resolution Log into the Partner Central.
Configure Plesk interface in Product Configuration > Select Configuration. Log into Plesk.
Go to Tools & Settings > License Management.
Press the Retrieve Keys button to apply the changes.
"
3,"A website hosted in Plesk fails to load when ModSecurity is enabled: Access denied with code 403
Applicable to: Plesk for Linux
Plesk for Windows Symptoms ModSecurity is installed and enabled at Tools & Settings > Web Application Firewall (ModSecurity) > On. Website is unavailable or it's not possible to make changes in site, for example edit posts in Wordpress, add products to shopping cart:
PLESK_INFO: ERR_CONNECTION_REFUSED PLESK_INFO: 403 Forbidden PLESK_INFO: 500 Internal Server Error PLESK_INFO: ERR_CONNECTION_TIMED_OUT WordPress Customization page is not displayed properly at WordPress Admin Dashboard > Customize. One of the following error messages appear on the Logs page in Plesk at Domains > example.com > Logs:
CONFIG_TEXT: ModSecurity: Access denied with code 403 (phase 2). Operator GE matched 5 at TX:anomaly_score. [file ""/etc/apache2/modsecurity.d/rules/owasp_modsecurity_crs_3-plesk/REQUEST-949-BLOCKING-EVALUATION.conf""] [line ""57""] [id ""949110""] [msg ""Inbound Anomaly Score Exceeded (Total Score: 5)""] [severity ""CRITICAL""] [tag ""application-multi""] [tag ""language-multi""] [tag ""platform-multi""] [tag ""attack-generic""] [hostname ""example.com""] [uri ""/robots.txt""] [unique_id ""XPsROH8AAQEAABEiZFcAAABC""] CONFIG_TEXT: ModSecurity: Warning. Operator GE matched 5 at TX:inbound_anomaly_score. [file ""/etc/httpd/conf/modsecurity.d/rules/owasp_modsecurity_crs_3-plesk/RESPONSE-980-CORRELATION.conf""] [line ""37""] [id ""980130""] [msg ""Inbound Anomaly Score Exceeded (Total Inbound Score: 5 - SQLI=0,XSS=5,RFI=0,LFI=0,RCE=0,PHPI=0,HTTP=0,SESS=0): Possible XSS Attack Detected - HTML Tag Handler""] [tag ""event-correlation""] [hostname ""webmail.example.com""] [uri ""/.noindex.html""] [unique_id ""XDapuhD7O9GFbqsJzesp7AAAAAM""], referer: https://webmail.example.com/?_task=mail&_action=compose&_id=11404279895c36a9270c378 CONFIG_TEXT: ModSecurity: Warning. Pattern match ""^5\\\\d{2}$"" at RESPONSE_STATUS. [file ""/etc/apache2/modsecurity.d/rules/owasp_modsecurity_crs_3-plesk/RESPONSE-950-DATA-LEAKAGES.conf""] [line ""93""] [id ""950100""] [rev ""3""] [msg ""The Application Returned a 500-Level Status Code""] [data ""Matched Data: 504 found within RESPONSE_STATUS: 504""] [severity ""ERROR""] [ver ""OWASP_CRS/3.0.0""] [maturity ""9""] [accuracy ""9""] [tag ""application-multi""] [tag ""language-multi""] [tag ""platform-multi""] [tag ""attack-disclosure""] [tag ""WASCTC/WASC-13""] [tag ""OWASP_TOP_10/A6""] [tag ""PCI/6.5.6""] [tag ""paranoia-level/2""] [hostname ""server.example.com""] [uri ""/index.php""] [unique_id ""XdNacAQXfB4uxMr8GqtZmQAAAAI""] CONFIG_TEXT: ModSecurity: [file ""/etc/httpd/conf/modsecurity.d/rules/custom/004_i360_4_custom.conf""] [line ""1194""] [id ""77140992""] [msg ""Suspicious access attempt (WP folders)!||SC:/var/www/vhosts/examplecom./httpdocs/wp-admin/options.php||T:APACHE||MVN:REQUEST_FILENAME||MV:/wp-admin/options.php||PC:279||""] [severity ""NOTICE""] [tag ""i360custom""] [tag ""noshow""] Warning. Pattern match ""(\\\\.htaccess|.+\\\\.(pht|phtml|php\\\\d?)$)"" at REQUEST_FILENAME. [hostname ""example.com""] [uri ""/wp-admin/options.php""] [unique_id ""XmDCi5leJOHfxcUxur7kKwAAAAE""], referer: https://example.com/wp-admin/admin.php?page=elementor-tools CONFIG_TEXT: [:error] [pid 31252] [client 203.0.113.2] ModSecurity: [file ""/etc/httpd/conf/modsecurity.d/rules/tortix/modsec/50_plesk_basic_asl_rules.conf""] [line ""387""] [id ""340465""] [rev ""56""] [msg ""Protected by Atomicorp.com Basic Non-Realtime WAF Rules: Remote File Injection attempt in ARGS (admin.php)""] [severity ""CRITICAL""] Access denied with code 403 (phase 2). Match of ""rx ://%{SERVER_NAME}/"" against ""ARGS:acf[field_56f7086726ff3][5723803c33c38][field_56f7089d26ff5]"" required. [hostname ""example.com.203-0-113-2.example.com""] [uri ""/wp-admin/admin.php""] [unique_id ""VyOBQIoQ1geo@o607dR4jwAAAAQ""] Cause
False-positive detection by ModSecurity.
Strict ModSecurity rule-sets (e.g. OWASP or Comodo) may block some operations on the website (such as file sharing, webmail, and some web applications, including WordPress and its plugins).
Resolution
Disable the ModSecurity using ID from the error above: Log in to Plesk. Go to Domains > example.com > Web Application Firewall. Specify the rule IDs from the error message above (for example, 340465) in the field and click OK. "
5,"Plesk Migration fails with max_allowed_packet parameter warning: Could not backup database
Applicable to: Plesk for Windows
Plesk for Linux Symptoms
Migration fails with error:
PLESK_ERROR: Could not backup database 'wordpress_f' of type mysql[Method not found: 'Int64 psarepository.Repository.Pack(System.String, System.String[], System.String[], System.String, System.String, System.String, Int32, Int64, System.Collections.ArrayList, System.Collections.ArrayList)'.]
PLESK_WARN: domain ""example.com"" server. The 'max_allowed_packet' parameter on the source database server is 16777216, which is bigger than on the destination server, where it is 1048576. Some database objects for the domains specified below might not be restored. Please increase the 'max_allowed_packet' value on the destination database server. 1 domain(s) will be affected.
Cause
Low max_allowed_packet value is set for the destination MySQL server.
Resolution
Click on a section to expand Plesk for Linux Connect to the server via SSH Check max_allowed_packet parameter values on both source and destination servers in /etc/my.cnf file. Set the value greater than it is set on the source MySQL server:
# cat /etc/my.cnf | grep 'max_allowed_packet' max_allowed_packet=96M Restart MySQL server:
# service mysql restart
Note: service name might vary depending on the OS, it might be mariadb or mysqld Restart the migration Plesk for Windows Connect to the server via RDP Check max_allowed_packet parameter values on both source and destination servers under ""%plesk_dir%""\\Databases\\MySQL\\data\\my.ini path. Set the value greater than it is set on the source MySQL server:
C:\> ""%plesk_dir%""\\Databases\\MySQL\\data\\my.ini | findstr max_allowed_packet max_allowed_packet=96M Restart MySQL server going to Plesk Service Monitor > SQL Server > Restart Restart the migration "
8,"MailEnable autoresponder does not send an autoreply on Plesk server
Applicable to: Plesk for Windows Symptoms MailEnable autoresponder does not send an autoreply.
The output of the command below differs from an affected server:
C:\> reg query ""HKEY_LOCAL_MACHINE\SOFTWARE\Wow6432Node\Mail Enable\Mail Enable\Agents\MTA"" | findstr Pick Pickup Event Enabled REG_DWORD 0x1 Pickup Event Timeout REG_DWORD 0xea60 Pickup Event Command Enabled REG_DWORD 0x0 Pickup Event Class Name REG_SZ pleskmemta.PleskMEMTA Pickup Event Class Enabled REG_DWORD 0x1 Pickup Event Command REG_SZ Cause
MTA settings were changed or configured manually.
Resolution Connect to the server via RDP;
Note: If direct SSH access to the server is not possible, contact server administrator for further assistance. Open Windows Registry ( Start > Run > regedit.exe ) Navigate to HKEY_LOCAL_MACHINE\SOFTWARE\Wow6432Node\Mail Enable\Mail Enable\Agents\MTA Correct the MTA service settings in the registry as shown below:
CONFIG_TEXT: Pickup Event Enabled REG_DWORD 0x1 Pickup Event Timeout REG_DWORD 0xea60 Pickup Event Command Enabled REG_DWORD 0x0 Pickup Event Class Name REG_SZ pleskmemta.PleskMEMTA Pickup Event Class Enabled REG_DWORD 0x1 Pickup Event Command REG_SZ Launch MailEnable Management console at Windows Start > All Programs > MailEnable. In MailEnable Management console: expand System > Services Status > click on MailEnable SMTP Connector > Restart on the right panel. expand Mail Enable > Services > localhost > Services and Connectors > SMTP > Stop and Start "
2,"Unable to change subscription resources: Unable to allocate the required amount of resources
Applicable to: Plesk for Linux
Plesk for Windows Symptoms Unable to synchronize a subscription of a reseller with the service plan. It is not possible to adjust limit for a subscription. The following message is shown in Plesk:
PLESK_ERROR: Unable to allocate the required amount of resources (15 GB Disk space). Only 12 GB Disk space are available.
OR
PLESK_ERROR: Unable to set the required resource usage limit (15 GB Disk space) because the new value is less than the amount of resources reserved for your customers or used by yourself (12G Disk space)
OR
PLESK_ERROR: Unable to allocate the required amount of resources (2 MySQL databases). Only 0 MySQL databases are available. Unable to restore a backup in Plesk > Domains > example.com > Backup Manager with the following error:
PLESK_ERROR: Unable to allocate the required amount of resources (Unlimited Disk space). Only 12 GB Disk space are available. Migration of a subscription throws similar warnings in Tools & Settigns > Migration and Transfer Manager > 203.0.113.2 > Overview tab > example.com [Details]:
PLESK_WARN: Plesk restore report problem:Execution of ""C:\Program Files (x86)\Plesk\bin\domain_pref.exe"" --update example.com -disk_space_soft -1 -ignore-nonexistent-options failed with return code 1.Stderr isAn error occurred while updating domain settings: Cannot set limit 'disk_space_soft' value to '-1': Unable to allocate the required amount of resources (Unlimited Disk space). Only 90 GB Disk space are available. Cause
Reseller is lacking resources.
Resellers have their own resources they can sell, and for this particular reseller overselling is not allowed, therefore it is not possible to increase disk limit for his subscription.
Resolution In Plesk go to Resellers > John Doe and click Customize. Apply one of the following solutions: Increase disk space limit. Increase amount of allowed MySQL databases. Allow overselling. "
7,"Plesk upgrade fails on installing IIS Rewrite: The installation of the package 'urlrewrite' failed with code 1603 Applicable to: Plesk Onyx for Windows Symptoms
Plesk upgrade for Windows fails: CONFIG_TEXT: MSI: Error! An error occurred during the installation of assembly 'Microsoft.Web.Management.Rewrite,fileVersion=""7.1.761.0"",version=""7.2.2.001"",culture=""neutral"",publicKeyToken=""31BF3856AD364E35"",processorArchitecture=""MSIL""'. Please refer to Help and Support for more information. HRESULT: 0x8002802F. Failed to install 'C:\\a9f588c2d45cba549bb91b9b7de86ab2\\parallels\\PANEL-WIN_11.5.30\ hirdparty-msi-Windows-any-x86_64\\rewrite_2.0_rtw_x64.msi': Fatal error during installation. (Error code 1603) Error: The installation of the package 'urlrewrite' failed with code 1603. (install: installing IIS URL Rewrite Module...) Not all packages were installed. Please, contact product technical support.
Cause
IIS rewrite module is corrupted.
Resolution Connect to Plesk server via RDP Open Server Manager > Tools > Add Features and Roles and install .Net Framework 2.0 or 3.0 or 3.5 ( but not 4+ ): Manual installation is available at this link . Try installing IIS Rewrite module manually (having downloaded the package for Plesk 17.8, or for Plesk 17.5). Consider applying this article if the installation fails. If the issue still persist, remove and install IIS Rewrite Module using Plesk installer:
C:\> plesk installer --console
and reboot the server."
10,"Cannot publish a site with WPB for cPanel: ""Can't receive authorization to work with the host"" Applicable to: Web Presence Builder for Linux Symptoms The site cannot be published via Web Presense Builder while being logged in to end-user's cPanel (11.42.0.23 or higher) from admin ""WebHost Manager (WHM)"". The following error appears in editor:
The site cannot be published to the specified location. One or several of the following errors appear in sitebuilder.log:
[EMERG] /JsonApi/ SB_Site_Compiler_Target_AuthoriseException: Can't receive authorization to work with the host 'example.com' with login 'end-user' file: /usr/local/sb/include/SB/Site/Compiler/Target/FTP.php line: 181 code: 0 10.10.10.10 http://10.10.10.11/Editor Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/33.0.1750.146 Safari/537.36 [EMERG] /JsonApi/ SB_Exception: Invalid CSRF token has been provided. file: /usr/local/sb/include/SB/Controller/Plugins/Sb/CsrfProtect.php line: 21 code: 0 in /usr/local/sb/include/SB/Controller/Plugins/Sb/CsrfProtect.php on line 21 #1 at SB_Controller_Plugins_Sb_CsrfProtect->preDispatch(object(SB_Controller_Request_Http))in /usr/local/sb/include/Zend/Controller/Plugin/Broker.php on line 309 #2 at Zend_Controller_Plugin_Broker->preDispatch(object(SB_Controller_Request_Http))in /usr/local/sb/include/Zend/Controller/Front.php on line 941 #3 at Zend_Controller_Front->dispatch()in /usr/local/sb/include/SB/Application/Web.php on line 262 #4 at SB_Application_Web::run()in /usr/local/sb/htdocs/index.php on line 3 [ERR] /JsonApi/ Cannot copy file to '8520e18166b4a618b525a36cf3627a37.php' via FTP (ftp_put(/usr/local/sb/tmp/ftp_publish_cache_zKT0K0_dir/8520e18166b4a618b525a36cf3627a37.php): failed to open stream: No such file or directory) Cause
Some parameters, particularly FTP passwords, are not propagated from ""WHM"" to cPanel.
Resolution
Make sure that you are logged in to cPanel as a customer, and that you are not using the option log in to cPanel from WHM > Account Information > List Accounts.
Additional information Troubleshooting Integration Issues "
2,"How to change IP address type? Applicable to: Plesk for Linux Plesk for Windows Question
How to change the type of IP address to dedicated or shared? Answer Log into Plesk.
Go to Tools & Settings > IP Addresses > click on the required IP address in the IP Address column.
Tick the Shared or Dedicated option in the IP address is distributed as section: Press the OK button to apply the changes. Solution using the server access For Plesk on Linux Log into the server via SSH. Using the ipmanage command change IP address type: Note: replace the 203.0.113.2 with the required IP address.
To shared
# plesk bin ipmanage -u 203.0.113.2 -type shared
To dedicated
# plesk bin ipmanage -u 203.0.113.2 -type exclusive
Note: before changing to dedicated IP type make sure that websites and customers are not using such an IP address. For Plesk on Windows Log into Log into the server via RDP. Open command prompt.
Using the ipmanage command change the IP address type:
Note: replace the 203.0.113.2 with the required IP address.
To shared
C:\> plesk bin ipmanage.exe --update 203.0.113.2 -type shared
To dedicated
C:\> plesk bin ipmanage.exe --update 203.0.113.2 -type exclusive
Note: before changing to dedicated IP type make sure that websites and customers are not using such an IP address. "
3,"Plesk shows error: This website cannot be started. Another Web site may be using the same port
Applicable to:
Plesk for Windows
Symptoms Domain renaming or creation of a new domain in Plesk fails with error:
PLESK_ERROR: This Web site cannot be started. Another Web site may be using the same port. The same error appears when trying to change hosting settings, e.g. Hosting type from No hosting to Website hosting in Plesk > Domains > example.com > Hosting Settings or Horde site startup in IIS Manager. Cause
Duplicate host headers/bindings in IIS.
Resolution Connect to the server using RDP. Open Windows PowerShell and execute the following script:
PS Get-WebBinding | % { $name = $_.ItemXPath -replace '(?:.*?)name=''([^'']*)(?:.*)', '$1' New-Object psobject -Property @{ Name = $name Binding = $_.bindinginformation.Split("":"")[-1] } } | Group-Object -Property Name | Format-Table Name, @{n=""Bindings"";e={$_.Group.Binding -join ""`n""}} -Wrap Find the duplicates in the output. For example:
CONFIG_TEXT: example.com example.com <- duplicate www.example.com ipv4.example.com example1.com example1.com www.example1.com ipv4.example1.com example.com <- duplicate Open IIS > Expand the Web Sites > Right click on a web site > Select Bindings and remove duplicates for example.com Restart the website in IIS. "
5," How to restore Plesk installation on a new Windows server after disaster?
Applicable to: Plesk for Windows Question
How to restore Plesk installation on a new Windows server after disaster?
Answer
Note: on the new server, the same version of Plesk as on the old one should be installed to the same path, and it should be licensed properly. Also, the same set of components and extensions should be installed on the new server.
We strongly recommend restoring the server from a server backup. It will be the best way to solve the issue.
Also, the following instructions can be used, but we can not guarantee no issue will be faced.
Please note that server configuration (paths) should be exactly the same.
Let us assume that:
CONFIG_TEXT: plesk_dir = C:\Program Files (x86)\Plesk plesk_vhosts = C:\Inetpub\vhosts\
Create a server with exactly the same version of Plesk with the same set of tools installed, with the same DB providers and same IP addresses.
Mount HDD from crashed server on the new server (we assume it is D:\).
Connect to the server using RDP. Plesk Obsidian Open Plesk Services Monitor, click the Select All and then the Stop button in order to stop all Plesk services: Copy Web Presence Builder folders: From:
CONFIG_TEXT: D:\Program Files (x86)\Plesk\sb\config
To:
CONFIG_TEXT: C:\Program Files (x86)\Plesk\sb\config From:
CONFIG_TEXT: D:\Program Files (x86)\Plesk\sb\sites\
To:
CONFIG_TEXT: C:\Program Files (x86)\Plesk\sb\sites\ Copy applications cache folder:
From:
CONFIG_TEXT: D:\Program Files (x86)\Plesk\var\apspackages
To:
CONFIG_TEXT: C:\Program Files (x86)\Plesk\var\apspackages Copy Horde DB password file as follows:
From:
CONFIG_TEXT: D:\Program Files (x86)\Plesk\Webmail\horde\conf.horde.shadow
To:
CONFIG_TEXT: C:\Program Files (x86)\Plesk\Webmail\horde\conf.horde.shadow Copy Plesk databases:
From:
CONFIG_TEXT: D:\Program Files (x86)\Plesk\MySQL\Data
To:
CONFIG_TEXT: C:\Program Files (x86)\Plesk\MySQL\Data Copy websites content:
From:
CONFIG_TEXT: D:\Inetpub\vhosts
To:
CONFIG_TEXT: C:\Inetpub\vhosts Copy mail content: For MailEnable Server:
From:
CONFIG_TEXT: D:\Plesk\Mail Servers\Mail Enable\Config D:\Plesk\Mail Servers\Mail Enable\Postoffices D:\Plesk\Mail Servers\Mail Enable\Queues
To:
CONFIG_TEXT: C:\Plesk\Mail Servers\Mail Enable\Config C:\Plesk\Mail Servers\Mail Enable\Postoffices C:\Plesk\Mail Servers\Mail Enable\Queues For SmarterMail Server:
It will copied in the end of the instruction. Just follow the next steps. Copy Databases: For MySQL databases:
From:
CONFIG_TEXT: D:\Program Files (x86)\Plesk\Databases\MySQL
To:
CONFIG_TEXT: C:\Program Files (x86)\Plesk\Databases\MySQL For MSSQL databases:
From:
CONFIG_TEXT: D:\Program Files (x86)\Plesk\Databases\MSSQL\MSSQL.1\MSSQL\Data
To:
CONFIG_TEXT: C:\Program Files (x86)\Plesk\Databases\MSSQL\MSSQL.1\MSSQL\Data
Attach MSSQL databases using Microsoft SQL Server Management Studio or any other MSSQL Management Utility. Export sym_key to be able to restore users and passwords: Open Windows Registry and load D:\Windows\System32\config\SOFTWARE hive according to Load or Unload Registry Hives.
Export NEW_HIVE\HKEY_LOCAL_MACHINE\SOFTWARE\Wow6432Node\PLESK\PSA Config\Config\sym_key from the loaded hive.
Unload hive, edit the path in exported registry file removing the temp folder name and double-click on it to import. Open Plesk Services Monitor, click the Select All and then the Start button in order to start all Plesk services: Run Command Prompt as Administrator. Restore MSSQL password for the sa user via MSSQL Management Studio . Reconfigure MSSQL Webadmin by executing these commands one by one:
C:\> ""%plesk_cli%/repair.exe"" --reconfigure-mssql-webadmin-siteC:\> ""%plesk_cli%/repair.exe"" --update-mssql-users-permissions Restore MS SQL users and databases
C:\> ""%plesk_cli%/repair.exe"" --mssql Find and rename/delete all .Security files in the vhosts folders:
C:\> for /F ""skip=1 usebackq"" %r in (`plesk db -e ""select name from domains""`) do move ""%plesk_vhosts%""\%r\.plesk\.Security ""%plesk_vhosts%""\%r\.plesk\.Security.old Back to the Command Line Console and re-create all system users by executing the command:
C:\> ""%plesk_cli%\repair.exe"" --repair-all-webspaces-system-users Run Plesk Reconfigurator, click the Repair Plesk Installation button, mark the Plesk Virtual Hosts security checkbox only and click the Check button in order to recreate systems users and restore their permissions: Go to Tools & Settings > Server components > and click Refresh Server Components Back to the Command Line Console and repair SSL certificates:
C:\> plesk repair web -sslcerts Recreate domains in IIS Web server by executing these commands:
C:\> plesk repair web -y Reconfigure FTP by running this command:
C:\> plesk repair ftp -y Reconfigure Mail server by launching this command:
C:\> plesk repair mail -y
Note: in case of issues with the Horde webmail reinstall it. Run the command below to update DNS zones:
C:\> plesk repair dns -y Copy SmarterMail content:
From:
CONFIG_TEXT: D:\SmarterMail
To:
CONFIG_TEXT: C:\SmarterMail Plesk Onyx and Plesk 12.5 Open Plesk Services Monitor, click the Select All and then the Stop button in order to stop all Plesk services: Copy Web Presence Builder folders: From:
CONFIG_TEXT: D:\Program Files (x86)\Plesk\sb\config
To:
CONFIG_TEXT: C:\Program Files (x86)\Plesk\sb\config From:
CONFIG_TEXT: D:\Program Files (x86)\Plesk\sb\sites\
To:
CONFIG_TEXT: C:\Program Files (x86)\Plesk\sb\sites\ Copy applications cache folder:
From:
CONFIG_TEXT: D:\Program Files (x86)\Plesk\var\apspackages
To:
CONFIG_TEXT: C:\Program Files (x86)\Plesk\var\apspackages Copy Horde DB password file as follows:
From:
CONFIG_TEXT: D:\Program Files (x86)\Plesk\Webmail\horde\conf.horde.shadow
To:
CONFIG_TEXT: C:\Program Files (x86)\Plesk\Webmail\horde\conf.horde.shadow Copy Plesk databases: If it is located on MySQL server:
From:
CONFIG_TEXT: D:\Program Files (x86)\Plesk\MySQL\Data
To:
CONFIG_TEXT: C:\Program Files (x86)\Plesk\MySQL\Data If it is located on MSSQL server:
From:
CONFIG_TEXT: D:\Program Files (x86)\Plesk\Databases\MSSQL\MSSQL.1\MSSQL\Data
To:
CONFIG_TEXT: C:\Program Files (x86)\Plesk\Databases\MSSQL\MSSQL.1\MSSQL\Data
Attach Plesk database using Microsoft SQL Server Management Studio or any other MSSQL Management Utility. Copy websites content:
From:
CONFIG_TEXT: D:\Inetpub\vhosts
To:
CONFIG_TEXT: C:\Inetpub\vhosts Copy mail content: For MailEnable Server:
From:
CONFIG_TEXT: D:\Plesk\Mail Servers\Mail Enable\Config D:\Plesk\Mail Servers\Mail Enable\Postoffices D:\Plesk\Mail Servers\Mail Enable\Queues
To:
CONFIG_TEXT: C:\Plesk\Mail Servers\Mail Enable\Config C:\Plesk\Mail Servers\Mail Enable\Postoffices C:\Plesk\Mail Servers\Mail Enable\Queues For SmarterMail Server:
It will copied in the end of the instruction. Just follow the next steps. Copy Databases: For MySQL databases:
From:
CONFIG_TEXT: D:\Program Files (x86)\Plesk\Databases\MySQL
To:
CONFIG_TEXT: C:\Program Files (x86)\Plesk\Databases\MySQL For MSSQL databases:
From:
CONFIG_TEXT: D:\Program Files (x86)\Plesk\Databases\MSSQL\MSSQL.1\MSSQL\Data
To:
CONFIG_TEXT: C:\Program Files (x86)\Plesk\Databases\MSSQL\MSSQL.1\MSSQL\Data
Attach MSSQL databases using Microsoft SQL Server Management Studio or any other MSSQL Management Utility. Open Plesk Services Monitor, click the Select All and then the Start button in order to start all Plesk services: Run Command Prompt as Administrator. Set Plesk Administrator password exactly the same as on the crashed server by using steps from this article:
How to retrieve/reset password of Plesk Administrator (admin) user in Plesk for Windows?
If you have any issues with resetting a password by using this command, restore MySQL password for the admin user according to the following article:
How to reset MySQL administrator password on Windows Restore MSSQL password for the sa user via MSSQL Management Studio . Reconfigure MSSQL Webadmin by executing these commands one by one:
C:\> ""%plesk_cli%/repair"" --reconfigure-mssql-webadmin-site
C:\> ""%plesk_cli%/repair"" --update-mssql-users-permissions Find and rename/delete all .Security files in the vhosts folders:
C:\> for /F ""skip=1 usebackq"" %r in (`plesk db -e ""select name from domains""`) do move ""%plesk_vhosts%""\%r\.plesk\.Security ""%plesk_vhosts%""\%r\.plesk\.Security.old Reset passwords for all Plesk entities by using steps from this article:
Plesk Mass Password Reset script Back to the Command Line Console and create all system usersby executing these commands:
C:\> ""%plesk_bin%\dbclient.exe"" --direct-sql --sql=""SELECT su.login,accounts.password,su.home FROM sys_users su LEFT JOIN accounts ON su.account_id=accounts.id"" > accounts.list.txt > for /f ""skip=1 tokens=1-3"" %x in (accounts.list.txt) do ""%plesk_bin%\usermng.exe"" --add --name=%x --password=%y --home=%z Run Plesk Reconfigurator, click the Repair Plesk Installation button, mark the Plesk Virtual Hosts security checkbox only and click the Check button in order to recreate systems users and restore their permissions: Go to Tools & Settings > Server components > and click Refresh Server Components Back to the Command Line Console and repair SSL certificates:
C:\> plesk repair web -sslcerts Recreate domains in IIS Web server by executing these commands:
C:\> plesk repair web -y Reconfigure FTP by running this command:
C:\> plesk repair ftp -y Reconfigure Mail server by launching this command:
C:\> plesk repair mail -y
Note: in case of issues with the Horde webmail reinstall it. Run the command below to update DNS zones:
C:\> plesk repair dns -y Copy SmarterMail content:
From:
CONFIG_TEXT: D:\SmarterMail
To:
CONFIG_TEXT: C:\SmarterMail Plesk 10.x-12.0 Stop all Plesk services in Plesk Services Monitor: Copy Web Prescense Builder configuration and websites:
D:\Program Files (x86)\Plesk\sb\config to C:\Program Files (x86)\Plesk\sb\config.
D:\Program Files (x86)\Plesk\sb\sites to C:\Program Files (x86)\Plesk\sb\sites Copy applications cacheD:\Program Files (x86)\Plesk\var\apspackages into C:\Program Files (x86)\Plesk\var\apspackages. Copy Horde DB password from D:\Program Files (x86)\Plesk\Webmail\horde\conf\.horde.shadow to C:\Program Files (x86)\Plesk\Webmail\horde\conf\.horde.shadow. Copy Plesk databases:
MySQL - copy D:\Program Files (x86)\Plesk\MySQL\Data to C:\Program Files (x86)\Plesk\MySQL\Data MSSQL - copy D:\Program Files (x86)\Plesk\Databases\MSSQL\MSSQL.1\MSSQL\Data to C:\Program Files (x86)\Plesk\Databases\MSSQL\MSSQL.1\MSSQL\Data Attach Plesk database using Microsoft SQL Server Management Studio or any other MSSQL Management Utility. Copy content from D:\Inetpub\vhosts to C:\Inetpub\vhosts. Copy mail content:
MailEnable Server - D:\Plesk\Mail Servers\Mail Enable , folders Config , Postoffices , Queues .
SmarterMail Server - copy D:\SmarterMail to C:\SmarterMail with content only at the end of this instruction. Copy Databases from D:\Program Files (x86)\Plesk\Databases\MySQL to C:\Program Files (x86)\Plesk\Databases\MySQL.
The same operation for C:\Plesk\Databases\MSSQL Attach MSSQL databases using Microsoft SQL Server Management Studio or any other MSSQL Management Utility. Copy certificates from D:\Program Files (x86)\Plesk\var\certificates to C:\Program Files (x86)\Plesk\var\certificates. Start Plesk services in Plesk Services Monitor Set Administrator password in cmd exactly the same as on crashed server:
C:\> ""%plesk_bin%\plesksrvclient.exe"" -set setup Restore MSSQL ""sa"" password with MSSQL Management Studio .
Reconfigure MSSQL Webadmin:
C:\> ""%plesk_cli%/repair"" --reconfigure-mssql-webadmin-site C:\> ""%plesk_cli%/repair"" --update-mssql-users-permissions Find and rename/delete all '.Security' files in vhosts folders:
For Plesk 11 and Plesk 10.x:
C:\> for /F ""skip=1 usebackq"" %r in (`dbclient.exe --direct-sql ""--sql=select name from domains""`) do move ""%plesk_vhosts%""\%r\.Security ""%plesk_vhosts%""\%r\.Security.old
For Plesk 11.5 and Plesk 12.0:
C:\> for /F ""skip=1 usebackq"" %r in (`dbclient.exe --direct-sql ""--sql=select name from domains""`) do move ""%plesk_vhosts%""\%r\.plesk\.Security ""%plesk_vhosts%""\%r\.plesk\.Security.old Open Windows Registry and load D:\Windows\System32\config\SOFTWARE hive according to Load or Unload Registry Hives. Export NEW_HIVE\HKEY_LOCAL_MACHINE\SOFTWARE\Wow6432Node\PLESK\PSA Config\Config\sym_key from loaded hive. Unload hive, edit the path in exported registry file removing the temp folder name and double-click on it to import. Create all system users in Windows OS:
C:\> ""%plesk_bin%\dbclient.exe"" --direct-sql --sql=""SELECT su.login,accounts.password,su.home FROM sys_users su LEFT JOIN accounts ON su.account_id=accounts.id"" > accounts.list.txt for /f ""skip=1 tokens=1-3"" %x in (accounts.list.txt) do ""%plesk_bin%\usermng.exe"" --add --name=%x --password=%y --home=%z Run Plesk Reconfigurator and perform Repair Plesk Installation > Plesk Virtual Hosts security - it recreates systems users and restores permissions. Recreate domains in IIS Web server:
For Plesk 11.0:
C:\> ""%plesk_bin%\websrvmng.exe"" --reconfigure-all
For Plesk 11.5 and Plesk 12.0:
C:\> ""%plesk_bin%\dbclient.exe"" --direct-sql --sql=""SELECT displayName FROM domains"" > domains.txt C:\> for /f ""skip=1"" %i in (domains.txt) do ""%plesk_dir%\bin\repair.exe"" --reconfigure-web-site -web-site-name %i C:\> ""%plesk_dir%\bin\repair.exe"" --synchronize-protected-directories-storage C:\> ""%plesk_dir%\bin\repair.exe"" --repair-all-webspaces-security C:\> ""%plesk_dir%\bin\repair.exe"" --synchronize-impersonation-storage C:\> ""%plesk_dir%\bin\repair.exe"" --synchronize-protected-directories-storage C:\> for /f ""tokens=*"" %d in ('type C:\domains.txt') do ""%plesk_dir%\bin\repair.exe"" --repair-webspace-security -webspace-name %d Reconfigure FTP:
For Plesk 11.0:
C:\> ""%plesk_bin%\ftpmng.exe"" --reconfigure-all
For Plesk 11.5 and Plesk 12.0:
C:\> ""%plesk_dir%\bin\repair.exe"" --reconfigure-ftp-sites Reconfigure Mail server:
C:\> ""%plesk_bin%\mchk.exe"" --all --fix=all
Note: In case of Webmail issues please reinstall Horde Update DNS zones:
C:\> ""%plesk_bin%\dnsmng.exe"" update * Copy SmarterMail content if required. "
6,"Unable to activate/deactivate domain or import MSSQL dump: User or role does not exist in this database Applicable to: Plesk for Windows Symptoms Unable to activate/deactivate domain or import MSSQL dump, the following error appears:
CONFIG_TEXT: Error: Unable to activate/deactivate domain: User or role 'db_user' does not exist in this database.at (VADOConnection::execute line 90)at Disable user db_user in MSSQL database database_name on host 203.0.113.2\SQLEXPRESS.(domainmng::alter_mssql_users line 730)at Turn off dbusers for domain domain.tld(domainmng::db_users_on_off line 486)at (domainmng::db_users_on_off line 487)at Turn off domain domain.tld (state=1)(domainmng::turnDomain line 120)
Or
CONFIG_TEXT: Error: Some of the selected subscriptions were not activated. Enable database user failed: mssqlmng failed: User or role 'db_user' does not exist in this database. at (VADOConnection::execute line 78) at execute console command --access-user-enable(vconsoleapp::start line 100) at execute ""C:\Program Files (x86)\Parallels\Plesk\admin\bin\mssqlmng.exe"" --access-user-enable ""--server=localhost"" ""--login=sa"" ""--password=*"" ""--database=database_name "" ""--user-login=db_user""(vconsoleapp::run line 117) (Error code 1) When going to Domains > example.com > Databases >Database Users > db_username and pressing OK the following error appears: CONFIG_TEXT: Error: mssqlmng failed: User or role 'database_name' does not exist in this database.at (VADOConnection::execute line 78)at updateUserPermissions(user=db_user, database=database_name, grant_alter_database=false, repair_roles=true)(MSSQLServerManager::updateUserPermissions line 611)at (MSSQLServerManager::updateUserPermissions line 624)at execute console command --update-users-permissions(vconsoleapp::start line 122)at execute ""C:\Program Files (x86)\Plesk\admin\bin\mssqlmng"" --update-users-permissions ""--server=.\MSSQLSERVER2014"" ""--login=sa"" ""--password=*"" ""--grant-alter-database=false"" ""--users-config-file=C:/Program Files (x86)/Plesk/PrivateTemp/bl5178.tmp"" ""--repair-roles=db_backupoperator;db_datareader;db_datawriter;db_ddladmin""(vconsoleapp::run line 139)(Error code 1) Cause
Database user is not mapped to domain's database or absent in MSSQL Server.
Resolution Connect to the server via RDP; Map the database to the user in SQL Server Management Studio > Security > Logins > johndoe > Properties > User Mapping.
Note: use the affected user name instead of johndoe "
8,"Outlook 2007 and other old mail clients not able to use SSL/TLS connection
Applicable to: Plesk 12.5 for Linux
Plesk Onyx for Linux Symptoms
Old mail client such as Outlook 2007 is not able to send a mail via SSL/TLS.
/var/log/maillog contains the following error message from Postfix and Courier:
CONFIG_TEXT: courier-imaps: couriertls: accept: error:1408F10B:SSL routines:SSL3_GET_RECORD:wrong version number postfix/smtpd[17918]: warning: TLS library problem: 21146:error:1408F10B:SSL routines:SSL3_GET_RECORD:wrong version number:s3_pkt.c:340:
or
CONFIG_TEXT: postfix/smtpd: warning: TLS library problem: 7346:error:1408F10B:SSL routlines: SSL3_GET_CLIENT_HELLO:no shared cipher:s3_srvr.c:1387
Cause
SSLv3 support was disabled.
Resolution
Update Outlook version.
OR
Connect to the server using SSH and enable backward compatibility with old mail clients: Set TLS_PROTOCOL=SSL23 in /etc/courier-imap/pop3d-ssl and /etc/courier-imap/imapd-ssl .
Note . SSL23 will enable all SSL/TLS protocols. Edit /etc/postfix/main.cf and set the following:
CONFIG_TEXT:smtp_tls_security_level = may tls_medium_cipherlist = MEDIUM:!aNULL:!MD5 Reload both Postfix and Courier services:
# service postfix reload && service courier reload "
2,"A warning is shown while accessing Plesk or webmail: The certificate is not trusted or NET::ERR_CERT_AUTHORITY_INVALID
Applicable to: Plesk for Linux
Plesk for Windows Symptoms
The following error is shown while accessing Plesk or webmail: On Google Chrome:
CONFIG_TEXT: Your connection is not privateNET::ERR_CERT_AUTHORITY_INVALID On Firefox:
CONFIG_TEXT: This Connection is Untrusted(Error code: sec_error_unknown_issuer)Certificate Error: The security certificate presented by this website was issued for a different website's address. This problem might indicate an attempt to fool you or intercept any data you send to the server. On Internet Explorer:
CONFIG_TEXT: There is a problem with this website’s security certificate. On Opera
CONFIG_TEXT: Opera cannot verify the identity of the server ""XXXX"", due to a certificate problem. The server could be trying to trick you Cause
By default, Plesk is using a self-signed certificate that does not have a signature from the trust center.Or, the mismatched certificate was applied.
Resolution
Note: If Plesk/WebMail is secured via Let's Encrypt, use hostname/domain name to access it because IP address itself cannot be secured with a valid certificate.
In order to avoid the warning, it is required to have a valid SSL certificate. There are several options on how to achieve that: Secure Plesk/domain/WebMail via Let's Encrypt: For domain/webmail/alias, it is required to go to Websites and Domains > example.com > Let's Encrypt and proceed with the installation. Details are available in the following article:How to install SSL certificate for a domain in Plesk For securing Plesk/Mail Server, go to Tools & Settings > SSL/TLS certificates and proceed from there. See the details in the following articles:How to secure Plesk login page URL with SSL certificateHow to secure mail server with Let's Encrypt certificate? Use a purchased SSL certificate: Purchase an SSL certificate signed for IP address/hostname/domain by a trusted center (Certificate Authority) or install Let's Encrypt extension and obtain a free certificate. See Administrator's Guide - Getting SSL Certificates for details. "
0,"How to change PHP parameter for all domains on Plesk server?
Applicable to: Plesk for Linux
Plesk for Windows Question
How to change PHP parameter for all domains?
For example, change open_basedir parameter for all domains?
Answer
Warning: current example is for changing open_basedir value to none. Select another value if needed.
For already created domains:
Note: the further instructions are intended for server administrators with direct RDP/SSH access to the server. If direct SSH/RDP access to the server is not possible, contact server administrator for further assistance. Click here to reveal information for Linux. Connect to the server using SSH. Create a list of domains:
# MYSQL_PWD=`cat /etc/psa/.psa.shadow` mysql psa -uadmin -Ne""select name from domains where htype='vrt_hst'"" > /root/list.txt Create a php.txt file with the needed open_basedir configuration, e.g:
CONFIG_TEXT: open_basedir = none
Note: the above configuration depending on the needs. Run the following command to apply settings from php.txt created on the previous step:
# cat /root/list.txt | while read dom; do /usr/local/psa/bin/site --update-php-settings $dom -settings /root/php.txt;done Click here to reveal information for Windows. Connect to the server via RDP. Create a list of domains:
C:\> plesk db -Ne""select name from domains where htype='vrt_hst'"" > C:\list.txt Create a php.txt file with the needed open_basedir configuration, e.g:
CONFIG_TEXT: open_basedir = none
Note: the above configuration depending on the needs. Run the following command to apply settings from php.txt created on the previous step:
C:\> for /f ""skip=1 tokens=1"" %a in (C:\list.txt) do @""%plesk_cli%\site.exe"" --update-php-settings %a -settings C:\php.txt For new domains:
Set up open_basedir value to none at Service Plans > plan_name > PHP Settings.
Note: Service Plans are available for Web Host and Web Pro editions only.
Alternatively, modify panel.ini configuration file: Log into Plesk. Install the Panel.ini Editor extension in Plesk How to manage Plesk extensions (install, disable, remove, update) Go to Plesk > Extensions > My Extensions > Panel.ini Editor > Go To Extension > Editor. Set the default open_basedir to none:
if there is no [php] section in Panel.ini, add the following:
CONFIG_TEXT: [php] settings.general.open_basedir.default=""none""
Otherwise, add the directive to [php] section:
CONFIG_TEXT: settings.general.open_basedir.default=""none"" Click Save: Additional information
PHP parameters customization.
How to change/customize PHP settings?"
5,"Unable to connect via FTP to Windows Server which is connected to a domain (Active Directory)
Applicable to: Plesk for Windows Symptoms An FTP user cannot login with a correct username and password when Windows Server is connected to a domain. The following error message appears in Windows command-line FTP client:
C:\> ftp 203.0.113.2 Connected to 203.0.113.2. 220 Microsoft FTP Service User (203.0.113.2:(none)): john_doe 331 Password required Password: 530-User cannot log in. Win32 error: The user name or password is incorrect. Error details: An error occurred during the authentication process. 530 End Login failed.
OR
C:\> Access denied FileZilla:
PLESK_INFO: Response: 530 User cannot log in. Error: Critical error: Could not connect to server Cause
When Windows Server is connected to a domain (Active Directory), an FTP user is treated as a domain user.
Resolution
Use the ""hostname\FTP login"" pair as a username for FTP connections: Find a server hostname:
C:\> hostname WIN-PLESK-SERVER Use this hostname together with an FTP login as a username. For example:
C:\> ftp 203.0.113.2 Connected to 203.0.113.2. 220 Microsoft FTP Service User (203.0.113.2:(none)): WIN-PLESK-SERVER\john_doe 331 Password required Password: 230 User logged in. ftp> ls 200 PORT command successful.
Alternatively, use the ""Active Directory domain name\FTP login"" pair:
C:\> ftp 203.0.113.2Connected to 203.0.113.2. 220 Microsoft FTP Service User (203.0.113.2:(none)): pleskserver\john_doe "
9,"How to exclude backup files created by a Plesk administrator from the disk usage of a subscription
Applicable to: Plesk for Linux
Plesk for Windows Question
A server-wide backup is included into the disk space usage of a subscription and causes suspension of hosting service due disk overuse.
How to exclude backup files created by a Plesk administrator from the disk usage of a subscription?
Answer Excluding server-wide backups via the Plesk interface In Plesk, go to Tools & Settings > Server Settings. Uncheck the backup files created by the administrator setting. Click OK to apply the changes. Excluding server-wide backups via a command-line interface Connect to a Plesk server via SSH. Run the command:
# plesk bin server_pref -u -include-admindumps <option>
where <option> can be one of the following: true - enables including domain backup files in the disk space usage calculation false - disables including domain backup files in the disk space usage calculation Note: Subscription disk usage will be recalculated with the next Daily Maintenance Backup Task execution. Related Articles How to rerun daily maintenance tasks separately for Plesk on Linux
How to rerun daily maintenance tasks separately on Plesk for Windows
"
3,"Unable to start PHP-FPM if no domains are assigned to it: No pool defined. at least one pool section must be specified in config file
Applicable to: Plesk 12.5 for Linux
Plesk Onyx for Linux Symptoms
Unable to start PHP-FPM if no domains are using it:
Note: plesk-php56-fpm is used as an example. The command below reports that PHP-FPM is not in use by any domain:
# plesk bin php_handler --get-usage -id plesk-php56-fpm The PHP handler with ID ""plesk-php56-fpm"" is not used. There are no (zero) configuration files inside a PHP-FPM pool directory:
# ls /opt/plesk/php/5.6/etc/php-fpm.d/* | wc -l ls: cannot access /opt/plesk/php/5.6/etc/php-fpm.d/*: No such file or directory 0 The following error message appear in /var/log/plesk-php56-fpm/error.log:
CONFIG_TEXT: ERROR: No pool defined. at least one pool section must be specified in config file Going to Tools & Settings > Services Management > Plesk PHP-FPM 5.6 service cannot be started, its status is disabled as follows: Cause
This is expected behavior: If a PHP-FPM handler is not in use by any of domains, it will not start.
When a domain will be switched to this PHP-FPM handler, its PHP-FPM service will start automatically.
Resolution
To start using a particular PHP-FPM version, just assign it to any domain at Domains > example.com > PHP Settings. The service will be started automatically."
6,"Unable to remove a database: This resource is used by installed web application Applicable to: Plesk for Linux Plesk for Windows Symptoms Unable to remove a database in Plesk: The option Remove Database is grayed out at Plesk > Domains > example.com > Databases.
The check-box next to the database name is grayed out and the database name contains This resource is used by the installed site application at Tools & Settings > Database Server > Databases. There is no application installed at Domains > example.com > Applications. Cause
Database inconsistency.
Resolution
In order to fix this, the following can be done:
Click on a section to expand Through SSH connection and CLI Connect to a Plesk server via SSH/RDP. Create a backup of the Plesk database: on Linux, run the command:
# plesk db dump psa > /root/psa_backup.sql on Windows Server, start a command prompt as an Administrator and run the command:
C:\> plesk db dump psa > C:\psa_backup.sql Connect to the Plesk database:
MYSQL_LIN: plesk db Find ID of the subscription to which the affected domain belongs:
MYSQL_LIN: mysql> select id from domains where name='example.com'; +----+ | id | +----+ | 23 | +----+ Find the connection ID between an application and a database using ID from the step 4:
MYSQL_LIN: mysql> SELECT data_bases.name,apsResources.pleskId FROM `data_bases` INNER JOIN `DatabaseServers` ON data_bases.db_server_id = DatabaseServers.id LEFT JOIN `apsResources` ON apsResources.pleskId = data_bases.id AND apsResources.pleskType=""db"" WHERE (dom_id = 23); +------------+---------+ | name | pleskId | +------------+---------+ | example_db | 17 | +------------+---------+ Delete a connection record using pleskId from the step 5:
MYSQL_LIN: mysql> DELETE FROM apsResources WHERE pleskType=""db"" AND pleskId=17; Remove the database at Plesk > Domains > example.com > Databases. Through Plesk interface Log in to Plesk Go to Tools and settings > Database Servers and access PhpMyAdmin Create psa database dump through select psa database and clicking on the export tab and clicking on Go Click SQL tab to access SQL query box Find ID of the subscription to which the affected domain belongs:
MYSQL_LIN: mysql> select id from domains where name='example.com'; +----+ | id | +----+ | 23 | +----+ Find the connection ID between an application and a database using ID from the step 4:
MYSQL_LIN: mysql> SELECT data_bases.name,apsResources.pleskId FROM `data_bases` INNER JOIN `DatabaseServers` ON data_bases.db_server_id = DatabaseServers.id LEFT JOIN `apsResources` ON apsResources.pleskId = data_bases.id AND apsResources.pleskType=""db"" WHERE (dom_id = 23); +------------+---------+ | name | pleskId | +------------+---------+ | example_db | 17 | +------------+---------+ Delete a connection record using pleskId from the step 5:
MYSQL_LIN: mysql> DELETE FROM apsResources WHERE pleskType=""db"" AND pleskId=17; Remove the database at Plesk > Domains > example.com > Databases. "
7,"Cannot install Plesk: ERROR 1146 (42S02) at line 1: Table 'psa.misc' doesn't exist
Applicable to: Plesk Onyx for Linux Symptoms Plesk cannot be installed: PLESK_INFO: ERROR 1146 (42S02) at line 1: Table 'psa.misc' doesn't exist Plesk autoinstaller cannot create 'psa' database. Also, it is not possible to create the database manually:
# MYSQL_PWD=`cat /etc/psa/.psa.shadow` mysql -u admin psa < /usr/local/psa/bootstrapper/pp17.8.11-bootstrapper/db/psa_db.sql ERROR 1364 (HY000) at line 141: Field 'pname' doesn't have a default value MySQL server is running in strict mode:
# plesk db ""show variables like 'sql_mode'"" sql_mode | STRICT_TRANS_TABLES,STRICT_ALL_TABLES Cause
Strict mode does not allow inserting NULL value into a NOT NULL column. Resolution Login to the server over SSH Disable the strict mode in /etc/my.cnf (RHEL/Centos) or /etc/mysql/my.cnf (Debian/Ubuntu): CONFIG_TEXT: [mysqld] sql_mode="""" Restart MySQL server:
# service mysql restart || service mariadb restart || service mysqld restart "
8,"Mailman on Plesk server is not saving messages in archive: [Errno 13] Permission denied
Applicable to:
Plesk for Linux
Symptoms Mailman is not saving received messages, and sent messages are not delivered to recipients. One of the following errors is found in the log file /var/log/mailman/error:
CONFIG_TEXT: mlist.ArchiveMail(msg) File ""/usr/lib/mailman/Mailman/Archiver/Archiver.py"", line 200, in ArchiveMail self.__archive_to_mbox(msg) File ""/usr/lib/mailman/Mailman/Archiver/Archiver.py"", line 169, in __archive_to_mbox mbox = self.__archive_file(afn) File ""/usr/lib/mailman/Mailman/Archiver/Archiver.py"", line 157, in __archive_file return Mailbox.Mailbox(open(afn, 'a+')) IOError: [Errno 13] Permission denied: '/var/lib/mailman/archives/private/example.mbox/example.mbox'
OR
CONFIG_TEXT: (1860) Archive file access failure: /var/lib/mailman/archives/private/example.mbox/example.mbox [Errno 13] Permission denied: '/var/lib/mailman/archives/private/example.mbox/example.mbox' (1860) Uncaught runner exception: [Errno 13] Permission denied: '/var/lib/mailman/archives/private/example.mbox/example.mbox' The ownership of the directory /var/lib/mailman/archives/private is set as mailman:apache:
# ls -ld /var/lib/mailman/archives/private drwxrws--- 8 mailman apache 4096 Apr 13 08:31 /var/lib/mailman/archives/private Cause
Incorrect ownership on the directory /var/lib/mailman/archives/private.
Resolution Connect to the server using SSH. Set the correct ownership for the directory /var/lib/mailman/archives/private:
# chown apache.mailman /var/lib/mailman/archives/private # chown -R .mailman /var/lib/mailman/archives/private/* "
3,"Website fails to load with 502/503: (13)Permission denied: AH02454: FCGI: attempt to connect to Unix domain socket failed
Applicable to: Plesk 12.5 for Linux
Plesk Onyx for Linux
Plesk 12.0 for Linux Symptoms PHP-FPM handler is set in Domains > example.com > PHP Settings for a website and it is not accessible with the following error:
CONFIG_TEXT: 502 Bad Gateway
CONFIG_TEXT: 503 Service Temporarily Unavailable The server is temporarily unable to service your request due to maintenance downtime or capacity problems. Please try again later. The following error is in /etc/apache2/logs/error_log or in /var/www/vhosts/example.com/logs/error_log:
CONFIG_TEXT: (13)Permission denied: AH02454: FCGI: attempt to connect to Unix domain socket /var/www/vhosts/system/example.com/php-fpm.sock (127.0.0.1) failed Socket file has incorrect permissions (it should be 0660 ):
# getfacl /var/www/vhosts/system/example.com/php-fpm.sockgetfacl: Removing leading '/' from absolute path names file: var/www/vhosts/system/example.com/php-fpm.sock owner: root group: psaserv user::rw- group::--- other::--- Cause
Extended ACL rules are set for /var/www/vhosts/system/ directory and subdirectories, which overwrite correct permissions.
Resolution Connect to the server via SSH; Disable extended ACL rules for /var/www/vhosts/system/ directory
# setfacl -Rb /var/www/vhosts/system/ If it did not fix the issue, try changing PHP version for the domain: Log into Plesk;
Go to Domains > example.com > PHP Settings.
"
6,"Plesk Installer fails: ERROR while trying to backup MySQL database
Applicable to: Plesk for Linux Symptoms Plesk upgrade/update fails with:
CONFIG_TEXT: Trying to backup MySQL database... ERROR while trying to backup MySQL database Check the error reason(see log file: /tmp/plesk_11.0.9_installation.log), fix and try again Upgrade log file /tmp/plesk_11.0.9_installation.log contains:
CONFIG_TEXT: === Preparing upgrade chown: changing ownership of `/storage/mysql.preupgrade.11.0.9-11.0.9.20130616-153540.dump.gz': Operation not permitted Cause
An incorrect value of DUMP_D variable is set in /etc/psa/psa.conf file.
Resolution Connect to the Plesk server via SSH. Change DUMP_D variable in /etc/psa/psa.conf file to the default value:
# cat /etc/psa/psa.conf | grep DUMP DUMP_D /var/lib/psa/dumps DUMP_TMP_D /tmp "
8,"Unable to update/remove a mailbox in Plesk: mailmng failed: MEAOPO.Mailbox.GetMailbox failed
Applicable to: Plesk for Windows Symptoms The error message is received when attempting to manage (update the password for or remove) a mailbox using Plesk: Refresh Usage Stats fails under Domains > example.com > Email Addresses and Disk Usage is shown incorrectly
The affected mailbox is missing under MailEnable > Messaging Manager > Post Offices > example.com One of the errors below is observed:
CONFIG_TEXT: Unable to remove the mail names: mailmng failed: MEAOPO.Mailbox.GetMailbox failed MEAOPO.Mailbox.RemoveMailbox failed MEAOAM.AddressMap.RemoveAddressMap failed for domainexample.com [example.com] CONFIG_TEXT: MEAOPO.Mailbox.GetMailbox failed at (MailEnable::MailEnableMailName::MailEnableMailName line 92) at execute console command --set-password(vconsoleapp::start line 128) at execute ""C:\\\\Program Files\\\\SWsoft\\\\Plesk\\\\admin\\\\bin\\\\mailmng.exe"" --set-password ""--domain-name=example.com"" ""--mailname=jdoe"" --password=stereotype""(vconsoleapp::run line 138) Execute file name: C:\\\\Program Files\\\\Plesk\\\\admin\\\\bin\\\\mailmng.exe CONFIG_TEXT: Internal error: mailmng failed: Loaded Postoffice Configuration Provider (MEAIPO.DLL) MEAOPO.Mailbox.GetMailbox failed Message mailmng failed: Loaded Postoffice Configuration Provider (MEAIPO.DLL) MEAOPO.Mailbox.GetMailbox failed CONFIG_TEXT: Unable to delete some of the selected e-mail addresses CONFIG_TEXT: Internal error: mailmng failed: MEAOPO.Mailbox.GetMailbox failed at (MailEnable::MailEnableMailName::MailEnableMailName line 95) at execute console command --get-mailbox-size(vconsoleapp::start line 122) at execute ""E:\Program Files (x86)\Parallels\Plesk\admin\bin\mailmng"" --get-mailbox-size ""--domain-name=example.com"" ""--mailname=jdoe""(vconsoleapp::run line 139) (Error code 1) Cause
MailEnable misconfiguration
Resolution
Note: if direct RDP access to the server is not possible, contact server administrator for further assistance. Connect to the server via RDP. Open Command Prompt as Administrator:
Run the following command:
C:\> plesk repair mail example.com "
6,"How to install and enable PostgreSQL database server in Plesk
Applicable to: Plesk for Linux Question
How to install and enable PostgreSQL database server in Plesk?
Answer Install PostgreSQL database server using Plesk Installer according to this KB article. Go to Tools & Settings > Database Servers and click localhost next to PostgreSQL. Specify username and password which will be administrative for PostgreSQL and click OK to initialize PostgreSQL: Related Articles How to enable remote access to PostgreSQL server on a Plesk server Additional information PostgreSQL Client Authentication
"
5,"How to choose a license for destination Plesk server in case of migration?
Applicable to: Plesk Question How to choose a license for the destination Plesk server in case of migration? How to migrate a license from the source server to the destination server after migration? Answer Contact Plesk Sales team to request a trial license, that is valid for 14 days and does not have any limitations on number on domains, languages or components. For Plesk Obsidian and Plesk Onyx, the customers can request a trial license: Plesk Trial For Free For other versions, customers should contact Plesk Sales team. Install a trial license and migrate. Determine if an old license can be used and/or upgraded, or a new one should be purchased: If the other hosting panel is installed on the source server either Plesk version 9 or older one, a new license should be purchased. If Plesk versions are the same on the source and destination server, the old license can be used. For other Plesk licenses, visit: Is my Plesk license compatible with Plesk Onyx "
4,"[FIXED BUG] Unable to list APS applications: Search results could not be loaded at the moment Applicable to: Plesk Obsidian for Linux Symptoms Unable to list APS applications for a domain with the error:
PLESK_ERROR: Search results could not be loaded at the moment Unable to upgrade Plesk:
PLESK_ERROR: Unable to find ""main"" IP address in ""psa"" database. The following error can be found in /var/log/sw-cp-server/error_log file:
CONFIG_TEXT: ERR (3): APS Catalog error: Unable to define main IP address Cause Product issue: #PPPM-11484 ""Under specific circumstances, Plesk no longer fails to detect the main IP address on the server.""
Fixed in: Plesk Obsidian 12 May 2020 (Linux) Plesk Obsidian 17 March 2020 (Linux) Resolution
Please consider updating your server: How to install Plesk updates Workaround
Apply one of the following solutions:
Via Plesk GUI Log into Plesk. Go to Tools & Settings > IP addresses.
Press the Reread IP button.
Note: in case the solution did not help, use the steps from the ""Via server access"" section. Via Server access Connect to the server via SSH. Run the following command:
# /usr/local/psa/bin/ipmanage --reread If the solution above did not help, apply the solution below: Create a backup of psa database:
# plesk db dump psa > psa.sql Connect to psa database in MySQL console:
# plesk db Change the value of main to true for one of the IP addresses:
MYSQL_LIN: mysql> UPDATE IP_Addresses set main='true' WHERE ip_address='10.10.10.10';
Note: replace the IP Address 10.10.10.10 with yours one. "
6,"phpMyAdmin shows error exporting large database: PHP Fatal error: Allowed memory size of 268435456 bytes exhausted
Applicable to: Plesk 12.5 for Linux Symptoms When trying to export a database to a file using phpMyAdmin tool, it generates a file of 0 bytes in size. Plesk may fail to open PHPMyAdmin page at https://example.com:8443/domains/databases/phpMyAdmin/export.php. Following error appears in /var/log/sw-cp-server/error_log:
CONFIG_TEXT: FastCGI-stderr: PHP Fatal error: Allowed memory size of 134217728 bytes exhausted (tried to allocate 98069376 bytes) in /opt/psa/admin/htdocs/domains/databases/phpMyAdmin/libraries/zip.lib.php on line 115 Resolution Connect to the server via SSH; Increase memory_limit value by editing the file /usr/local/psa/admin/conf/php.ini
Note: this will change the limit to 384M:
# sed -i ""s/memory_limit\ \=\ [0-9][0-9][0-9]M/memory_limit\ \=\ 384M/"" /usr/local/psa/admin/conf/php.ini Restart services:
# service sw-cp-server restart && service sw-engine restart "
8,"Mail queue in Plesk contains deferred emails: Host or domain name not found
Applicable to: Plesk for Linux Symptoms There are deferred (unsent) emails in Plesk > Tools and Settings > Mail Server Settings > Mail Queue, that failed to be sent to @example.com address. The following error is shown in /var/log/maillog :
CONFIG_TEXT: status=deferred (Host or domain name not found. Name service error for name=example.com type=MX: Host not found, try again The remote may be resolved from Plesk server:
# dig example.com +short # dig example.com mx +short The remote host can be resolved from a different server:
# dig example.com +short 203.0.112.2 # dig example.com mx +short 10 mail.example.com Cause
The server is configured to use a DNS resolver which cannot resolve DNS names or there are no DNS servers configured in /etc/resolv.conf.
Resolution Connect to the server via SSH;
Add proper resolver to /etc/resolv.conf. For example:
# cat /etc/resolv.conf nameserver 8.8.8.8
Note: If in /etc/resolv.conf there are more nameservers, please set it on top of the nameservers list. Nameservers list order matters. Additional information
Postfix has stopped sending emails: status=deferred, Host or domain name not found"
5,"Backup to external FTP fails on Plesk: Transport error: unable to list directory: Curl error: Transferred a partial file
Applicable to: Plesk 12.5 for Linux
Plesk 12.0 for Windows
Plesk 12.0 for Linux Symptoms Plesk backup to external FTP repository fails:
PLESK_ERROR: Transport error: unable to list directory: Curl error: Transferred a partial file ProFTPD 1.3.3a or higher is used on external FTP.
Manual upload of backup file on same FTP repository using FileZilla or other FTP client is working fine, but upload using curl fails:
# curl -v -k --ftp-ssl ftp://xxx.xxx.xxx.xxx//backups/ --user <ftpuser>:<ftp_pass> --upload-file backup.zip < 425 Unable to build data connection: Operation not permitted * server did not report OK, got 425 Cause
Starting from ProFTPD 1.3.3 mod_tls only accepts SSL/TLS data connections that reuse the SSL session of the control connection. But curl does not reuse SSL sessions.
Resolution Connect to the remote server via SSH. Disable requirement of SSL session reuse in the /etc/proftpd.conf configuration file by editing using vi utility:
<IfModule mod_tls.c> ... TLSOptions NoSessionReuseRequired ...</IfModule> Restart ProFTPD service:
# service xinetd restart "
8,"How to enable submission port 587 in MailEnable on Plesk Windows server? Applicable to: Plesk for Windows Question
How to enable submission port 587 in MailEnable?
Answer
Submission port 587 can be enabled either via Plesk or via MailEnable Management Console.
Click on a section to expand Via Plesk Log into Plesk. Go to Tools & Settings > Mail Server Settings. Enable the option Switch on message submission on all IP addresses. Click OK to apply the changes. Click on a section to expand Via MailEnable Management Console Connect to a Plesk server via RDP.
Note: if direct RDP access to the server is not possible, contact server administrator for further assistance. Launch MailEnable from Windows Start > All Programs > Mail Enable. In the Mail Enable Management console expand MailEnable Management > Servers > Localhost > Services and Connectors and right-click on SMTP to open its Properties. In the SMTP Properties window switch to the Inbound tab and click Settings (Port Settings). Enable the option Listen on alternate port: 587 and click OK. Right-click on SMTP: stop the service and then start the service to apply the changes. Additional information
How to enable 587 submission port on Linux?"
2,"Plesk shows HTTP Error 503. The service is unavailable: A listener channel for protocol 'http' in worker process serving application pool 'PleskControlPanel' reported a listener channel failure Applicable to: Plesk 11.x for Windows Plesk 12.0 for Windows Plesk 12.5 for Windows Symptoms Unable to access Plesk GUI, the following error is shown:
CONFIG_TEXT: HTTP Error 503. The service is unavailable. Plesk uses IIS as a Web server. IIS Advanced Logging or IIS Mod-Rewrite is installed on the server. Going to IIS > Sites > PleskControlPanel > ISAPI Filters > There are third-party ISAPI filters registered as shown in the following screenshot: Plesk Default application pool crashes several seconds after it has been restarted and the following error is shown in Event viewer:
CONFIG_TEXT: Log Name: System Source: Microsoft-Windows-WAS Date: 9/29/2009 1:02:52 PM Event ID: 5139 Task Category: None Level: Warning Keywords: Classic User: N/A Computer: Test Description: A listener channel for protocol 'http' in worker process '3768' serving application pool 'PleskControlPanel' reported a listener channel failure. The data field contains the error number. Cause
This is caused by a third-party ISAPI filter configured for the PleskControlPanel website, which cannot run at the same time as the Plesk rewrite filter.
Resolution Connect to the server via RDP Go to IIS > Sites > PleskControlPanel > ISAPI Filters > Remove third-party ISAPI filters, keep only the Plesk rewrite filter as shown in the following screenshot: "
2,"How to restore default permissions on a domain in Plesk for Windows?
Applicable to: Plesk Onyx for Windows
Plesk 11.x for Windows
Plesk 12.0 for Windows
Plesk 12.5 for Windows
Plesk 9.x for Windows Question
How to restore default permissions on a domain in Plesk for Windows?
Answer
When default permissions on the domain folder are lost, the following actions can be performed to restore them:
For Plesk 12.5 and Onyx:
C:\> ""%plesk_cli%\repair.exe"" --repair-webspace-security -webspace-name example.com
If it is necessary to repair permissions for all domains, the following command should be used:
C:\> ""%plesk_cli%\repair.exe"" --repair-all-webspaces-security
Also, Plesk Reconfigurator could be used: in the Windows Start menu, select All Programs > Plesk > Plesk Reconfigurator and select Repair Plesk installation > Plesk Virtual Hosts Security > Check .
For Plesk before 12.5:
Go to the Domains page, mark the required domains, and click on the Check permissions button. Then uncheck the Check-only mode checkbox and click OK .
Additional information
For Plesk on Linux use the following KB article:
#213910345 - How to restore default permissions in the virtual host directory"
2,"How to hide buttons from the External Services section in Plesk? Applicable to: Plesk for Linux Question How to hide buttons Register Domain Name, Manage Domain Names, View Services and Buy SSL/TLS Certificate in Plesk > Tools & Settings > External Services?
How to hide buttons Register Domain Name and Manage Domain Names in Plesk > Domains > example.com? Answer Log into Plesk.
Go to Tools & Settings > Interface Management > Interface Controls Visibility > Controls.
Tick the option which is required to hide: Note: if all three options will be selected as on the screenshot above, the External Services section will not be no shown in Plesk > Tools & Settings. Press the OK button to apply the changes. Solution using the SSH access Log into the server via SSH.
Execute the command below to hide the corresponding button: To hide View Services button:
# plesk bin panel_gui --preferences -extras true To hide Buy SSL/TLS Certificate button:
# plesk bin panel_gui --preferences -cert_purchasing true To hide Register Domain Names and Manage Domain Names buttons:
# plesk bin panel_gui --preferences -cert_purchasing true "
6,"Unable to upload database with phpMyAdmin: Script timeout passed or 504 Gateway Timeout is shown
Applicable to: Plesk for Linux
Plesk for Windows Symptoms
When trying to upload a database in phpMyAdmin more than 500Mb, getting the error.
PLESK_ERROR: Script timeout passed, if you want to finish import, please resubmit same file and import will resume. Or:
CONFIG_TEXT: ERROR: Maximum execution time of 300 seconds exceeded (DBIMysqli.php:262) Cause
The error occurs because of a huge file and the restoration process fails with timeout.
Resolution
Starting from Plesk 12.5, it is possible to import databases via Plesk. Browse to Home > Domains > example.com > Databases and use importing functionality: If it does not help, follow one of the solutions below.
Solution 1
Increase the 'ExecTimeLimit' value:
Linux: Login to the server over SSH. Create the file config.inc.php at /usr/local/psa/admin/htdocs/domains/databases/phpMyAdmin/libraries/ copying the content of config.default.php file:
# cp -p /usr/local/psa/admin/htdocs/domains/databases/phpMyAdmin/libraries/config.default.php /usr/local/psa/admin/htdocs/domains/databases/phpMyAdmin/libraries/config.inc.php Increase the value of $cfg['ExecTimeLimit'] in /usr/local/psa/admin/htdocs/domains/databases/phpMyAdmin/libraries/config.inc.php:
CONFIG_TEXT: $cfg['ExecTimeLimit'] = 3600; Increase the settings in /etc/sw-cp-server/config to avoid '504 Gateway Timeout' error:
CONFIG_TEXT: fastcgi_read_timeout 3600; fastcgi_send_timeout 3600; Restart sw-cp-server:
# service sw-cp-server restart Note: if the issue still persist, the browser cache sholud be cleared. Windows: Login to the server over RDP. Create the file config.inc.php at %plesk_dir%admin\htdocs\domains\databases\phpMyAdmin\libraries\. Copy the content of %plesk_dir%admin\htdocs\domains\databases\phpMyAdmin\libraries\config.default.php to %plesk_dir%admin\htdocs\domains\databases\phpMyAdmin\libraries\config.inc.php. Increase the value of $cfg['ExecTimeLimit'] in %plesk_dir%admin\htdocs\domains\databases\phpMyAdmin\libraries\config.inc.php:
CONFIG_TEXT: $cfg['ExecTimeLimit'] = 3600; Solution 2
Upload the database via command prompt:
Linux: Login to the server over SSH.
Upload the database dump to the server (any of the convenient ways).
Restore the database:
# MYSQL_PWD=`cat /etc/psa/.psa.shadow` mysql -uadmin db_name < /path/to/database_dump Windows: Login to the server over RDP.
Upload the database dump to the server.
Restore the database:
C:\> ""%plesk_dir%MySQL\bin\mysql.exe"" -u DBUSER -p******** -P 3306 DATABASENAME < .\path\to\mysql_backup.sql Additional Information Cannot edit config.inc.php: Can't open file for writing "
8,"How to check how many messages in the mail queue in Plesk?
Applicable to: Plesk for Linux Question
How to check how many messages in the mail queue in Plesk?
Answer
Note: The list of messages in the mail queue can be found in Plesk in Tools & Settings > Mail Server Settings > Mail Queue For Qmail Connect to the server using SSH Execute the following command:
# /var/qmail/bin/qmail-qstat messages in queue: 58 messages in queue but not yet preprocessed: 1
The output means that there are 58 messages in the queue. And one message was received for delivery via SMTP but has not been processed and put in the queue for delivery. For Postfix Connect to the server using SSH Execute one of the following commands:
# mailq | grep Requests -- 4 Kbytes in 2 Requests.
# postqueue -p | tail -n 1 -- 4 Kbytes in 2 Requests.
The above output means there are 2 messages in the queue. "
4,"Unable to manage subscription or install Let's Encrypt SSL: Failed to updated ip. Can't set to addon domain ip different from webspace ip
Applicable to: Plesk Onyx for Linux
Plesk Onyx for Windows Symptoms Unable to change the Hosting Settings or PHP Settings via Plesk > Subscriptions > example.com due to the following error:
PLESK_ERROR: Failed to updated ip. Can't set to addon domain ip different from webspace ip The same error occurs in an attempt to install a Let's Encrypt certificate. There are subdomains and/or additional domains under the affected subscription. The following error is displayed while accessing the WordPress Admin Panel or saving settings via WordPress Admin Panel:
CONFIG_TEXT: PHP has encountered an Access Violation at XXXXX Cause
The inconsistency in the psa database.
There are different IP addresses set on additional domains and subdomains under the affected subscription.
Resolution For Linux Connect to the server via SSH. Create a backup of the psa database:
# plesk db dump psa > /root/psa_backup.sql Download the attached script:
# wget https://plesk.zendesk.com/hc/article_attachments/115001860533/script_kb213376309 Make the script executable:
# chmod +x script_kb213376309 Launch the script for the affected subscription:
Note: change the ""example.com"" website in the command below to the correct one.
# ./script_kb213376309 example.com If an error like below appears:
CONFIG_TEXT: ERROR 1062 (23000) at line 5: Duplicate entry '123-789' for key 'PRIMARY' exit status 1
find the duplicate record in the database:
Note: change the ""123"" ipCollectionId in the command below to the correct one based on the error message regarding the duplicate entry.
# plesk db ""select * from IpAddressesCollections where ipCollectionId=123;"" +----------------+-------------+ | ipCollectionId | ipAddressId | +----------------+-------------+ | 123 | 789 | | 123 | 456 | +----------------+-------------+ Remove the duplicate record from the database:
Note: change the ""123"" ipCollectionId in the command below to the correct one based on the error message regarding the duplicate entry Change the ""456"" ipAddressId in the command below to the correct one based on the output from the previous step.
# plesk db ""delete from IpAddressesCollections where ipCollectionId=123 and ipAddressId=456;"" For Windows Connect to the server via RDP. Run the Command Prompt as administrator. Create a backup of the psa database:
C:\> plesk db dump psa > C:\psa_backup.sql Connect to Plesk database:
C:\> plesk db Declare a variable with the affected website:
Note: change the ""example.com"" website in the command below to the correct one.
MYSQL_WIN: set @name:='example.com'; Run the following SQL queries one by one:
MYSQL_WIN: SELECT IP_Addresses.id FROM IP_Addresses LEFT JOIN dom_param ON dom_param.val=IP_Addresses.id AND dom_param.param='ip_addr_id' LEFT JOIN domains d ON d.id=dom_param.dom_id WHERE d.name=@name into @ip_id; UPDATE dom_param SET val=@ip_id WHERE param='ip_addr_id' AND dom_id IN (SELECT id FROM domains WHERE name=@name OR webspace_id = (SELECT id FROM domains WHERE name=@name)); UPDATE IpAddressesCollections set ipAddressId=@ip_id where ipCollectionId in (select ipCollectionId from DomainServices where type='web' AND dom_id in (select id from domains where name=@name OR webspace_id = (select id from domains where name=@name))); If an error like below appears:
CONFIG_TEXT: ERROR 1062 (23000) at line 5: Duplicate entry '123-789' for key 'PRIMARY' exit status 1
find the duplicate record in the database:
Note: change the ""123"" ipCollectionId in the command below to the correct one based on the error message regarding the duplicate entry.
MYSQL_WIN: select * from IpAddressesCollections where ipCollectionId=123; +----------------+-------------+ | ipCollectionId | ipAddressId | +----------------+-------------+ | 123 | 789 | | 123 | 456 | +----------------+-------------+ Remove the duplicate record from the database:
Note: change the ""123"" ipCollectionId in the command below to the correct one based on the error message regarding the duplicate entry Change the ""456"" ipAddressId in the command below to the correct one based on the output from the previous step.
MYSQL_WIN: delete from IpAddressesCollections where ipCollectionId=123 and ipAddressId=456; "
7,"Unable to update/upgrade Plesk: ERROR with rpm_check_debug vs depsolve: package is needed by package2
Applicable to: Plesk for Linux Symptoms Plesk update/upgrade procedure fails due to dependencies error, for example:
CONFIG_TEXT: Fatal error during packages installation: [u'ERROR with rpm_check_debug vs depsolve:', 'php-gd is needed by psa-php5-configurator-1.7.0-cos6.build1708180212.17.x86_64', 'php-imap is needed by psa-php5-configurator-1.7.0-cos6.build1708180212.17.x86_64', 'php-mbstring is needed by psa-php5-configurator-1.7.0-cos6.build1708180212.17.x86_64', 'php-mysql is needed by psa-php5-configurator-1.7.0-cos6.build1708180212.17.x86_64', 'libkadm5clnt_mit.so.8()(64bit) is needed by krb5-workstation-1.10.3-65.el6.x86_64', 'libkadm5clnt_mit.so.8(kadm5clnt_mit_8_MIT)(64bit) is needed by krb5-workstation-1.10.3-65.el6.x86_64', 'libkadm5srv_mit.so.8()(64bit) is needed by krb5-workstation-1.10.3-65.el6.x86_64', 'libkadm5srv_mit.so.8(kadm5srv_mit_8_MIT)(64bit) is needed by krb5-workstation-1.10.3-65.el6.x86_64', The same error can be found in the /var/log/plesk/panel.log file. Output of the command below shows that the packages mentioned in the error message are not installed on the server. For example, php-pdo:
# rpm -qa | grep php-pdo # Cause
Mentioned in the error above packages are not installed.
Resolution Connect to the server via SSH; Install all missing packages mentioned in the error message, in this example:
Warning: Disable any 3d-party repositories if enabled to avoid package conflict.
# yum install php-pdo php-gd php-imap php-imap php-mbstring php-mysql libkadm5.x86_64 Re-run Plesk upgrade. "
8,"Mail from Plesk server is rejected with error: 550-5.7.1 is likely unsolicited mail
Applicable to: Plesk for Linux
Plesk for Windows Symptoms
Mail forwarded to Gmail is rejected:
CONFIG_TEXT: Our system has detected that this message 550-5.7.1 is likely unsolicited mail. To reduce the amount of spam sent to 550-5.7.1 Gmail, this message has been blocked. Please visit 550-5.7.1 http://support.google.com/mail/bin/answer.py?hl=en&answer=188131 for 550 5.7.1 more information. ho13si622251wib.49 - gsmtp (in reply to end of DATA command)
OR
CONFIG_TEXT: MailEnable: Message could not be delivered to some recipients. The following recipient(s) could not be reached: Recipient: [SMTP:john.doe@example.com] Reason: Remote SMTP Server Returned: 550 See http://spf.pobox.com/why.html?sender=***(#5.7.1)
The following error log can be found in /var/log/maillog :
CONFIG_TEXT: postfix/smtp[4907]: 02A25158106B: to=john.doe@example.com, relay=mx1.example.com[203.0.113.2]:25, delay=22, delays=0.45/0.04/10/12, dsn=5.7.1, status=bounced (host mx1.example.com[203.0.113.2] said: 550 5.7.1 john.doe@example.com: Recipient address rejected: Please see http://www.openspf.net/Why?s=helo;id=example1.com;ip=203.0.113.3;r=mx1 (in reply to RCPT TO command))
OR
CONFIG_TEXT: postfix / smtp [21756]: 6EB2880CAD5E: to = john.doe@example.com, relay = mx1.example.com [203.0.113.2]: 25, delay = 0.64, delays = 0.05 / 0.01 / 0.15 / 0.43, dsn = 5.0.0, status = bounced (host mx1.example.com [203.0.113.2] said: 550 Rejecting for Sender Policy Framework (in reply to RCPT TO command))
Similar issue may occur with other public mail services, like Hotmail etc.
The message can be also placed to the spam folder.
Cause
SPF record is not set properly.
Resolution
Using Plesk Interface Log in to Plesk. Go to Domains > example.com > DNS Settings. Check the syntax of SPF record according to the article How to check whether a domain has a correctly set SPF record?
If a domain does not have an SPF record, add it by clicking Add Record, selecting TXT Record Type:
v=spf1 +a +mx \-all: Using SSH/RDP connection
Connect to the server via SSH/RDP and execute the following command in the Command Prompt or Linux Shell:
on Windows :
C:\> plesk bin dns --add example.com -txt ""v=spf1 +a +mx -all""
on Linux :
# plesk bin dns --add example.com -txt ""v=spf1 +a +mx -all""
Note: if SPF record was updated recently wait till proper SPF record will be propagated 12-24h"
9,"How to update or rebuild DNS configuration file and zone files of domains? Applicable to: Plesk for Linux
Plesk for Windows Question
How to update or rebuild DNS configuration file and zone files of domains?
Answer Log in to Plesk server using SSH/RDP Use repair utility:
# plesk repair dns -y "
2,"Unable to create domain under a subscription: IP addresses for mail service of domain are not set
Applicable to: Plesk for Linux Symptoms
Creation of domain fails with error:
PLESK_ERROR: IP addresses for mail service of domain are not set
Cause
Database inconsistency. Missing entry in table psa.IpAddressesCollections .
Resolution
Note: in case the issue occurs on Plesk Multi Server, the solution must be applied on the service node with the affected subscription. Connect to the server using SSH. Login to Plesk database: How to access Plesk database. Find ipCollectionId of missing entry:
MYSQL_LIN: mysql> select id from psa.IpCollections where id not in (select ipCollectionId from psa.IpAddressesCollections); +----+ | id | +----+ | 15 | +----+ 1 row in set (0.00 sec) Find ID of an appropriate IP address:
MYSQL_LIN: mysql> select id, ip_address from IP_Addresses; +----+-------------+ | id | ip_address | +----+-------------+ | 1 | 203.0.113.2 | | 2 | 192.0.2.2 | +----+-------------+ 2 rows in set (0.00 sec) Add missing record with preferred IP address ID, e.g. 1:
MYSQL_LIN: mysql> insert into psa.IpAddressesCollections values(15,1); Query OK, 1 row affected (0.00 sec)
Note: In case multiple records are missing in psa.IpAddressesCollections table in step 3, use the following script to add all of the records :
# plesk db -Ne ""select id from psa.IpCollections where id not in (select ipCollectionId from psa.IpAddressesCollections)"" | while read i; do plesk db ""insert into IpAddressesCollections values ('$i','1')""; done "
9,"DNS records not propagated to slave-server permission denied
Applicable to: Plesk 12.5 for Linux Symptoms ""Slave DNS Manager"" extension is used on the Plesk server. DNS record of CNAME type example.com is present on slave DNS server, but slave DNS server does not resolve name example.com . The following message is present in /var/log/messages :
CONFIG_TEXT: ns1 named[7428]: dumping master file: tmp-W29mSBbQ7W: open: permission denied. On slave DNS server The following message appears in /var/log/named/general.log with verbose logging is on
CONFIG_TEXT: 03:51:40.281 zone example.com/IN: refresh: CNAME at top of zone in master 203.0.113.2#53 (source 0.0.0.0#0)Or below record in /var/log/messages:CONFIG_TEXT: zone example.com/IN: refresh: non-authoritative answer from master 203.0.113.2#53 (source 0.0.0.0#0). The following command fails with permission denied error
# rndc -c /usr/local/psa/var/modules/slave-dns-manager/slave_203.0.113.2.conf delzone example.com Cause
Group named have no permissions to write to directory /var/named .
Resolution Connect to the slave dns server via SSH. Perform the following command on the slave DNS server:
# chmod 770 /var/named Perform the following commands on the Plesk server:
# rndc -c /usr/local/psa/var/modules/slave-dns-manager/slave_203.0.113.2.conf delzone example.com# rndc -c /usr/local/psa/var/modules/slave-dns-manager/slave_203.0.113.2.conf reload "
2,"Different operations in Plesk fails with error: System error 13: Permission denied
Applicable to: Plesk for Linux Symptoms An operation in Plesk interface fails with a Permission denied error:
PLESK_ERROR: Unable to read components configuration from the service node: sh: /usr/local/psa/admin/bin/packagemng: Permission denied
OR
PLESK_ERROR: ifmng: execve failed for /usr/local/psa/admin/sbin/ifmng: Permission denied System error 13: Permission denied
OR
PLESK_ERROR: ERROR: Service_Agent_Exception Unable to execute php_handlers_control: php_handlers_control: execve failed for /usr/local/psa/admin/sbin/php_handlers_control: Permission denied System error 13: Permission denied
OR
PLESK_ERROR: ERROR: PleskUtilException mailmng-server failed: mailmng-server: execve failed for /usr/local/psa/admin/sbin/mailmng-server: Permission denied System error 13: Permission denied
OR
PLESK_ERROR: Internal error: mailmng-mailname failed: Unable to open dir /var/qmail/mailnames/example.com/test/@attachments: Permission denied System error 13: Permission denied
OR
PLESK_ERROR: lsws_cmd: execve failed for /usr/local/psa/admin/sbin/modules//litespeed/lsws_cmd: Permission denied
OR
PLESK_ERROR: ERROR: PleskFatalException: StatInfo->getProductVersion failed: sysinfo failed: sysinfo: execve failed for /usr/local/psa/admin/sbin/sysinfo: Permission denied Migration pre-check fails with the following error:
PLESK_ERROR: COMMAND: '/usr/local/psa/admin/sbin/modules/panel-migrator/plesk-migrator' 'generate-migration-list' '/usr/local/psa/var/modules/panel-migrator/sessions/20171101170413/config.ini' '--migration-list-format=json' '--migration-list-file=/usr/local/psa/var/modules/panel-migrator/sessions/20171101170413/migration-list-raw.json' '--skip-services-checks' '--include-existing-subscriptions' '--async' '--overwrite' '--reload-source-data' EXIT CODE: 126 STDOUT: STDERR: sh: /usr/local/psa/admin/bin/modules/panel-migrator/plesk-migrator: Permission denied Cause
Plesk service cannot execute a backend utility or the utility is unable to change some files due to incorrect permissions.
Resolution Connect to the server via SSH. Make sure that the following files have the proper permissions and owners:
# ls -al /usr/local/psa/admin/sbin/*wrapper-r-s--x--- 1 root psaadm 13120 Jun 13 21:51 ./admin/sbin/mod_wrapper-r-s--x--- 1 root psaadm 13632 Jun 13 21:51 ./admin/sbin/wrapper If permissions above are not correct use the following commands to fix them :
# cd /usr/local/psa/ # chown root:psaadm ./admin/sbin/*wrapper # chmod 4510 ./admin/sbin/*wrapper Make sure that the correct permissions are set to all the directories below:
# ls -ld /usr/local/psa/admin/sbin/ drwxr-xr-x 3 root root 4096 Sep 22 03:28 /usr/local/psa/admin/sbin/ # ls -ld /usr/local/psa/admin/ drwxr-xr-x 18 root root 4096 Aug 11 2014 /usr/local/psa/admin/ # ls -ld /usr/local/psa/ drwxr-xr-x 15 root root 4096 Sep 14 05:27 /usr/local/psa/ # ls -ld /usr/local/ drwxr-xr-x 14 root root 4096 Aug 19 11:35 /usr/local/ # ls -ld /usr/ drwxr-xr-x 13 root root 4096 Jul 6 16:48 /usr/ # ls -ld / dr-xr-xr-x 20 root root 4096 Oct 28 12:40 / Make sure that the correct permissions are set to the following folder as also: For Centos 7:
# ls -ld /bin lrwxrwxrwx 1 root root 7 Mar 8 2017 /bin -> usr/bin # ls -ld /usr/bin/ dr-xr-xr-x. 2 root root 28672 Apr 18 20:29 /usr/bin/ For other OS:
# ls -ld /bin dr-xr-xr-x 2 root root 4096 Mar 16 03:20 /bin "
8,"Outlook fails to send an email: SASL authentication failure. On Plesk for Linux
Applicable to: Plesk for Linux Symptoms While trying to send an email from Microsoft Outlook, the login/password prompt appears and do not accept credentials.
The warning as below can be found in the /var/log/maillog:
CONFIG_TEXT: mail.example.com postfix/smtpd[17318]: warning: SASL authentication failure: realm changed: authentication aborted Cause
Current implementation of a DIGEST-MD5 authentication in libsasl2 library is incompatible with Microsoft Outlook.
Resolution Login to the server via SSH. Back up the file:For CentOS/RHEL-based distributions:
# cp /usr/lib64/sasl2/smtpd.conf /usr/lib64/sasl2/smtpd.conf.bak
For Debian/Ubuntu-based distributions: # cp /etc/postfix/sasl/smtpd.conf /etc/postfix/sasl/smtpd.conf.bak Disable Digest-MD5 authentication for postfix by editing /usr/lib64/sasl2/smtpd.conf or /etc/postfix/sasl/smtpd.conf file using text editor with replacing there a line:
CONFIG_TEXT: mech_list: DIGEST-MD5 CRAM-MD5 PLAIN LOGIN
with
CONFIG_TEXT: mech_list: CRAM-MD5 PLAIN LOGIN Restart the Postfix service to apply changes:
# service postfix restart "
5,"Plesk migration cannot start: key type ssh-dss not in PubkeyAcceptedKeyTypes
Applicable to: Plesk 12.5 for Linux Symptoms Plesk Migration cannot start:
PLESK_ERROR: Error: Failed to fetch basic information about resellers, clients and domains data from source servers Cause: Command execution failed on the local server with non-zero exit code. command: rsync -l --chmod=Fu=r,Du=rwx,go= -e 'ssh -i /usr/local/psa/var/modules/panel-migrator/sessions/20160927004329/ssh-keys/id_dsa.203.0.113.2 -p 22 -o PasswordAuthentication=no -o StrictHostKeyChecking=no -o GSSAPIAuthentication=no' /usr/local/psa/var/modules/panel-migrator/sessions/20160927004329/ssh_upload.1 root@203.0.113.2:/tmp/panel_migrator/version exit code: 12 stdout: stderr: Permission denied (publickey,password). rsync: connection unexpectedly closed (0 bytes received so far) [sender] rsync error: error in rsync protocol data stream (code 12) at io.c(605) [sender=3.0.9] Error in /var/log/secure:
CONFIG_TEXT: sshd[13892]: userauth_pubkey: key type ssh-dss not in PubkeyAcceptedKeyTypes [preauth] sshd[13892]: Connection closed by 203.0.113.1 [preauth] Cause
SSH server misconfiguration.
Resolution
Warning: Use this solution only if the following error is found in /var/log/secure file:
# grep ssh-dss /var/log/secure userauth_pubkey: key type ssh-dss not in PubkeyAcceptedKeyTypes [preauth] Connect to the source server via SSH Add the key type to SSH server configuration:
# echo ""PubkeyAcceptedKeyTypes=+ssh-dss"" >> /etc/ssh/sshd_config Reload SSH server:
# service sshd reload "
3,".svc files are being downloaded or show ""HTTP Error 404.3""
Applicable to: Plesk for Windows Symptoms
When opening a .svc file in a web-browser, the file is being downloaded or the following error message appears:
PLESK_INFO: HTTP Error 404.3 - Not Found
Cause
IIS misconfiguration.
Resolution
Apply one of the following solutions: Install the HTTP Activation module on the server: Connect to a Plesk server via RDP. Start Server Manager from Windows Start. In Server Manager, click Manage > Add Roles and Features. In the Features section, expand .NET Framework 4.X Features > WCF Services Select HTTP Activation feature for installation and click Install. Add additional configuration in domain's web.config file: Connect to a Plesk server via RDP. Open the web.config file located in domain's httpdocs directory in any text editor and add the content below in <system.webServer></system.webServer>:
CONFIG_TEXT: <handlers> <add name=""svc-integrated"" path=""*.svc"" verb=""*"" type=""System.ServiceModel.Activation.HttpHandler"" resourceType=""File"" preCondition=""integratedMode"" /> </handlers> Try to open a .svc file in a web-browser directly from the Plesk server.
If the following error message appears in a web-browser after adding configuration in web.config:
PLESK_INFO: This collection already contains an address with scheme http. There can be at most one address per scheme in this collection. If your service is being hosted in IIS you can fix the problem by setting 'system.serviceModel/serviceHostingEnvironment/multipleSiteBindingsEnabled' to true or specifying 'system.serviceModel/serviceHostingEnvironment/baseAddressPrefixFilters'.
open the web.config file again and add the following configuration right before </configuration>:
CONFIG_TEXT: <system.serviceModel> <serviceHostingEnvironment multipleSiteBindingsEnabled=""true"" ></serviceHostingEnvironment> </system.serviceModel> "
7,"Unable to open the ""Updates and Upgrades"" page or start Plesk Installer in CLI: Update operation was locked by another update process
Applicable to: Plesk for Linux
Plesk for Windows Symptoms
Unable to open the Updates and Upgrades page or start Plesk Installer in a command-line interface, when another Plesk Installer process is running on a server: On Linux:
# ps aux | grep install | grep -v grep root 11451 1.7 0.7 193396 14764 ? S 15:35 0:00 /usr/local/psa/admin/bin/autoinstaller --service-mode --enable-xml-output --ssl-cert /usr/local/psa/admin/conf/httpsd.pem --branch release,stable --web-interface --with-ssl --disable-browser On Windows Server this can be check using two ways: In a command prompt with the command:
C:\> wmic process where ""caption like '%installer%'"" get processId,caption Caption ProcessId parallels_installer_Microsoft_10.0_x86_64_3.22.12.exe 6444 In Task Manager: When clicking on Updates and Upgrades in Plesk, the page prompts for a root password or does not open at all with one of the following error messages in a web-browser:
PLESK_INFO: The connection has timed out PLESK_INFO: Can't connect to backend: No such file or directory PLESK_INFO: This webpage is not available. PLESK_INFO: ERR_CONNECTION_TIMED_OUT When starting Plesk Installer in a command-line interface, the following message is shown:
CONFIG_TEXT: BUSY: Update operation was locked by another update process. CONFIG_TEXT: Error: Unable to start Plesk Installer. The following error has occurred: Installation could not be started: another installation procedure is currently running. The following error message may appear in autoinstaller3.log (on Linux: /var/log/plesk/install/autoinstaller3.log, on Windows Server: C:\ParallelsInstaller\autoinstaller3.log:
CONFIG_TEXT: Error: Can't start build-in web-server. Cause
Only one instance of Plesk Installer can be launched at a time.
Possible causes: Previously started Plesk Web Installer process (Tools & Settings > Updates and Upgrades) is still running on the server. By design, if Plesk Web Installer was opened in a web-browser and then closed, its process will still be active in a background and then terminated automatically after 30 minutes of inactivity. Previously started Plesk Installer process hanged for some reason and could not be terminated automatically. Another Plesk administrator is using Plesk Installer. Resolution
Terminate active Plesk Installer processes to start Plesk Installer.
Note: Before applying the solution below, make sure that other users on the Plesk server are not using Plesk Installer. For Plesk Obsidian Connect to the Plesk server via SSH (Linux) / RDP (Windows Server). Stop Plesk Installer processes (On Windows Server, use a command prompt as Administrator):
# plesk installer stop For Plesk Onyx and earlier releases For Plesk on Linux Connect to the Plesk server via SSH. Find PIDs of Plesk Installer processes:
# ps aux | grep install | grep -v grep root 12345 1.5 0.8 136856 18280 ? S 20:43 0:00 /var/cache/parallels_installer/parallels_installer_CentOS_7_x86_64_3.21.3 --service-mode --enable-xml-output --ssl-cert /usr/local/psa/admin/conf/httpsd.pem --branch release,stable --web-interface --with-ssl --disable-browser root 12346 0.0 0.1 109776 2808 ? S 20:43 0:00 /var/cache/parallels_installer/parallels_installer_CentOS_7_x86_64_3.21.3 --service-mode --enable-xml-output --ssl-cert /usr/local/psa/admin/conf/httpsd.pem --branch release,stable --web-interface --with-ssl --disable-browser Kill found processes using the command below. Replace 12345 12346 with actual PIDs from the step above:
# kill -9 12345 12346 Remove the /tmp/psa-installer.lock file, if it exists. Start Plesk Installer. For Plesk on Windows Server Apply one of the following solutions: Terminate Plesk Installer processes using a command prompt Connect to the Plesk server via RDP. Start a command prompt. Find PID of a Plesk Installer process:
C:\> wmic process where ""caption like '%installer%'"" get processId,caption Caption ProcessId parallels_installer_Microsoft_10.0_x86_64_3.22.12.exe 6444Caption ProcessIdai.exe 6444 Kill the process using its PID:
C:\> taskkill /PID 6444 /F Kill the ai.exe process:
C:\> taskkill /FI ""IMAGENAME eq ai.exe"" /F Terminate Plesk Installer processes using Windows Task Manager Open Task Manager (Open Windows Start > type ""Task Manager""). Right-click on each existing ""Plesk Installer"" process and click End Task.
Note: Plesk Installer processes can have one of the following names depending on Plesk version: Plesk Installer, ai.exe, parallels-installer.exe or plesk-installer.exe. "
3,"Website in Plesk shows error 503; its application pool randomly stops within a specified time period: automatically disabled due to a series of failures
Applicable to: Plesk for Windows Symptoms A website is unavailable with the following error:
CONFIG_TEXT: 503. The service is unavailable. The application pool stops randomly within a specified time period. The following error can be found in Windows > Start > Event Viewer > Windows Logs: Cause
Rapid-Fail Protection disables application pool if it crashes several times within a specified time period.
Resolution
Note: Rapid-Fail Protection prevents the failing application pool from getting into a continuous loop of crashing. This is useful when an application goes out of control which could overload the server. In general, it is better to review the application code to resolve crashes.
To prevent an Application Pool from stopping, disable Rapid Fail Protection in IIS. Refer to these articles for more information: http://www.iis.net/configreference/system.applicationhost/applicationpools/add/failure
http://technet.microsoft.com/en-us/library/cc745955.aspx General steps to disable Rapid Fail Protection for application pool are the following: Connect to the server via RDP. Open Internet Information Services (IIS) Manager > Application pools > choose application pool > Advanced Settings. Scroll down to Rapid Fail Protection and change the option Enabled from True to False. Click OK to apply the changes. Note: if the application is crashing frequently, it may require reviewing the application code in order to prevent repeated crashes."
8,"Mailenable webmail fails with error: 0x80070003 Cannot read configuration file
Applicable to: Plesk for Windows Symptoms
Attempting to access Mailenable webmail in a browser fails with error:
CONFIG_TEXT: HTTP Error 500.19 - Internal Server ErrorThe requested page cannot be accessed because the related configuration data for the page is invalid.Detailed Error InformationModule IIS Web CoreNotification BeginRequestHandler Not yet determinedError Code 0x80070003Config Error Cannot read configuration fileConfig File \\\\?\\C:\\Program Files (x86)\\Parallels\\Plesk\\.\\Mail Servers\\Mail Enable\\Bin\\NETWebMail\\web.config
Cause
There is an extra dot '.' in the path of webmail site in IIS configuration.
Resolution Connect to the server using RDP. Open IIS(Internet Information Services) manager and navigate to Sites > MailEnable Webmail, click Basic Settings... and specify the correct path: If the above steps does not solve the issue follow the below instruction: Check MailEnable configuration in registry. Open HKEY_LOCAL_MACHINE\\SOFTWARE\\Wow6432Node\\Mail Enable\\Mail Enable find Application Directory key and modify it. The key value should look as:
CONFIG_TEXT: C:\\Program Files (x86)\\Parallels\\Plesk\\Mail Servers\\Mail Enable\\Bin Correct webmail configuration in IIS config file C:\\Windows\\System32\\inetsrv\\config\\applicationHost.config file. It should look like:
CONFIG_TEXT: <application path=""/MEWebMail"" applicationPool=""MailEnableAppPool""> <virtualDirectory path=""/"" physicalPath=""C:\Program Files (x86)\Parallels\Plesk\Mail Servers\Mail Enable\Bin\NetWebMail"" /> </application> "
8,"Mail delivery to an external domain fails: mail loops back to myself
Applicable to: Plesk for Linux Symptoms Mail to an external domain is not delivered. The following entries can be found in /usr/local/psa/var/log/maillog :
# status=bounced (mail for example.com loops back to myself) # postfix/smtp[30738]: warning: host mail.example.com[203.0.113.2]:25 greeted me with my own hostname c1.example.com Unable to get root email delivered externally. In /etc/aliases there is the following:
# tail /etc/aliases # Person who should get root's mail root: johndoe@example.com Cause
The remote server thinks that he is sending mail to itself. Possible reasons: IP Address of MX record for recipient's domain points to Plesk server
myhostname parameter is the same on both sender and recipient servers Resolution Connect to the server via SSH. Make sure first that IP address of the recipient's domain does not belong to the Plesk server:
# host example.com example.com has address 203.0.113.2 example.com mail is handled by 0 example.com. # if a | grep 203.0.113.2 inet 203.0.113.2/32 brd 203.0.113.2 scope global venet0:0
On the example above, IP address 203.0.113.2 belongs to sender server. That is why Postfix falls in a loop.
If DNS is handled by third party name server, correct DNS settings in Plesk accordingly. In case IP address does not point to the same server, check myhostname on a source and compare with hostname from the log:
# postconf | grep myhostname myhostname = c1.example.com # postfix/smtp[30738]: warning: host mail.example.com[129.168.0.1]:25 greeted me with my own hostname c1.example.com
If they are equal, it is required to change myhostname in /etc/postfix/main.cf file. As an additional step, it may be required to add a required domain name to 'mydestination' line. It should look as follows: mydestination = localdomain, localhost, localhost.localdomain, localhost, example.com and restart postfix using the following command:
# service postfix restart "
6,"Unable to install Plesk applications: Unable connect to local MySQL server through socket '/tmp/mysql.sock' (2) Applicable to: Plesk Onyx for Linux
Plesk 12.5 for Linux Symptoms Installation of application in Domains > example.com > Website & Settings > Applications > Install application or an attempt to access WordPress Toolkit page fails with the error:
PLESK_INFO: Exception: ODBC error #08S01: [unixODBC][MySQL][ODBC 5.1 Driver]Can't connect to local MySQL server through socket '/tmp/mysql.sock' (2) file: /usr/share/aps_php/aps_php.php line: 12519 code: 0 The same error is shown while accessing Plesk > Tools & Settings > Application Vault MySQL service is running. Cause
The /tmp/mysql.sock link does not exist.
Resolution Connect to the server via SSH Make sure that MySQL is running. If not try to start it. If yes, this solution is not applicable.
Check /tmp/mysql.sock link file:
# ls -l /tmp/mysql.sock ls: cannot access /tmp/mysql.sock: No such file or directory Create the link if it does not exist:
# ln -s /var/lib/mysql/mysql.sock /tmp/mysql.sock "
7,"ModSecurity ruleset update fails: Cannot retrieve metalink for repository: epel Applicable to: Plesk Onyx for Linux Note: applicable for RedHat-based operating systems only.
Symptoms ModSecurity ruleset update fails with the error below:
CONFIG_TEXT: WARNING: This key is not certified with a trusted signature! gpg: There is no indication that the signature belongs to the owner. Primary key fingerprint: 1818 66DF 9DAC A40E 5B42 9B08 FFBD 5D0A 4520 AFA9 TERM environment variable not set. Error: Cannot retrieve metalink for repository: epel. Please verify its path and try again Command '/bin/bash < /tmp/tmpsGmerE/aum-plesk-installer' returned non-zero exit status 1 Unable to download tortix rule set Plesk upgrade fails with the following error:
CONFIG_TEXT: RepoError: Cannot retrieve metalink for repository: epel. Please verify its path and try again Cause
epel repository cannot be verified.
Resolution Connect to the server via SSH.
Upgrade ca-certificates package.
# yum --disablerepo=epel -y update ca-certificates Update ModSecurity rule set manually:
# /usr/local/psa/bin/sw-engine-pleskrun /usr/local/psa/admin/plib/DailyMaintainance/script.php -f UpdateModSecurityRuleSet If it does not help, follow next steps: Connect to the server via SSH.
Disable epel repository in /etc/yum.repos.d/epel.repo by switching from 1 to 0:
CONFIG_TEXT: [BEFORE] [epel] name=Extra Packages for Enterprise Linux 7 - $basearch #baseurl=http://download.fedoraproject.org/pub/epel/7/$basearch metalink=https://mirrors.fedoraproject.org/metalink?repo=epel-7&arch=$basearch failovermethod=priority enabled=1 gpgcheck=1 gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-EPEL-7 [AFTER] [epel] name=Extra Packages for Enterprise Linux 7 - $basearch #baseurl=http://download.fedoraproject.org/pub/epel/7/$basearch metalink=https://mirrors.fedoraproject.org/metalink?repo=epel-7&arch=$basearch failovermethod=priority enabled=0 gpgcheck=1 gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-EPEL-7 Update ModSecurity rule set manually:
# /usr/local/psa/bin/sw-engine-pleskrun /usr/local/psa/admin/plib/DailyMaintainance/script.php -f UpdateModSecurityRuleSet "
8,"Postfix is not running in Plesk: fatal: open database /var/spool/postfix/plesk/transport.db: Invalid argument Applicable to: Plesk for Linux Symptoms Postfix is shown as not running in Tools & Settings > Services Management.
However, postfix service is running in case it is checked via SSH:
# service postfix status master (pid 2741) is running... In the /usr/local/psa/var/log/maillog following error exists:
CONFIG_TEXT:postfix/trivial-rewrite[19467]: fatal: open database /var/spool/postfix/plesk/transport.db: Invalid argument postfix/master[3213]: warning: process /usr/libexec/postfix/trivial-rewrite pid 19467 exit status 1 postfix/master[3213]: warning: /usr/libexec/postfix/trivial-rewrite: bad command startup -- throttling postfix/smtpd[19469]: fatal: open database /var/spool/postfix/plesk/blacklists.db: Invalid argument postfix/master[3213]: warning: process /usr/libexec/postfix/smtpd pid 19469 exit status 1 postfix/master[3213]: warning: /usr/libexec/postfix/smtpd: bad command startup -- throttling Cause
The /var/spool/postfix/plesk/transport.db database is corrupted.
Resolution Log into the server via SSH. Rebuild /var/spool/postfix/plesk/transport.db:
# /usr/local/psa/admin/sbin/mchk --with-spam In case it fails with error below:
# /usr/local/psa/admin/sbin/mchk --with-spam ==> Checking for: mailsrv_conf_init... fail
Rename file /var/spool/postfix/plesk/transport.db and execute the command again.
Check /usr/local/psa/var/log/maillog for further errors. Additional Information
Unable to send emails: Temporary lookup failure"
8,"Website or Webmail is showing 500 internal server error: command cgi_wrapper not in docroot Applicable to: Plesk Onyx for Linux Symptoms Accessing to Webmail shows a ""500 internal server error"" The following can be seen in the Apache log file:
# tail -f /var/log/httpd/error_log [warn] [client 123.123.123.123] (104)Connection reset by peer: mod_fcgid: error reading data from FastCGI server [Thu Dec 05 17:21:00 2013] [error] [client 123.123.123.123] Premature end of script headers: index.php The following can be seen in the Suexec log file:
# tail -f /var/log/httpd/suexec_log uid: (501/horde_sysuser) gid: (504/504) cmd: cgi_wrapper command cgi_wrapper not in docroot (501) Cause
CGI wrapper that comes with CentOS' apache RPM is configured to allow only CGI scripts in /var/www
Resolution
Ensure that the /var/www is not a symlink to any other directory: Connect to the server via SSH Check that /var/www is not a symlink to any other directory:
# ls -ld /var/www lrwxrwxrwx 1 root root 14 Oct 24 11:14 www -> /mnt/data/www/ If the symlink exist, remove it and change the vhost location using the the transvhosts.pl from the following article: How to change virtual hosts location in Plesk for Linux? "
0,"How to get a list of all domains from which are using a specific PHP handler in Plesk via command line?
Applicable to: Plesk for Linux
Plesk for Windows Question
How, using the CLI, the version and type of PHP setup configured on each site on the server can be found?
Answer Connect to the server via SSH/via RDP. Use the following command to get the additional information for each registered PHP handler by its' ID:
# plesk bin php_handler --list ... plesk-php54-fpm 5.4.45 5.4.45 5.4 fpm /opt/plesk/php/5.4/sbin/php-fpm /opt/plesk/php/5.4/bin/php /opt/plesk/php/5.4/etc/php.ini true enabled plesk-php55-cgi 5.5.38 5.5.38 5.5 cgi /opt/plesk/php/5.5/bin/php-cgi /opt/plesk/php/5.5/bin/php /opt/plesk/php/5.5/etc/php.ini true disabled plesk-php55-fastcgi 5.5.38 5.5.38 5.5 fastcgi /opt/plesk/php/5.5/bin/php-cgi /opt/plesk/php/5.5/bin/php /opt/plesk/php/5.5/etc/php.ini true enabled ... The first column of the command output contains the PHP handler IDs, as stored in Plesk database. To get domain names and corresponding PHP handler ID, execute the following command:
# plesk db ""select d.name,h.php_handler_id from domains d join hosting h on h.dom_id=d.id"" To get the list of the domains using PHP 5.5.38 FastCGI handler (for example), execute the following command:
# plesk db ""SELECT d.name,h.php_handler_id FROM domains d JOIN hosting h on h.dom_id=d.id WHERE php_handler_id='plesk-php55-fastcgi'""
Change the value of php_handler_id in the above command to match the ID from the output of the command in step 2 to search for domains using a different handler. To get the list of domains with PHP version and whether php is served as Apache or nginx:
# plesk db ""select domains.name, dom_id, php, php_handler_id, fastcgi, WebServerSettingsParameters.value as 'Served as nginx?' from hosting JOIN domains on domains.id=hosting.dom_id JOIN WebServerSettingsParameters on WebServerSettingsParameters.webServerSettingsId=(select val from dom_param WHERE param='webServerSettingsId' AND dom_id=domains.id) where WebServerSettingsParameters.name='nginxServePhp' AND domains.status=0"" "
6,"How to connect to MySQL on a Plesk for Linux server using a MySQL admin password in plain text
Applicable to: Plesk for Linux Question How to connect to MySQL on a Linux server using a MySQL admin password in plain text? How to connect to MySQL on a Linux server using database management tools? How to get MySQL admin password in plain text? Answer
For security reasons, MySQL admin password is encrypted and stored in the file /etc/psa/.psa.shadow on a Plesk for Linux server.
To connect to MySQL using MySQL admin password in plain text, use the encrypted string from the file /etc/psa/.psa.shadow: Print the content of /etc/psa/.psa.shadow:
# cat /etc/psa/.psa.shadow$AES-128-CBC$ZmY/EEpy1+TwCNq5kalqSA==$Pd02kf4TTlpXdi/qyeo92w== Use the string from the command above as an admin password when connecting using database management tools (MySQL Workbench, HeidiSQL, etc.).
Note: When connecting to MySQL server using a plain admin password from a Linux shell, be sure to put single quotes on the sides of the password:
# mysql -uadmin -p'$AES-128-CBC$ZmY/EEpy1+TwCNq5kalqSA==$Pd02kf4TTlpXdi/qyeo92w==' Related Articles How to access the Plesk psa database in MySQL
"
5,"[BUG] Migration to Plesk server fails: error 1006: Access to API is disabled Applicable to: Plesk for Linux Plesk for Windows Symptoms Migration to the Plesk server fails with one of the following errors:
PLESK_ERROR: Failed to connect to target Plesk server by Plesk API: Plesk error [1006]: Access to API is disabled. PLESK_ERROR: Error: Looks like the migration could not be started. Please check that the specified IP address and the administrator login and password are correct and try again. Refer to logs for details: download info log, download debug log. Cause
API is disabled in Plesk configuration file panel.ini on the target Plesk server.
This is Plesk Migrator issue with ID #PMT-2702, which is planned to be fixed in future product updates.
Resolution
As a workaround, enable API using the following steps: Log into Plesk UI.
Install ""panel.ini editor"" extension using this guide.
Open Plesk > Extensions > My extensions > panel.ini editor: Using Panel.ini editor extension set option enabled = on under [api] section. If there any other lines under [api] section comment them out :
[api] enabled = on;allowedIPs <--- this line is commented ;ip filter <--- this line is commented Cancel current migration and start a new migration from scratch. Additional information Unable to start migration: Failed to connect to target Plesk server by Plesk API Plesk error 1006 Access to API is disabled
Migration can not be started: Failed to connect to target Plesk server by Plesk API Plesk error 1006 Access to API is disabled
Site import or migration cannot be started: ailed to connect to target Plesk server by Plesk API: Plesk error [1006]: Access to API is disabled for 203.0.113.2 "
6,"How to change a PostgreSQL admin password in Plesk for Linux Applicable to: Plesk for Linux Question
How to change a PostgreSQL admin password in Plesk?
Answer Changing the password via Plesk In Plesk, go to Tools & Settings > Database Servers > PostgreSQL > localhost (or another corresponding hostname) next to PostgreSQL. Specify a new password and click OK. Changing the password via a command-line interface Connect to a Plesk server via SSH. Run the following command to change the password:
# plesk bin database-server --update-server localhost:5432 -type postgresql -passwd '*****' where ***** is a new PostgreSQL admin password. Related Articles How to install and enable PostgreSQL server in Plesk How to enable remote access to PostgreSQL server on a Plesk server "
7,"Plesk upgrade fails on CentOS/RHEL/CloudLinux: cpio: rename failed - Operation not permitted
Applicable to: Plesk for Linux Symptoms Plesk upgrade fails:
PLESK_INFO: ERROR: Exception Up Level Permission denied Error in /tmp/autoinstaller3.log :
PLESK_INFO: error: unpacking of archive failed on file /usr/bin/chage: cpio: rename failed - Operation not permitted SELinux is in enforcing mode:
# getenforce Enforcing The following context is set on the file mentioned in error (it should be ""passwd_exec_t""):
# ls -Z /usr/bin/chage -rwxr-x---. root root unconfined_u:object_r:plesk_t:s0 /usr/bin/chage Cause
Incorrect SELinux context of the file.
Resolution Login to the server over SSH Restore the correct SELinux context:
# restorecon -v -F /usr/bin/chage "
2,"The Plesk Home page shows a blank page or ""500 Internal Server Error"": require_once(): Failed opening required 'modules/firewall/FwConfigurator.php'
Applicable to:
Plesk for Linux
Symptoms The Plesk Home page shows a blank page or ""500 Internal Server Error"". The log file /var/log/plesk/panel.log contains the following message:
CONFIG_TEXT: PHP Fatal error: require_once(): Failed opening required 'modules/firewall/FwConfigurator.php' (include_path='/usr/local/sb/include:/opt/psa/admin/plib:/opt/psa/admin/externals:/usr/local/sb/include:/usr/local/sb/include/PEAR') in /opt/psa/admin/application/admin/controllers/HomeController.php on line 104 `FwConfigurator.php` is a part of Plesk firewall module, but this was not properly installed. Cause
The Plesk Firewall extension is corrupted.
Resolution
Re-install the Plesk Firewall extension: How to install / uninstall Plesk components?"
0,"How to install PHP MongoDB driver for Linux?
Applicable to: Plesk for Linux Question
How to install PHP MongoDB driver for Linux?
Note: Since MongoDB driver is not included in Plesk PHP packages, it could only be installed manually. Create a thread on Plesk UserVoice to vote for including MongoDB driver into Plesk PHP.
Manual extension installation:
Warning: If /tmp is mounted with no-exec option, PECL will be unable to install modules. For more information refer to this article: Error while using pecl install: shtool at /tmp does not exist or is not executable .
Answer Connect to the server using SSH. Install prerequisite build packages:
# yum groupinstall ""Development Tools"" # yum install php-pear php-devel
Note: if gcc and make are not installed the installation will fail. Use the same commands above in order to install gcc and make. Execute the following to install a driver:
# pecl install mongodb Add the following line to your /etc/php.ini file:
CONFIG_TEXT: extension=mongodb.so Check whether the driver is available:
# php -m | grep mongo mongo For Plesk PHP
Note: Steps below describe the installation of PHP developer package for PHP 5.6. To install the driver for other versions of PHP, change the version number accordingly. Install prerequisite build packages:
# yum groupinstall ""Development Tools""
Note: This step should be done on CentOS/RHEL-based distributions only Install Plesk PHP development package:
For CentOS/RHEL-based distributions:
# yum install plesk-php56-devel php-pear php-devel
For Debian/Ubuntu-based distributions:
# apt-get install plesk-php56-dev Execute the following to install a driver:
# /opt/plesk/php/5.6/bin/pecl install mongodb Enable the driver:
# echo ""extension=mongodb.so"" > /opt/plesk/php/5.6/etc/php.d/mongodb.ini Update PHP handlers information:
# plesk bin php_handler --reread Check whether the driver is available:
# /opt/plesk/php/5.6/bin/php -c /opt/plesk/php/5.6/etc/php.ini -m | grep mongo mongo Note: these configurations are not reverted during Plesk update/upgrade.
Additional Information
Official MongoDB web site"
8," How to change the default location of mailboxes in Plesk for Linux
Applicable to: Plesk for Linux Question
By default, Plesk stores all mailboxes in the /var/qmail/mailnames/ directory. How to change this location?
Answer Find what SMTP and IMAP/POP3 servers are in use: Login to Plesk and go to Tools & Settings > Mail Server Settings: Connect to the server using SSH Stop the SMTP service:
# service postfix stop Open the file/etc/psa/psa.conf and change the PLESK_MAILNAMES_D variable: specify a new location for mailbox directory so that it is like:
# grep PLESK_MAILNAMES_D /etc/psa/psa.conf PLESK_MAILNAMES_D <new_mailnames_directory>
Note: To avoid performance degradation, the new location for the mailboxes directory should be located in the local file system - it should not be mounted as a network share, such as NFS. Move mailboxes from the current directory to the new location with the command:
# cp -ap /var/qmail/mailnames/* /new/mailnames/directory/ For Dovecot:
- Create a new custom file to add variables in it:
# touch /etc/dovecot/conf.d/99-custom_dir.conf
- Copy the actual location from the file /etc/dovecot/dovecot.conf:
# egrep -i mail_home\|mail_location /etc/dovecot/dovecot.conf mail_home = /var/qmail/mailnames/%Ld/%Ln mail_location = maildir:/var/qmail/mailnames/%Ld/%Ln/Maildir
- Add those 2 variables in the custom file: /etc/dovecot/conf.d/99-custom_dir.conf. Then change them to the custom location:
# egrep -i mail_home\|mail_location /etc/dovecot/conf.d/99-custom_dir.confmail_home = /new/mailnames/directory/%Ld/%Ln mail_location = maildir:/new/mailnames/directory/%Ld/%Ln/Maildir
- Restart the dovecot service and pc-remote service:
# service dovecot restart # service pc-remote restart
For Courier-IMAP: No need to change configuration, just restart all Courier services:
# service courier-authdaemon restart# service courier-imapd restart# service courier-imaps restart# service courier-pop3d restart# service courier-pop3s restart After all the steps are done, start SMTP service and reconfigure mail settings:
# service postfix start # plesk repair mail -y Set the new home directory for the popuser. In /etc/passwd file change /var/qmail/ to the required one: For Red Hat based OS: From:
CONFIG_TEXT: popuser:x:30:31:POP3 service user:/var/qmail/popuser:/sbin/nologin
To:
CONFIG_TEXT: popuser:x:30:31:POP3 service user:/<new_mailnames_directory>/popuser:/sbin/nologin
For Debian based OS: From:
CONFIG_TEXT: popuser:x:30:31:POP3 service user:/var/qmail/popuser:/bin/false
To:
CONFIG_TEXT: popuser:x:30:31:POP3 service user:/<new_mailnames_directory>/popuser:/bin/false Note: Before creating new mailboxes on new domains it may be required to configure SELinux in the following way:
# chcon -R -t mail_spool_t <new_mailnames_directory>
Related Articles How to change virtual hosts location in Plesk for Linux? How to change default location for temporary backup files on Linux? How to change the location for Plesk backup files on a Linux server? "
2,"[BUG] Plesk is not accessible after upgrade: ""ssl_ciphers"" directive is duplicate
Applicable to: Plesk 12.5 for Linux Symptoms Unable to access Plesk after an upgrade.
Attempt to restart sw-cp-server service results in error:
# service sw-cp-server restart sw-cp-serverd: nginx: [emerg] ""ssl_ciphers"" directive is duplicate in /etc/sw-cp-server/conf.d/ssl.conf:1 sw-cp-serverd: nginx: configuration file /etc/sw-cp-server/config test failed Previously, the article [Plesk] CVE-2015-4000 LOGJAM TLS DH vulnerability has been applied on Plesk installation. Cause
This is a Plesk bug with ID PPPM-3228, which is fixed in Plesk 12.5.30 Update 1: Resolution
Upgrade to the latest Plesk version How to upgrade Plesk to the next release.
If upgrade is not possible, apply the workaround below:
Note: if direct SSH access to the server is not possible, contact server administrator for further assistance. Connect to the server using SSH Remove the file /etc/sw-cp-server/conf.d/ssl.conf and restart the service sw-cp-server :
# rm -f /etc/sw-cp-server/conf.d/ssl.conf # service sw-cp-server restart "
6,"Unable to add Microsoft or Postgre SQL database server: only MySQL is available Applicable to: Plesk for Windows Symptoms The Microsoft or Postgre SQL database server is not available in the Database server type drop-down menu in Tools & Settings > Database Servers > Add Database Server. The Microsoft or Postgre SQL Server support has the Off value in Tools & Settings > License Management. The Microsoft or Postgre SQL Server is shown as ""not running"" without the option to run it in Tools & Settings > Services Management The Microsoft or Postgre SQL Server is shows as Installed in Tools & Settings > Updates > Add/Remove Component Cannot install PostgreSQL via CLI:
# plesk bin database-server --create-server localhost:5432 -type postgresql -admin admin -passwd 'password' To use Postgresql server, you need the support for it in your license key. Please consult your Plesk sales representative. Cause
The support of the database server is not included in the Plesk license.
Resolution
Both Microsoft SQL and PostgreSQL options are available as part of the following feature packs: Developer Pack Power Pack Hosting Pack Thus, one of these feature packs should be purchased to support options to the license.
Plesk Web Pro and Plesk Web Host editions include the Developer Pack by default and allows using these database servers.
Web Admin Edition does not provide Developer Pack by default, so Microsoft and Postgre SQL are not available for this type of the license.
After the feature is available in the license, use this documentation article to add support of required database server."
8,"Blacklisting for spam protection does not work Applicable to: Plesk for Linux Plesk for Windows Symptoms
The system does not block mail from IP’s listed at DNSBL providers configured in Tools & Settings > Mail Server Settings > DNS zones for DNSBL service, for example, zen.spamhaus.org.
Cause
Some public DNS providers implement non-hijacked responses for known DNSBL zones like Spamhaus.
Resolution
Check what DNS resolvers you are using: If free DNS servers like Google Public DNS are used, in most cases you will receive a not listed (NXDOMAIN) reply from Spamhaus’ public DNSBL servers. Use your own DNS servers when doing DNSBL queries to Spamhaus.
Reference: spamhaus FAQ
In other words, commonly used public resolvers such as Google’s 8.8.8.8 / 8.8.4.4 and 4.2.2.1 – 4.2.2.6 would not work with Spamhaus.
Proper DNS response:
# dig +short TXT 2.0.0.127.zen.spamhaus.org""http://www.spamhaus.org/sbl/query/SBL233""""http://www.spamhaus.org/query/bl?ip=127.0.0.2""
As a workaround, you can specify other DNS servers. For example, OpenDNS Home :
CONFIG_TEXT: 208.67.222.222 208.67.220.220"
5,"[BUG] Full backups are not sent to FTP repository: The backup process failed: Not enough free disk space to backup selected objects.
Applicable to: Plesk 11.x for Linux
Plesk 12.0 for Linux
Plesk 12.0 for Windows
Plesk 12.5 for Linux
Plesk Onyx for Linux Symptoms When trying to back up Plesk to an external FTP repository, the process fails with the following error:
PLESK_ERROR: Error: The backup process failed: Not enough free disk space to backup selected objects. At least #### Mbytes free disk space is required.
Or
PLESK_ERROR: Error: The dump have been made successfully but can not be imported to FTP due to errors.The dump 'backup_info_1310131347.xml' has been left at repository. Please export it manually The backup session logs may contain following errors:
# grep 'No space left' /usr/local/psa/PMM/sessions/2013-10-26-070603.687/stderr DEBUG Runtime error: Unable to write to output file: No space left on device at /usr/local/psa/PMM/agents/shared/Storage/Splitter.pm line 84.
or
# grep 'No space left' /usr/local/psa/PMM/logs/backup-2017-12-28-19-56-02-012/backup.log /bin/tar: /usr/local/psa/PMM/tmp/backupVMSrvt/server_1712281956.tar: Cannot write: No space left on device The following error may also occur:
# less /usr/local/psa/PMM/sessions/2013-10-26-070603.687/psadump.log [18153]: 13:22:35 DEBUG Failed to pack files rsnxtest_info_1403241212.xml in /usr/local/psa/PMM/tmp/backupFrXE1T [ 174715392 bytes free of 375809638400 bytes total on mount point 0] [18153]: 13:22:35 ERROR b8e53bdd-b5e9-4db3-8b08-91a34d007663 Failed to pack files rsnxtest_info_1403241212.xml in /usr/local/psa/PMM/tmp/backupFrXE1T [ 174715392 bytes free of 375809638400 bytes total on mount point 0] [18153]: 13:22:35 DEBUG Runtime error: Cannot export files Cause
This is considered to be correct behavior. Feature request PPP-111 (Streaming upload to FTP) has been created and it is fixed in Plesk Onyx.
There is insufficient free space or free inodes on the partition where the /usr/local/psa/PMM/tmp/ directory is located. Before uploading backup files to a remote FTP repository, Plesk creates an archived copy of the backup files in /usr/local/psa/PMM/tmp/ (in /var/lib/psa/dumps/ for Plesk 12.5). It then uploads them from this directory to the remote FTP-server.
Resolution
Perform the upgrade to Plesk Onyx.
Or
Connect to the server via SSH and free up some space on the partition where the /usr/local/psa/PMM/tmp/ directory is located:
# df -h /usr/local/psa/PMM/tmp/ Filesystem Size Used Avail Use% Mounted on /dev/mapper/vg00-usr 4.0G 1.5G 1.1G 39% /usr # df -ih Filesystem Inodes IUsed IFree IUse% Mounted on /dev/mapper/vg00-usr 1.3M 1.3M 0 100% /usr
For example, if a full server backup takes 10GB (as listed in Plesk Backup Manager), then there should be at least 10GB free on the partition where /usr/local/psa/PMM/tmp/ ( /var/lib/psa/dumps/ for Plesk 12.5) is located.
Note: it may be enough free space, but it is possible that not enough free inodes."
3,"Website or webmail shows 500 internal server error on Plesk: mod_fcgid: read data timeout
Applicable to: Plesk for Linux Symptoms A website or webmail page is not loading and ""500 internal server error"" is shown after ~30-60 seconds. The following errors can be found in Domains > example.com > Logs:
CONFIG_TEXT: [warn] mod_fcgid: read data timeout in 45 seconds [error] Premature end of script headers [core:error] End of script output before headers The following error can be found in /var/log/apache2/error.log:
CONFIG_TEXT: [warn] mod_fcgid: process XXX graceful kill fail, sending SIGKILL Cause
The FcgidIOTimeout value - the maximum period of time the module will wait while trying to read from or write to a FastCGI application - has been exceeded.
Resolution
Increase the parameter value or optimize FastCGI application. Domain-wide solution (click to expand) Domain-wide solution. FcgidIOTimeout parameter for a domain is set to the same value as max_execution_time PHP parameter. Log into Plesk UI.
Increase max_execution_time (e.g. to 300) in Domains > example.com > PHP settings Add the following to Domains > example.com > Apache & Nginx settings > Additional directives for HTTP and Additional directives for HTTPS:
CONFIG_TEXT: <IfModule mod_fcgid.c> FcgidIOTimeout 300 </IfModule> If it does not help, increase the parameter to higher value. Optionally, switch the domain to FPM handler at Domains > example.com > PHP Settings. Server-wide solution (click to expand) Server-wide solution: Connect to the server using SSH.
Open the /etc/apache2/mods-enabled/fcgid.conffile (on Debian/Ubuntu) or the /etc/httpd/conf.d/fcgid.conf file (on RedHat/CentOS/CloudLinux), edit it with text editor and increase ""FcgidIdleTimeout"" and ""FcgidProcessLifeTime"" parameters to ""300"" or more:
FcgidIdleTimeout 300 FcgidProcessLifeTime 300 Reload Apache service configuration:
On RedHat/CentOS/CloudLinux systems:
# service httpd reload
On Debian/Ubuntu systems:
# service apache2 reload If it does not help, increase the value of both parameters to higher values and reload Apache service configuration. "
8,"How to enable debug logging for Horde webmail on Plesk server
Applicable to: Plesk for Linux
Plesk for Windows Symptoms
How to enable debug logging for Horde webmail on a Plesk server?
Resolution For Horde 5 and above Connect to the server using SSH or RDP. Open Horde configuration file in a text editor: Linux: /etc/psa-webmail/horde/horde/conf.php Windows: %plesk_dir%\webmail\horde\horde\config\conf.php Change the value of the parameter $conf['log']['priority'] to DEBUG:
CONFIG_TEXT: $conf['log']['priority'] = 'DEBUG'; For previous Horde versions Connect to the server using SSH or RDP. Open Horde configuration file in a text editor: Linux: /etc/psa-webmail/horde/horde/conf.php Windows: %plesk_dir%\webmail\horde\horde\config\conf.php Change the value of the parameter $conf['log']['priority'] to PEAR_LOG_DEBUG:
CONFIG_TEXT: $conf['log']['priority'] = PEAR_LOG_DEBUG; Warning: Do not forget to revert the changes once the monitoring is completed."
3,"Unable to start apache: Syntax error was not closed
Applicable to: Plesk for Linux Symptoms
Apache cannot start with following errors:
# service httpd start Starting httpd: httpd: Syntax error on line 223 of /etc/httpd/conf/httpd.conf: Syntax error on line 9 of /etc/httpd/conf.d/zz010_psa_httpd.conf: Syntax error on line 136 of /etc/httpd/conf/plesk.conf.d/vhosts/example.com.conf: /etc/httpd/conf/plesk.conf.d/vhosts/example.com.conf:216: <Directory> was not closed. /etc/httpd/conf/plesk.conf.d/vhosts/example.com.conf:136: was not closed. [FAILED] # service httpd start Redirecting to /bin/systemctl start httpd.service Job for httpd.service failed because the control process exited with error code. See ""systemctl status httpd.service"" and ""journalctl -xe"" for details. # journalctl -u httpd httpd[5005]: AH00526: Syntax error on line 136 of /etc/httpd/conf/plesk.conf.d/vhosts/example.com.conf: httpd[5005]: <Directory> directive missing closing '>' # httpd -t AH00526: Syntax error on line 136 of /etc/httpd/conf/plesk.conf.d/vhosts/example.com.conf: <Directory> directive missing closing '>'
Cause
Domain configuration file has wrong syntax due to corruption or it was manually edited.
Resolution
Connect to the server using SSH and apply one of the following solutions:
I. Automatic configuration repair:
Execute the following command to rebuild configuration file for a domain mentioned in the error:
# plesk repair web example.com II. Manual config editing: Try to find and fix a tag not closed with symbol "">"" (grater then) in the file and line from the error.
For example, the line below has a missing closing symbol "">"" in the end of the line:
Before:
CONFIG_TEXT: <Directory /var/www/vhosts/example.com/httpdocs
After:
CONFIG_TEXT: <Directory /var/www/vhosts/example.com/httpdocs> "
2,"Unable to log in to Plesk: unknown user name or bad password
Applicable to: Plesk for Windows Symptoms When logging in to Plesk one of the following errors appears in a browser:
PLESK_INFO: ERROR: Exception Unable to logon user (Plesk Administrator): (1326) The user name or password is incorrect.
OR
PLESK_INFO: ERROR: Exception: Unable check file existence: Unable to lookup SID for name Plesk Administrator: (1332) No mapping between account names and security IDs was done.<br> at Plesk impersonation(PipeServer::ServerThread::impersonateWithoutProfile line 786)<br> at (zif_plesk_internal_file_exists line 1507)
OR
PLESK_INFO: ERROR: Exception: Unable to get administrator password: The system cannot find the file specified. (Error code 2) at Unable to connect to pipe \\.\pipe\P_4755d610-937d-498b-a70f-6ee61941f472 at (Con::ClientOverlappedPipe::create line 503) at getPassword('pwd')(PleskSrvClient::getInstance line 334) at (zif_get_admin_password line 260)
OR
PLESK_INFO: ERROR: Exception: Unable to get administrator password: Access is denied. (Error code 5) at Unable to connect to pipe \\.\pipe\P_964acf24-9bd8-4b94-89f7-2c5dc566f924 at (Con::ClientOverlappedPipe::create line 503) at getPassword('pwd')(PleskSrvClient::getPassword line 208) at (zif_get_admin_password line 260) Additionally, an exception has occurred while trying to report this error: Zend_Exception No entry is registered for key 'translate' (Helper.php:68)
OR
PLESK_INFO: ERROR: Uncaught exception 'Exception' with message 'Unable to execute proc_open: The system can not find the file specified. (Error code 2) at Unable to connect to pipe \\\\.\\pipe\\I_3ed9f1e1-4e0e-4d46-a245-8b166434ae88 at (Con::ClientOverlappedPipe::create line 503) at (zif_plesk_proc_open line 1097)' in C:\\Program Files (x86)\\Parallels\\Plesk\\admin\\plib\\common_func.php3:363 Stack trace: #0 C:\\Program Files (x86)\\Parallels\\Plesk\\admin\\plib\\common_func.php3(363): plesk_proc_open('""C:\\\\Program Fil...', Array, NULL, Array) #1 C:\\Program Files (x86)\\Parallels\\Plesk\\admin\\plib\\common_func.php3(173): proc_open_exec('""C:\\\\Program Fil...', Array) #2 C:\\Program Files (x86)\\Parallels\\Plesk\\admin\\plib\\common_func.php3(95): util_exec('send-error-repo...', Array, Array, 'proc_open', 'C:\\\\Program File...') #3 C:\\Program Files (x86)\\Parallels\\Plesk\\admin\\plib\\Os.php(91): smart_exec('send-error-repo...', Array, 'proc_open') #4 C:\\Program Files (x86)\\Parallels\\Plesk\\admin\\plib\\CommonPanel\\Exception.php(322): Os:: (common_func.php3:363)
OR
PLESK_INFO: Unable check file existence: Unable to logon user (SERVER_NAME\Plesk Administrator): (1326) The user name or password is incorrect. at LogonUser(SERVER_NAME\Plesk Administrator)(CClientProfile::logon line 126) at Plesk impersonation(PipeServer::ServerThread::impersonateWithoutProfile line 761) at (zif_plesk_internal_file_exists line 1503) (functions.php:1783)
OR
PLESK_INFO: ERROR: Exception: Unable to get administrator password: Unexpected end of data when read from serializer.<br> at getPassword('pwd')(PleskSrvClient::getPassword line 218)<br> at (zif_get_admin_password line 261) Additionally, an exception has occurred while trying to report this error: Zend_Exception No entry is registered for key 'translate' (Helper.php:68) The following error can be found in the Event Viewer:
PLESK_INFO: Unhandled exception Execute file name: C:\\Program Files (x86)\\Parallels\\Plesk\\admin\\bin\\plesksrv.exe Unable to thread impersonate run without profile: Unable to logon user (\\Plesk Administrator): (1326) Logon failure: unknown user name or bad password. Execute file name: C:\\Program Files (x86)\\Parallels\\Plesk\\admin\\bin\\plesksrv.exe
OR
PLESK_INFO: Unable to change the user (Plesk Administrator) password: (2221) Could not find the username. at serviceMainFunc(plesksrv::serviceMain line 280) When trying to start Plesk Management Service in Plesk Services Monitor, one of the following errors appears:
PLESK_INFO: The process terminated unexpectedly. (Error code 1067) at Start service plesksrv at (service::startStopService line 994)
OR
PLESK_INFO: System error 1067 has occurred The process terminated unexpectedly.
OR
PLESK_INFO: Windows Could not start Plesk Management Service on Local Computer. Error 1067: The process terminated unexpectedly.
OR
PLESK_INFO: Windows could not start the Plesk Management Seervice service on Local Computer. Error 2: The system cannot find the file specified. When trying to repair Plesk with Plesk Reconfigurator, the following error message is shown:
PLESK_INFO: Unable to execute ""C:\Program Files (x86)\Plesk\admin\bin\usermng.exe"" --install-plesk-admin: Change flags failed of user (Plesk Administrator): (1322) This operation is disallowed as it could result in an administration account being disabled, deleted or unable to logon. at execute console command --install-plesk-admin(vconsoleapp::start line 122) at execute ""C:\Program Files (x86)\Plesk\admin\bin\usermng.exe"" --install-plesk-admin(vconsoleapp::run line 139) Cannot start service plesksrv. System error is: Time out has expired and the operation has not been completed. Cannot start service PopPassD. System error is: Cannot start service plesksrv. System error is: Time out has expired and the operation has not been completed. Unable to execute ""C:\Program Files (x86)\Plesk\admin\bin\websrvmng.exe"" --configure-plesk-website: The system cannot find the file specified. (Error code 2) at Unable to connect to pipe \\.\pipe\P_6f2c920a-1db3-4b7d-8baf-d029b037caca at (Con::ClientOverlappedPipe::create line 503) at get shared instance of PleskSrvClient(PleskSrvClient::getInstance line 334) at execute console command --configure-plesk-website(vconsoleapp::start line 122) at execute ""C:\Program Files (x86)\Plesk\admin\bin64\websrvmng.exe"" --configure-plesk-website(vconsoleapp::run line 139) Cause
The ""psaadm"" and/or ""Plesk Administrator"" users are missing on the server or lacking the necessary permissions.
Resolution Connect to a Plesk server via RDP. Run Plesk installer to verify installation:
C:\> plesk installer update Repair Plesk installation:
2.1. Start Plesk Reconfigurator at Windows Start > All Programs > Plesk or run the command below in a command prompt:
C:\> ""%plesk_bin%""\reconfigurator.exe
2.2. In Plesk Reconfigurator, click Repair Plesk installation.
2.3. Select the following: Plesk Server Accounts
Plesk file security
Plesk Services 2.4. Click Check. Correct permissions by running the following checks one-by-one in Plesk Reconfigurator: Correct disk permissions Check Component and Folder Permissions (Note: Select all components from the list) Restart the Plesk Management Service and Plesk SQL Server services:
4.1. Start Plesk Services Monitor at Windows Start > All Programs > Plesk.
4.2. In Plesk Services Monitor, check Plesk Management Service and Plesk SQL Server.
4.3. Click Restart. Access Plesk.
If Plesk is not accessible with the error below, refer to this KB article for a solution
PLESK_INFO: Access denied for user 'admin'@'localhost' (using password: YES) "
0,"Unable to activate or remove Fail2ban in Plesk: error reading information on service fail2ban: No such file or directory
Applicable to: Plesk for Linux Symptoms Modifying fail2ban settings in Tools & Settings > IP Address Banning (Fail2Ban) fails with an error:
PLESK_ERROR: ERROR:f2bmng:No section: 'Definition' PLESK_ERROR: Error: f2bmng failed: error reading information on service fail2ban: No such file or directory ERROR:f2bmng:Command '['/sbin/chkconfig', '--add', 'fail2ban']' returned non-zero exit status 1 PLESK_ERROR: Error: Unable to save the settings: f2bmng failed: Service fail2ban doesn't exist Usage: register_service {--enable service [options] | --disable service | --list | --full-list} Enables or disables the specified service. --enable enable the specified service --disable disable the specified service --list show list of services --full-list show list of services with status enable options: --with-resource-controller register the service in Plesk Resource Controller --no-watchdog don't monitor by watchdog ERROR:main:Command '['/usr/local/psa/admin/sbin/register_service', '--enable', 'fail2ban']' returned non-zero exit status 1. On Red Hat -based operating system (RHEL, CentOS, CloudLinux) fail2ban cannot be completely removed from Tools & Settings > Updates and Upgrades:
PLESK_INFO: Error in PREUN scriptlet in rpm package 1:fail2ban-0.9.6-centos7.17122713.noarch Exception: Scriptlet or other non-fatal errors occurred during transaction. Erasing: plesk-fail2ban-configurator [1/2] Failed to stop fail2ban.service: Unit fail2ban.service not loaded. Failed to execute operation: No such file or directory error: %preun(fail2ban-1:0.9.6-centos7.17122713.noarch) scriptlet failed, exit status 1 PLESK_INFO: Error in PREUN scriptlet in rpm package fail2ban fail2ban-0.8.13-14052018.noarch was supposed to be removed but is not! Exception: Scriptlet or other non-fatal errors occurred during transaction. Erasing: plesk-fail2ban-configurator [1/2] fail2ban: unrecognized service error reading information on service fail2ban: No such file or directory error: %preun(fail2ban-0.8.13-14052018.noarch) scriptlet failed, exit status 1 Cause
Corrupted Fail2ban installation.
Resolution Connect to the server via SSH; Create a backup of Fail2ban configuration and log:
# mkdir /fail2ban_backup && mv /etc/fail2ban /fail2ban_backup && mv /var/log/fail2ban.log /fail2ban_backup Remove fail2ban-related packages: For Red Hat -based operating systems (RHEL, CentOS, CloudLinux):
# rpm -e --nopreun fail2ban # rpm -e --nopreun plesk-fail2ban-configurator For Debian-based operating systems (Debian, Ubuntu):
# plesk installer --select-release-current --remove-component fail2ban Install fail2ban back using Plesk installer:
# plesk installer --select-release-current --install-component fail2ban "
9,"Unable to create a new domain/subdomain or migrate/rename an existing domain/subdomain: DNS record already exists Applicable to: Plesk for Linux
Plesk for Windows Symptoms When creating a new domain/subdomain/alias, migrating an existing domain/subdomain or activating the mail service for a domain, the operation fails with one of the following errors:
PLESK_ERROR: DNS records for domain with such name already exist PLESK_ERROR: The subdomain with such name already exists PLESK_ERROR: This DNS record already exists. PLESK_ERROR: Unable to create the subdomain test.example.com. because a DNS record pointing to the host test.example.com. already exists. PLESK_ERROR: Unable to set up the domain alias example.net because a DNS record pointing to the host example.net already exists. PLESK_ERROR: An error occurred during domain creation: DNS records for a domain with such a name already exist. PLESK_ERROR: Plesk API call failed example.com: [Error 1007] DNS records for a domain with such a name already exist. On attempt to apply the changes to DNS template at Tools & Settings > DNS Template > Apply DNS Template Changes, the operation fails with the following error message:
PLESK_WARN: There were issues syncing DNS zones with the DNS zone template. Unable to resolve dns zone owner The following error message appears in /var/log/plesk/panel.log:
CONFIG_TEXT: ERR [panel] Unable to synchronize DNS zone [6] example.com: Unable to resolve dns zone owner Cause
Orphaned DNS records exist in the Plesk database.
Resolution For Plesk on Linux Connect to the Plesk server via SSH. Create a database dump of the Plesk database (for more information, see this KB article):
# plesk db dump psa > /root/psa_backup.sql Access the Plesk database:
# plesk db Find dns_zone_id of the domain, which cannot be created, using the following command. Replace example.com with an actual domain name:
MYSQL_LIN: mysql> select dns_zone_id,host from dns_recs where host like ""%example.com%""; +-------------+---------------------+ | dns_zone_id | host | +-------------+---------------------+ | 3 | www.example.com. | | 3 | example.com. | | 3 | ns2.example.com. | | 3 | ns1.example.com. | | 3 | example.com. | | 3 | ftp.example.com. | | 3 | example.com. | | 3 | example.com. | | 3 | _dmarc.example.com. | | 3 | example.com. | | 3 | mail.example.com. | | 3 | ipv4.example.com. | +-------------+---------------------+ Using dns_zone_id from the output above, make sure that the domain name is the same:
Note: In some cases the output may be empty.
MYSQL_LIN: mysql> select id,name from dns_zone where id=3; +----+-------------+ | id | name | +----+-------------+ | 3 | example.com | +----+-------------+ Delete records from corresponding tables using the ID from the steps above. In case all zones for all domains need to be removed the where id=x can be omitted:
MYSQL_LIN: mysql> delete from dns_zone where id=3; mysql> delete from dns_recs where dns_zone_id=3; mysql> delete from dns_refs where zoneId=3; Exit MySQL:
MYSQL_LIN: mysql> exit Create the domain/subdomain/alias in Plesk / Rerun the migration. For Plesk on Windows Connect to the Plesk server via RDP. Start a command prompt as an Administrator. Create a database dump of the Plesk database (for more information, see this KB article):
C:\> plesk db dump psa > C:\psa_backup.sql Access the Plesk database:
C:\> plesk db Run these commands to remove orphaned records:
MYSQL_WIN: delete from dns_recs where dns_zone_id in (select id from dns_zone where id not in (select dns_zone_id from domains) and id not in (select dns_zone_id from domain_aliases));
MYSQL_WIN: delete from dns_zone where id not in (select dns_zone_id from domains) and id not in (select dns_zone_id from domain_aliases); Exit MySQL:
MYSQL_WIN: mysql> exit Create the domain/subdomain/alias in Plesk / Rerun the migration. "
2,"How to manage permission of changing PHP handler and PHP version for Plesk users?
Applicable to: Plesk 12.5 for Linux Question
How to forbid or allow changing PHP handler and PHP version for Plesk users?
Answer To manage permissions for all subscriptions of the Service Plan To allow changing: Login to Plesk Go to Service Plans > [Service plan name] > Permissions tab Enable ""PHP version and handler management"" option: Click Update & Sync to apply new permissions to all subscriptions bound to this service plan. To forbid changing the PHP handler and PHP version, disable the corresponding permission to the Service plan and sync all subscriptions: To manage permission for one particular subscription To allow changing: Login to Plesk Go to Subscriptions > example.com and press Customize link on the right-side panel Switch to Permissions tab and enable ""PHP version and handler management"" option: Click OK. To forbid changing the PHP handler and PHP version, disable the corresponding permission to the Service plan and sync all subscriptions. "
0,"How to send a Plesk technical report and get its ID Applicable to: Plesk for Linux
Plesk for Windows Question
How to send a Plesk technical report and get its ID?
Answer
A Plesk technical report can be sent either via Plesk or a command-line interface directly from the server.
Note: A Plesk technical report contains only technical information. No private data is included. Sending a technical report via the Plesk interface Go to Tools & Settings > Support > select Generate a technical report before contacting support > click Next. In the next window, click Send Report. Get your report ID. Sending a technical report via a command-line interface Connect to a Plesk server via SSH/RDP. Run the command below to generate and send a technical report (on Windows Server, start a command prompt as an Administrator):
MYSQL_LIN: plesk bin report --send When the command execution is completed, get your report ID:
MYSQL_LIN: Your report ID: TR-PLSK-35583 Contact Plesk support and provide this ID to get help Additional Information Administrator's Guide: Plesk Technical Reports
"
2,"Scheduled Tasks link is not shown when logging as a customer/reseller
Applicable to: Plesk for Linux
Plesk for Windows Symptoms Scheduled Tasks link is not shown when logging as a customer/reseller: When login as a customer/reseller not all domains are shown in Websites & Domains > Scheduled Tasks > Add Task > Web Space. Cause
Scheduled tasks management option is not enabled for subscription.
Resolution
Enable Scheduler management: For a service plan and all subscriptions under it: Log into Plesk. Open Service Plans > service plan name > Permissions tab > select Scheduler management checkbox and apply changes by clicking to Update & Sync button: Note: Depending on number of subscriptions under this service plan, synchronization may take some time. For a reseller: Log into Plesk. Open Service Plans > Reseller Plans tab > service plan name > Permissions tab > select Scheduler management checkbox and apply changes by clicking to Update & Sync button: Note: Depending on number of subscriptions under this service plan, synchronization may take some time. For one subscription from Plesk UI: Create Add-on plan in Service Plans > Add an Add-on Open Permissions tab and select Scheduler management option > OK. Assign Add-on plan to subscription in Subscriptions > example.com > Change plan/add-ons: OR
Open Subscriptions > example.com > Customize > Permissions > check Scheduler management box and apply changes by clicking to Update & Lock button.
Note: In this case subscription be locked for synchronization with service plan. For one subscription from the command-line: Connect to the server via SSH or via RDP. Run the command below:
# plesk bin subscription_settings --update example.com -manage_crontab true "
7,"Plesk Onyx Release Tiers Applicable to: Plesk Onyx for Linux Plesk Onyx for Windows Information
In Onyx, Plesk continues to support “Release Tiers” – a systematic way for customers and hosts to select the visibility of Plesk upgrades, along with automatic settings for upgrades.
Release Tiers can be selected on the Tools & Settings > Update and Upgrade Settings screen in the Plesk interface.
Plesk versions prior to Obsidian come in a variety of tiers that become available over time, one after another. Each tier comes with its own advantages and peculiarities, detailed below. Read the descriptions to understand which tier works best for you. Testing release. Before the official release of the upcoming Plesk version, public previews of this version start becoming available. The previews are usually released on a monthly basis and include the new features developed up to the moment of the latest preview release.
Choose this tier to test the new features of the upcoming Plesk release. Be prepared to encounter bugs. Some features may be incomplete, missing, or they may not operate properly. Using this tier in production is not recommended. Also, Plesk Support does not assist in issues with these versions. Early adopter release. The RTM (Release to manufacturing) date for the latest Plesk release coincides with the early adopter release becoming public. This tier is fully functional, contains all features included in the latest Plesk release, and has been extensively tested and certified by the Plesk QA team. However, hiccups are possible.
Choose this tier if you are willing to sacrifice some stability to get the newest Plesk features and be among the first to offer these features to your customers. We do not recommend upgrading production servers to this tier without testing the upgrade in staging first. General release (recommended). The availability of this tier is linked to the GA (General Availability) date for the latest Plesk release. This tier is fully functional, contains all features included in the latest Plesk release, and comes with a number of updates released after RTM that include bugfixes, as well as stability improvements and security patches.
Choose this tier if you favor a balanced approach. You will get the newest features sooner than the late adopters and will enjoy greater stability than the early adopters. Late adopter release (Stable). By the time this tier becomes available, the latest Plesk version has been out long enough to have most of its issues discovered and fixed. You can be certain that the Plesk version you are about to install has already been used in production environments for some time, and there are no major issues that could compromise the stability of your Plesk servers.
Choose this tier if you prefer stability over new features, and you are willing to delay going to market with the latest Plesk features and improvements to get a rock-solid stable performance. After Late Adopter tier is released, version-free Plesk for Linux Virtuozzo containers templates (i.e., templates with names like pp or pp-webmail ) are switched to the new release. This has the following consequences: If Plesk is installed in a container using the version-free template pp , running vzpkg update <CTID> on the container will cause Plesk to upgrade to the new version.
Installing a version-free template on a container with an existing installation of Plesk will cause Plesk to upgrade. All new containers to which a version-free template is installed will have the latest version of Plesk installed.
Support for VZ templates for Windows was dropped in Plesk Onyx due to extremely low demand in Plesk 12.5
We recognize that some partners and customers are very cautious about upgrading, so we created a Late Adopter release tier that indicates a level of stability that a very cautious host or customer might prefer. Additional information
In Plesk Obsidian, the update strategy was changed, as described here."
8,"Unable to open the Mail section in Horde webmail: No input file specified Applicable to: Plesk for Linux Symptoms When trying to access the Mail section or send an email in Horde webmail, the following error message is shown:
PLESK_INFO: Error when communicating with the server There are no errors in /var/log/maillog and /var/log/psa-horde/psa-horde.log. When loading the Mail page in Horde with a browser console opened (Ctrl+Shift+J in Firefox and Chrome), the following error is shown:
PLESK_INFO: No input file specified Cause
Horde webmail misconfiguration.
Resolution Connect to a Plesk server via SSH. Check if open_basedir is set in the files /etc/psa-webmail/horde/horde/php.ini. If it does, remove this directive.
# grep open_basedir /etc/psa-webmail/horde/horde/php.ini Make sure that cgi.fix_pathinfo is set to 1 in the file /etc/psa-webmail/horde/horde/php.ini. If this option is not set, add it under the [PHP] section:
# grep cgi.fix_pathinfo /etc/psa-webmail/horde/horde/php.inicgi.fix_pathinfo=1 "
5,"How to enable debug mode for Plesk backup operations
Applicable to: Plesk Onyx for Linux
Plesk Onyx for Windows Question
Logging of Plesk backup procedure is not detailed enough. How to increase its verbosity?
Answer
In order to enable backup debug logging for Plesk Backup Manager, enable Plesk debug mode.
Use the information below for enabling extended debug mode for backup operations: For backup tasks that are performed in Plesk Backup Manager
Nothing needs to be done. Logs are collected with the debug switch by default. For scheduled backup tasks
To increase verbosity for scheduled backups, enable the verbose_scheduled_backup_logs parameter in Plesk database using the command below: To enable debug run:
# plesk db ""REPLACE INTO misc (param,val) VALUES ('verbose_scheduled_backup_logs', 'true')""
Warning: It is strongly recommended to disable verbosity once the troubleshooting is finished. Otherwise, the server might quickly run out of free disk space, which will in turn lead to data loss and service downtime. Server performance will be affected as well. To turn debug off, run:
# plesk db ""DELETE FROM misc WHERE param='verbose_scheduled_backup_logs'"" For the 'pleskbackup' command-line utility
Add one or more verbose -v options to the backup command.
For example, the below commands will back up the whole server with maximum verbosity in logs and output in a command-line interface: on Linux:
# /usr/local/psa/bin/pleskbackup server -vvvvv on Windows Server, multiple verbose options cannot be joined and has to be specified separately:
C:\> ""%plesk_cli%\pleskbackup"" --server -v -v -v -v -v Additional debug logging for pmmcli-rc utility
In addition to debug mode mentioned above, enable debug mode: Open the pmmcli-rc file in a text editor: on Linux:
MYSQL_LIN: /usr/local/psa/admin/share/pmmcli/pmmcli-rc on Windows Server:
C:\> C:\Program Files (x86)\Plesk\admin\share\pmmcli\pmmcli-rc Change the value of the FORCE_DEBUG_LOG parameter from 0 to 1:
CONFIG_TEXT: FORCE_DEBUG_LOG 1 Save the changes and close the file.
Note: Do not forget to revert the changes back after troubleshooting. Related Articles How to enable / disable Plesk debug mode
How to enable debug mode for Plesk back-end utilities on Windows
How to enable debug mode for Plesk Installer
"
2,"Cannot open domain hosting settings in Plesk: Unable to load object of type SysUser with id
Applicable to: Plesk for Linux
Plesk for Windows Symptoms
Unable to open Subscriptions > example.com or Domains > example.com > Websites & Domains:
PLESK_INFO: Internal error: Unable to load object of type SysUser with id=370:SysUser: unable to select: no such row in the table
Cause
Database inconsistency.
Resolution
Warning: Create backup of the Plesk database before making any updates. Log in to the server via SSH/RDP. Check for missing records in PSA database dumps and restore them:
For Linux:
/var/lib/psa/dumps/mysql.daily.dump.N.gz
For Windows:
%plesk_dir%MySQL\Backup\psa-date.sql If needed records were not found in dumps, the below solution can be applied. Find the domain's sys_user login and system parameters.
For Linux:
Use the domain name (example.com) to search in the /etc/passwd file:
# grep 'example.com' /etc/passwdexample:x:10007:503::/var/www/vhosts/example.com:/bin/false
Note: in case such record is missing, execute the following command:# plesk sbin usermng --add-user --user=example --homedir=""/var/www/vhosts/example.com"" --shell=""/bin/false
For Windows:
Refer to the Security tab of the %plesk_vhosts%example.com folder to get the system user name. Create a new record in the account table for this user:
a. Log in to Plesk database:
# plesk db
b. Run the following queries:
MYSQL_LIN: mysql> select @id:= (select MAX(id) + 1 FROM accounts);+------------------------------------------+ | @id:= (select MAX(id) + 1 FROM accounts) | +------------------------------------------+ | 15 | +------------------------------------------+ mysql> insert into accounts values (@id,""plain"",""password""); Insert data into the psa.sys_users table using the following values: id - User ID. Use the ID from the error (370 in our example). serviceNodeId - Always equal to ""1"". login - System user login, the first substring from the output in step 1: ""example"" mapped_to - Always equal to ""NULL"". home - System user home directory. Use the output from step 1: ""/var/www/vhosts/example.com"" shell - System shell available for user. Use the output from step 1: ""/bin/false"" quota - Set equal to ""0"" So the final command will be:
MYSQL_LIN: mysql> insert into sys_users (id,serviceNodeId,login,account_id,mapped_to,home,shell,quota) values (370,1,'example',@id,'','/var/www/vhosts/example.com','/bin/false',0); Change the system user password under the Domains > Web Hosting Access tab to sync passwords between the database and operating system. Additional info
Unable to create website configuration with the error: Unable to load object of type SysUser with id"
3,"Domain reconfiguration fails when custom templates are in use: Class 'Template_Writer_Apache' not found in /opt/psa/admin/conf/templates/custom/server.php
Applicable to: Plesk for Linux Symptoms Domain reconfiguration fails with one of the following errors:
# /usr/local/psa/admin/sbin/httpdmng --reconfigure-allExecution failed.Command: httpdmngArguments: Array( [0] => --reconfigure-server [1] => -no-restart)Details: PHP Fatal error: Class 'Template_Writer_Apache' not found in /opt/psa/admin/plib/Template/Processor.php(19) : eval()'d code on line 4Releasing semaphore 4 in request cleanup
OR
# /usr/local/psa/admin/sbin/httpdmng --reconfigure-domain example.comERR [util_exec] proc_close() failed ['/opt/psa/admin/bin/apache-config' '-t'] with exit code [1]Error occured while sending feedback. HTTP code returned: 502ERR [panel] Apache config (15057218280.63527300) generation failed: Template_Exception: AH00526: Syntax error on line 96 of /etc/apache2/plesk.conf.d/vhosts/example.com.conf:php_admin_value takes two arguments, PHP Value Modifier (Admin)file: /opt/psa/admin/plib/Template/Writer/Webserver/Abstract.phpline: 75code: 0Error occured while sending feedback. HTTP code returned: 502AH00526: Syntax error on line 96 of /etc/apache2/plesk.conf.d/vhosts/example.com.conf:php_admin_value takes two arguments, PHP Value Modifier (Admin) The following error message might appear on the Home page in Plesk:
PLESK_ERROR: Error: New configuration files for the Apache web server were not created due to the errors in configuration templates: AH00526: Syntax error on line 96 of /etc/apache2/plesk.conf.d/vhosts/example.com.conf: php_admin_value takes two arguments, PHP Value Modifier (Admin). Search in KB
OR
PLESK_ERROR: New configuration files could be created for the Apache webserver: Template processing failed: file = /opt/psa/admin/conf/templates/custom/server.php, error = Template_Exception: Template server / tomcat .php does not exist file: /opt/psa/admin/plib/Template/Processor.php line: 28 code: 0 Previous error: Template_Exception: Template server / tomcat.php does not exists file: / opt / psa / admin / plib / Template / Finder.php line: 25 code: 0. Detailed error descriptions have been sent to you by e-mail. Please solve the problem and click here to recreate the damaged configuration files or here to create all configuration files The following error can be found in the logfile /usr/local/psa/admin/logs/panel.log:
CONFIG_TEXT: Fatal error: Class 'Template_Writer_Apache' not found in /opt/psa/admin/conf/templates/custom/server.php Cause
Custom templates located at /usr/local/psa/admin/conf/templates/custom are corrupted.
Resolution Connect to a Plesk server via SSH. Rename the directory /usr/local/psa/admin/conf/templates/custom:
# mv /usr/local/psa/admin/conf/templates/custom /usr/local/psa/admin/conf/templates/custom_bak Re-run the ""httpdmng"" utility to regenerate configuration files: for all domains:
# /usr/local/psa/admin/sbin/httpdmng --reconfigure-all for one domain:
# /usr/local/psa/admin/sbin/httpdmng --reconfigure-domain example.com If domain reconfiguration still fails, in Plesk go to Domains > example.com > PHP Settings and clear the Additional configuration directives field. Related Articles Changing Virtual Hosts Settings Using Configuration Templates
"
8,"Unable to send an email from a Plesk server with Postfix: SASL login authentication failed
Applicable to: Plesk for Linux Symptoms When sending an email from webmail, the following error message is shown:
PLESK_INFO: SMTP Error (535): Authentication failed. The following error message appears in /var/log/maillog:
CONFIG_TEXT: postfix/smtpd[7538]: warning: unknown[203.0.113.2]: SASL login authentication failed: authentication failure The following error message appear in the Roundcube log /var/log/plesk-roundcube/errors:
CONFIG_TEXT: ERROR: Invalid response code received from server (535) SMTP Error: Authentication failure: Invalid response code received from server (Code: 535) in /usr/share/psa-roundcube/program/lib/Roundcube/rcube.php on line 1649 (POST /?_task=mail&_unlock=loading1486700183680&_lang=en_US&_framed=1&_action=send) The saslauthd service is running on the system:
# service saslauthd status ... Active: active (running) since ... SMTP authorization does not work, even though valid login credentials are used:
# telnet localhost 25 Trying 127.0.0.1...Connected to localhost. Escape character is '^]'. 220 plesk.example.com ESMTP Postfix AUTH LOGIN 334 VXNlcm5hbWU6YWJlemJvcm9kb3ZhQHBhcmFsbGVscy5jb20=334 UGFzc3dvcmQ6MTIzcXdl 535 5.7.8 Error: authentication failed: authentication failure Cause
The Postfix smtpd.conf configuration file contains incorrect data.
Resolution Connect to the Plesk server via SSH. Open the smtpd.conf file in a text editor (in this example, we are using the vi editor) and edit the file as follows: on CentOS/RHEL-based distributions
# vi /usr/lib64/sasl2/smtpd.conf pwcheck_method: auxprop saslauthd auxprop_plugin: plesk saslauthd_path: /var/spool/postfix/private/plesk_saslauthd mech_list: DIGEST-MD5 CRAM-MD5 PLAIN LOGIN sql_engine: intentionally disabled log_level: 4 on Debian/Ubuntu-based distributions
# cat /etc/postfix/sasl/smtpd.conf pwcheck_method: auxprop saslauthd auxprop_plugin: plesk saslauthd_path: /private/plesk_saslauthd mech_list: DIGEST-MD5 CRAM-MD5 PLAIN LOGIN sql_engine: intentionally disabled log_level: 4 Save the changes and close the file. Restart the saslauthd service:
# service saslauthd start "
3,"Increased memory usage by PHP-CGI processes on server after Plesk update
Applicable to: Plesk for Linux Symptoms The memory usage increased after installing Plesk updates.
RAM is used by dozens of php-cgi processes started by Apache:
# topPID USER PR NI VIRT RES SHR S %CPU %MEM TIME+ COMMAND26267 johndoe+ 20 0 810324 72704 3372 S 0.0 0.5 0:01.62 /opt/plesk/php/5.3/bin/php-cgi -c /var/www/vhosts/system/example.com/etc/php.ini10022 janedoe+ 20 0 809084 71940 2108 S 0.7 0.5 0:01.72 /opt/plesk/php/5.3/bin/php-cgi -c /var/www/vhosts/system/example1.com/etc/php.ini 996 jadedoe+ 20 0 814800 68728 10556 S 0.0 0.5 0:04.24 /opt/plesk/php/5.3/bin/php-cgi -c /var/www/vhosts/system/example2.com/etc/php.ini Very big timeouts are specified in /etc/httpd/conf.d/fcgid.conf :
CONFIG_TEXT: FcgidIdleTimeout 2100 FcgidProcessLifeTime 2100 FcgidMaxProcesses 300 FcgidConnectTimeout 2100 FcgidIOTimeout 2100 FcgidBusyTimeout 2100 Cause
PHP-CGI processes are consuming too much memory due to big timeout values in FastCGI configuration.
Resolution
Click on a section to expand Solution 1 Connect to the server via SSH Open /etc/httpd/conf.d/fcgid.conf in any text editor Decrease timeouts to lower values to finish php-cgi processes earlier, and execute service httpd reload command to reload Apache configuration. Default values are:
CONFIG_TEXT: FcgidIdleTimeout 40 FcgidProcessLifeTime 30 FcgidMaxProcesses 20 FcgidConnectTimeout 30 FcgidIOTimeout 45 FcgidIdleScanInterval 10
Note: The drawback of this solution is the possible failure of long-running PHP scripts. If you are sure that there is no any on the server, you can follow this option. Solution 2 Log in to Plesk, go to Domains > example.com > PHP settings and set PHP version to 7.0.33 and handler to FPM application served by nginx:
Perform these configuration changes for every domain one by one.
Note: The drawback of this solution is possible websites' downtime due to switching to nginx. For example, domain-level .htaccess files can not be handled anymore, that can lead to website downtime. That's why it was recommended to switch the websites one by one, checking their availability. "
7,"Plesk Update/Upgrade fails on Debian/Ubuntu when the /boot partition has no free disk space: No space left on device
Applicable to: Plesk for Linux Symptoms Plesk Update/Upgrade fails on Debian/Ubuntu:
CONFIG_TEXT: You might want to run 'apt-get -f install' to correct these: The following packages have unmet dependencies: <package_name> : PreDepends: <package_name> (= 1.42.13-1ubuntu1.1) but 1.42.13-1ubuntu1.2 is to be installed linux-image-generic : Depends: linux-image-4.4.0-171-generic but it is not going to be installed System package updater apt fails with the ""No space left on device"" error message:
# apt-get -f install Unpacking linux-image-3.16.0-55-generic (3.16.0-55.74~14.04.1) ... dpkg: error processing archive /var/cache/apt/archives/linux-image-3.16.0-55-generic_3.16.0-55.74~14.04.1_amd64.deb (--unpack): cannot copy extracted data for './boot/vmlinuz-3.16.0-55-generic' to '/boot/vmlinuz-3.16.0-55-generic.dpkg-new': failed to write (No space left on device) No apport report written because the error message indicates a disk full error The partition on which the /boot directory is mounted is full:
# df -h | grep boot /dev/sda1 472M 443M 5.1M 99% /boot Additional symptoms The following error message appears in /var/log/plesk/install/autoinstaller3.log:
# grep ""No space left on device"" /var/log/plesk/install/autoinstaller3.log cat: write error: No space left on device Multiple linux-image packages are shown when running the command:
# dpkg --list 'linux-image*'|awk '{ if ($1==""ii"") print $2}'|grep -v `uname -r` Cause
System packages cannot be updated due to full /boot partition. The partition may be full due to multiple old kernels persisting on the system.
Resolution
Resize the partition on which the /boot directory is mounted to increase free space or remove old kernels from the system.
Warning: Disk partitioning is not covered by Plesk Technical Support. If you are not familiar with Linux system administering and would like Plesk professionals to handle this task, please contact Plesk Professional Services team."
2,"Customer is unable to remove the main domain on a subscription in Plesk: remove option is missing
Applicable to: Plesk for Linux
Plesk for Windows Symptoms Unable to remove a domain from within customer's account in Plesk: option Remove is missing Domain in question is the main domain of a subscription (it has the same name as the subscription name). Subscription that domain belongs to has 'Domains management' permission in Subscriptions > example.com > Customize > Permissions Cause
This is by design. Customers do not have the ability to create or remove their subscriptions, only additional domains under already created subscriptions. Main domain can be removed only along with subscription by Plesk administrator or a Reseller who owns the customer. In that case all additional domains under the subscription will be removed as well.
Subscription is always associated with some service plan (custom one or from the set of already created ones), which is a set of hosting resources and services that administrator offers to customers for sell. To prohibit ability for customers to assign resources and services for themselves by their own, it is not allowed for them to create/remove subscriptions.
Resolution
The main domain of any subscription cannot be deleted by a customer. However, it can be renamed.
To actually remove the main domain, it is required that removal is performed by a Plesk administrator or a reseller who owns the customer in question. For more details, visit Plesk Administrator Guide.
Note: All additional domains under the subscription will be removed as well."
5,"Unable to connect to a Plesk for Windows server via FTP when the server is behind NAT: PASV FTP error ECONNABORTED
Applicable to: Plesk 12.0 for Windows
Plesk 12.5 for Windows Symptoms A Plesk Server is behind NAT. When accessing a Plesk server via FTP in the passive mode using the external IP address, the connection fails with the following error message:
CONFIG_TEXT: Error: Disconnected from server: ECONNABORTED - Connection abortedError: Failed to retrieve directory listing When accessing a Plesk server via FTP in the passive mode using the internal IP address, the connection fails with the following error message:
CONFIG_TEXT: 425-Cannot open data connection.Win32 error: The network connection was aborted by the local system.Error details: Client IP on the control channel didn't match the client IP on the data channel. Cause
FTP firewall settings are not configured in IIS on a Windows server.
Resolution Connect to a Plesk server via RDP. Start a command prompt as an Administrator and run the following command to start IIS Manager:
C:\> start inetmgr In IIS Manager, click SERVERNAME > FTP Firewall Support. Specify the passive FTP port range and the external IP address of an edge firewall. Once done, click Apply. Additional Information
To ensure that the passive FTP port range is properly configured, check the following KB article: How to configure a passive FTP port range in Plesk for Windows
"
8,"How to enable 587 submission port on Plesk server (Linux)?
Applicable to: Plesk for Linux Question
How to enable 587 submission port for Postfix/qmail mail server?
Resolution From Plesk interface Go to Plesk > Tools & Settings > Mail Server Settings set the Enable SMTP service on port 587 on all IP addresses check box. From SSH Connect to the server using SSH.
Note: if direct SSH access to the server is not possible, contact server administrator for further assistance. Execute the following command:
# /usr/local/psa/bin/mailserver --set-message-submission true Additional Information
How to enable submission port 587 in MailEnable on Plesk Windows server?
Administrator's Guide. Configuring Server-Wide Mail Settings"
3,"Login to WordPress or PHP application fails without any error messages, when ModSecurity is enabled in Plesk
Applicable to: Plesk for Linux
Plesk for Windows Symptoms The Log In button for WordPress, Typo3 or other CMS in Plesk is not working: it redirects to application login page with empty credentials fields. Login to PHP application using POST request fails without any error messages. Cause
Login mechanism is breaking by ModSecurity Tradeoff/Thorough modes, enabled in Plesk > Tools & Settings > Web Application Firewall > Settings. These modes include analysis of POST data that lead to changing sending packets.
Resolution
Log into Plesk and apply one of the following solutions: Switch ModSecurity mode to Fast on Plesk > Tools & Settings > Web Application Firewall (ModSecurity) > Settings: this mode does not include analysis of POST data. Disable ModSecurity for a domain via Plesk > Domains > example.com > Web Application Firewall. Forbid ModSecurity to access request bodies (Windows Server only): Connect to the server via RDP. Open the file C:\Program Files\ModSecurity IIS\modsecurity.conf in a text editor and set the SecRequestBodyAccess setting to the Off value:
CONFIG_TEXT: SecRequestBodyAccess Off Restart IIS webserver via a command prompt:
C:\> iisreset "
3,"[BUG] Cannot set up client_max_body_size for nginx in Plesk: [emerg] ""client_max_body_size"" directive is duplicate
Applicable to: Plesk for Linux Symptoms
Cannot set up client_max_body_size directive in Domains > example.com > Apache & Nginx settings > Additional nginx directives:
PLESK_ERROR: Invalid nginx configuration: nginx: [emerg] ""client_max_body_size"" directive is duplicate in /var/www/vhosts/system/example.com/conf/vhost_nginx.conf:1 nginx: configuration file /etc/nginx/nginx.conf test failed
Cause
This is Plesk bug with ID #PPPM-1914 which will be fixed in future product updates.
Resolution
By default, Plesk applies 'client_max_body_size 128m;' directive for each domain, while the default server-wide value is '1m'. The following steps keep '128m' as default value server-wide and apply custom value on domain level: Connect to Plesk server using SSH Set up global value for nginx ('128m' or any other default server-wide value can be set up here):
# echo 'client_max_body_size 128m;' > /etc/nginx/conf.d/aa_client_max_body.conf Modify /usr/local/psa/admin/conf/panel.ini: # echo -e ""[webserver]\n nginxClientMaxBodySize =\n"" >> /usr/local/psa/admin/conf/panel.ini
If the panel.ini file does not exist, create it using sample file and set correct permissions:
# cp /usr/local/psa/admin/conf/panel.ini.sample /usr/local/psa/admin/conf/panel.ini
# chmod 644 /usr/local/psa/admin/conf/panel.ini Regenerate Apache configuration files:
# plesk sbin httpdmng --reconfigure-all Restart nginx:
# service nginx restart Video tutorial:
"
3,"How to change Default Server Page for domains in disabled status
Applicable to: Plesk for Linux
Plesk for Windows Question
How to change Default Server Page for domains in disabled status?
Answer
Note: The default server page is shown in case if domain is disabled or the server's IP address is specified in address bar.
To enable default server page: Log in to Plesk Go to Tools & Settings > IP Addresses and click the IP address to edit its settings.
Set Default siteoption to None To customize the default page: Log in to Plesk server via SSH or RDP Edit or replace the file /var/www/vhosts/default/htdocs/index.html (Plesk for Linux) or %plesk_vhosts%default\htdocs\index.html (Plesk for Windows). Warning: it's not recommended to place index.php to default web server website document root as it may break Plesk installation"
3,"Cannot start PHP FPM service: cannot get uid for user
Applicable to:
Plesk Onyx for Linux
Symptoms
The PHP FPM service can not start:
\# systemctl status php5-fpm.service ... \
**ERROR: \[pool example.com\] cannot get uid for user 'john.doe'** ERROR: FPM initialization failed \
php5-fpm.service: main process exited, code=exited, status=78/n/a \
Failed to start The PHP FastCGI Process Manager. \
Unit php5-fpm.service entered failed state. Cause
Because php-fpm pool wasn't updated properly, the required system user is missing.
Resolution Log in to Plesk Re-generate PHP settings for the domain mentioned in the error message by going to Domains > example.com > PHP Settings and clicking on OK
Note: if the domain has ""No hosting"" type, change the domain's hosting type to ""Website"" and specify username from the error. To re-generate PHP settings of all domains: Connect to the server using SSH Run this command:
# /usr/local/psa/bin/php_settings -u "
2,"Unable to install a certificate for a domain in Hosting Settings: The system cannot find the path specified.
Applicable to: Plesk for Windows Symptoms Unable to install a certificate for a domain in Hosting Settings:
PLESK_ERROR: certmng failed: The system cannot find the path specified. (Error code 3) at Open file '' at (VFile::open line 104) at execute console command --install-web-certificate(vconsoleapp::start line 122) at execute ""C:\Program Files (x86)\Plesk\admin\bin\certmng"" --install-web-certificate ""--name=ssl_example.com"" ""--certificate-path="" ""--ca-certificate-path=""(vconsoleapp::run line 139) (Error code 1) The website https://example.com shows:
PLESK_INFO: This page can’t be displayed Attempt to reconfigure the domain fails with the following error message:
C:\>""%plesk_cli%\repair"" --reconfigure-web-site -web-site-name example.com A specified logon session does not exist. It may already have been terminated. (Exception from HRESULT: 0x80070520) In Microsoft.Web.Administration module Exception type: System.Runtime.InteropServices.COMException at Microsoft.Web.Administration.Interop.IAppHostMethodInstance.Execute() at Microsoft.Web.Administration.BindingManager.Save() at Microsoft.Web.Administration.ServerManager.CommitChanges() at ServerManagerFactory.commit() at IISServerManager.commit(IISServerManager* ) (Error code 1) Cause
The SSL certificate was incorrectly installed.
Resolution Connect to a Plesk server via RDP. Run the following commands to reconfigure SSL certificate and the website:
C:\> ""%plesk_cli%\\repair"" --reconfigure-ssl-certificates C:\> ""%plesk_cli%\\repair"" --reconfigure-web-site -web-site-name example.com "
8,"Mail sent to Postfix default accounts is routed to Plesk Administrator's email
Applicable to: Plesk for Linux Symptoms When the mail service is enabled for a domain (i.e. example.com), the following email accounts are set up in Postfix by default:
CONFIG_TEXT: postmap -s /var/spool/postfix/plesk/virtual | grep @example1.com anonymous@example.com anonymous@localhost.localdomain drweb@example.com drweb@localhost.localdomain kluser@example.com kluser@localhost.localdomain postmaster@example.com postmaster@localhost.localdomain root@example.com root@localhost.localdomain mailer-daemon@example.com mailer-daemon@localhost.localdomain If an email message is sent to one of those email accounts (e.g. root@example.com), it gets forwarded to the email address that is set under the Plesk Administrator's Profile. Cause
This behavior is by design: In the following output, it can be seen that all emails sent to the accounts mentioned (for example root@localhost.localdomain) are forwarded to Plesk Administrator email address (for example pleskadmin@example.com):
CONFIG_TEXT: postmap -s /var/spool/postfix/plesk/aliases drweb pleskadmin@example.com kluser pleskadmin@example.com postmaster pleskadmin@example.com root pleskadmin@example.com anonymous pleskadmin@example.com drweb-daemon pleskadmin@example.com ailer-daemon pleskadmin@example.com mailman pleskadmin@example.com
Resolution
In order to change this behavior: Connect to the server via SSH; Modify /etc/aliases file to forward all messages from desired accounts to another mailbox (for example john.doe@example.com).
For instance, for the account root@localhost.localdomain, add the following line into the /etc/aliases file:
CONFIG_TEXT: root: john.doe@example.com Run the following command:
# postalias /etc/aliases Verify that the setting applied:
# postmap -s /etc/aliases | grep root Note: This will not affect accounts created in Plesk with the name root@domainname.com, but if the mailbox does not exist then the message will be forwarded to john.doe@example.com instead of the Plesk Administrator email address."
8,"Many email messages are sent from PHP scripts on a Plesk server. How to find domains on which these scripts are running if Postfix is used?
Applicable to: Plesk for Linux Question
Many email messages are being sent from PHP scripts on a server. How to find domains on which these scripts are running if Postfix is used?
Answer
Warning: if you do not have SSH access contact your service provider or server administrator.
Note: this article is for Postfix only.
There is a way to determine from which directory the PHP script sending mail is run.
Note: depending on the operating system and Plesk version, paths can slightly differ. For example: for Debian and Ubuntu use /usr/sbin/sendmail instead of /usr/sbin/sendmail.postfix in the commands below.
Click on a section to expand RHEL/CentOS Connect to the server via SSH. Create a /usr/sbin/sendmail.postfix-wrapper script with the following content:
CONFIG_TEXT: #!/bin/sh (echo X-Additional-Header: $PWD ;cat) | tee -a /var/tmp/mail.send|/usr/sbin/sendmail.postfix-bin ""$@"" Create /var/tmp/mail.send log file and set a+rw permissions. Make the wrapper executable, rename the old sendmail.postfix file, and link it to the new wrapper:
# touch /var/tmp/mail.send # chmod a+rw /var/tmp/mail.send # chmod a+x /usr/sbin/sendmail.postfix-wrapper # mv /usr/sbin/sendmail.postfix /usr/sbin/sendmail.postfix-bin # ln -s /usr/sbin/sendmail.postfix-wrapper /usr/sbin/sendmail.postfix Wait for a while to collect data: 30 -60 min. Rename sendmail.postfix-bin back to /usr/sbin/sendmail.postfix:
# mv /usr/sbin/sendmail.postfix /root/backup__sendmail.postfix # mv /usr/sbin/sendmail.postfix-bin /usr/sbin/sendmail.postfix
Note: File /var/tmp/mail.send is not rotated automatically and it is not recommended to leave it for a long period of time as it could consume a server disk space. Delete and create a new file /var/tmp/mail.send after every check up. Check /var/tmp/mail.send file. There should be lines starting with ""X-Additional-Header"" pointing to the domain folders where the scripts that sent the mail are located.
The directories, from which mail PHP scripts are run, can be seen using the following command:
# grep X-Additional /var/tmp/mail.send | grep `cat /etc/psa/psa.conf | grep HTTPD_VHOSTS_D | sed -e 's/HTTPD_VHOSTS_D//' `
Note: If no output is shown from the command above, it means no mail was sent using the PHP mail function from the Plesk virtual host's directory.
Usually, that means one of the mail accounts has been compromised. Check the login attempt count:
# zgrep -c 'sasl_method=LOGIN' /var/log/maillog*/var/log/maillog:221000/var/log/maillog.processed:362327/var/log/maillog.processed.1.gz:308956
If an unusually high number of login attempts is shown, it is very likely accounts were compromised. Try identifying these accounts in the following way:
# zgrep 'sasl_method=LOGIN' /var/log/maillog* | awk '{print $9}' | sort | uniq -c | sort -nr | head 891574 sasl_username=admin@example.com To stop spam from being sent, change passwords for the compromised accounts and restart the Postfix service.
Also, check Administrator's Guide Click on a section to expand Debian/Ubuntu Connect to the server via SSH. Create a /usr/sbin/sendmail-wrapper script with the following content:
CONFIG_TEXT: #!/bin/sh (echo X-Additional-Header: $PWD ;cat) | tee -a /var/tmp/mail.send|/usr/sbin/sendmail-bin ""$@"" Create /var/tmp/mail.send log file and set a+rw permissions. Make the wrapper executable, rename the old sendmail file, and link it to the new wrapper:
# touch /var/tmp/mail.send # chmod a+rw /var/tmp/mail.send # chmod a+x /usr/sbin/sendmail-wrapper # mv /usr/sbin/sendmail /usr/sbin/sendmail-bin # ln -s /usr/sbin/sendmail-wrapper /usr/sbin/sendmail Wait for a while to collect data: 30 -60 min. Rename sendmail-bin back to /usr/sbin/sendmail:
# mv /usr/sbin/sendmail /root/backup__sendmail # mv /usr/sbin/sendmail-bin /usr/sbin/sendmail
Note: File /var/tmp/mail.send is not rotated automatically and it is not recommended to leave it for a long period of time as it could consume a server disk space. Delete and create a new file /var/tmp/mail.send after every check up. Check /var/tmp/mail.send file. There should be lines starting with ""X-Additional-Header"" pointing to the domain folders where the scripts that sent the mail are located.
The directories, from which mail PHP scripts are run, can be seen using the following command:
# grep X-Additional /var/tmp/mail.send | grep `cat /etc/psa/psa.conf | grep HTTPD_VHOSTS_D | sed -e 's/HTTPD_VHOSTS_D//' `
Note: If no output is shown from the command above, it means no mail was sent using the PHP mail function from the Plesk virtual host's directory.
Usually, that means one of the mail accounts has been compromised. Check the login attempt count:
# zgrep -c 'sasl_method=LOGIN' /var/log/maillog*/var/log/maillog:221000/var/log/maillog.processed:362327/var/log/maillog.processed.1.gz:308956
If an unusually high number of login attempts is shown, it is very likely accounts were compromised. Try identifying these accounts in the following way:
# zgrep 'sasl_method=LOGIN' /var/log/maillog* | awk '{print $9}' | sort | uniq -c | sort -nr | head 891574 sasl_username=admin@example.com To stop spam from being sent, change passwords for the compromised accounts and restart the Postfix service.
Also, check Administrator's Guide "
6,"MySQL/MariaDB fails to start on a Plesk for Linux server: Can't open and lock privilege tables
Applicable to: Plesk for Linux Symptoms MySQL/MariaDB fails to start due to the missing/corrupted tables in the 'mysql' database. The following errors appear in /var/log/mysqld.log or /var/log/mariadb/mariadb.log:
CONFIG_TEXT: [ERROR] Fatal error: Can't open and lock privilege tables: Incorrect file format '<table_name>'
OR
CONFIG_TEXT: [ERROR] Fatal error: Can't open and lock privilege tables: Table '<table_name>' doesn't exist
OR
CONFIG_TEXT: /usr/sbin/mysqld: Table '<table_name>' doesn't exist [ERROR] Can't open the <table_name> table. Please run mysql_upgrade to create it. Consequences Plesk is not accessible with one of the following error messages in a web-browser:
PLESK_INFO: ERROR: PleskDBException: Unable to connect to database: mysql_connect(): No such file or directory /var/run/mysqld/mysqld.sock (Error code: 2002). Please check that database server is started and accessible. (Abstract.php:69)
OR
PLESK_INFO: ERROR: Uncaught exception 'Zend_Log_Exception' with message '""/var/log/plesk/panel.log"" cannot be opened with mode ""a""' in /usr/local/psa/admin/externals/Zend/Log/Writer/Stream.php:81
OR
PLESK_INFO: SQLSTATE[HY000] [2002] No such file or directory. Cause
Tables in the mysql database are missing or corrupted.
Resolution Connect to the Plesk server via SSH. Stop the MySQL/MariaDB service:
# service mariadb stop
OR
# service mysql stop
OR
# service mysqld stop Modify the my.cnf file:
3.1. Open the my.cnf file in a text editor. In this example, we are using the vi editor: on CentOS/RHEL-based distributions
# vi /etc/my.cnf on Debian/Ubuntu-based distributions
# vi /etc/mysql/my.cnf 3.2. Add the skip-grant-tables directive under the [mysqld] section:
CONFIG_TEXT: [mysqld] skip-grant-tables general_log = on general_log_file=/var/log/query <...>
3.3. Save the changes and close the file. Start the MySQL/MariaDB service:
# service mariadb start
OR
# service mysql start
OR
# service mysqld start Create a backup of the mysql database:
# MYSQL_PWD=`cat /etc/psa/.psa.shadow` mysqldump -uadmin --skip-extended-insert mysql > /root/mysql.dump.`date +%F.%s`.sql Fix MySQL tables:
# mysql_upgrade --force
Depending on the results, click on one of the following sections: If no error appeared during 'mysql_upgrade' Restart the MySQL/MariaDB service:
# service mariadb restart
OR
# service mysql restart
OR
# service mysqld restart List all available Plesk daily dumps (the default dump folder is /var/lib/psa/dumps):
# ls -lat `cat /etc/psa/psa.conf | grep DUMP_D | grep -v ""#"" | awk '{print $2}'`/mysql.daily.dump* -rw------- 1 root root 236253 Dec 3 01:51 /var/lib/psa/dumps/mysql.daily.dump.0.gz -rw------- 1 root root 229653 Jul 2 01:48 /var/lib/psa/dumps/mysql.daily.dump.1.gz -rw------- 1 root root 222485 Apr 1 01:56 /var/lib/psa/dumps/mysql.daily.dump.2.gz Restore the mysql database from the most recent Plesk daily dump:
# zcat /var/lib/psa/dumps/mysql.daily.dump.0.gz | sed -n '/-- Current Database: `mysql`/,/-- Current Database:*/p' | MYSQL_PWD=`cat /etc/psa/.psa.shadow` mysql -uadmin
If the restoration process fails with the following error:
CONFIG_TEXT: ERROR 1813 (HY000) at line 6185: Tablespace 'mysql.engine_cost' exists.
OR
CONFIG_TEXT: ERROR 1146 (42S02): Table 'mysql.proc' doesn't exist
go to the Fails with ""Error occurred: Query against mysql.user table failed when checking the mysql.session KB article section. Stop the MySQL/MariaDB service:
# service mariadb stop
OR
# service mysql stop
OR
# service mysqld stop Remove the skip-grant-tables directive which was added on step 3. Start the MySQL/MariaDB service:
# service mariadb start
OR
# service mysql start
OR
# service mysqld start The 'mysql_upgrade' process fails with ""Error occurred: Query against mysql.user table failed when checking the mysql.session"" Create a backup of the mysql folder:
# mkdir /root/mysql_backup # cp -a /var/lib/mysql/mysql/* /root/mysql_backup # cd /var/lib/mysql/ # rm -rf ./mysql/ Create the mysql database:
# MYSQL_PWD=`cat /etc/psa/.psa.shadow` mysql -uadmin mysql> create database mysql; List all available Plesk daily dumps (the default dumps folder is /var/lib/psa/dumps):
# ls -lat `cat /etc/psa/psa.conf | grep DUMP_D | grep -v ""#"" | awk '{print $2}'`/mysql.daily.dump* -rw------- 1 root root 236253 Dec 3 01:51 /var/lib/psa/dumps/mysql.daily.dump.0.gz -rw------- 1 root root 229653 Jul 2 01:48 /var/lib/psa/dumps/mysql.daily.dump.1.gz -rw------- 1 root root 222485 Apr 1 01:56 /var/lib/psa/dumps/mysql.daily.dump.2.gz Restore the mysql database from the most recent Plesk daily dump:
# zcat /var/lib/psa/dumps/mysql.daily.dump.0.gz | sed -n '/-- Current Database: `mysql`/,/-- Current Database:*/p' | MYSQL_PWD=`cat /etc/psa/.psa.shadow` mysql -uadmin Stop the MySQL/MariaDB service:
# service mariadb stop
OR
# service mysql stop
OR
# service mysqld stop Remove the skip-grant-tables directive which was added on step 3. Start the MySQL/MariaDB service:
# service mariadb start
OR
# service mysql start
OR
# service mysqld start Related Articles How to fix InnoDB corruption cases for the MySQL databases on Plesk for Linux?
"
2,"How to refresh the list of installed server components in Plesk?
Applicable to: Plesk for Linux
Plesk for Windows Question
The component (for example PHP, .NET) is installed, but it is missing in Tools & Settings > Server Components
How to refresh the list of installed server components in Plesk?
Answer
Click on a section to expand Via Plesk GUI Log in to Plesk GUI Go to Tools & Settings > Server Components > Click on Refresh Via SSH/CLI For Linux OS: Connect to the server via SSH Run the following command:
# plesk sbin packagemng -sdf For Windows OS: Connect to the server via RDP Start a command prompt as Administrator Run the following command:
C:\> plesk sbin defpackagemng.exe --update --fix "
7,"Custom file permissions have been lost on Plesk upgrade on Windows
Applicable to: Plesk for Windows Symptoms
In order to make certain web applications work with Plesk on a server, it is necessary to customize permissions for those folders. However, after Plesk is upgraded, these permissions can be reverted to their default statuses, and it is needed to customize them again.
Resolution
Create an additional file with custom rules and put it into the %plesk_dir%\etc\DiskSecurityfolder, as described in Plesk Advanced Administration Guide."
7,"Is it safe to update Plesk server's system packages using an operating system package manager? Applicable to: Plesk for Linux Question
Is it safe to update system packages using an operating system package manager?
Answer
Yes, it is safe, and moreover, we recommend using package managers (for example, ""yum"" on RedHat-based systems, or ""apt-get"" on Debian-based systems) to keep the system up-to-date.
On Plesk Onyx, it can be done via Tools & Settings > System Updates menu.
If Plesk is installed inside a container, the kernel updates are not necessary - the kernel should be upgraded from the Hardware Node. If Plesk is installed on a hardware server, the kernel updates are recommended if there are only vendor's repositories configured. Otherwise, if the custom repositories provide new kernels, it is better to have the kernel manually updated from the vendor's repository. The reason is simple: major troubles are caused by kernels with GRSecurity patches applied. Plesk is not designed for working with such configurations.
Additional information
Is it possible to update Apache version from custom repository on Plesk server?"
8,"Mail delivery fails: Error 554: host refused to talk to me
Applicable to: Plesk for Linux Symptoms Mail delivery to particular domains fails with the following error message in /var/log/maillog:
CONFIG_TEXT: 0572C2801E1: uid=30 from=john.doe@example.com 0572C2801E1: message-id=6AD1BED0ECFB2E4FA52CC9B923AE4ED6A50F7157@example.com 0572C2801E1: from=john.doe@example.com, size=3826, nrcpt=1 (queue active) 0572C2801E1: host mx.example.net refused to talk to me: 554 IP=IP_ADDRESS - A problem occurred. (Ask your postmaster for help or to contact info@mx.example.net to clarify.) (BL) When manually connecting to the remote server from the error message (In this example, mx.example.net) using the telnet utility, connection fails:
# telnet mx.example.net 25 Trying mx.example.net.... Connected to mx.example.net. Escape character is '^]'. 554 IP=IP_ADDRESS - A problem occurred. (Ask your postmaster for help or to contact info@mx.example.net to clarify.) (BL) Connection closed by foreign host. Or mail delivery via mail relay / smart host server fails:
hostname.example.com postfix/smtp[6568]: 547F6402BD: host smtp.example.org refused to talk to me: 550 5.7.1 [IIA] Connection refused the host ""smtp.example.com"" refuses the connection Cause
Error code 554 means IP-Blocking: A remote mail server is not currently accepting emails from a server IP address. This IP blocking may be due to a previously observed unusual volume of emails at the IP address concerned.
Resolution
Contact administrator of a remote mail server/mail relay server. For more information about a blacklisted mail server, see this KB article: Plesk Mail Server is blacklisted. What to do? Related Articles What are spam protection general recommendations
"
8,"How to check what Message Transfer Agent is used on the server with Plesk and how to switch it?
Applicable to: Plesk for Linux Question
How to check what Message Transfer Agent is used on the server with Plesk and how to switch it?
Answer
Starting from Plesk version 9 only two Message Transfer Agents (MTA) are supported - QMail and Postfix. Only one of them can be used at a time.
Check the installed MTA:
Click on a section to expand Via Plesk GUI Log in to Plesk GUI Go to Tools & Settings > Services Management: Find SMTP Server line. Depending on the installed MTA it will be:
SMTP Server (Postfix) OR SMTP Server (QMail) Via CLI Connect to the server via SSH Execute the following command:
# plesk sbin mailmng-server --features | grep SMTP_Server
Depending on the installed MTA, the output will be:
# plesk sbin mailmng-server --features | grep SMTP_Server $features['SMTP_Server'] = ""Postfix""; $features['SMTP_Server_package'] = ""postfix"";
OR
# plesk sbin mailmng-server --features | grep SMTP_Server $features['SMTP_Server'] = ""QMail""; $features['SMTP_Server_package'] = ""psa-qmail""; Change the installed MTA:
Click on a section to expand Via Plesk GUI Note: Before switching the MTA, it is recommended to wait until all queued emails are delivered. Log in to Plesk GUI Go to Tools & Settings > Services Management Stop the service SMTP Server Go to Tools & Settings > Updates and Upgrades > Add/Remove Components > Mail Hosting > SMTP servers. Select the necessary SMTP server - QMail or Postfix. Click Continue > Install Via CLI Note: Before switching the MTA, it is recommended to wait until all queued emails are delivered. Connect to the server via SSH Stop the Mail service:
# plesk sbin mailmng-service --stop-service Make sure that there aren't processes binding port 25:
# lsof -i :25 (Empty Output)
In case any process is returned by the previous command, run the following command to kill running processes:
# lsof -i :25 | grep LISTEN | awk '{print $2}' | sort | uniq | xargs kill Install the necessary SMTP server: Postfix
# plesk installer --select-release-current --install-component postfix QMail
# plesk installer --select-release-current --install-component qmail Also, it is possible to run Plesk installer and select the necessary SMTP server in Mail Hosting section:
# plesk installer Additional Information
To flush the Mail queue:
Click on a section to expand Via Plesk GUI Log in to Plesk GUI Go to Tools & Settings > Mail Server Settings > Mail Queue tab > Clear Via CLI Connect to the server via SSH Clear the mail queue according to the installed MTA: For QMail:
# kill -ALRM pidof qmail-send For Postfix:
# postqueue -f "
8,"How to configure MailEnable mail relaying on Plesk for Windows server hosted on Google Cloud Platform or Microsoft Azure?
Applicable to:
Plesk for Windows
Question
How to configure MailEnable mail relaying on a Plesk for Windows server hosted on Google Cloud Platform or Microsoft Azure?
Answer
According to the official Google Cloud Platform Documentation, Google Compute Engine does not allow outbound connections on ports 25, 465, and 587.
According to official Microsoft Azure Update, Azure does not allow outbound connections on port 25.
In order to set up mail relaying, follow these steps: Register an account in a mail relay service (SendGrid, Mailgun, Mailjet, etc.).
Note: These services may have a free tier for some of the platform's users. For additional information, refer to the documentation of the service. Connect to the Plesk server using RDP. Open the MailEnable Administrator console in Start > Mail Enable. Go to Servers > localhost > Services and Connectors > right-click on SMTP > Properties > Smart Host. Select Smart Host Enabled and under IP/Domain specify: smtp.sendgrid.net for SendGrid. smtp.mailgun.org for Mailgun. in.mailjet.com for Mailjet. In the Port field, specify 587 in case of Azure or 2525 in case of Google Cloud Platform. Select the option The remote server requires authentication, enter the credentials provided after the registration on the mail relay service and click Apply.
Note: For more information on how to properly set up the relay authentication and proper credentials, refer to the documentation of service. Restart SMTP Connector: right-click on SMTP > Stop and then click on Start. Additional information
Unable to send emails using Plesk local mail server: Connection timed out or connection refused How to configure Postfix to send emails using SendGrid"
2,"How to switch IP address for domain in Plesk?
Applicable to: Plesk for Linux Question
How to change IP Address for domain in Plesk?
Answer
Note: If you don't have this menu or option, please contact server's administrator or Hosting Provider.
Log into Plesk and go to Domains > example.com > Web Hosting Access and choose from the drop-down list of all available IP addresses on a server. Alternatively, the same operation can be performed via CLI. Connect to the server via SSH and execute:
# plesk bin subscription --update example.com -ip 203.0.113.3 To change IP for multiple subscriptions: Connect to the server via Connect to the server via SSH Create the list of all subscriptions:
# plesk bin subscription --list > /root/subscr.txt (Optional) Edit file to remove subscriptions where changing IP address is not required Run the following command to change the IP:
# cat /root/subscr.txt | while read i; do plesk bin subscription -u $i -ip 203.0.113.3 ; done Note: It is not possible to have domains with different IP addresses in on subscription.
Take part in our product improvement and vote for this feature on Plesk UserVoice. The top-ranked suggestions are likely to be included in the next versions of Plesk."
4,"How to install Let's Encrypt certificate for domain alias in Plesk
Applicable to: Plesk for Linux
Plesk for Windows Question
How to install Let's Encrypt certificate for domain alias in Plesk? Answer
A separate certificate only for the domain alias cannot be created. Instead, create a new Let's Encrypt certificate for the main domain and specify the alias to secure:
I. Log in to Plesk and Install Let's Encrypt from Extensions catalog if it is not yet installed.
II. Create a new certificate: Go to Websites & Domains > Let's Encrypt.
Specify email address of domain owner. Specify if you want to include an alternative domain name for the domain and each selected alias, for example: www.example.com for example.com. It is recommended to select this checkbox.
Specify if you want to include webmail, for example: webmail.example.com. It is recommended to select this checkbox.
Select the domain alias to secure and click Install: III. Secure the main domain with it's aliases: Go to Websites & Domains and click Hosting Settings.
Select the SSL/TLS support checkbox.
Select the newly issued Let's Encrypt certificate from the Certificate menu, and click OK. Additional information
To secure domain alias with a paid certificate, contact a certificate provider to add the alias name to the certificate as the subject alternative name (SAN). Then, secure the main domain with this certificate as described here."
7,"Unable to upgrade Plesk to a new release for early adopters: Install or Upgrade Product option is greyed out
Applicable to: Plesk Onyx for Linux
Plesk Onyx for Windows Symptom
A new Plesk version is released for early adopters. It is not possible to upgrade Plesk at Home > Tools & Settings > Updates and Upgrades as the option Install or Upgrade Product is greyed out.
Cause
Plesk upgrade is configured as (Recommended) General release in Home > Tools & Settings > Update and Upgrade Settings.
Resolution
The new Plesk versions that are not matching to General release tier requirements are not available in Update and Upgrade.
To be able to upgrade to a new Plesk version for early adopters log in to Plesk as admin user, tick the option Early adopter release and click Ok at Home > Tools & Settings > Update and Upgrade Settings: Additional information
Plesk Release Tiers"
4,"APSC inconsistency: Cannot find registry resource for Application IDSymptoms The following error is shown when accessing an application link in the Applications tab in Plesk:
PLESK_ERROR: Internal error: Can not find registry resource for Application ID fbea5fe0-7e00-42fb-9fa0-e4fd2e664f8bCan not find registry resource for Application ID fbea5fe0-7e00-42fb-9fa0-e4fd2e664f8b
OR The following error is shown when trying to remove a subscription:
PLESK_ERROR: Can not find registry resource for Application ID fbea5fe0-7e00-42fb-9fa0-e4fd2e664f8b Cause
The application was incorrectly removed. As a result, while the application was left in the PSA database, it was removed from the APSC database.
Resolution Connect to the server via SSH; Backup psa and apsc databases; Check there is an apsc.aps_registry_object record for this application ID:
# plesk dbmysql> select * from apsc.aps_registry_object where uid='fbea5fe0-7e00-42fb-9fa0-e4fd2e664f8b';Empty set (0.00 sec)
In the above example, there is no record for this application in the APSC database. Check for this application in the PSA database:
# plesk dbmysql> select * from psa.apsContextsApplications where registryApplicationId='fbea5fe0-7e00-42fb-9fa0-e4fd2e664f8b';+----+--------------+--------------------------------------+| id | apsContextId | registryApplicationId |+----+--------------+--------------------------------------+| 19 | 17 | fbea5fe0-7e00-42fb-9fa0-e4fd2e664f8b |+----+--------------+--------------------------------------+mysql> select * from psa.apsContexts where id=17;+----+-----------+---------+-------+----------------+| id | pleskType | pleskId | ssl | subscriptionId |+----+-----------+---------+-------+----------------+| 17 | hosting | 530 | false | 527 |+----+-----------+---------+-------+----------------+mysql> select name from psa.domains where id=530;+-------------------+| name |+-------------------+| domain.tld |+-------------------+
Note: In the above example, records are shown for the broken application and its corresponding domain. Remove the inconsistent records from the PSA database:
# plesk dbmysql> DELETE FROM psa.apsContexts WHERE id=17;mysql> DELETE FROM psa.apsContextsApplications WHERE apsContextId=17; "
0,"How to set up file audit on Windows server? Applicable to: Plesk 12.0 for Windows Plesk 12.5 for Windows Information
Note: Security configuration and events audits fall out of scope of Plesk Technical Support and should be performed by your company's Security Administrator.
Anyway, there are some recommendations for Microsoft Windows built-in tools that will allow you to perform audits on files and folders and protect your server from unauthorized use. In some cases it is necessary to know who modified or deleted a file or folder and when.
Microsoft Windows allows you to monitor several event types for security purposes.
This article describes how to set up a files audit on a Windows 2008 R2 server and how to obtain Audit log data from the Event Viewer.
Steps ::: Set the audit tracking: Enable Audit process tracking for Success and Failure results:
- Open Start -> Run - Type secpol.msc and hit Enter - Navigate to Security Setting -> Local Policies -> Audit Policy - Edit Audit process tracking key and enable both Success and Failure events auditing
Resulting settings should look similar to this picture: Propagate policy changes:
- Open Start -> Run - Type in gpupdate /force and hit Enter. Set up auditing on required files and folders for needed event types:
- Open Windows Explorer and navigate to the file (folder) in question.
- Right-click the file and select Properties
- On the tab Security, click on Advanced button
- Switch to the Auditing tab and hit the Edit button
- Click Add to choose users and groups for monitoring. The common practice is to add Authenticated Users group.
- Select checkboxes on required events for both Success and Failure in Auditing Entry . For an explicit audit, select all checkboxes.
Resulting settings should look similar to this picture: Now all access attempts will be tracked in the Security log of Event Viewer. ::: See the audit log in Event Viewer: Open the Event viewer
- Open Start -> Run
- Type eventvwr and hit Enter Select the Security section. On the right-side, click on Search, and type the filename that should be audit. In this example: FileToTrackAccess.txt At the Details of the found Audit registry, look for the Logon ID, and remember it. Again on the right-side, click on Search, and type the Logon ID we're looking for. The IP address will be shown on the Details. ::: Export the audit log in HTML: Export Security log from Event Viewer :
- Open Start -> Run. - Type in the below line and hit Enter: CONFIG_TEXT: wmic ntevent where log='Security' get LogFile,SourceName,EventType,Message,TimeGenerated /format:htable > C:\\SecurityLog.htm Open the resulting HTML file in your web browser (located at C:\SecurityLog.htm)
- Open context search with Ctrl+F.
- Search for the required file name to find out what access attempts have been made. For example: we found that FileToTrackAccess.txt was opened with notepad.exe: Once found, remember the Logon ID to find the IP address from where the user was logged in. Find the corresponding login event in the HTML file using the Logon ID from the previous step: As seen in the picture, notepad.exe edits were performed by the user Administrator (who logged on remotely from IP 192.0.2.2) .
Note: This procedure may not work as expected if the server is the member of an Active Directory domain with group policies assigned. Consult with your network administrator if needed to clarify this aspect. Additional information
The above steps represent one of many possible ways to audit access to files and folders on your server. It is suggested that you provide this information to your company's Security Administrator to perform the task more efficiently.
Additional sources: http://www.ultimatewindowssecurity.com/wiki/WindowsSecuritySettings/Recommended-Baseline-Audit-Policy-for-Windows-Server-2008 http://www.computerperformance.co.uk/w2k3/gp/group\_policy\_security\_audit.htm http://oreilly.com/pub/a/windows/2005/07/26/audit\_policy.html http://technet.microsoft.com/en-us/library/dd277403.aspx "
3,"Migration error: The managed runtime version 2.0 is not available on the destination server
Applicable to: Plesk for Windows Symptoms
The following warning appears during transfer from one Plesk to another:
PLESK_WARN: The managed runtime version 2.0 is not available on the destination server
Or:
PLESK_WARN: Failed to synchronize subscription with plan Migration tools tried to perform operation in 3 attempts: Plesk error [1023]: managed_runtime_version - Description: . Requested: 2.0. Allowed: 4.0
Cause
ASP.NET 2.0 is not installed on the destination server.
Resolution
For Windows Server 2008 Connect to the server via RDP. Download from Microsoft site:
https://www.microsoft.com/en-us/download/details.aspx?id=6523 Install package manually. For Windows Server 2008 R2 and higher
Since .NET 2.0 and 3.0 are included into .NET 3.5 package, it is required to install .NET 3.5 on the destination server. Refer to the below article for details: How to enable ASP.NET 3.5 on Plesk for Windows Server 2012 and 2016"
8,"Messages from Plesk mail server are not received: Could not find a valid SPF record
Applicable to: Plesk for Linux Symptoms Messages from Plesk mail server are not received.
Error in /usr/local/psa/var/log/maillog :
CONFIG_TEXT: /usr/lib64/plesk-9.0/psa-pc-remote[16671]: Unable to get sender domain by sender mailname spf filter[18496]: Error code: (2) Could not find a valid SPF record spf filter[18496]: Failed to query MAIL-FROM: No DNS data for 'mta.example.com'. Cause
SPF is not configured.
Resolution Log in to Plesk Configure SPF record for the sender domain. If the sender domain is hosted on Plesk, go to Domains > example.com > DNS Settings and add a TXT record:
CONFIG_TEXT: example.com TXT ""v=spf1 a:example.com mx -all"" Go to Tools & Settings > Server-Wide Mail Settings, switch on SPF protection and configure it:
CONFIG_TEXT: SPF guess rules: v=spf1 a/24 mx/24 ptr "
5,"Plesk Pre-Upgrade Checker: A tool to identify business logic issues before upgrade or migrationRelease Notes It is no longer required to download this script manually, it will be automatically downloaded and executed before an upgrade. If it is required to run this script manually, download and run it as it is described in the ""HOW TO USE"" chapter. Description
The script allows you to check the environment before an upgrade or a migration. It checks for business logic issues and works for both the Linux and the Windows platforms. This tool could be launched prior to an upgrade in order to obtain a report on potential problems with the upgrade. Based on the report, a host can decide whether an upgrade is suitable for their situation.
How to use
Connect to the server via SSH/RDP.
Note: Enclose the <plesk-db-admin-password> in quotes (e.g. ""plesk-db-admin-password"") to properly parse any special characters in the password. Linux : Download the script:
# wget https://autoinstall.plesk.com/<Plesk_version>/examiners/panel_preupgrade_checker.php
where <Plesk_version> is the desired version of Plesk you are willing to upgrade to.
For example, to check upgrade to Plesk Onyx 17.5, the link will be http://autoinstall.plesk.com/PSA_17.5.3/examiners/panel_preupgrade_checker.php For Plesk Obsidian retrieve the links to script with the following command:
# curl -s http://autoinstall.plesk.com/pool/ | sed -E 's/.*href\=\""(.*)\/\"".*/https\:\/\/autoinstall.plesk.com\/pool\/\1\/examiners\/panel_preupgrade_checker.php/g' |grep PSA | sort -r Run it like below:
# php -d safe_mode=Off panel_preupgrade_checker.php <plesk-db-admin-password>
Note: Pre-upgrade checker for Plesk 17.8 is not fully compatible with CentOS/RHEL 6 as by default PHP 5.3 is used. As a workaround execute Pre-Upgrade checker specifying the PHP version manually:
# /opt/plesk/php/5.6/bin/php -d safe_mode=Off panel_preupgrade_checker.php `cat /etc/psa/.psa.shadow` Windows : Download the script from http://autoinstall-win.plesk.com/ selecting the desired Plesk version you are willing to upgrade to.
For example, to check the upgrade to Plesk Onyx 17.5, the link will be http://autoinstall-win.plesk.com/PANEL-WIN_17.5.3/panel_preupgrade_checker.php_ Run it like below:
C:\> ""%plesk_bin%\php.exe"" -d safe_mode=Off panel_preupgrade_checker.php_ <plesk-db-admin-password> Report Content Clarification
At the beginning of the report, it shows a general overview of the changes that a host should expect from the upgrade.
Also, the report gives an overview of potential problems you may encounter during a transition to the new Plesk version with the corresponding Knowledge Base articles."
8," Domain or mail account creation error: mailmng-outgoing failed
Applicable to: Plesk for Linux Symptoms
One of the following symptoms may apply: Mail tab is missing for a domain and mail service cannot be enabled:
# plesk bin subscription -u example.com -mail_service true ERR [util_exec] proc_close() failed ['/usr/local/psa/admin/bin/mailmng-outgoing' '--add-subscription' '--main-domain-name=example.com' '--out-limit=100'] with exit code [1] mailmng-outgoing failed: ERROR:outgoing:column name is not unique Unable to create a domain or a mail account under a subscription:
PLESK_ERROR: Error: mailmng-outgoing failed: ERROR:outgoing:domains.subscription_id may not be NULL Error: mailmng-outgoing failed: ERROR:outgoing:mails.domain_id may not be NULL Error: mailmng-outgoing failed: ERROR:outgoing:NOT NULL constraint failed: mails.domain_id Unable to connect with a mail client such as Outlook, thunderbird. The authorization fails with the following error shown in /var/log/maillog:
CONFIG_TEXT: authpsa[260371]: No such user 'johndoe@example.com' in mail authorization database Mail restore fails:
# plesk repair mail example.com .... Restoring outgoing limits for johndoe@example.com NOT NULL constraint failed: mails.domain_id # plesk repair mail example.com .... Restoring outgoing limits for info@example.com mails.domain_id may not be NULL # plesk repair mail example.com ... Fatal error: plesk::SystemError(You should specify at least one non-empty ip adress: No such file or directory) The record for ipAddressId is missing in IpAddressesCollections table:
# MYSQL_PWD=`cat /etc/psa/.psa.shadow` mysql -u admin psa -Nse ""SELECT d.name FROM domains d JOIN DomainServices ds on d.id=ds.dom_id LEFT JOIN IpAddressesCollections ipc on (ds.ipCollectionId = ipc.ipCollectionId ) WHERE ds.type='mail' AND ipc.ipCollectionId is NULL"" Passwords for mailboxes may be changed frequently for unknown reason Cause
Plesk database inconsistency: missing entries in psa.IpAddressesCollections table for the corresponding domain.
Resolution
Note: if you don't have root-level SSH access to Plesk server, contact your hosting company to resolve the issue. Log in to the server via SSH.
Back up Plesk database Generate list of domains affected by the issue:
# MYSQL_PWD=`cat /etc/psa/.psa.shadow` mysql -u admin psa -Nse ""SELECT d.name FROM domains d JOIN DomainServices ds on d.id=ds.dom_id LEFT JOIN IpAddressesCollections ipc on (ds.ipCollectionId = ipc.ipCollectionId ) WHERE ds.type='mail' AND ipc.ipCollectionId is NULL"" > /root/affected_domains.txt Download, extract and assign the correct permissions to the script:
# wget https://plesk.zendesk.com/hc/article_attachments/360008434854/kb213371469.zip
# unzip kb213371469.zip
# chmod +x kb213371469.sh Execute the script to restore missing entries in psa.IpAddressesCollections table:
# ./kb213371469.sh /root/affected_domains.txt Check and repair inconsistencies with plesk repair utility if any:
# plesk repair db Fix mail configuration:
# plesk repair mail -y "
6,"Cannot enter webmail on Plesk server: Login database error
Applicable to: Plesk for Linux Symptoms Cannot enter webmail:
CONFIG_TEXT: Login database error The /var/log/sw-cp-server/error_log file contains the following error:
CONFIG_TEXT: Error message or request description : Nov 12 13:57:54 mail authpsa[23054]: No such user '@' in mail authorization database Nov 12 13:57:54 mail courier-imapd: LOGIN FAILED, user=@, ip=[::ffff:127.0.0.1] The /var/log/plesk/panel.log file contains the following error:
CONFIG_TEXT: ""stderr: mailmng[10610]: Failed to read entire encryption key from '/var/spool/postfix/plesk/passwd_db_key': Success (0) mailmng[10610]: Failed to initialize encryption cipher 'AES-256-CBC:PKCS' with key '/var/spool/postfix/plesk/passwd_db_key' mailmng[10610]: Failed to initialize password cipher context (for mail address 'info@example.com') mailmng[10610]: Unable to set password for mailname info@example.com"" Cause
Mail server authentication database key is damaged.
Resolution
Recreate the corrupted file: Connect to the server via SSH.
Note: if direct SSH access to the server is not possible, contact server administrator for further assistance. Run the following command: For CentOS based OS:
# /usr/lib64/plesk-9.0/remote_mail_restore/mail_auth_dump For Debian based OS:
# /usr/lib/plesk-9.0/remote_mail_restore/mail_auth_dump "
2,"Domain/subdomain creation or SSL certificate upload fails: websrvmng failed: A specified logon session does not exist
Applicable to: Plesk 11.x for Windows
Plesk 12.0 for Windows
Plesk 12.5 for Windows
Plesk Onyx 17.5 for Windows Symptoms An attempt to create a domain or subdomain on a subscription produces this error:
PLESK_ERROR: Error: WebServerManager::addVhost() failed: websrvmng failed: A specified logon session does not exist. It may already have been terminated. (Exception from HRESULT: 0x80070520) In Microsoft.Web.Administration module Exception type: System.Runtime.InteropServices.COMException at Microsoft.Web.Administration.Interop.IAppHostMethodInstance.Execute() at Microsoft.Web.Administration.Binding.AddSslCertificate(Byte[] certificateHash, String certificateStoreName) at Microsoft.Web.Administration.BindingManager.BindingTransaction.Commit() at Microsoft.Web.Administration.BindingManager.Save() at Microsoft.Web.Administration.ServerManager.CommitChanges() at ServerManagerFactory.commit() at IIS7ServerManager.commit(IIS7ServerManager* ) The same error may be reported on an attempt to secure a website with an SSL certificate; Trying to upload a certificate provided by GoDaddy in Domains > example.com > SSL/TLS Certificates > Add SSL/TLS Certificate using .p7b file as CA certificate, the similar error occurs:
PLESK_ERROR: Error: Unable to set the CA certificate: Unable to put certificate file: Unable to update certificate in Web Server: websrvmng failed: A specified logon session does not exist. It may already have been terminated. (Exception from HRESULT: 0x80070520) In Microsoft.Web.Administration module Exception type: System.Runtime.InteropServices.COMException .......... at reconfigureVHosts()(WebServerManager::reconfigureVHosts line 334) at execute console command --reconfigure-vhosts(vconsoleapp::start line 122) at execute ""C:\Program Files (x86)\Plesk\admin\bin64\websrvmng"" --reconfigure-vhosts ""--config=tmp2B47.tmp""(vconsoleapp::run line 139) (Error code 1) Cause The issue may be caused by the wrong SSL certificate being applied to the website, i.e. by the SSL certificate and CA certificate parts being the same, or the old CA certificate may be empty. When an SSL certificate is not enabled on a domain in IIS, but SSL is enabled in Plesk. Resolution Log in to Plesk. Go to Plesk > Domains > example.com > Websites & Domains > Hosting Settings and make sure that SSL is enabled. Connect to the server via RDP. Check that the certificate is assigned to the domain in IIS > Sites > example.com > Bindings... : On the SSL certificate properties screen ( Websites & Domains tab > example.com > SSL/TLS Certificates > Certificate name ), verify that the CA Certificate section does not contain the same content as the certificate section above it.
If the sections match, remove the CA certificate part from the SSL certificate by clicking the the Remove button in the CA Certificate section. If the issue persists, remove all the outdated certificates from Plesk > Tools & Settings > SSL Certificates. If the certificate affected is domain's one, remove it from Websites & Domains tab > example.com > SSL/TLS Certificates. "
0,"How to test network connection performance between two Linux servers
Applicable to: Plesk for Linux Information
In some cases, it is necessary to check network connection performance between two Linux-based hosts, for example, to validate traffic shaping settings.
The simplest way to do this is to use netcat.
On server machine:
# nc -l 1122 > /dev/null
On client machine:
# dd if=/dev/zero bs=9100004096 count=1 | nc <SERVER_MACHINE_IP> 1122
As a result, a similar message will be displayed:
CONFIG_TEXT: 2147479552 bytes (2.1 GB) copied, 46.8923 s, 45.8 MB/s
Note: It is necessary to set count=1 because after the first portion, netcat will quit."
2,"Internal error: Failed to parse metadata, File aps_php.php
Applicable to: Plesk for Linux
Plesk for Windows Symptoms The Plesk > Domains page cannot be opened due to the following error:
PLESK_ERROR: Internal error: Failed to parse metadata Message Failed to parse metadata File aps_php.php Line 12559 Type Exception The same error appears in an attempt to create/remove a customer/subscription. APS package settings cannot be checked:
# /usr/local/psa/bin/aps --get-packages-global-settings Failed to parse metadata
OR
# /usr/local/psa/bin/aps --get-packages-global-settings PHP Warning : aps_registry_packageconfiguration_getglobalsettings(): Entity: line 7: parser error : Char 0x0 out of allowed range; File: /usr/share/aps_php/aps_php.php, Line: 10024 PHP Warning : aps_registry_packageconfiguration_getglobalsettings(): ; File: /usr/share/aps_php/aps_php.php, Line: 10024 ... Failed to parse metadata It is not possible to install an application. Unable to clear cache at Tools & Settings > Application Vault > Clear Cache on Plesk:
PLESK_ERROR: Internal error: Cannot find package cache directory: '/usr/local/psa/var/apspackages/apscatalog7R2ZJ5.zipb17fa7a9-c64e-c0' Message Cannot find package cache directory: '/usr/local/psa/var/apspackages/apscatalog7R2ZJ5.zipb17fa7a9-c64e-c0' File Content.php Line 73 Type CommonPanel_Aps_Cache_Exception When creating a server backup, the following error message appears in the backup task sumary:
PLESK_INFO: Warning: server ""server"" Unable to get Global settings for APS Applications (ErrorCode: 3, STDOUT:). The /opt/psa/var/apspackages or /usr/local/psa/var/apspackages was accidentally cleared. Cause
The metafile_uri directory (from the apsc.aps_package table) is missing on the server or the APP-META.xml file is corrupted.
Resolution
If the apspackages folder was accidentally cleared, the best way is restoring it from the full server backup.
If it does not contain all applications, follow steps below as well as for other cases. For Windows Connect to the server via RDP. Download the attached script restore-cache.ps1. Right-click on it and select Run in Powershell. For Linux Connect to the server via SSH. Download this script:
# wget https://support.plesk.com/hc/en-us/article_attachments/360010105354/restore-cache Set .sh extension and make it executable:
# mv restore-cache restore-cache.sh; chmod +x restore-cache.sh Run the script:
# ./restore-cache.sh If the issue persists after 10 minutes, do the following: Clear the Apps cache: Tools & Settings > Application Vault > Clear Cache Create the reported directory if unable to clear cache and retry:
# mkdir /usr/local/psa/var/apspackages/apscatalog7R2ZJ5.zipb17fa7a9-c64e-c0 # chown -R psaadm:psaadm /usr/local/psa/var/apspackages/apscatalog7R2ZJ5.zipb17fa7a9-c64e-c0 Make sure that SQL query debug is disabled in config file /usr/local/psa/admin/conf/panel.ini.
The script does not work with enabled debug. Login to the MySQL server:
# MYSQL_PWD=`cat /etc/psa/.psa.shadow` mysql -u admin apsc Determine metafile_uri path by using the following sql query:
MYSQL_LIN: mysql> select `id`, `name`, `version`, `release`, `metafile_uri` from apsc.aps_package; +-----+-----------+---------+---------+----------------------------------------------------------------------------------+ | id | name | version | release | metafile_uri | +-----+-----------+---------+---------+----------------------------------------------------------------------------------+ | 66 | WordPress | 2.3.3 | 5 | /usr/local/psa/var/apspackages/556229a0-5008-41b5-83d1-3c0b32649196/APP-META.xml | | 77 | WordPress | 3.3.1 | 4 | /usr/local/psa/var/apspackages/2abd12d2-7017-46ee-a80b-ed42599f7c0a/APP-META.xml | | 106 | WordPress | 3.5.2 | 2 | /usr/local/psa/var/apspackages/c22666c4-b469-4eb2-a0e7-7c6f3f4f11eb/APP-META.xml | +-----+-----------+---------+---------+----------------------------------------------------------------------------------+ 3 rows in set (0.00 sec) Make sure that the metafile_uri directories exist on the server.
Directories should exist as below:
# ls -la /usr/local/psa/var/apspackages/c22666c4-b469-4eb2-a0e7-7c6f3f4f11eb/APP-META.xml -rw-r--r-- 1 psaadm psaadm 50828 Mar 12 21:23 /usr/local/psa/var/apspackages/c22666c4-b469-4eb2-a0e7-7c6f3f4f11eb/APP-META.xml # ls -la /usr/local/psa/var/apspackages/556229a0-5008-41b5-83d1-3c0b32649196/APP-META.xml -rw-r--r-- 1 psaadm psaadm 21506 Mar 12 21:23 /usr/local/psa/var/apspackages/556229a0-5008-41b5-83d1-3c0b32649196/APP-META.xml # ls -la /usr/local/psa/var/apspackages/2abd12d2-7017-46ee-a80b-ed42599f7c0a/APP-META.xml -rw-r--r-- 1 psaadm psaadm 21706 Mar 12 21:23 /usr/local/psa/var/apspackages/2abd12d2-7017-46ee-a80b-ed42599f7c0a/APP-META.xml Make sure that all the APP-META.xml files are readable:
# head /usr/local/psa/var/apspackages/a1a41e6f-f5ae-4f80-8e30-788a0a418196/APP-META.xml <application packaged=""2014-12-19T14:05:21"" version=""1.2"" xmlns=""http://apstandard.com/ns/1""> <id>http://wordpress.org/</id> <name>WordPress</name> <version>4.1</version> <release>74</release> <homepage>http://wordpress.org/</homepage> <vendor> <name>WordPress.org</name> <homepage>http://wordpress.org/</homepage> If it is not readable or binary, remove and recreate the package folder as listed below. If the metafile_uri directory is missing, create it:
# mkdir /usr/local/psa/var/apspackages/c22666c4-b469-4eb2-a0e7-7c6f3f4f11eb # mkdir /usr/local/psa/var/apspackages/556229a0-5008-41b5-83d1-3c0b32649196 # mkdir /usr/local/psa/var/apspackages/2abd12d2-7017-46ee-a80b-ed42599f7c0a Download APS packages with the corresponding name and version from dev.apsstandard.org to the directories created in the previous step. If your WordPress version is not present on the above mentioned page, visit apscatalog.com .
Upon downloading via browser nginx 403 Forbidden error can occur. In that case copy generated link to the archive from the browser and download it using wget tool, e.g.:
# wget https://apscatalog.com/storage/wordpress.org/WordPress/2.7.1-2/parallels.com/undefined/undefined/undefined/WordPress-2.7.1-2.app.zip Extract the zip file in the same directory, for example:
# ls -la /usr/local/psa/var/apspackages/2abd12d2-7017-46ee-a80b-ed42599f7c0a/ drwxr-xr-x 5 psaadm psaadm 4096 Jan 17 2013 ./ drwxr-xr-x 15 psaadm psaadm 4096 Sep 5 04:34 ../ -rw-r--r-- 1 psaadm psaadm 13434 Jan 17 2013 APP-META.xml drwxr-xr-x 2 psaadm psaadm 4096 Jan 17 2013 htdocs/ drwxr-xr-x 2 psaadm psaadm 4096 Jan 17 2013 images/ drwxr-xr-x 2 psaadm psaadm 4096 Jan 17 2013 scripts/ Change permissions to psaadm:psaadm on the package folder recursively:
# chown -R psaadm:psaadm /usr/local/psa/var/apspackages/2abd12d2-7017-46ee-a80b-ed42599f7c0a/ "
3,"High CPU and memory usage by Apache or PHP processes in Plesk Applicable to: Plesk Onyx for Linux Symptoms High CPU and memory usage by Apache process is reported by top command:
# top 2043 example 20 0 0 0 0 S 100.0 70.5 0:05.43 httpd High CPU usage by PHP-FPM process is reported by top command: # top PID USER PR NI VIRT RES SHR S %CPU %MEM TIME+ COMMAND ... 2089 example 20 0 0 0 0 S 96.8 60.5 0:02.43 php-fpm Cause
Apache module is used to serve PHP. It is the slowest engine available.
Resolution
Log into Plesk and apply a solution according to handler type in Domains > example.com > PHP Settings if mod_php or FastCGI is used Switch websites' PHP engine to FastCGI application served by Apache or to FPM application served by Apache (better option) via the tab Domains > example.com > Hosting Settings: if ""FPM Application server by Apache"" is used Warning: Nginx does not support .htaccess rules. Code of some websites may not support FastCGI or PHP-FPM, so it is recommended to consult with website developer before switching the handler.
1. Enable nginx web server 2. Switch to PHP 7.0 or newer at Domains > example.com > PHP Settings
3. Enable to Nginx for affected domain: open Subscriptions > example.com > Apache & nginx Settings, check option Proxy mode and press OK:
Note: on servers with high load, switch to Event mode at Tools & Settings > Apache Web server > MPM Mode "
10,"There is no Launch Presence Builder button
Applicable to: Plesk for Linux
Plesk for Windows
Web Presence Builder Symptoms It is not possible to create a Presence Builder site, as the Launch Presence Builder icon is missing.
There is no Launch Presence Builder icon, even for a domain that has a quick Presence Builder Edit Website button. There is a customizations.conf file that disables the Presence Builder section:
# grep sitebuilder /usr/local/psa/admin/conf/customizations.conf {""ini"":{""aps"":{""serverAppsPromoEnabled"":false},""promos"":{""enabled"":false,""cloudFlare"":{""active"":true},""commTouch"":{""active"":true},""googleIntegration"":{""active"":true},""helpDesk"":{""active"":true},""mobile"":{""active"":true},""sitebuilderTrial"":{""active"":true},""techDomain"":{""active"":true}},""google"":{""tools"":{""enabled"":false}},""sitebuilder"":{""enabled"":false},""marketplace"":{""panelAndAddonsLicensesAvailable"":false,""panelAndAddonsLicensesStore"":""""},""feedback"":{""kbServerUrl"":""""}},""db"":{""misc"":{""show_commercial_apps"":false,""disable_mail_ui"":true,""domain_registration"":false,""domain_registration_url"":"""",""domain_management_url"":"""",""cert_purchasing"":false,""cert_purchasing_url"":"""",""extras"":false,""mpc_portal_url"":"""",""hide_support_link"":false,""support_url"":""""}},""serverSettingsVersion"":""plesk-1""} Cause
The file contains ""sitebuilder"":{""enabled"":false} directive. This means the Presence Builder button is disabled for domains.
Resolution
It is required to modify /usr/local/psa/admin/conf/customizations.conf and add or modify entry like below:
""sitebuilder"":{""enabled"":true} Note: for Windows based Plesk installations the file path is %plesk_dir%\\admin\\conf\\customizations.conf .
After that, the ""Presence Builder"" icon will be accessible.
Additional Information
In case this article helps, then note that such restrictions was applied from the license key used on the server. In order to clarify the purpose of such restrictions, get in contact with your service provider."
6,"Unable to access myLittleAdmin in Plesk: myLittleAdmin Silent Logon Error
Applicable to: Plesk for Windows Symptoms
When clicking myLittleAdmin icon for MSSQL database on example.com subscription in Plesk, one of the following errors appears:
PLESK_ERROR: ERROR: Zend_Controller_Exception: Permission denied.#0 C:\Program Files (x86)\Parallels\Plesk\admin\externals\Zend\Controller\Plugin\Broker.php(309): Plesk\Application\Controller\Plugin\ForgeryProtection->preDispatch(Object(Zend_Controller_Request_Http)) #1 C:\Program Files (x86)\Parallels\Plesk\admin\externals\Zend\Controller\Front.php(941): Zend_Controller_Plugin_Broker->preDispatch(Object(Zend_Controller_Request_Http)) #2 C:\Program Files (x86)\Parallels\Plesk\admin\plib\Application\Web.php(39): Zend_Controller_Front->dispatch(NULL) #3 C:\Program Files (x86)\Parallels\Plesk\admin\htdocs\application.php(15): Plesk\Application_Web->run() #4 {main} Message Permission denied.#0 C:\Program Files (x86)\Parallels\Plesk\admin\externals\Zend\Controller\Plugin\Broker.php(309): Plesk\Application\Controller\Plugin\ForgeryProtection->preDispatch(Object(Zend_Controller_Request_Http)) #1 C:\Program Files (x86)\Parallels\Plesk\admin\externals\Zend\Controller\Front.php(941): Zend_Controller_Plugin_Broker->preDispatch(Object(Zend_Controller_Request_Http)) #2 C:\Program Files (x86)\Parallels\Plesk\admin\plib\Application\Web.php(39): Zend_Controller_Front->dispatch(NULL) #3 C:\Program Files (x86)\Parallels\Plesk\admin\htdocs\application.php(15): Plesk\Application_Web->run() #4 {main} File Broker.php Line 312 Type Zend_Controller_Exception
or
PLESK_INFO: myLittleAdmin Silent Logon Error Login failed for user 'USER_NAME'
or
PLESK_INFO: [DBNETLIB][ConnectionOpen (Connect()).]SQL Server does not exist or access denied. Provider=sqloledb;Data Source=.\\MSSQLSERVER2012;User Id=userdb;Password=*****;
or
PLESK_INFO: Connection timeout
or
PLESK_INFO: MyLittleAdmin commercial license key is installed
or
PLESK_INFO: This page can't be displayed. Make sure the web address is correct. Look for the page with your search engine.
or
PLESK_INFO: HTTP Error 404. The requested resource is not found
or
PLESK_INFO: Server Error 404 - File or directory not found
or
PLESK_INFO: myLittleAdmin Silent Logon Error A network-related or instance-specific error occurred while establishing a connection to SQL Server. The server was not found or was not accessible. Verify that the instance name is correct and that SQL Server is configured to allow remote connections. (provider: SQL Network Interfaces, error: 26 - Error Locating Server/Instance Specified)
Cause Domain names mssql.example.com and example.com are not resolved to current Plesk server. MyLittleAdmin is not licensed for additional servers. Resolution Make sure domain example.com resolves properly . Otherwise, contact domain registrar and check the DNS settings.
Note: DNS propagation may take up to 24-48 hours. Check if the following 'A' records are present in domain's dns zone at: Domains > example.com > Website & domains > DNS settings CONFIG_TEXT: mssql.example.com A 203.0.113.2 example.com A 203.0.113.2 Make sure that MyLittleAdmin is licensed for additional SQL Server instances.
Note: The default license installed along with Plesk, is the ""Free Lite Version"". If a different version is installed, the license can be checked directly with MyLittleAdmin support: Technical support Add the following record to the Windows hosts file for a particular machine if required:
CONFIG_TEXT: 203.0.113.2 mssql.example.com "
6,"MySQL crashes with error: Fatal error: cannot allocate memory for the buffer pool
Applicable to: Plesk for Linux Symptoms Plesk is not accessible: CONFIG_TEXT: Error 2002. ERROR: PleskDBException: Unable to connect to database: mysql_connect(): Connection refused /var/run/mysqld/mysqld.sock (Error code: 2002) MySQL crashes intermittently. There is an error in /var/log/mysqld.log file:
CONFIG_TEXT: InnoDB: Initializing buffer pool, size = 128.0M InnoDB: mmap(137363456 bytes) failed; errno 12 InnoDB: Completed initialization of buffer pool InnoDB: Fatal error: cannot allocate memory for the buffer pool [ERROR] Plugin 'InnoDB' init function returned error. [ERROR] Plugin 'InnoDB' registration as a STORAGE ENGINE failed. [ERROR] Unknown/unsupported storage engine: InnoDB [ERROR] Aborting Cause
MySQL buffer size is bigger than free RAM available on the server.
Resolution
Contact system administrator to allocate more RAM to the server.
As a temporary workaround: Connect to the server using SSH.
Check how much free RAM there is on the server:
# free -hm total used free shared buffers cached Mem: 1.0G 122M 901M 92K 0B 61M -/+ buffers/cache: 61M 962M Swap: 1.0G 0B 1.0G Set MySQL buffer pool size in /etc/my.cnf less than amount of free RAM:
CONFIG_TEXT: innodb_buffer_pool_size=100M Restart MySQL service:
# service mysqld restart || service mysql restart || service mariadb restart "
6,"How to create MSSQL database backup in Plesk
Applicable to: Plesk for Windows Question
How to create MS SQL database backup manually?
Answer
There are several ways to create MSSQL database backup.
Using Plesk UI: Note: 1. In Plesk it is not possible to make a backup of database without copying user files. 2. MySQL databases will be included in the backup as well. Log into Plesk.
Go to Domains > example.com > Backup Manager Click on Back Up button
Check User files and databases option and click Ok Using Microsoft tools SQL Management Studio:
Create a .sql database script as described in the Microsoft knowledge base article. "
3," After switching a WordPress website to FPM served by nginx in Plesk, it fails to load with ""404 Not Found"" on all pages except start page
Applicable to: Plesk Onyx for Linux
Plesk for Linux Symptoms After setting PHP for a WordPress (or probably another CMS) website as FPM application served by nginx in Plesk at Domains > example.com > PHP Settings, only start page is loading in a web-browser. Other pages show ""404 Not Found"" error.
Wordpress permalinks are enabled Domains > example.com > Apache & nginx Settings > Proxy mode is disabled. Cause
When PHP is running as FPM application served by nginx, Apache is not involved into website processing. As a result, the .htaccess file (used by WordPress to rewrite page URLs) is processed by nginx, which does not support rules defined in .htaccess.
Resolution
Note: This guide is intended for Plesk administrators. If you are a domain owner, please contact your service provider for assistance with configuration of nginx directives. Apply one of the following solutions: For a single website In Plesk, add the content below to the Additional nginx directives field of the WordPress domain at Domains > example.com > Apache & nginx Settings:
CONFIG_TEXT: if (!-e $request_filename) { set $test P; } if ($uri !~ ^/(plesk-stat|webstat|webstat-ssl|ftpstat|anon_ftpstat|awstats-icon|internal-nginx-static-location)) { set $test ""${test}C""; } if ($test = PC) { rewrite ^/(.*)$ /index.php?$1; } If a WordPress installation is located in a subdirectory (for example, ""httpdocs/sub-dir"") or this is a WordPress multisite network based on subdirectories, add the /sub-dir/ before /index.php?$1 so it will look like this:
CONFIG_TEXT: rewrite ^/(.*)$ /sub-dir/index.php?$1;
Note: For WordPress multisite network based on subfolder, add the above rule for each subdirectory. For all newly created websites (Web Pro & Web Host license editions) If you are in Power User view, switch to Service Provider view at Tools & Settings > Interface Management. Add the rewrite rules below to the Additional nginx directives field at Service Plans > service_plan > Web Server tab:
CONFIG_TEXT: if (!-e $request_filename) { set $test P; } if ($uri !~ ^/(plesk-stat|webstat|webstat-ssl|ftpstat|anon_ftpstat|awstats-icon|internal-nginx-static-location)) { set $test ""${test}C""; } if ($test = PC) { rewrite ^/(.*)$ /index.php?$1; } Click Update & Sync to apply the changes.
Note: Additional nginx directives will be applied only to newly created websites under this server plan. For all existing and newly created websites in Plesk Onyx & Obsidian Connect to the Plesk server via SSH. Create a directory for custom templates and copy default configuration templates there:
# mkdir -p /usr/local/psa/admin/conf/templates/custom/domain # cp /usr/local/psa/admin/conf/templates/default/domain/nginxDomainVirtualHost.php /usr/local/psa/admin/conf/templates/custom/domain/nginxDomainVirtualHost.php
Note: Any changes made in original configuration templates will be lost after an installation of Plesk micro-updates. Open the file /usr/local/psa/admin/conf/templates/custom/domain/nginxDomainVirtualHost.php in any text editor (for example, with the ""vi"" text editor) and replace the section: on Plesk Onyx 17.0:
CONFIG_TEXT: location ~ /$ { <?php echo $VAR->domain->physicalHosting->proxySettings['directoryIndex'] ?> } on Plesk Onyx 17.5, 17.8:
CONFIG_TEXT: <?php if ($VAR->domain->physicalHosting->directoryIndex): ?> location ~ /$ { index <?=$VAR->quote($VAR->domain->physicalHosting->directoryIndex)?>; } <?php endif ?> on Plesk Obsidian:
CONFIG_TEXT: <?php if ($VAR->domain->physicalHosting->directoryIndex && !$VAR->domain->physicalHosting->proxySettings['nginxProxyMode']): ?> location ~ /$ { index <?=$VAR->quote($VAR->domain->physicalHosting->directoryIndex)?>; } <?php endif ?> with the following:
CONFIG_TEXT: location ~ / { index index.php index.cgi index.pl index.html index.xhtml index.htm index.shtml; try_files $uri $uri/ /index.php$is_args$args; } Regenerate web-server configuration files:
# plesk repair web For all existing and newly created websites in Plesk 12.5 and earlier Connect to the Plesk server via SSH. Create a directory for custom templates and copy default configuration templates there:
# mkdir -p /usr/local/psa/admin/conf/templates/custom/domain/service # cp /usr/local/psa/admin/conf/templates/default/domain/nginxDomainVirtualHost.php /usr/local/psa/admin/conf/templates/custom/domain/nginxDomainVirtualHost.php # cp /usr/local/psa/admin/conf/templates/default/domain/service/nginxWordpressIndexing.php /usr/local/psa/admin/conf/templates/custom/domain/service/nginxWordpressIndexing.php
Note: Any changes made in default configuration templates will be lost after installation of Plesk microupdates. Open the file /usr/local/psa/admin/conf/templates/custom/domain/nginxDomainVirtualHost.php in any text editor (for example, with the ""vi"" text editor) and replace the section:
CONFIG_TEXT: location ~ /$ { <?php echo $VAR->domain->physicalHosting->proxySettings['directoryIndex'] ?> }
with:
CONFIG_TEXT: location ~ / { index index.php index.cgi index.pl index.html index.xhtml index.htm index.shtml; try_files $uri $uri/ /index.php$is_args$args; } Then, open the file /usr/local/psa/admin/conf/templates/custom/domain/service/nginxWordpressIndexing.php and replace:
CONFIG_TEXT: location ~* ""^<?php echo $OPT['ssl'] ? $wordpress->httpsLocation : $wordpress->httpLocation; ?>"" {
with:
CONFIG_TEXT: location ~* ^/<?php echo $wordpress->location; ?> { Regenerate web-server configuration files:
# plesk repair web "
2,"Plesk shows 502 Bad Gateway error and service sw-engine is marked as stopped
Applicable to: Plesk for Linux Symptoms Plesk shows 502 Bad Gateway error; The service sw-engine is not running:
# service sw-engine status ● sw-engine.service - Startup script for Panel sw-engine Loaded: loaded (/usr/lib/systemd/system/sw-engine.service; enabled; vendor preset: disabled) Active: inactive (dead) since Mon 2018-03-26 21:57:49 +07; 5min ago Cause
sw-engine service is stopped. This may occur if upgrade attempt was unsuccessful or it was stopped manually.
Resolution
For Plesk Onyx 17.8 Click Open Repair Kit and log in with Plesk admin credentials. If it was successful, try starting sw-engine service by clicking Restart Processes If it was successfully started, click Log In to Plesk button For other Plesk versions Connect to the server via SSH. Start sw-engine service:
# service sw-engine start
Or start psa service:
# service psa start Additional info
[HUB] 502 Bad Gateway"
6,"Fail2ban jails not activated on Plesk server: NOK: ('database disk image is malformed')
Applicable to: Plesk for Linux Symptoms Activation of fail2ban jails / Re-reading IP addresses / Adding IP address to trusted fails with the following error in Plesk:
PLESK_ERROR: ERROR NOK: ('database disk image is malformed',) ERROR NOK: ('columns jail, path, firstlinemd5 are not unique',) ERROR NOK: ('database or disk is full',) ERROR:f2bmng:Command '['/usr/bin/fail2ban-client', 'reload', 'plesk-wordpress']' returned non-zero exit status 255 ERROR:f2bmng:Failed to reload following jails due to errors in configuration: plesk-wordpress Cause
fail2ban sqlite database file is corrupted.
Resolution Log into the server via SSH;
Note: If direct SSH access to the server is not possible, contact server administrator for further assistance. Backup Fail2Ban sqlite database:
# cp -a /var/lib/fail2ban/fail2ban.sqlite3{,.bkp} Re-install fail2ban component How to install / uninstall Plesk components? "
2,"How to enable/disable debug logging for Plesk backend utilities on Windows
Applicable to: Plesk for Windows Question
This article describes the debug logging for the Plesk backend utilities (i.e. utilities within the %plesk_bin% folder). It is also applicable for troubleshooting of the Plesk integration with a third-party application (like mail or DNS server). For all other cases, it is sufficient to enable debug logging described in this KB article.
Answer
To enable debug logging for the Plesk backend utilities: Log into the server via RDP. Create (if it does not exist) the HKLM\SOFTWARE\Wow6432Node\PLESK\PSA Config\Config\Debug registry entry of type DWORD . Set its value to 1. You can use the regedit.exe utility or run the following command in the command-line:
C:\> REG ADD ""HKLM\SOFTWARE\Wow6432Node\PLESK\PSA Config\Config"" /v Debug /t REG_DWORD /d 1 /f Debug information is start logging immediately in the Event Viewer > Applications and Services Logs > Plesk and into the %plesk_dir%admin\logs\plesklog_debugYYYYmmdd.log file, where YYYYmmdd represents current day of the year. Note: It is strongly recommended to switch off debug logging once it is not necessary as it may slow down your server performance and consume a lot of disk space.
To disable logging for the Plesk backend utilities:
Set the HKLM\SOFTWARE\PLESK\PSA Config\Config\Debug registry entry value to 0 or just remove it. Command-line examples below: To check registry entry:
C:\> REG QUERY ""HKLM\SOFTWARE\Wow6432Node\PLESK\PSA Config\Config"" /v Debug To switch off:
C:\> REG ADD ""HKLM\SOFTWARE\Wow6432Node\PLESK\PSA Config\Config"" /v Debug /t REG_DWORD /d 0 /f To delete entry:
C:\> REG DELETE ""HKLM\SOFTWARE\Wow6432Node\PLESK\PSA Config\Config"" /v Debug /f Related Articles How to enable/disable Plesk debug mode
"
8,"Unable to open Spam Filtering tab or email account page the process is loading forever
Applicable to: Plesk Onyx for Windows Symptoms Unable to open the Spam Filtering tab in Plesk > Tools & Settings > Mail Server Settings, the page is loading forever.
The same behavior occurs in an attempt to open any mailbox in Domains > example.com > Email Addresses.
With the enabled debug mode, in the %plesk_dir%admin\logs\php_error.log file can be found that the process of opening is stuck on the following stage:
CONFIG_TEXT: DEBUG [util_exec] [59fac39c7d922] Starting: spammng --list-languages, stdin: Cause
Multiple spammng.exe processes are stuck.
Resolution Log into the server via RDP. Open Windows Command Prompt (CMD) in a Windows server.
Kill the stuck processes of Spam Filter with the command below:
C:\> taskkill /F /IM spammng.exe "
8,"How to install and manage Spam filter and Antivirus server-wide in Plesk? Applicable to: Plesk for Linux
Plesk for Windows Question
How to enable Kaspersky Antivirus or Plesk Premium antivirus server-wide in Plesk?
Answer Plesk for Windows Purchase additional key for required antivirus. Log in to Plesk. Install the Kaspersky Antivirus or Plesk Premium antivirus component. Install the license key at Tools & Settings > License Management > Additional License Keys. Go to Tools & Settings > Mail Server Settings > Settings and select Kaspersky AntiVirus or Plesk Premium antivirus radio button under Antivirus settings. Switch to Antivirus tab and select usage policy, for example: Plesk for Linux Note: In Plesk for Linux it is required to log into server directly to enable antivirus for all mailboxes at once Purchase additional key for required antivirus. Log in to Plesk. Install the Kaspersky Antivirus or Plesk Premium antivirus component. Install the license key at Tools & Settings > License Management Additional License Keys. Go to Tools & Settings > Mail Server Settings > Settings and select Kaspersky AntiVirus or Plesk Premium antivirus radio button under ""Antivirus settings"". Log on to the server via SSH. Run the following command to enable selected antivirus for all mailboxes:
# plesk db -Ne""select concat(m.mail_name,'@',d.name) as email from mail as m left join domains as d on m.dom_id=d.id""| while read i; do plesk bin mail -u $i -antivirus inout; done
Note: to disable the selected antivirus for all mailboxes for execute the command below:
# plesk db -Ne""select concat(m.mail_name,'@',d.name) as email from mail as m left join domains as d on m.dom_id=d.id""| while read i; do plesk bin mail -u $i -antivirus off; done Enable antivirus for newly created mailbox automatically (Linux) For every newly created mailbox, the antivirus can be activated using Event Hadler feature: Log on to the server via SSH Create a script /root/handler.sh with the following content:
CONFIG_TEXT: #!/bin/bash plesk bin mail -u ${NEW_MAILNAME} -antivirus inout Grant execution permission to the script:
# chmod +x handler.sh Go to Plesk > Tools & Settings > Event Manager Click Add Event Handler. Select the event Mail account created and specify the full path to the script in the Command field "
5,"Plesk Migration and Transfer Guide
Applicable to: Plesk for Linux
Plesk for Windows Table of contents General Information Planning migration Preparing servers Migration pre-check Migration (data transfer) Migration post-check Data synchronization Switching IP/DNS (moving to production) Limitations for migration General Information Plesk Migrator is a tool that Plesk provides for migration to the latest Plesk versions.
It has pre- and post-migration checks, error reporting features, allows to re-sync data between an old and a new server after migration to make migration to Plesk an easy process. Plesk Migrator can be also used for upgrading Plesk to the latest version (Upgrade by transfer): Upgrade by transfer is the process of switching to the latest Plesk version by moving all hosting data and settings from the current Plesk server to a server with the latest version installed. Upgrade by transfer also allows you to minimize the downtime of services on the production server, as websites stay online while the transfer is in progress. During the migration process, data on the source server (Subscriptions', Customers' data, etc) will not be changed or removed as well as all services will be running. With Plesk Migrator you can: Migrate to: Plesk Obsidian Plesk Onyx Migrate from: Via Plesk and command-line interface Plesk 8.6 and later (Linux and Windows)
cPanel
Confixx 3.3
Helm 3.2
Plesk Expand 2.3.2
Parallels Pro Control Panel for Linux 10.3.6
DirectAdmin 1.51 (when migrating from DirectAdmin installed on Ubuntu 10.x, only custom migration is supported) Via command-line interface only (for assistance, submit a request to Plesk Professional Services team) Enkompass
HDE Controller 6
Hosting Controller v7 Panel
H-Sphere (both Linux and Windows servers can be migrated)
Interworx
ISPmanager 4 Pro
ISPmanager 5 Business
MSPControl (commercial and multi server WebSitePanel)
Parallels Plesk Automation (both Linux and Windows servers can be migrated)
Control Web Panel
WebSitePanel
XUnitConf For other platforms or if Plesk version is earlier than 8.6, refer to custom migration guides: for Linux
for Windows Server Planning migration Choose hardware for the destination server. It should be greater or equal to the source server hardware specifications. Choose a supported operating system for the destination server. List of supported OSes for Plesk Obsidian and Plesk Onyx List of supported Virtualization platforms for Plesk Obsidian and Plesk Onyx Installation on Сloud platforms for Plesk Obsidian and Plesk Onyx migration from Linux to Windows and vice versa is not supported
OS must be x64 OS Make sure that you have a proper Plesk license for the destination server. In case of any questions, contact Plesk License team. Choose a method of bringing domains online on the destination server after migration. Other factors that require decision making on the planning stage: check what functionality is deprecated in Plesk Onyx.
if Plesk is integrated with 3rd-party software, some post-migration actions might be needed in that software (e.g. conflict resolving in OBAS, changes in your custom billing solution).
if there are real time applications it is better to take a specialized approach to these websites and agree with the end users to arrange a pause for changes to the websites, so the data (e.g. database update transactions) added after last data sync and before DNS records propagation completion does not stay on the source server.
if the source server is overloaded or is low on resources, it is better to plan the migration job outside of business hours, if possible.
Plesk Migrator transfers service plans, subscriptions with all associated domains, and websites with content (such as websites, mail, databases, and so on). However, you should take into account that not all Plesk configuration can be transferred. See the migration limitations article for details. Preparing servers Install Plesk on the destination server following Plesk deployment guide.
Note: If the migration is Plesk-to-Plesk, the Plesk version installed on the target server must be equal or higher than the source server. Make sure that all components which are in use on the source server are installed and configured on the target server. For example, if you are planning to migrate a website with an ASP.NET 2.0-specific application and MS SQL databases, make sure that ASP.NET of a compatible version with needed packages (e.g. AJAX, MVC) and MS SQL server are installed on the target server. Install a Plesk license on the destination server (purchased or trial license). Make sure there is enough disk space on the source and destination servers. Add the necessary amount of IP addresses on the destination server (the best practice is to have equal amount of shared and dedicated IPs on both servers for migration). Install the Plesk Migrator extension on the destination server and verify connectivity following the Installation and Prerequisites steps. Make sure your source and destination servers can communicate with each other. Since version 12.5.30, the following ports are required to be opened for migration purpose: On Linux 22 (TCP) for SSH
8443 (TCP) for access to Plesk XML API on the target server and on the source servers, in case of migrating from Plesk
110, 143 (TCP) for POP3 and IMAP, on source and target servers for post-migration checks On Windows Server 135, 139, 445 (TCP) ports for migration
137, 138 (UDP) ports for migration
10155 (TCP) for a custom Plesk Migrator service performing miscellaneous tasks
10156 (TCP) for rsync server(migration)
1434 (TCP) and all (or manually selected) TCP ports for MS SQL, if it is used as a named instance Notify your customers about your pre-scheduled migration date. For some domains, the name-server IP address may need to be switched to the new destination server. This step may require customer involvement, so plan ahead. Decrease the TTL for DNS zones to 1 hour or less. Low TTL value allows clients to get the DNS updates faster. In case of switching a domain to the new IP they will start working with the new server earlier. On Linux
# for domain in $(MYSQL_PWD=`cat /etc/psa/.psa.shadow` mysql -u admin psa -Ns -e""select name from dns_zone where name not in (select val from misc where param = 'FullHostName')"") ; do /usr/local/psa/bin/dns --update-soa $domain -soa-ttl 1h; done On Window Server
""%plesk_bin%""\dbclient.exe --direct-sql --sql=""select name from dns_zone"" > C:\domains.txt FOR /F %D IN (C:\domains.txt) DO IF NOT '%D' == 'name' ""%plesk_dir%\bin\dns.exe"" --update-soa %D -soa-ttl 1h Migration pre-check Start migration from Plesk administration panel on the destination server:
Server Management > Extensions > Plesk Migrator > Start a New Migration .
You can always go back to this page to continue from where you left off or to start a new migration process. Plesk Migrator GUI contains hints for controls related to migration. Detailed information depending on source hosting platform including migration via command line utilities reference is in the Plesk Migration documentation . Next, specify root/built-in administrator accounts for the source and destination servers and proceed to the next step by clicking Prepare Migration : Plesk Migrator will connect to the source server, do several preliminary checks and fetch information about hosting objects from the source server. On the next screen, select objects for migration. Typical scenario is migration of a set of subscriptions. In this case, on the Add subscriptions tab choose the subscriptions for migration and specify what data should be migrated (web, mail, databases). When you are satisfied with the list of subscriptions to migrate and the migration options, click Migrate to proceed. Plesk will run pre-migration checks to detect potential issues and display a report: You should always pay attention to the messages from the pre-migration checker. Estimate the importance of each message (you can ignore some messages, but some of them might indicate issues blocking the transfer process). Solve underlying problems using the instructions provided in the message. After that, Refresh the pre-migration checking status, and click Start migration again.
The Migration section of our Plesk Expert education course contains visual representation of migration steps and overviews basic techniques to troubleshoot the pre-check warnings. There is a good chance that the problem and its solution is already described in one of our Knowledgebase articles. Migration (data transfer) When the pre-migration check returns a clean result, click Start migration to begin migrating. The process can take several hours to complete depending on the amount of data. For example, a migration process for 300 domains can take 10 hours (this is a very rough estimation, as the time generally depends on what the data is, its amount, transfer speed and servers’ performance). In case of full migration for a notable number of accounts it might be convenient to launch the migration process overnight and do additional data synchronization in the morning. Alternatively, you can migrate customers by groups, not everything at once.
You will see a status report for every migrated subscription. It is also possible to check migration status manually (for example, it is necessary, if the migration process was launched from command line). In case some subscriptions are migrated with errors they will be also marked by or on the Overview screen after migration and the reason will be displayed, if you click the Details link. It is necessary to fix related problems and repeat migration of the problem subscriptions. Migration post-check After migrating, you can perform a post-migration check to verify that the transferred websites, email accounts, databases, and so on are available on the destination server. It can be done either automatically, or manually.
1. Automated post-check
When migrating via GUI, Check the operability of services after migration checkbox should be enabled. If you are migrating via the command line, a CLI command should be run after the migration is finished. For details, refer to Plesk documentation .
2. Manual post-check
If you would like to do additional manual checks of the migrated websites, add the corresponding record to the hosts file on the destination server and verify the websites locally (this is the recommended process, rather than site preview functionality in the Plesk panel): location of the hosts file: /etc/hosts or C:\Windows\System32\Drivers\etc\hosts record format: 192.0.2.0 example.com, where 192.0.2.0 is the IP on the destination server the example.com was migrated to. These types of manual checks and related content fixes are performed by Plesk engineers in scope of the paid migration service. Data synchronization As all the services operate on the source server during migration and you may want to take time to verify everything before going online with the destination server, the migrated content can get out of sync after some time.
To solve it, you can easily synchronize migrated data for each subscription from the Plesk interface without repeating the whole migration process. It can be done separately for web, databases, and mail data. It can also be done simultaneously for all domains, for one domain or a group of selected domains. When migration is completed, you will see the Re-sync option near each subscription on the Overview tab. On the Subscriptions List tab, you can also select multiple subscriptions for synchronization. It is also possible to launch the synchronization process from CLI, if necessary.
To avoid data changes on the source server it is possible to stop the services on the source server: Apache, Nginx, mail service (Postfix / Qmail). Do not stop database server, migration will fail. This option leads to web and mail services downtime, it is only applicable when you can schedule maintenance time-frame during migration. Switching IP/DNS (moving to production) When all the post checks are completed and the migrated domains’ data is synchronized with the source server, it is time to turn the services online on the destination server.
The way it should be done depends on what IP/DNS switch scenario was chosen during the migration planning stage. It is either pointing domain names in DNS to the new server’s IPs or changing the IPs of domains in Plesk: for Linux , for Windows. Limitations for migration The settings of Plesk services, such as installed PHP handlers, Fail2Ban settings, ModSecurity settings, firewall settings, and so on are not transferred.
Custom configuration (e.g. permissions set not via Plesk, web server configuration changes done not via Plesk) is not transferred.
Any server component or software that is installed separately from Plesk, like Apache or PHP modules, should be installed on the target server anew.
Server-wide settings, such as PHP settings defined in Home >Tools & Settings, are not transferred
Service plans with no subscriptions assigned are not transferred. Resellers and customers that do not have any subscriptions are not transferred as well. Please read more information about the limitations of Plesk Migrator in the Knowledge base article. Additional Information Migration Guide - Plesk Docs
Plesk Professional Services - Plesk
"
0,"How to enable custom error pages for a domain in Plesk
Applicable to: Plesk Onyx for Linux
Plesk Onyx for Windows Question
How to set up custom error pages for a domain in Plesk?
Answer
Note: In some cases, custom error pages may not work properly due to customized domain configuration (in .htaccess file, additional Apache/nginx directives on Linux and web.config file on Windows Server). For Linux Enabling default error pages provided by Plesk If Proxy Mode is enabled at Domains > example.com > Apache & nginx Settings, then go to Domains > example.com > Hosting Settings and enable the Custom error documents setting: If Proxy Mode is disabled at Domains > example.com > Apache & nginx Settings, add the following content to Additional nginx directives field:
Notes: The Additional nginx directives field is available to Plesk administrator only. If you are a domain owner, please contact your service provider for assistance with configuration of error pages. To apply these settings for all new domains created under a particular service plan, go to Service Plans > Example Plan > Web Server tab and add the below lines to the Additional nginx directives field.
CONFIG_TEXT: fastcgi_intercept_errors on; location ^~ /error_docs/ { root /var/www/vhosts/example.com/; } error_page 400 /error_docs/bad_request.html; error_page 401 /error_docs/unauthorized.html; error_page 403 /error_docs/forbidden.html; error_page 404 /error_docs/not_found.html; error_page 405 /error_docs/method_not_allowed.html; error_page 406 /error_docs/not_acceptable.html; error_page 407 /error_docs/proxy_authentication_required.html; error_page 412 /error_docs/precondition_failed.html; error_page 414 /error_docs/request-uri_too_long.html; error_page 415 /error_docs/unsupported_media_type.html; error_page 500 /error_docs/internal_server_error.html; error_page 501 /error_docs/not_implemented.html; error_page 502 /error_docs/bad_gateway.html; error_page 503 /error_docs/maintenance.html; Configuring custom HTML error pages In Plesk, go to Domains > example.com > File Manager > click Home directory > then click and create a new directory for your custom error pages (For example, custom_error_pages). Create/upload your HTML error pages to the newly created directory. Configure error pages:
Note: Add only those error code lines, for which custom error pages exist in your directory. If Proxy Mode is enabled at Domains > example.com > Apache & nginx Settings:
Go to Domains > example.com > Apache & nginx Settings and add the following content to the Additional directives for HTTP and Additional directives for HTTPS. Replace custom_error_pages in each line, if your directory has a different name:
CONFIG_TEXT: Alias /custom_error_pages /var/www/vhosts/example.com/custom_error_pages ErrorDocument 400 /custom_error_pages/bad_request.html ErrorDocument 401 /custom_error_pages/unauthorized.html ErrorDocument 403 /custom_error_pages/forbidden.html ErrorDocument 404 /custom_error_pages/not_found.html ErrorDocument 405 /custom_error_pages/method_not_allowed.html ErrorDocument 406 /custom_error_pages/not_acceptable.html ErrorDocument 407 /custom_error_pages/proxy_authentication_required.html ErrorDocument 412 /custom_error_pages/precondition_failed.html ErrorDocument 414 /custom_error_pages/request-uri_too_long.html ErrorDocument 415 /custom_error_pages/unsupported_media_type.html ErrorDocument 500 /custom_error_pages/internal_server_error.html ErrorDocument 501 /custom_error_pages/not_implemented.html ErrorDocument 502 /custom_error_pages/bad_gateway.html ErrorDocument 503 /custom_error_pages/maintenance.html If Proxy Mode is disabled at Domains > example.com > Apache & nginx Settings:
Add the following content to the Additional nginx directives field:
CONFIG_TEXT: fastcgi_intercept_errors on; location ^~ /custom_error_pages/ { root /var/www/vhosts/example.com/; } error_page 400 /custom_error_pages/bad_request.html; error_page 401 /custom_error_pages/unauthorized.html; error_page 403 /custom_error_pages/forbidden.html; error_page 404 /custom_error_pages/not_found.html; error_page 405 /custom_error_pages/method_not_allowed.html; error_page 406 /custom_error_pages/not_acceptable.html; error_page 407 /custom_error_pages/proxy_authentication_required.html; error_page 412 /custom_error_pages/precondition_failed.html; error_page 414 /custom_error_pages/request-uri_too_long.html; error_page 415 /custom_error_pages/unsupported_media_type.html; error_page 500 /custom_error_pages/internal_server_error.html; error_page 501 /custom_error_pages/not_implemented.html; error_page 502 /custom_error_pages/bad_gateway.html; error_page 503 /custom_error_pages/maintenance.html; Configuring custom PHP error pages In Plesk, go to Domains > example.com > File Manager > click and create a new directory for your custom error pages (For example, custom_error_pages) inside the httpdocs directory.
Note: If the domain has a custom document root (e.g. httpdocs/website) at Domains > example.com > Hosting Settings, create the directory for custom error pages there (httpdocs/website/custom_error_pages). Create/upload your PHP error pages to the newly created directory. Configure error pages:
Note: Add only those error code lines, for which custom error pages exist in your directory. If Proxy Mode is enabled at Domains > example.com > Apache & nginx Settings:
Go to Domains > example.com > Apache & nginx Settings and add the following content to the Additional directives for HTTP and Additional directives for HTTPS. Replace custom_error_pages in each line, if your directory has a different name:
CONFIG_TEXT: ProxyErrorOverride on <Location /custom_error_pages/> ProxyErrorOverride off </Location> ErrorDocument 400 /custom_error_pages/bad_request.php ErrorDocument 401 /custom_error_pages/unauthorized.php ErrorDocument 403 /custom_error_pages/forbidden.php ErrorDocument 404 /custom_error_pages/not_found.php ErrorDocument 405 /custom_error_pages/method_not_allowed.php ErrorDocument 406 /custom_error_pages/not_acceptable.php ErrorDocument 407 /custom_error_pages/proxy_authentication_required.php ErrorDocument 412 /custom_error_pages/precondition_failed.php ErrorDocument 414 /custom_error_pages/request-uri_too_long.php ErrorDocument 415 /custom_error_pages/unsupported_media_type.php ErrorDocument 500 /custom_error_pages/internal_server_error.php ErrorDocument 501 /custom_error_pages/not_implemented.php ErrorDocument 502 /custom_error_pages/bad_gateway.php ErrorDocument 503 /custom_error_pages/maintenance.php If Proxy Mode is disabled at Domains > example.com > Apache & nginx Settings:
Add the following content to Additional nginx directives field:
CONFIG_TEXT: fastcgi_intercept_errors on; error_page 400 /custom_error_pages/bad_request.php; error_page 401 /custom_error_pages/unauthorized.php; error_page 403 /custom_error_pages/forbidden.php; error_page 404 /custom_error_pages/not_found.php; error_page 405 /custom_error_pages/method_not_allowed.php; error_page 406 /custom_error_pages/not_acceptable.php; error_page 407 /custom_error_pages/proxy_authentication_required.php; error_page 412 /custom_error_pages/precondition_failed.php; error_page 414 /custom_error_pages/request-uri_too_long.php; error_page 415 /custom_error_pages/unsupported_media_type.php; error_page 500 /custom_error_pages/internal_server_error.php; error_page 501 /custom_error_pages/not_implemented.php; error_page 502 /custom_error_pages/bad_gateway.php; error_page 503 /custom_error_pages/maintenance.php; For Windows Server Enabling default error pages provided by Plesk In Plesk, go to Domains > example.com > Hosting Settings and enable Custom error documents. Configuring custom HTML error pages using default Plesk documents In Plesk, go to Domains > example.com > Hosting Settings and make sure that the Custom error documents setting is enabled. Go to Domains > example.com > Virtual Directories > Error Documents tab > click on a required error page and make sure that it has a File type. Go to File Manager > error_docs > click on a required custom document and modify it according to your needs. Here is a list of the error pages names:
PLESK_INFO: 400 Bad File Request - bad_request.html 401 Unauthorized - unauthorized.html 403 Forbidden/Access denied - forbidden.html 404 Not Found - not_found.html 405 Method Not Allowed - method_not_allowed.html 406 Not Acceptable - not_acceptable.html 407 Proxy Authentication Required - proxy_authentication_required.html 412 Precondition Failed - precondition_failed.html 414 Request-URI Too Long - request-uri_too_long.html 415 Unsupported Media Type - unsupported_media_type.html 500 Internal Server Error - internal_server_error.html 501 Not Implemented - not_implemented.html 502 Bad Gateway - bad_gateway.html 503 Service Temporarily Unavailable - maintenance.html Configuring custom error pages using custom URLs In Plesk, go to Domains > example.com > Hosting Settings and make sure that the Custom error documents setting is enabled. Go to File Manager > httpdocs and create your custom error pages. Once created, go to Domains > example.com > Virtual Directories > Error Documents tab and click on a required error page. Change its type to URL and specify the Location of the custom error page. For example, if the file not_found.php is located in httpdocs, the location will be http://example.com/not_found.php (or https://example.com/not_found.php if the website is using a secure connection). Click OK to apply the changes. Now open a non-existent page in a browser to check newly configured custom error page.
Note for Plesk administrators: If a non-existent page on this website is opened directly on a Plesk server, a default IIS page will appear. This is behavior by default. Additional information Plesk Administrator's Guide: Setting Up Custom Error Page
"
7,"Plesk installation fails on server with MySQL service: ERROR while trying to establish test connection
Applicable to: Plesk 12.0 for Linux
Plesk 12.5 for Linux
Plesk Onyx for Linux Symptoms
Plesk installation fails with the error:
CONFIG_TEXT: Error message or request description : ***** problem report *****ERROR while trying to establish test connection. If you are installing Plesk on an already configured MySQL server, you need to specify the administrator's credentials to succeed with the installation. To do this, you need to create a file - /root/.my.cnf with the 'client' section where you need to provide user and its password (""user = $admin_name"" and ""password = $admin_pass""). After installation is finished, the file /root/.my.cnf will be renamed to /root/.my.cnf.bakCheck the error reason(see log file: /var/log/plesk/install/plesk_12.0.18_installation.log), fix and try againSynchronizing the Debian APT package index files.
Cause
Mysql had already been installed.
Resolution
Prepare the environment for Plesk installation with pre-installed MySQL/MariaDB server according to How to install Plesk on Linux with specific pre-installed MySQL version?"
0,"Scheduled tasks do not start automatically on Plesk for Linux server
Applicable to:
Plesk for Linux
Symptoms On a Plesk for Linux server, scheduled tasks do not start automatically, including scheduled backup or statistics tasks. If a scheduled task is started manually from Plesk, it works correctly. cron service is stopped:
# systemctl status cron.service | grep ""Active:"" Active: inactive (dead) since Thu 2019-10-17 13:17:27 +07; 1s ago
OR
# service crond status crond is stopped Cause
cron service is stopped on the server.
Resolution Connect to the server using SSH. Enable and start cron: On CentOS/RHEL/CloudLinux 7 and newer:
# systemctl enable crond # systemctl start crond On CentOS/RHEL/CloudLinux 6:
# chkconfig crond on # service crond start On Debian and Ubuntu:
# systemctl enable cron # systemctl start cron "
0,"Why there are two locations for domain log files in Plesk?
Applicable to: Plesk for Linux Question
Why there are two locations for domain logs: /var/www/vhosts/system/example.com/logs and /var/www/vhosts/example.com/logs?
Answer
The directory /var/www/vhosts/system/example.com/ contains domain configuration, its log files, statistics data and protected directories.
By design, this directory is not accessible in Plesk interface.
Therefore, to allow accessing the domain logs from Plesk interface the hard links (the files have the same inode) are created in the directory /var/www/vhosts/example.com/logs to the files in the directory /var/www/vhosts/system/example.com/logs."
8,"How does the pc-remote milter service work? Applicable to: Plesk for Linux Question
How does the pc-remote milter service work? Is it possible to safely remove this service?
Answer
The pc-remote here is essential for mail service on the server.
Note: the Postfix will not accept incoming messages and will not process the mail queue if this service is absent or down.
The Postfix connects to the pc-remote when the sender connects to the server before the message is saved into the mail queue, before the message is sent to a remote server and before the message is delivered to the local mailbox. Each time, Postfix submits the message to pc-remote and waits for a response. If the message passes all filters of a particular stage of mail delivery, the pc-remote gives it go and Postfix continues the delivery.
If the message is matched by one of the filters, the pc-remote reports Postfix to reject the message. Note: the pc-remote works only together with Postfix and will be automatically removed if the Qmail installed."
2,"Plesk for Windows Server shows 503 Service Unavailable: Cannot read configuration file Applicable to: Plesk for Windows Symptoms When accessing Plesk, the following error appears in a browser:
PLESK_INFO: Service Unavailable.HTTP Error 503. The service is unavailable. The ""PleskControlPanel"" application pool in IIS Manager is stopped. After starting it manually, the application pool stops on the next attempt to open Plesk in a browser. The following error message appears in the Event Viewer Application log (Windows Logs):
PLESK_INFO: The worker process for application pool 'PleskControlPanel' encountered an error'Cannot read configuration file due to insufficient permissions' trying to read configuration data from file '?\C:\inetpub\temp\apppools\PleskControlPanel\PleskControlPanel.config', line number '0'.The data field contains the error code.
OR
PLESK_INFO: The worker process for application pool 'PleskControlPanel' encountered an error'Cannot read configuration file' trying to read configuration data from file '\\?\<EMPTY>', line number '0'.The data field contains the error code. Cause
Plesk configuration file PleskControlPanel.config located at C:\inetpub\temp\appPools\PleskControlPanel is corrupted.
Resolution Connect to a Plesk server via RDP. Rename the PleskControlPanel.config file located at C:\inetpub\temp\appPools\PleskControlPanel. This file will be automatically generated on the next attempt to open Plesk. Start Plesk Reconfigurator at Windows Start > All Programs > Plesk. In Plesk Reconfigurator, click Repair Plesk Installation > select Check Plesk Services > click Check. Restart IIS using the following command in a command prompt:
C:\> iisreset /restart Access Plesk.
"
0,"How to give limited SSH access to Plesk domain's system user
Applicable to: Plesk for Linux Question
How to give limited SSH access to Plesk domain's system user?
Answer
Warning: SSH access allows the domain owner accessing the SSH interface under subscription's user account with non-administrative access. It can be provided only for system domain user. This type of access does not allow the user applying administrative commands and it cannot be used for applying instructions in other Plesk articles. In this case, the home folder for the user will be the same as specified in Plesk > Domains > example.com > Hosting Settings is provided. Video instruction ""How to provide SSH access for domain's system user"" Note: If the menus are different, upgrade to the latest Plesk version or contact server's administrator/hosting provider. For a single domain/subscription Log into Plesk. Go to Plesk > Domains > example.com > Web Hosting Access. Set the appropriate user shell at Access to the server over SSH field (check this article to get information about different types of the shells):
Note: The non-selectable Forbidden value for non-admin users means that the Management of access to the server over SSH permission is set to Not allowed in the subscription and/or service plan settings by the service provider. Follow instructions from this article to add such permissions to the subscription. Values Forbidden, /sbin/nologin or /usr/sbin/nologin will restrict SSH access to a user, the rest of options will allow SSH access. Click the OK button to apply changes. To ensure that the SSH access is provided to the john_doe user do the following: Connect to the server via SSH. Execute the following command:
# grep john_doe /etc/passwd john_doe:x:10001:1003::/var/www/vhosts/example.com:/usr/local/psa/bin/sh For all subscriptions under the same service plan To provide SSH access to all Plesk users of subscriptions with the same service plan (only for Service Provider view), do the following:
Note: If the menus are different, upgrade to the latest Plesk version or contact server's administrator/hosting provider. Set required environment in the Plesk > Service Plans > Default > Hosting Parameters > SSH access to the server shell under the subscription's system user drop-down list: Go to Permissions tab in Plesk > Service Plans > Default and set Management of access to the server over SSH to Not Allowed in order to propagate new value to all already existing subscriptions: If Management of access to the server over SSH is allowed, the change will not be propagated to existing subscriptions - only to newly created ones.
See Plesk Guide for more details: to preserve the modifications made by customers, Plesk does not sync a plan property if a related permission is granted. Click the Update & Sync button to apply changes and synchronize subscriptions with the service plan. To ensure that the SSH access is provided to the john_doe user do the following: Connect to the server via SSH. Execute the following command:
# grep john_doe /etc/passwd john_doe:x:10001:1003::/var/www/vhosts/example.com:/usr/local/psa/bin/sh Note: The functionality to provide SSH access for a particular folder, like /var/www/vhosts/example.com/httpdocs/ or /var/www/vhosts/example.com/httpdocs/dir1 is not implemented in Plesk. Take part in our product improvement and vote for this feature on Plesk UserVoice.The top-ranked suggestions are likely to be included in the next versions of Plesk."
8,"How to change the maximum attachment size for webmail on Plesk server?
Applicable to: Plesk for Linux
Plesk for Windows Question
How to change the maximum attachment size for webmail?
Answer Procedure for Linux Connect to the server via SSH.
Note: if direct SSH access to the server is not possible, contact server administrator for further assistance. Change the PHP settings below: CONFIG_TEXT: upload_max_filesize = 64M post_max_size = 128M For Horde edit file /etc/psa-webmail/horde/horde/php.ini For Roundcube edit file /etc/psa-webmail/roundcube/php.ini Modify also horde attach_size_limit value at /etc/psa-webmail/horde/imp/conf.php, it should be set to 0 (unlimited):
# grep attach_size_limit /etc/psa-webmail/horde/imp/conf.php $conf['compose']['attach_size_limit'] = 0;
Note: Set higher values if it is required. Procedure for Windows For Horder webmail Connect to the server via RDP.
Note: if direct SSH access to the server is not possible, contact server administrator for further assistance. Edit file %plesk_dir%webmail\horde\conf\php.ini and change the PHP settings for Horde.For example:
C:\> type %plesk_dir%webmail\horde\conf\php.ini | findstr max ... upload_max_filesize = 64M post_max_size = 128M ... Modify also horde attach_size_limit value at %plesk_dir%Webmail\horde\horde\imp\config\conf.php, it should be set to 0 (unlimited):
C:\> type %plesk_dir%Webmail\horde\horde\imp\config\conf.php | findstr attach_size_limit $conf['compose']['attach_size_limit'] = 0;
Note: Set higher values if it is required. For MailEnable webmail Connect to the server via RDP.
Go to Windows > Mailenable > Servers > localhost >Services and Connectors > right-click on SMTP > properties > Outbound tab
Under Limit outbound size, specify a higher value in Maximum field; Click OK; Stop and start the SMTP service to apply the new change at Windows > Mailenable > Servers > localhost > Services and Connectors > right-click on SMTP .
Note: If the issue persists, apply the solution described in MailEnable KB
Note: Set higher values if it is required. "
0,"How does password strength policy work in Plesk?
Applicable to: Plesk for Linux
Plesk for Windows Question
How is password strength determined for Plesk?
Answer
Passwords strength is a sum of the following criteria. All characters are verified against them, every match adds specific score and has specific weight.
Here are rules applied for password validation in Plesk Onyx and Obsidian: If a password is 4 or less symbols in length, it gains 3 scores. If the length is between 5 and 7, then it gains 6 scores. If the length is between 8 and 15, then it gains 12 scores. If the length is 16 or more, then it gains 18 scores. If password contains at least one lower case letter from ' a ' to ' z ', then it give us 1 score. If there is at least one upper case letter from 'A' to 'Z' , then it brings 5 scores. If there is at least one number, then it brings 5 scores. If there is at least three numbers, then it brings 5 scores. If there is at least one special character from this list (without quotes): "" !, @, #, $, %, ^, &, *, ?, _, ~ "", then it brings 5 scores. If there is at least two special characters from the list above, then it brings 5 scores. If there is both upper and lower case, then it brings 2 scores. If both letters and numbers, then it brings 2 scores. If there is combination of letters and numbers and special characters, then it will give us 2 scores. Summary: If the sum of score less than 15, the password is Very Weak. If the sum of scores between 15 and 24, then it is Weak password. If the sum of scores between 25 and 34, then it is Medium password. If the sum of scores between 35 and 44, then it is Strong password. If the sum of score is more than 45, it is Very Strong. Example:
The password P@ssw0rd: Length between 8 and 15 (+12).
At least one lower case letter (+1).
At least one lower case letter uppercase (+5).
At least one number (+5).
At least one special character (+5).
Have both upper and lower case (+2).
Have both letters and numbers (+2).
Have letters, numbers and special characters (+2). Overall score is 34, which is less than 35. Verdict is Medium."
8,"Email is delivered with a delay
Applicable to: Plesk for Linux Symptoms Email messages and mailing list deliveries are delayed Greylisting is enabled One of the following errors might appear in /var/log/maillog file:
CONFIG_TEXT: handlers_stderr: DEFER DEFER during call 'grey' handler Message aborted. milter-reject: DATA from mail.example.com[203.0.113.2]: 451 4.7.1 Service unavailable - try again later; from=<jdoe@example.com> to=<jsmith@example.org> proto=ESMTP helo=<mail.example.com> Starting greylisting filter... handlers_stderr: SKIP SKIP during call 'grey' handler
CONFIG_TEXT: greylisting filter[10489]: Starting greylisting filter... /usr/lib64/plesk-9.0/psa-pc-remote[8641]: handlers_stderr: REJECT /usr/lib64/plesk-9.0/psa-pc-remote[8641]: REJECT during call 'grey' handler /usr/lib64/plesk-9.0/psa-pc-remote[8641]: Message aborted. postfix/smtpd[10450]: reply: SMFIR_REJECT data 0 bytes postfix/smtpd[10450]: E612613C0057: milter-reject: DATA from unknown[203.0.113.2]: 550 5.7.1 Command rejected; from=<jdoe@example.com> to=<jsmith@example.org> proto=ESMTP helo=<mail.example.com> Starting greylisting filter... handlers_stderr: SKIP SKIP during call 'grey' handler
CONFIG_TEXT: Handlers Filter before-queue for qmail started ... from=jdoe@example.com to=jsmith@example.org Starting greylisting filter... handlers_stderr: DEFER DEFER during call 'grey' handler Starting greylisting filter... handlers_stderr: SKIP SKIP during call 'grey' handler Mailing list deliveries are delayed and the following error is shown in /var/log/maillog file:
CONFIG_TEXT: postfix/smtpd[1598278]: 85AB012F841: milter-reject: DATA from localhost[127.0.0.1]: 451 4.7.1 Service unavailable - try again later; from=<mailinglist-bounces@example.com> to=<jsmith@example.org> proto=ESMTP helo=<mail.example.com>
And the following error is shown in /var/log/mailman/smtp-failure file:
CONFIG_TEXT: (2430) delivery to jsmith@example.org failed with code 451: 4.7.1 Service unavailable - try again later Cause
This is expected the behavior of Greylisting.
Greylisting works as follows: the first message is rejected, and the next message sent from the same address (sender server IP address and 'From:') will be accepted after a certain length of time passes.
After the first email is rejected, the sender's address is added to the Greylisting database. The information is stored there for an expiration time interval. For the message to be accepted, the grey interval must complete. If the message was sent before the grey interval has passed, the penalty interval is added.
Resolution
To prevent a delay, perform one of the following actions: Reduce the grey interval according to the following KB article: How to configure Greylisting? Go to Plesk > Tools & Settings > Spam Filter Settings > White List and add the required mailbox, domain or pattern to the white-listed senders and their emails will be accepted without passing through the greylisting and SpamAssassin. Adding an email address to the whitelist: jdoe@example.com Adding all emails sent from a specific domain to the whitelist: *@example.com Note: In case an email sent to a mailing list is delayed, it is required to add the domain from the mailing list address in the white list. Disable Greylisting spam protection on the whole server by unchecking Switch on server-wide greylisting spam protection in from Plesk > Tools & Settings > Spam Filter Settings
Warning: This change reduces the protection from spam. Additional information Antispam Tools Greylisting (Linux) How to configure Greylisting? The following statuses of Greylisting can be seen in the /var/log/maillog file: ""DEFER"" means ""Try again later"" ""SKIP"" means ""Allow delivery"" ""REJECT"" means that the sender IP is blacklisted globally. "
2,"Unable to open Plesk: The user name or password that is specified for the identity may be incorrect, or the user may not have batch logon rights
Applicable to: Plesk 12.0 for Windows
Plesk 12.5 for Windows Symptoms Unable to open Plesk: the page does not load. Application Pool is stopped. Trying to restart it does not work: it is started, then is stopped again. The following error is displayed in Event Viewer: CONFIG_TEXT: The identity of application pool plesk(default)(4.0)(pool) is invalid. The user name or password that is specified for the identity may be incorrect, or the user may not have batch logon rights. If the identity is not corrected, the application pool will be disabled when the application pool receives its first request. If batch logon rights are causing the problem, the identity in the IIS configuration store must be changed after rights have been granted before Windows Process Activation Service (WAS) can retry the logon. If the identity remains invalid after the first request for the application pool is processed, the application pool will be disabled. The data field contains the error number.
Cause
psaadm user does not have enough permissions in Local Group Policy
Resolution Connect to the server via RDP. Run gpetit.msc to accress Local Group Policy Editor. Follow the path Computer Configuration > Windows Settings > Security Settings > Local policies > User Rights Assignment. Add psaadm user to the following policies: Log on as a batch job
Log on as a service "
8,"How to disable PHP mail() function for a spamming domain on Plesk for Linux server?
Applicable to: Plesk for Linux Question How to disable mail() function for a spamming domain on Plesk server? How to prevent e-mails from being sent via scripts through Sendmail? Answer
Click on a section to expand Disable mail() function for a particular domain To disable PHP mail() function for a domain, follow the steps below: Log in to Plesk GUI Go to Subscriptions > example.com > Customize > PHP settings Add disable_functions = mail string to the Additional configuration directives field: Click OK button to apply changes Note: Make sure that the corresponding subscription is locked, otherwise the global definitions of that subscription plan will be synced and the domain's specific configuration will be lost.
Warning: If disable_functions = mail is set, but 'mail' is not listed as disabled in Domains > example.com > PHP Settings > phpinfo (), check if some additional PHP modules are installed on the server. Additional PHP modules can overwrite php.ini settings for the domain.
In case Suhosin PHP module is installed, follow these steps: Connect to the server via SSH and comment out disable_functions directive in Suhosin config in order not to override the same directives in domains php.ini.
# grep disable_function /etc/php.d/suhosin.ini ;disable_functions = Add additional PHP directive for domain:
CONFIG_TEXT: disable_functions = exec, system, mail Note: If mail() function is disabled for PHP, but emails are still being sent by unidentified script, Sendmail can be disabled completely. Disable mail() function server-wide Usage of Sendmail utility can be disabled server-wide with the settings at: Log in to Plesk GUI > Tools & Settings > Mail Server Settings > Disable the option Allow scripts and users to use Sendmail Or at Service Plan level: Log in to Plesk GUI > Service Plans > <service_plan_name> > Mail > Disable the option Allow scripts and users to use Sendmail Or at Subscription level: Log in to Plesk GUI > Subscriptions > example.com > Outgoing mail control > Subscription > Change limits > Disable the option Allow scripts and users to use Sendmail Additional Information
Also, it is possible to block all outgoing mail that is being sent by PHP scripts like PHPMailer by adding the following iptables rule: Connect to the server via SSH Save the current iptables rules to the file:
# iptables-save > /root/pre_iptables_rules Add the rule that blocks all outgoing packets send by processes where the owner is not postfix excluding local connections from Webmail:
# iptables -I OUTPUT -m owner ! --uid-owner postfix -m tcp -p tcp --dport 25 ! -d 127.0.0.1 -j REJECT Save iptables rules to make the changes permanent:
# /sbin/service iptables save "
5,"SFTP is not available for additional FTP users
Applicable to: Plesk for Linux Symptoms Additional FTP user is specified instead of the subscription's system user SFTP connection cannot be established with the similar error on connection attempt:
# sftp additional_user@203.0.113.2 additional_user@203.0.113.2's password: Connection closed
# sftp additional_user@203.0.113.2 additional_user@203.0.113.2's password: unexpected end of file
Note: SFTP stands for SSH File Transfer Protocol and uses SSH for establishing connection and transferring the data. FTP and FTPS connections are not affected by this issue, as they use the different protocol and mechanisms. Similar errors might be logged by the Journal:
# journalctl --since=""10m ago"" | grep chrootsh plesk-chrootsh[16727]: user with id=10000 and name=additional_user not found in chrooted passwd file plesk-chrootsh[16727]: system error: No such file or directory Cause
SFTP configuration for additional FTP users is not implemented in Plesk yet.
Resolution
Vote for this feature on our UserVoice portal. As a workaround, apply following steps Warning: Such configuration was not officially tested. It might be changed automatically in case users are modified through Plesk. Shell value of the additional user will not be synchronized with the main user. Connect to the server via SSH. Download and unpack the script:
# curl -LO https://plesk.zendesk.com/hc/article_attachments/360009752840/213912005_clone_shell.tar.gz # tar xf 213912005_clone_shell.tar.gz Run the script providing the names of additional users:
# ./213912005_clone_shell.sh examplecom1 examplecom2 Changing examplecom1 shell from /bin/false to /usr/local/psa/bin/chrootsh Adding examplecom1 to the chrooted passwd file Changing examplecom2 shell from /bin/false to /usr/local/psa/bin/chrootsh Adding examplecom2 to the chrooted passwd file
Note: The additional user should have access to the / directory in Plesk under Domains > FTP Access > additional_user "
8,"How to block a particular mailbox or a range of mailboxes belonged to a specific domain from sending emails to Plesk server? Applicable to: Plesk for Linux
Plesk for Windows Question
How to block a particular mailbox or a range of mailboxes belonged to a specific domain from sending emails to Plesk server?
Answer
Note: in order to block the email sender by IP, navigate to this article: Is there any way to block an IP address in Plesk Firewall? Server-wide Log into Plesk. Go to Plesk > Tools & Settings > Spam Filter > Black List. Press the Add Addresses button. Specify a particular mailbox or a range of mailboxes belonged to a specific domain in the Email addresses field, e.g.:
CONFIG_TEXT: johndoe@example.com *@example.org *@*.net Press the OK button. Note: The steps above will add the address to individual black list, which will give it a score 100, making it be detected and processed as spam. What to do with such messages can be only achieved on a mailbox level with the option ""What to do with messages classified as spam"" at Domains > example.com > Email Addresses > john.doe@example.com > Spam Filter tab. In order to not receive messages added to blacklist select option ""Delete all spam messages"" Particular mailbox Note: SpamAssassin has to be installed on the server and enabled on the required mailbox. Log into Plesk. Go to Plesk > Domains > example.com > Email Addresses > john.doe@example.com > Spam filter. Click the Show Advanced Settings link. Specify a particular mailbox or a range of mailboxes belonged to a specific domain in the Black list field, e.g.:
CONFIG_TEXT: johndoe@example.com *@example.org *@*.net Press the OK button. Note: The steps above will add the address to individual black list, which will give it a score 100, making it be detected and processed as spam. Now, in order to effectively delete the messages detected as spam, click on ""What to do with messages classified as spam"" option on the same tab and select the option ""Delete all spam messages""
Additional Information:
SpamAssassin blacklist for mail address does not work as described
Administrator's guide: SpamAssassin Spam Filter "
2,"Unable to access Plesk: Unknown database 'psa' Applicable to: Plesk for Linux
Plesk for Windows Symptoms Plesk is not accessible with one of the following error messages in a web-browser:
PLESK_INFO: Unable to connect to database: Unknown database 'psa' 0: common_func.php3:150 psaerror(string 'Unable to connect to database: Unknown database 'psa'') 1: auth.php3:111
OR
PLESK_INFO: ERROR: Zend_Db_Adapter_Exception: SQLSTATE[HY000] [1049] Unknown database 'psa'
OR
PLESK_INFO: Server Error 500 Zend_Db_Adapter_Exception SQLSTATE[HY000] [1049] Unknown database 'psa' Type Zend_Db_Adapter_Exception Message SQLSTATE[HY000] [1049] Unknown database 'psa' File Abstract.php Line 144
OR
PLESK_INFO: ERROR: PleskDBException: Unable to connect to database: Unknown database 'psa' (Abstract.php:69) On Plesk Onyx, the plesk db utility fails with:
# plesk db ERROR 1049 (42000): Unknown database 'psa' exit status 1 Cause
Plesk system database 'psa' is missing.
Resolution For Plesk on Linux Connect to the Plesk server via SSH. Switch to the directory with daily dumps:
# cd /var/lib/psa/dumps Find the most recent dump that contains the 'psa' database:
# zgrep ""Current Database:"" mysql.daily* | grep psa mysql.daily.dump.0.gz:-- Current Database: `psa` mysql.daily.dump.1.gz:-- Current Database: `psa` mysql.daily.dump.2.gz:-- Current Database: `psa` mysql.daily.dump.3.gz:-- Current Database: `psa` ... where mysql.daily.dump.0.gz is the most recent daily dump. Restore the 'psa' database from the most recent daily dump. In this example, the 'psa' database is restored from mysql.daily.dump.0.gz:
# zcat mysql.daily.dump.0.gz | sed -n '/-- Current Database: `psa`/,/-- Current Database:*/p' | MYSQL_PWD=`cat /etc/psa/.psa.shadow` mysql -uadmin Access Plesk. For Plesk on Windows Server Connect to the Plesk server via RDP. Start a command prompt as an Administrator. Connect to MySQL:
Note: MySQL admin password is required for this operation. In Plesk Onyx 17.8, retrieve the password with the command ""plesk sbin psadb --get-admin-password"".
C:\> ""%plesk_dir%\Mysql\bin\mysql.exe"" apsc -uadmin -p -P8306 Once in, create a new database with the name 'psa':
MYSQL_WIN: mysql> create database psa; Exit MySQL:
MYSQL_WIN: mysql> quit Switch to the directory with daily dumps:
C:\> cd %plesk_dir%Mysql\Backup List a name of a Plesk dump with the 'psa' database:
C:\> dir psa* ... Directory of C:\Program Files (x86)\Plesk\MySQL\Backup 03/27/2019 08:33 PM 468,888 psa-20181018020721.sql Restore the 'psa' database using the dump file name from previous step:
Note: MySQL admin password is required for this operation. In Plesk Onyx 17.8, retrieve the password with the command ""plesk sbin psadb --get-admin-password"".
C:\> ""%plesk_dir%""\Mysql\bin\mysql.exe -uadmin -p -P8306 psa < psa-20181018020721.sql Access Plesk. Related Articles How to back up/restore Plesk system databases
"
5,"Unable to start SSH session or Plesk migration: Failed getting banner
Applicable to: Plesk for Linux Symptoms Plesk migration fails:
CONFIG_TEXT: Error: launchpad error (Error code = 2): == STDERR ==================== Unable to start SSH session: Failed getting banner ==============================
OR
CONFIG_TEXT: Plesk for Linux is not found on the specified source server. Cannot connect to the source server via SSH:
# ssh 203.0.113.2 ssh_exchange_identification: Connection closed by remote host Cause
Not enough connections permitted for SSH service on the source server.
Resolution
Note: if you don't have root access to Plesk via SSH, contact your hosting provider regarding the issue Login to the source server over SSH. If it is not possible, log in via local server console. Uncomment MaxStartups parameter in/etc/ssh/sshd_config and set the following value:
CONFIG_TEXT: MaxStartups 50 Reload SSH server configuration to apply the changes:
# service sshd reload "
2,"Unable to login to Plesk control panel: Unable to connect to pipe
Applicable to: Plesk for Windows Symptoms After logging into Plesk the following error is shown:
PLESK_ERROR: Error message or request description : Unable to connect to pipe \\.\pipe\P_7da1332a-fe05-4176-91f2-4c4457fb71f0at (Con::ClientOverlappedPipe::create line 509)at get shared instance of PleskSrvClient(PleskSrvClient::getInstance line 327)at Unable to get administrator password: <Password has been wiped out for security reasons> line 205)
Or:
PLESK_ERROR: ERROR: Exception: Access is denied. (Error code 5) at Unable to connect to pipe \\.\pipe\P_36a625a6-260f-44af-b844-3beee654dbd6<br> at (Con::ClientOverlappedPipe::create line 503)<br> at get shared instance of PleskSrvClient(PleskSrvClient::getInstance line 337)<br> at Unable to get administrator password:(zif_get_admin_password line 206) (Helper.php:68)0: Helper.php:68get_admin_password()...AutoPrepend->run()9: auth.php:690 Attempt to upgrade Plesk fails with the same error. Cause
Plesk Management Service is stuck, not started or not available.
Resolution Connect to the server via RDP. Restart the Plesk Management Service via Plesk Services Monitor (Plesk icon in the tray menu): If it is not restarting, kill the plesksrv.exe process in Task Manager and restart the service along with PopPass service: Run %plesk_dir%admin\bin\reconfigurator.exe > Repair Plesk Installation > Plesk services: "
10,"Cannot send email via contact form using Web Presence Builder: Your message could not be sent due to an internal error Applicable to: Plesk Onyx for Linux Symptoms Cannot send email via contact form using Web Presence Builder:
CONFIG_TEXT: Your message could not be sent due to an internal error. Please contact the website administrator by other means to notify about this issue
But in fact, the email is sent and received successfully. Error in strace log:
CONFIG_TEXT: PHP Fatal error: Uncaught exception 'Zend_Mail_Transport_Exception' with message 'Unable to send mail. mail(/var/tmp/php.mail.log): failed to open stream: Permission denied' in /var/www/vhosts/example.com/httpdocs/includes/Zend/Mail/Transport/Sendmail.php: Cause
Incorrect permissions on/var/tmp/php.mail.logfile.
Resolution
Note: if you don't have root access to Plesk server via SSH, contact your hosting provider regarding the issue Login to Plesk server over SSH Set the correct permissions on/var/tmp/php.mail.logfile:
# chmod 664 /var/tmp/php.mail.log # ls -la /var/tmp/php.mail.log -rw-rw-r-- 1 root root 104306 Sep 5 22:47 /var/tmp/php.mail.log "
7,"Unable to start Plesk site in IIS after the upgrade:""Exception from HRESULT: 0x80070020"" Applicable to: Plesk 11.x for Windows Plesk 12.0 for Windows Symptoms An attempt to start Plesk Panel site in IIS fails with the error below All websites are stopped in IIS, an attempt to start it fails with the error below The process cannot access the file because it is being used by another process. (Exception from HRESULT: 0x80070020) Additionally, the following events are being logged in the System event log on the Microsoft Windows Server 2008-based computer that is running IIS: Event Source: W3SVCEvent ID: 1004Description: The World Wide Web Publishing Service (WWW Service) did not register the URL prefix http://my.domain.com:80:12.123.123/ for site 106. The site has been disabled. The data field contains the error number.Event Source: HTTPEvent ID: 15005Description: Unable to bind to the underlying transport for [::]:80. The IP Listen-Only list may contain a reference to an interface which may not exist on this machine. The data field contains the error number. Cause If the issue occurs only on Plesk Panel site, then the 8880 port/ SSL default * 8443 is probably listened by some other website in IIS. If the issue occurs with all websites in IIS, it means that some process is already using port 80 and IIS could not initialize the socket. Usually it means that another web server is running like Apache or webmail web server on port 80. Resolution Make sure that only Plesk Control Panel is binding to 8880 and 8443 ports Run the following command to find the PID of the process that listens corresponding ports: netstat -aon | findstr "":8880""netstat -aon | findstr "":8443"" The output will look like: C:\\Users\\Administrator>netstat -ano | findstr "":8443"" TCP 0.0.0.0:8443 0.0.0.0:0 LISTENING 4 TCP [::]:8443 [::]:0 LISTENING 4 To find the corresponding process use the following command: C:\\Users\\Administrator>tasklist /fi ""PID eq 4""Image Name PID Session Name Session# Mem Usage========================= ======== ================ =========== ============System 4 Services 0 304 K Please refer to the following #973094 article. Please pay attention to the HTTPMail that uses 8080 port, please refer to the mailenable me020202 article.
"
3,"A website opened over HTTPS shows content of another website Applicable to: Plesk for Linux Symptoms The website example.com opened over HTTPS shows content of another website. The option SSL/TLS support is disabled at Plesk > Domains > example.com > Hosting Settings. The option Default site is set to some hosted website at Tools & Settings > IP addresses > 203.0.113.2 (where 203.0.113.2 is the main Plesk IP address). Cause
When SSL/TLS support is disabled in Hosting Settings, the website example.com shows: a default Plesk page, if the option Default site is set to None at Tools & Settings > IP Addresses. content of a default website assigned for an IP address, if the option Default site is set to a hosted website at Tools & Settings > IP addresses > 203.0.113.2 (where 203.0.113.2 is the main Plesk IP address). Resolution
Apply one of the following solutions: Set the option Default site to none: In Plesk go to Tools & Settings > IP Addresses > 203.0.113.2 (where 203.0.113.2 is the main Plesk IP address). Set Default site to none. Click OK to apply the changes. Enable the option SSL/TLS support for the domain: In Plesk go to Domains > example.com > Hosting Settings. Check the option SSL/TLS support. Apply the changes. Additional Information Plesk Documentation: IP Addresses Management
"
0,"Logs are no longer rotated properly on some subscriptions
Applicable to:
Plesk for Linux
Symptoms Logs are not being rotated for several days for some subscriptions/domains. Configuration files for logrotate are missing from /usr/local/psa/etc/logrotate.d, however they are present for new domains. Cause
Logrotate config is missing after upgrade from the version, or config files were removed manually.
Resolution Connect to the server via SSH Recreate all the Logrotate configuration files for all domains with log rotation enabled:
# MYSQL_PWD=`cat /etc/psa/.psa.shadow` mysql -uadmin psa -Ne""select d.name from domains d join dom_param dp on d.id=dp.dom_id join log_rotation lr on dp.val=lr.id where dp.param='logrotation_id' and lr.turned_on='true';"" | while read d; do /usr/local/psa/bin/domain -u $d -log-rotate true; done
Note: If the solution from the article Logs are not being rotated for a domain in Plesk was applied before this article, the /usr/local/psa/var/logrotate.status file will contain incorrect data. Recreate it as described in Logs are not being rotated for a domain in Plesk "
3,"Prestashop blank page with PHP Fatal error: Call to undefined function mcrypt_encrypt()
Applicable to: Plesk for Linux Symptoms Fresh Prestashop installation is showing blank page; The following error is shown in Domains > example.com > Logs (/var/www/vhosts/system/logs/error_log):
CONFIG_TEXT: mod_fcgid: stderr: PHP Fatal error: Call to undefined function mcrypt_encrypt() in /var/www/vhosts/example.com/httpdocs/prestashop/classes/Rijndael.php on line 50 If PHP by OS vendor is used on the domain, the following command shows no output:
# rpm -qa | grep php-mcrypt
OR
PHP 7.2 or newer is used on the domain Cause
'php-mcrypt' module is not installed on the server, or it is not supported by the used PHP handler.
Resolution If OS vendor PHP is used on the domain Connect to the server via SSH; Install 'php-mcrypt' module:
For RHEL-based OSs:
# yum install php-mcrypt
For Debian-based OSs:
# apt-get install php5-mcrypt Find additional PHP .ini files folder:
# php -i | grep ""Scan this dir for additional .ini files"" Scan this dir for additional .ini files => /etc/php.d Add the configuration file mcrypt.ini to load the extension:
# echo ""extension=mcrypt.so"" >> /etc/php.d/mcrypt.ini If Plesk PHP 7.2 is used on the domain Note: PHP dropped mcrypt from PHP core starting from 7.2: Moving MCrypt to PECL Log into Plesk Install the mcrypt module on Plesk PHP 7.2: How to install the php-mcrypt module on a Plesk server
OR
Change PHP version to 7.1 or older: How to change PHP settings/version for a domain in Plesk? "
2,"Unable to activate domain in Plesk: The domain cannot be activated because it was disabled by your hosting provider
Applicable to: Plesk for Linux
Plesk for Windows Symptoms No backup operations are running Cannot activate domain in Plesk:
PLESK_ERROR: Error: The domain or website example.com cannot be activated because it was disabled by your hosting provider.
OR
PLESK_ERROR: Error: The domain or website example.com cannot be activated because it was suspended by your hosting provider. It may not be possible to activate it via CLI as well:
# plesk bin domain --on example.com An error occurred during turning domain on/off: The domain is suspended because the subscription is still suspended. Cause
Unclear.
Resolution Connect to a Plesk server via SSH/RDP Activate domain via CLI, if you did not try it yet:
# plesk bin domain --on example.com If the solution above did not help: activate domain in Plesk database Connect to a Plesk server via SSH/RDP Back up Plesk database Connect to Plesk database Set domain status to active:
MYSQL_LIN: mysql> update domains set status = 0 where name='example.com'; Set webspace status to active:
MYSQL_LIN: mysql> update domains set webspace_status=0 where name='example.com'; To activate domain aliases, find suspended ones and activate them using the value of dom_id:
MYSQL_LIN: mysql> select dom_id,displayName from domain_aliases where status!=0; +--------+-------------+ | dom_id | displayName | +--------+-------------+ | 40 | example.net | +--------+-------------+ mysql> update domain_aliases set status=0 where status=2 and dom_id=40; Log in to Plesk
Go to Domains > example.com. Suspend and activate the domain to ensure the issue got fixed. "
7,"Plesk for Windows services logs and configuration files
Applicable to: Plesk for Windows Question
Where to find Plesk for Windows services logs and configuration files?
Answer
This article's sole purpose is providing information regarding the services that Plesk interacts with. Below you will find the configuration and log file locations of the services, which may be useful during a troubleshooting procedure.
For Plesk on Linux see this article.
Services Plesk Management Service Plesk SQL Server (MySQL)
Plesk Installer Web Presence Builder phpMyAdmin myLittleAdmin 2000/2005 MailEnable Named / BIND NodeJS MySQL (local) SpamAssassin Dr.Web antivirus Kaspersky antivirus FTP Web Server (IIS) AWstats Webalizer
ModSecurity Backup Manager Plesk Migrator Plesk Migration Manager Horde Health Monitor Health Monitor Notification Daemon Tomcat (Java) WordPress Toolkit Plesk Management Service Logs: Access log: %plesk_dir%admin\logs\W3SVC<IIS site ID>\ex<date>.log PHP errors: %plesk_dir%admin\logs\php_error.log Debug logs: %plesk_dir%admin\logs\plesklog_debugXXXXXXXX.log (create DWORD value Debug=1 in HKLM\SOFTWARE\Wow6432Node\PLESK\PSA Config\Config ) Service control: Stop: net stop plesksrv /Y Start: net start plesksrv && net start poppassd Restart: net stop plesksrv /Y && net start plesksrv && net start poppassd Configuration: %plesk_dir%admin\conf\panel.ini IIS manager > Sites/Application Pools > PleskControlPanel Plesk SQL Server (MySQL) Logs: %plesk_dir%MySQL\Data\*.err Windows Event Viewer Service control: Stop: net stop plesksqlserver Start: net start plesksqlserver Restart: net stop plesksqlserver && net start plesksqlserver Configuration: %plesk_dir%MySQL\my.ini Plesk Installer Logs: C:\ParallelsInstaller\autoinstaller3.log
C:\ProgramData\Plesk\Installer\autoinstaller3.log Web Presence Builder Logs: Error logs: %plesk_dir%sb\logs\ Install/upgrade logs: %plesk_dir%sb\ mp\ Service log: %plesk_dir%admin\logs\plesklog_sitebuilder.log No service control (working on IIS)
Configuration: %plesk_dir%sb\config phpMyAdmin (web interface for MySQL management) Logs: %plesk_dir%admin\logs\W3SVC<IIS site ID>\ex<date>.log No service control (working via the plesksrv service).
Configuration: %plesk_dir%admin\htdocs\domains\databases\phpMyAdmin\config.inc.php myLittleAdmin 2000/2005 (web interface for MSSQL management) Configuration: IIS manager > Sites > sqladmin(default) > View Applications > /myLittleAdmin %plesk_dir%MyLittleAdmin %plesk_vhosts%sqladmin\myLittleAdmin\2005\config.xml MailEnable (mail server) Logs: %plesk_dir%Mail Servers\Mail Enable\Logging Service control: Stop: net stop meimaps && net stop melcs && net stop memtas && net stop mepops && net stop mepocs && net stop mesptpcs Start: net start meimaps && net start melcs && net start memtas && net start mepops && net start mepocs && net start mesptpcs Restart: net stop meimaps && net stop melcs && net stop memtas && net stop mepops && net stop mepocs && net stop mesptpcs && net start meimaps && net start melcs && net start memtas && net start mepops && net start mepocs && net start mesptpcs Configuration: %plesk_dir%Mail Servers\Mail Enable\Bin\MailEnable.msc Named / BIND Logs: Windows Event Viewer Service control: Stop: net stop named Start: net start named Restart: net stop named && net start named Configuration: %plesk_dir%dns NodeJS Logs: %plesk_vhosts%<domain>\logs\iisnode MySQL (local) Logs: %plesk_dir%Databases\MySQL\Data\*.err Windows Event Viewer Service control: Stop: net stop mysqlNN Start: net start mysqlNN Restart: net stop mysqlNN && net start mysqlNN Note: NN - is a version of installed MySQL. It can be equal to 51, 55, 56, etc.- Configuration: - %plesk_dir%Databases\MySQL\Data\my.ini SpamAssassin Logs: %plesk_dir%\admin\logs\plesklog_spamstatYYYYMMDD.log
Windows Event Viewer (with DWORD value Debug set to 1 in registry in HKLM\SOFTWARE\PLESK\PSA Config\Config) Configuration: %plesk_dir%Additional\SpamAssassin\var\spamassassin\3.004001\ Dr.Web antivirus Logs: %plesk_dir%\DrWeb\drcom.log
%plesk_dir%\admin\logs\plesklog_avstatYYYYMMDD.log Service control: Stop: net stop DrWebCom Start: net start DrWebCom Restart: net stop DrWebCom && net start DrWebCom Kaspersky antivirus Logs: %plesk_dir%\admin\logs\plesklog_avstatYYYYMMDD.log
Windows Event Viewer Service control: Stop: net stop kavsvc Start: net start kavsvc Restart: net stop kavsvc && net start kavsvc Configuration: %plesk_dir%kav\settings.xml FTP Logs: %plesk_vhosts%Servers\<ID>\logs Service control: Stop: net stop iisadmin Start: net start iisadmin Restart: net stop iisadmin && net start iisadmin Configuration: IIS Manager > Sites > <IP_address> Web server (IIS) Logs: Windows Event Viewer
Domain logs: %plesk_vhosts%<domain>\logs\iis\W3SVC<SITE ID> Service control: Stop: iisreset /stop Start: iisreset /start Restart: iisreset Configuration: IIS Manager AWstats Configuration: %plesk_dir%Additional\AWStats\wwwroot\cgi-bin\awstats.<domain>.conf Webalizer Configuration: %plesk_dir%Additional\Webalizer\conf\webalizer.conf ModSecurity Logs: %plesk_dir%\ModSecurity\vhosts\<domain's GUID>\logs Backup Manager Logs Backup logs: %plesk_dir%PMM\logs\backup-<datetime> Restore log: %plesk_dir%PMM\logs\restore-<datetime> Additional logs: %plesk_dir%PMM\logs\pmmcli.log , %plesk_dir%PMM\logs\pmmcli_daemon.log Functionality is controlled by Plesk control panel service Plesk Migrator Configuration %plesk_dir%var\modules\panel-migrator\conf\ Logs %plesk_dir%var\modules\panel-migrator\logs\ Migration Manager Logs %plesk_dir%PMM\logs\migration-<datetime> Functionality is controlled by Plesk control panel service Horde (webmail) Logs: %plesk_dir%tmp\horde\horde.log Configuration: IIS manager > Sites > webmail(horde) PHP configuration: %plesk_dir%Webmail\horde\conf\php.ini %plesk_dir%webmail\horde\horde\config\conf.php Health Monitor Logs: %plesk_dir%admin\logs\health-alarm.log %plesk_dir%admin\logs\HealthMonitoring.log Service control: Stop: net stop ParallelsHealthMonitor Start: net start ParallelsHealthMonitor Restart: net stop ParallelsHealthMonitor && net start ParallelsHealthMonitor Configuration: %plesk_dir%admin\conf\custom-health-config.xml %plesk_dir%admin\conf\health-config.xml Health Monitor Notification Daemon Logs: %plesk_dir%admin\logs\HealthNotifier.log Service control: Stop: net stop ParallelsHealthNotifier Start: net start ParallelsHealthNotifier Restart: net stop ParallelsHealthNotifier && net start ParallelsHealthNotifier Configuration: %plesk_dir%admin\conf\custom-health-config.xml %plesk_dir%admin\conf\health-config.xml Tomcat Logs: C:\Program Files\Apache Software Foundation\Tomcat 7.0\logs\ Service control: Stop: net stop Tomcat7 Start: net start Tomcat7 Restart: net stop Tomcat7 && net start Tomcat7 Configuration: C:\Program Files\Apache Software Foundation\Tomcat 7.0\conf\server.xml WordPress Toolkit Log: %plesk_dir%admin\logs\php_error.log with Debug mode enabled User actions logging: Tools & Settings > Action log "
0,"How to customize permissions for Plesk users through Disk Security?
Applicable to: Plesk Onyx for Windows Question
How to customize permissions for Plesk users through Disk Security?
For example, there is an application installed into the folder C:\Program Files\AppName. This module is used on customer's sites, but it does not work properly because Panel's default security rules prohibit customers from accessing arbitrary folders on the disk. Answer
To customize disk security, create an additional file with the .xml extension in the %plesk_dir%etc\DiskSecurity directory and specify additional security rules in the file. This will track changes and manipulate sets of security metadata easily.
For example: Connect to the server via RDP; Create file permissions.xml in %plesk_dir%\etc\DiskSecurity\ CONFIG_TEXT: <?xml version=""1.0"" encoding=""utf-8"" ?><Entries><Entry AccounType=""1"" Account=""Psacln"" Path=""C:\Program Files\"" SubPath=""AppName"" AceFlags=""ThisFolderSubfoldersAndFiles"" AccessMask=""FullAccess"" EntryFlags=""0x0"" /><Entry AccounType=""1"" Account=""Psaadm"" Path=""C:\Program Files\"" SubPath=""AppName"" AceFlags=""ThisFolderSubfoldersAndFiles"" AccessMask=""FullAccess"" EntryFlags=""0x0"" /></Entries> Run the ApplySecurity.exe utility:
C:\> ""%plesk_bin64%""\ApplySecurity.exe --apply-to-directory --directory=""C:\Program Files"" This file will be read during re-applying permissions by Plesk repair utility when it is either called directly from CLI or by Plesk Reconfigurator utility:
C:\> plesk repair --directory-permissions -directory ""C:\Program Files""
Additional Information
Refer to following Plesk documentation for more details: Customizing Disk Security "
8,"How to configure Qmail to use a specific IP address for outgoing email in Plesk?
Applicable to:
Plesk for Linux How to configure Qmail to use a specific IP address for outgoing email in Plesk?
Resolution
Note: Plesk GUI provides the option to configure the outgoing IP address for the email when Postfix is installed instead of Qmail. Check Plesk documentation for more details. Connect to the server via SSH Create the file /var/qmail/control/outgoingip and add the IP address:
# cat /var/qmail/control/outgoingip 203.0.113.2 Restart QMail service:
# service qmail restart "
0,"How to access a domain by IP address in Plesk
Applicable to: Plesk for Linux
Plesk for Windows Question
How to access a domain using the IP address instead of the domain name like http://xxx.xxx.xxx.xxx?
Answer
To specify which website will open when users refer to the web resource on your server by an IP address: Connect to the server via SSH. Go to Tools & Settings > IP addresses > <domain_ip>> Default site. All sites hosted on this IP address will be listed. Click the address assigned to the website and select the Default site from the drop-down list, select the required one and click OK. Note: The default server page will be shown if the Default site option is set to None. Additionally, it is possible to set the default domain using the command line on Plesk Onyx. Connect to the server via SSH or RDP and execute the following command (substitute example.com with the necessary domain name):
# plesk bin subscription_settings --set-default example.com"
8,"Error while changing mail settings or migrating a domain: There is no mail service for domain with id = 1
Applicable to: Plesk for Linux
Plesk for Windows Symptoms When creating a user or changing mail settings in Plesk, the following error is encountered:
PLESK_ERROR: There is no mail service for domain with id = 1. It must be created before call update
Or:
PLESK_ERROR: Error: There is no DSMail service for domain with id = 1 The following error may appear in migration logs when trying to migrate a domain to a new server without mail service enabled:
PLESK_ERROR: Failed to perform an action on subscription 'example.com': Unable to create mail account 'user@example.com' in subscription 'example.com': Command execution failed on the local server with non-zero exit code. command: /usr/local/psa/bin/mail --create user@example.com -mailbox true -passwd '***hidden***' -ignore-nonexistent-options exit code: 1 stdout: stderr: There is no DSMail service for domain with id = 11 Cause
The Mail service entry is missing for a domain in the psa database for one of the subscriptions due to a database inconsistency or missing mail service
Resolution For Linux Log into Plesk. Open Tools&Settings > Updates and Upgrades to make sure that all components were installed, including mail server. Make sure that mail service is enabled in Tools&Settings > Mail Server Settings: Note: even if mail service is enabled, disable it and enable again. Connect to the server via SSH. Activate the Mail service for the domain via CLI in order to re-generate the correct entries in the database. Single domain:
# /usr/local/psa/bin/domain --update example.com -mail_service true All the domains:
# for i in `plesk db -Ne""select name from domains;""`; do plesk bin domain -u $i -mail_service true; done For Windows Log into Plesk. Open Tools & Settings > Updates and Upgrades to make sure that all components were installed, including mail server. Make sure that mail service is enabled in Tools&Settings > Mail Server Settings: Note: even if mail service is enabled, disable it and enable again. Connect to the server via RDP. Activate the Mail service for the domain via CLI in order to re-generate the correct entries in the database. Single domain:
C:\>""%plesk_bin%\\mail.exe"" --update-service example.com -status enabled All the domains:
Download, unpack and run the script from the attachment. "
0,"How to change the port for the Plesk interface on Windows Applicable to: Plesk for Windows Question
How to change the port for the Plesk interface on Windows?
Answer
Warning: For many systems, Plesk must be accessible on the default ports. Port 8443 is used by external management and provisioning systems (Odin Service Automation, OBA-S, Customer & Business Manager) to communicate with Plesk, while port 8880 is required by Web Presence Builder and for integration with Virtuozzo containers offline management services.
Warning: The migration manager does not work with custom Plesk ports. In case custom ports are set to Plesk, migration between two Plesk panels will fail.
Warning: Any customization made on this matter is bound to be reverted back eventually on a Plesk update.
If it is required to make Plesk accessible on a custom port, it is better to add binding to the PleskControlPanel website in IIS: Connect to the server using RDP. Go to Internet Information Services (IIS) Manager > Sites > right-click on PleskControlPanel > Edit bindings.. > Add... Specify the protocol, IP address (or leave default value), and port. If the https protocol is selected, it is necessary to select the SSL certificate from the drop-down menu.
Apply the new bindings and restart the PleskControlPanel website.
Make sure that the firewall allows incoming connections to the TCP port, as defined in the new binding. Note: Default bindings will be restored if the Plesk installation is repaired with Plesk Reconfigurator ( Plesk Reconfigurator > Repair Plesk Installation > Plesk Services and click Check).
Additional Information
Which Ports Need To Be Opened for all Plesk Services to Work with a Firewall?"
0,"How to get a list of Plesk domains and their IP addresses?
Applicable to: Plesk Onyx for Linux
Plesk Onyx for Windows Question
How to get a list of domains and their IP addresses?
Answer
It is possible to retrieve corresponding information from Plesk database via command line interface. Plesk For Linux Connect to the server via SSH Run the following command:
# plesk db ""SELECT dom.id, dom.name, ia.ipAddressId, iad.ip_address FROM domains dom LEFT JOIN DomainServices d ON (dom.id = d.dom_id AND d.type = 'web') LEFT JOIN IpAddressesCollections ia ON ia.ipCollectionId = d.ipCollectionId LEFT JOIN IP_Addresses iad ON iad.id = ia.ipAddressId""
The output of the commands would look as follows:
CONFIG_TEXT: +----+--------------+--------------------+--------------+ | id | name | ipAddressId | ip_address | +----+--------------+--------------------+--------------+ | 1 | example.com | 1 | 203.0.113.2 | | 2 | example.net | 2 | 203.0.113.3 | | 3 | example.org | 3 | 203.0.113.4 | +-------------------+--------------------+--------------+ Plesk For Windows Connect to the server via RDP; Run following command from command prompt as administrator:
C:\> ""%plesk_bin%\\dbclient.exe"" --direct-sql --sql=""SELECT dom.id, dom.name, ia.ipAddressId, iad.ip_address FROM domains dom LEFT JOIN DomainServices d ON (dom.id = d.dom_id AND d.type = 'web') LEFT JOIN IpAddressesCollections ia ON ia.ipCollectionId = d.ipCollectionId LEFT JOIN IP_Addresses iad ON iad.id = ia.ipAddressId;""
The output of the commands would look as follows:
CONFIG_TEXT: +----+--------------+--------------------+--------------+ | id | name | ipAddressId | ip_address | +----+--------------+--------------------+--------------+ | 1 | example.com | 1 | 203.0.113.2 | | 2 | example.net | 2 | 203.0.113.3 | | 3 | example.org | 3 | 203.0.113.4 | +-------------------+--------------------+--------------+ "
6,"How to repair non-InnoDB MySQL tables on Plesk server?
Applicable to: Plesk for Windows
Plesk for Linux Question
How to repair non-InnoDB MySQL tables on Plesk server?
Answer Log into Plesk Go to Domains > example.com > Databases and click Check and Repair for the required database Command-line solution Linux-based operating systems: Connect to server over SSH Execute the below command substituting required table and database:
# MYSQL_PWD=`cat /etc/psa/.psa.shadow` mysqlcheck <database name> <table name> --repair -u admin Windows-based operating systems Connect to server via RDP Open command-line console cmd.exe with Administrator privileges. Execute below command substituting required table and database:
MYSQL_WIN: C:>""%plesk_dir%MySQL\bin\mysqlcheck"" -P3306 -uadmin -p -r <database name> <table name>
If the password is unknown, reset it according to this KB article. Not all the storage engines in MySQL database support repair of the tables. If storage engine does not support repair the following message will appear:
CONFIG_TEXT: The storage engine for the table doesn't support repair
In such a case, follow the instructions provided in the article: How to fix InnoDB corruption cases for the MySQL database?
Additional Information
How to access MySQL databases?"
5," Unable to connect to a Plesk server via FTP in the passive mode
Applicable to: Plesk for Linux
Plesk for Windows Symptoms It is not possible to connect to a Plesk server (or if connected, copy files) via FTP in the passive mode. One of the following error messages appears during connection (Error message varies depending on FTP client):
PLESK_INFO: 530 Login incorrect. Login failed.
OR
PLESK_INFO: ftp: connect: Connection refused
OR
PLESK_INFO: Response: 227 Entering Passive Mode (203,0,113,111,250,241). ... Error: Connection timed out after 20 seconds of inactivity Error: Failed to retrieve directory listing
OR
PLESK_INFO: ftp: connect: Connection timed out
OR
PLESK_INFO: 425 Can't open data connection.
OR
PLESK_INFO: An error occurred opening that folder on the FTP server. Make sure you have permission to access that folder. The operation timed out
OR
PLESK_INFO: Error listing directory '/httpdocs'. Transfer channel can't be opened. Reason: No connection could be made because the target machine actively refused it. Could not retrieve directory listing
OR
PLESK_INFO: Connecting data socket to (203.0.113.2) port 39383 Socket error (Connection timed out) - reconnecting Additional symptoms on Linux It is not possible to get a directory listing by FTP using Secured TLS: the connection establishes but directory listing does not work. The following errors appear in /var/log/secure:
CONFIG_TEXT: pam_env(proftpd:setcred): Unable to open config file: /etc/security/pam_env.conf: Permission denied pam_systemd(proftpd:session): Failed to connect to system bus: Permission denied pam_listfile(proftpd:auth): Couldn't open /etc/ftpusers The following records appear in /var/log/syslog:
CONFIG_TEXT: proftpd[3494]: fatal: PassivePorts: missing arguments on line 17 of '/etc/proftpd.conf' Cause
The passive port range is not properly configured.
Resolution
Configure the passive port range: Plesk for Linux How to configure the passive ports range for ProFTPd on a server behind a firewall Plesk for Windows Server How to configure a passive FTP port range on Windows Server Plesk for cloud solutions Configuring the Passive FTP Mode on an Amazon EC2 Instance Open Access to Plesk Services on an Amazon Lightsail Instance Configuring the Passive FTP Mode on a Microsoft Azure Instance Configuring Passive FTP Mode on a Google Cloud Instance Installing Plesk on Alibaba Cloud (Opening Ports Used by Plesk section) Related Articles How to configure ProFTPd to return a proper external IP address
"
8,"How to test SpamAssassin or antivirus software in Plesk?
Applicable to: Plesk for Linux
Plesk for Windows Question
How to test SpamAssassin or Kaspersky and Plesk Premium Antivirus antiviruses?
Where to see if the message is blocked by antivirus?
Answer
SpamAssassin
To test SpamAssassin, it is necessary to send a test email containing the following string of characters in the message body (in upper case and with no spaces or line breaks):
CONFIG_TEXT: XJS*C4JDBQADN1.NSBN3*2IDNEN*GTUBE-STANDARD-ANTI-UBE-TEST-EMAIL*C.34X
Note: The test email should be sent from a mailbox that is not located on the server.
While testing, note that Gtube test email gives +1000 scores to spam. So, even if a mailbox is in the whitelist, mail still be detected as spam because whitelisted email gets -100 scores. Detailed information about scores can be found in an email header. The output will look similar to:
CONFIG_TEXT: X-Spam-Report: * -100 USER_IN_WHITELIST From: address is in the user's white-list* -1.0 ALL_TRUSTED Passed through trusted hosts only via SMTP* 1000 GTUBE BODY: Generic Test for Unsolicited Bulk Email* 0.0 TVD_SPACE_RATIO No description available.
Antiviruses
To test Kaspersky Antivirus, Plesk Premium Antivirus or any other antivirus download and attach to email special test file eicar.zip
The file that already contains a special string and provided by Kaspersky Labs: https://support.kaspersky.com/common/diagnostics/7399 Alternatively attach a test file with file extension "".com"" that contains this special string:
CONFIG_TEXT: X5O!P%@AP[4\\PZX54(P^)7CC)7}$EICAR-STANDARD-ANTIVIRUS-TEST-FILE!$H+H*
On Plesk for Windows, the results can be seen in the file %plesk_dir%admin\logs\plesklog_avstat<date>.log.
Note: Plesk application debug should be enabled in the registry: set the value of the DWORD parameter debug to 1 in HKEY_LOCAL_MACHINE\SOFTWARE\Wow6432Node\PLESK\PSA Config\Config.
Additional Information
SpamAssassin Spam Filter"
7,"Plesk deployed on the Amazon EC2 web service has incorrect IP mapping after each restart
Applicable to: Plesk Onyx for Linux Symptoms
Plesk, which is deployed on the Amazon EC2 web service has incorrect IP mapping after each restart. It has mapping between several Elastic IP Addresses and public IPs, however, after a restart of VM, there is only one public IP for all private IPs.
Cause
Elastic IP addresses are not being assigned to Amazon Virtual Machine instance
Resolution To avoid incorrect remapping between Elastic IP Addresses and Public IP address after restart it is required to configure your AWS instance properly as it is described in Plesk Documentation - Deployment on Amazon EC2:
It is recommended to attach your Elastic IP to the instance. In the left menu, select Elastic IPs and Allocate New Address, or select any existing unassociated address to be associated to your instance. After the Elastic IP attachment, reboot the instance and perform additional actions to configure Plesk (see the Changing IP Address section). Learn more about Elastic IP in the Amazon AWS documentation: Elastic IP Addresses Otherwise, disable Prepare public IP scheduled task in Windows Task Scheduler. "
8,"Error while trying to send mail on Plesk Onyx with CBM: Recipient address rejected: User unknown in virtual alias table
Applicable to: Plesk Onyx for Linux Symptoms After upgrading to Plesk Onyx, email notifications with the following content is sent from psaadm@example.com address:
CONFIG_TEXT: This is the mail system at host example.com. I'm sorry to have to inform you that your message could not be delivered to one or more recipients. It's attached below. For further assistance, please send mail to postmaster. If you do so, please include this problem report. You can delete your own text from the attached returned message. Upon sending an email to psaadm@example.com (system user), the following error appears in /var/log/maillog : postfix/error[20590]: 42B11620B2C: to=<psaadm@example.com>, orig_to=<psaadm>, relay=none, delay=0.02, delays=0.01/0/0/0, dsn=5.0.0, status=bounced (User unknown in virtual alias table) User psaadm@example.com is absent in the virtual alias table:
# postmap -s /var/spool/postfix/plesk/virtual | grep psaadm@example.com If Qmail was installed, the following message is received:
CONFIG_TEXT: psaadm@example.com: Sorry, no mailbox here by that name. (#5.1.1) --- Below this line is a copy of the message. Return-Path: root@example.com Received: (qmail 22583 invoked by uid 500); 31 Jan 2018 09:45:02 +0000 Date: 31 Jan 2018 09:45:02 +0000 Message-ID: 20180131094502.22566.qmail@example.com From: root@example.com (Cron Daemon) To: psaadm@example.com Subject: Cron psaadm@example.com /opt/plesk-billing/task-manager/scripts/run-all.sh --config /opt/plesk-billing/task-manager/config/config.ini Content-Type: text/plain; charset=UTF-8 Auto-Submitted: auto-generated X-Cron-Env: <LANG=en_US.UTF-8> X-Cron-Env: <SHELL=/bin/sh> X-Cron-Env: <HOME=/usr/local/psa/admin> X-Cron-Env: <PATH=/usr/bin:/bin> X-Cron-Env: <LOGNAME=psaadm> X-Cron-Env: <USER=psaadm> File not found. Cause
The issue is caused by a Customer Business Manager (CBM) cron task file /etc/cron.d/billing-task-manager left on the server after an upgrade.
This behavior is expected on Plesk Onyx servers that were upgraded from Plesk 12.5 without preliminary removing CBM.
Resolution Connect to the server via SSH Uninstall Customer and Business Manager (CBM) from the server using steps from this article; Remove /etc/cron.d/billing-task-manager on all Plesk Onyx servers that used to use CBM.
# rm -rf /etc/cron.d/billing-task-manager "
3,"Unable to start Apache: (28)No space left on device: AH00023: Couldn't create the mutex
Applicable to: Plesk Symptoms Apache cannot be started:
# service httpd start Starting httpd : [Failed]
Or:
Apache reload results in failed state and hard Apache restart is performed:
CONFIG_TEXT: Sep 20 17:29:45 example systemd[1]: Reloaded The Apache HTTP Server. Sep 20 17:29:50 example systemd[1]: httpd.service: main process exited, code=exited, status=1/FAILURE Sep 20 17:29:50 example kill[3280]: kill: cannot find process """" Sep 20 17:29:50 example systemd[1]: httpd.service: control process exited, code=exited status=1 Sep 20 17:29:50 example systemd[1]: Unit httpd.service entered failed state. Sep 20 17:29:50 example systemd[1]: httpd.service failed. Sep 20 17:29:51 example systemd[1]: Starting The Apache HTTP Server... The following error can be found in the Apache error log file /var/log/httpd/error_log on RHEL/CentOS /var/log/apache2/error_log on Debian/Ubuntu:
CONFIG_TEXT: [Mon Oct 07 18:20:01 2013] [error] (28)No space left on device: Cannot create SSLMutex
OR:
CONFIG_TEXT: [Wed Oct 25 02:41:36 2017] [emerg] (28)No space left on device: Couldn't create accept lock (/etc/httpd/logs/accept.lock.44778) (5)
OR:
CONFIG_TEXT: [Wed Oct 25 04:45:05 2017] [emerg] (43)Identifier removed: couldn't grab the accept mutex
OR:
CONFIG_TEXT: [Thu Sep 20 17:39:20.139444 2018] [core:emerg] [pid 4565] (28)No space left on device: AH00023: Couldn't create the fcgid-pipe mutex
OR:
CONFIG_TEXT: [Thu Sep 20 17:39:54.387218 2018] [core:emerg] [pid 9462] (28)No space left on device: AH00023: Couldn't create the rewrite-map mutex Semaphore limit is reached:
# ipcs -s | wc -l 32004
While:
# cat /proc/sys/kernel/msgmni 32000
Or:
# cat /proc/sys/kernel/sem 250 24000 32 1024 Cause
Lack of inner-process communication resources in the system, such as semaphores or shared memory segments. This behavior is expected to be fixed in next versions of Plesk Obsidian.
Resolution
As a workaround, perform the following steps: Login to the server via SSH. Increase the limits in sysctl configuration:
# mkdir -p /etc/sysctl.d/ # touch /etc/sysctl.d/99-zz_plesk_semaphores.conf # chmod 755 /etc/sysctl.d/ /etc/sysctl.d/99-zz_plesk_semaphores.conf # chown root:root /etc/sysctl.d/ /etc/sysctl.d/99-zz_plesk_semaphores.conf
Such /etc/sysctl.d/99-zz_plesk_semaphores.conf configuration file has to contain:
CONFIG_TEXT: kernel.msgmni = 64000 kernel.sem = 250 256000 32 1024 Load the new sysctl settings from sysctl
# sysctl -p Check which user exhausted semaphores:
# ipcs -s | tail -n +4 | head -n -1 | tr -s ' ' | cut -d' ' -f3 | sort | uniq -c | sort -nr 234 somesoftware 33 httpd 4 root Clean semaphores left by Apache:
# ipcs -s | tail -n +4 | head -n -1 | tr -s ' ' | cut -d' ' -f2,3 | while read -r id owner; do [[ $owner == ""httpd"" ]] && ipcrm -s ""$id""; done
In case some other software heavily abusing semaphore limit, disable this software, clean its' semaphores and contact software provider for further investigation:
# ipcs -s | tail -n +4 | head -n -1 | tr -s ' ' | cut -d' ' -f2,3 | while read -r id owner; do [[ $owner == ""somesoftware"" ]] && ipcrm -s ""$id""; done Start Apache:
# service httpd start "
0,"How to trace failed requests for domain on Windows Server? Applicable to: Plesk for Windows Question
How to trace failed requests for domain on windows Server?
Answer Failed Request tracing is a troubleshooting tool that can be useful in the situations when you need to figure out the component, module name or the webpage that causes the error accessing webpage.It can be installed with IIS 7 and higher. For Plesk 12.5 and higher
1. Go to that domain's Websites and Domains page > Failed Requests Tracing and 2. Click Start Tracing. Additional information is available here: Tracing Failed Requests - Plesk Docs For Plesk 12.x and below
It is required to enable it manually: refer to Microsoft article to enable tracing errors on the server: http://www.iis.net/configreference/system.applicationhost/sites/site/tracefailedrequestslogging ."
2,"Plesk sw-engine process causes high CPU usage
Applicable to:
Plesk for Linux
Symptoms
Plesk sw-engine process causes high CPU usage:
# ps aux | grep sw-engine root 1242 0.0 0.3 348136 28732 ? Ss Jan14 0:14 /usr/bin/sw-engine -c /usr/local/psa/admin/conf/php.ini /usr/local/psa/admin/bin/modules/watchdog/wdcollect -c /usr/local/psa/etc/modules/watchdog/wdcollect.inc.php root 2315 0.0 0.1 353260 9908 ? Ss Jan14 0:00 sw-engine-fpm: master process (/etc/sw-engine/sw-engine-fpm.conf) root 3136 0.0 0.3 363840 32028 ? S Jan14 1:00 /usr/bin/sw-engine -c /usr/local/psa/admin/conf/php.ini /usr/lib64/plesk-9.0/psa-health-monitor-notification.php
Cause
Some sw-engine child processes are stuck and cannot be stopped normally.
Resolution Connect to the server via SSH. Stop sw-engine service:
# service sw-engine stop Stopping sw-engine-fpm: [ OK ] Kill stuck processes:
# kill -9 <process_ID>
where <process_ID> are IDs of stuck sw-engineprocesses from ps aux command Start sw-engine service:
# service sw-engine start Starting sw-engine-fpm: [ OK ] Additional information
Process sw-engine produces high CPU usage"
8,"Mail management is unavailable: Warning: Permission denied
Applicable to: Plesk for Windows
Plesk for Linux Symptoms When clicking on Domains > example.com > Mail Settings, the following warning is shown:
PLESK_WARN: Warning: Permission Denied Mail tab is missing in the subscription menu. Mail management functions are disabled in Tools & Settings > Mail Server Settings. On Linux the following error can be found in /var/log/plesk/panel/panel.log:
CONFIG_TEXT: [2018-03-16 16:53:33] ERR [panel] PleskPermissionDeniedException: Permission Denied. file: /usr/local/psa/admin/plib/Smb/Controller/Action/Admin/MailSection.php line: 28 code: 0 Cause
Mail management functions are not available bеcause they are disabled in Plesk mail settings.
Resolution Log into Plesk as an administrator and go to Tools & Settings > Mail Server Settings.
Note: if the access to admin account is not available, contact server administrator. Select the checkbox Enable mail management functions in Plesk. Click OK to apply the changes. Note: In case Mail service for the license is disabled in Partners Central, activate it in order to prevent the issue from happening again. If the license was bought not directly from Plesk, please consult the reseller."
0,"How to restore default permissions in the virtual host directory on Linux? Applicable to: Plesk for Linux Question How to restore the default permissions for the virtual host? Answer
Note: solution for Plesk for Windows is available in the article #213376469. Connect to the server using SSH. Run the following commands:
# find /var/www/vhosts/example.com/httpdocs/ -type f -exec chmod 644 {} \; # find /var/www/vhosts/example.com/httpdocs/ -type d -exec chmod 755 {} \; # find /var/www/vhosts/example.com/httpdocs/ -type f -exec chown user_example:psacln {} \; # find /var/www/vhosts/example.com/httpdocs/ -type d -exec chown user_example:psacln {} \;
Note: substitute example.com with the real subscription name and user_example with the system user of the subscription. Additional information
The virtual host structure description can be found in the Virtual Host Structure page.
Here are the default permissions for Plesk 12.5 domain:
# ls -la /var/www/vhosts/example.com total 16 drwx--x--- 4 admin123 psaserv 4096 Jan 5 13:14 . drwxr-xr-x 13 root root 4096 Jan 5 13:14 .. drwxr-x--- 6 admin123 psaserv 4096 Jan 5 13:14 httpdocs drwx------ 2 admin123 root 4096 Jan 5 13:15 logs # ls -la /var/www/vhosts/system/example.com total 24 drwx--x--x 6 root psaserv 4096 Jan 5 13:14 . drwxr-xr-x 7 root root 4096 Jan 5 13:14 .. drwxr-x--- 2 root psaserv 4096 Jan 5 13:15 conf drwxr-xr-x 2 root root 4096 Jan 5 13:14 etc drwx------ 2 psaadm root 4096 Jan 5 13:15 logs dr-xr-x--- 6 root psaserv 4096 Jan 5 13:14 statistics"
6,"mssqlmng failed: User does not have permission to use the KILL statement
Applicable to: Plesk 12.0 for Windows
Plesk Obsidian for Windows
Plesk Onyx for Linux Symptoms
Delete database login failed:
CONFIG_TEXT: mssqlmng failed: User does not have permission to use the KILL statement
Cause
User does not have sufficient permissions or some transaction on <DATABASE_NAME> is in progress.
Resolution
Note: The KILL will initiate a ROLLBACK on the table (which can take quite a while on a large table) to maintain DB consistency.
Login to the MS SQL server as sa user, execute sp_who then use command KILL <SPID>
Ensure that user <login> used to connect to the MS SQL server has 'Process Admin (processadmin)' SQL server role granted: Connect to the server via RDP;
Log into Microsoft SQL Server Management Studio;
Go to Security > Logins, right-click on <DATABASE_NAME> and go to Properties;
Click on Server Roles Page;
Check the 'processadmin' role and click OK. Or grant these permissions to that user:
CONFIG_TEXT: GRANT ALTER ANY CONNECTION TO <login>
Additional information
User does not have permission to use kill statement "
2,"Unable to create a domain or a subscription in Plesk: There are no available resources of this type (domains) left
Applicable to: Plesk Symptoms It is not possible to migrate subscription, the following error appears:
PLESK_ERROR: Failed deployment of domain example.com Execution of /opt/psa/admin/plib/api-cli/domain.php --create example.com -owner admin -do-not-apply-skeleton -notify false -guid b55020df-blya-4ecc-824e-2bdfb9dab685 -creation-date 2011-09-17 -ignore-nonexistent-options failed with return code 1. Stderr is An error occurred during domain creation: There are no available resources of this type (domains) left. Requested: 1; available: 0. It is not possible to create a new subscription, the following error appears in Plesk:
PLESK_ERROR: Error: There are no available resources of this type (domains) left. Requested: 1; available: 0. Cause
The issue is caused by Plesk license limitations. The limit of domains has been reached.
Resolution Check the Plesk license via Tools & Settings > License Management . Make sure that the number of domains does not reach limits. It can be done from the command line as follows: Windows C:\> ""%plesk_dir%MySQL\bin\mysql.exe"" -uadmin -p<plesk-admin-password> -P8306 -Dpsa -e ""SELECT COUNT(*) FROM psa.domains WHERE parentDomainId = 0;"" +----------+ | COUNT(*) | +----------+ | 6 | +----------+ Linux # MYSQL_PWD=`cat /etc/psa/.psa.shadow` mysql -uadmin psa -e ""SELECT COUNT(*) FROM psa.domains WHERE parentDomainId = 0;"" +----------+ | COUNT(*) | +----------+ | 1 | +----------+ "
8,"How to change PHP version for webmail in Plesk for Linux
Applicable to: Plesk Onyx for Linux Question
How to change PHP version for webmail in Plesk for Linux?
Answer
Note: In Plesk Obsidian, webmail uses PHP 7.3 that comes with Plesk. Connect to a Plesk server via SSH. Create a directory for custom configuration templates:
# mkdir -p /usr/local/psa/admin/conf/templates/custom/webmail Copy the original files roundcube.php and horde.php to the created directory: Roundcube:
# cp /usr/local/psa/admin/conf/templates/default/webmail/roundcube.php /usr/local/psa/admin/conf/templates/custom/webmail/ Horde:
# cp /usr/local/psa/admin/conf/templates/default/webmail/horde.php /usr/local/psa/admin/conf/templates/custom/webmail/ Run the command below to list all available PHP versions. If a required PHP version is not listed, install it using the steps from this KB article.
# plesk bin php_handler --list | grep fastcgi id: display name: fastcgi 5.4.16 by OS vendor plesk-php56-fastcgi 5.6.40 plesk-php70-fastcgi 7.0.33 plesk-php71-fastcgi 7.1.32 plesk-php72-fastcgi 7.2.23 plesk-php73-fastcgi 7.3.10 Modify the configuration file of Roundcube:
5.1. Open the roundcube.php file in a text editor. In this example, we are using the vi editor:
# vi /usr/local/psa/admin/conf/templates/custom/webmail/roundcube.php
5.2. Change the PHP handler from 'fastcgi' to any other id from step 4. In this example, we are setting PHP version 7.2: Before
CONFIG_TEXT: FcgidInitialEnv PP_CUSTOM_PHP_CGI_INDEX fastcgi After
CONFIG_TEXT: FcgidInitialEnv PP_CUSTOM_PHP_CGI_INDEX plesk-php73-fastcgi 5.3. Save the changes and close the file. Modify the configuration file of Horde:
6.1. Open the horde.php file in a text editor:
# vi /usr/local/psa/admin/conf/templates/custom/webmail/horde.php
6.2. Change the PHP handler from 'fastcgi' to any other id from step 4. In this example, we are setting PHP version 7.2: Before
CONFIG_TEXT: FcgidInitialEnv PP_CUSTOM_PHP_CGI_INDEX fastcgi After
CONFIG_TEXT: FcgidInitialEnv PP_CUSTOM_PHP_CGI_INDEX plesk-php73-fastcgi 6.3. Save the changes and close the file. Regenerate configuration files to apply the changes:
# plesk repair web -server "
7,"Plesk End of Life (EOL) Policy StatementInformation
Information about the Plesk End of Life Policy can be found here: Plesk Lifecycle Policy. End of Life cycle means that no support and new updates will be provided by Plesk. Plesk 12.x will still continue working and it will be possible to upgrade to Plesk Onyx.
The instructions below will help you keep the product up-to-date.
Keep you product up to date
There are two ways of switching to the latest release of Plesk: Upgrade your current server
It is always recommended that you upgrade to the most stable version of the product. The latest available stable version can be found by executing the following command on your current Plesk server: Linux:
# /usr/local/psa/admin/bin/autoinstaller --show-releases Windows: C:\> ""%plesk_bin%\\ai.exe"" --show-releases
Additionally you can locate the latest Plesk version at the official Plesk website. Transfer to a new server with the latest Plesk If you need instructions for migration to the latest Plesk version, please check out our migration process guide (.PDF)
If you prefer to migrate on your own but need consulting assistance Plesk offers free migration assistance from older versions.
If you prefer to let Plesk professionals handle the migration (or in-place upgrade) job and verification checks for you Plesk provides paid migration service. Upgrade tips
Here are the tips that may help you with the upgrade process: Support for certain operating systems has been discontinued. Please refer to the release notes, which can be found at the Plesk Documentation and Help Portal. Billing system for Plesk is now shipped as a separate product Odin Business Automation Standard : Odin Business Automation Standard If you are using Plesk Sitebuilder 4.5, it is recommended that you migrate your sites to Web Presence Builder, which is distributed with Plesk. Refer to the following article for migration instructions: [How to] How to migrate sites from Plesk SiteBuilder 4.5 to Web Presence Builder "
0,"How to change IP addresses of subscriptions on Plesk Windows server via CLI?
Applicable to: Plesk for Windows Question
How may the IPs be changed for the certain subscriptions?
Answer Connect to the server via RDP
Note: If direct RDP access to the server is not possible, contact server administrator for further assistance. Open Command Prompt as Administrator and execute the following command to get a list of all subscriptions:
C:\> plesk bin subscription -l > ""C:\domains.txt"" Assign new IP for subscriptions from C:\domains.txt file:
C:\> for /F ""tokens=1"" %d in ('type C:\\domains.txt') do ""%plesk_cli%\subscription.exe"" -u %d -ip <NEW_IP> "
9,"Domain web statistics in Plesk are not shown: 403 Forbidden
Applicable to: Plesk for Windows
Plesk for Linux Symptoms Statistics page http://example.com/plesk-stat/webstat/ or https://example.com/plesk-stat/webstat-ssl/ shows the following error:
CONFIG_TEXT: 403 Forbidden You do not have permission to access this document. On Linux, the following error can be found in /var/www/vhosts/example.com/logs/error_log:
CONFIG_TEXT: (13)Permission denied: /var/www/vhosts/system/.htaccess pcfg_openfile: unable to check htaccess file, ensure it is readable Cause
Incorrect permissions for domain's statistics directory.
Resolution
For Linux: Connect to the server via SSH. Repair ownership/permissions for the domain's directory:
# plesk repair fs example.com For Windows: Connect to the server via RDP. Run Command Prompt under Administrator. Repair ownership/permissions for the domain's directory:
C:\> plesk repair fs example.com "
6,"How to upgrade MySQL from 5.1 to 5.5 on Plesk for Linux?
Applicable to: Plesk for Linux Question
How to upgrade MySQL from the version 5.1 to 5.5 on Linux?
Answer
Plesk Installer gets packages from base repositories of an operating system installed.
If MySQL 5.5 is not listed in the base repository, it is not available in Plesk Installer.
In that case, in order to upgrade MySQL version to 5.5, it is needed to configure a third-party repository.
Note: Upgrade can be performed in a command-line interface with the instructions below at your own risk. This task is supposed to be performed by a system administrator.
Note: PHP package can also be upgraded during this procedure. Oracle MySQL yum repository is supported only by Plesk Onyx. Also, it is required to have an SSH connection to the server with administrative privileges. For CentOS/RHEL/CloudLinux systems Atomic repository can be used: (click to expand) Install the Atomicorp repository:
# wget -q -O - https://www.atomicorp.com/installers/atomic | sh Upgrade MySQL:
# yum upgrade mysql Restart the MySQL service:
# service mysqld restart Upgrade MySQL databases:
# mysql_upgrade -uadmin -p`cat /etc/psa/.psa.shadow` Execute this command to update the package version inside Plesk:
# plesk bin service_node --update local For Debian/Ubuntu systems MySQL 5.5 should be available from default repositories: (click to expand) Update all system packages:
# apt-get update Upgrade MySQL:
# apt-get upgrade mysql-server Restart the MySQL service:
# service mysql restart Upgrade MySQL databases:
# mysql_upgrade -uadmin -p`cat /etc/psa/.psa.shadow` Execute this command to update the package version inside Plesk:
# plesk bin service_node --update local Additional information After upgrading MySQL to 5.5, MySQL connector might not be updated and lead to the issue described here: The Application Vault or domain's menu is not accessible: '/usr/lib64/libmyodbc5.so': file not found How to upgrade MySQL 5.5 to 5.6/5.7 or MariaDB 5.5 to 10.0/10.1/10.2/10.3 on Linux? "
0," How to change the default content for newly created domains in Plesk?
Applicable to: Plesk for Windows
Plesk for Linux Question
How to change the default content for newly created domains in Plesk?
Answer
Note: The solution is applicable by Plesk Administrators and Plesk resellers.
Click on a section to expand Changing the default page via Plesk Download the following zip file, which contains files of default website: for Linux: Linux_default_skeleton.zip for Windows Server: Windows_default_skeleton.zip Modify the files inside this zip file according to your needs (website files are located inside the /httpdocs directory). Once done, go to Plesk > Tools & Settings > Virtual Host Template: Click Browse... (or Choose File) > Select the modified zip file > Click Send File: Changing the default page via SSH & RDP Modify the Default Virtual Host Templates: Connect to the Plesk server via SSH/RDP Modify the default template content inside the following directory: On Linux: /var/www/vhosts/.skel/0/httpdocs/ On Windows Server (just paste this path in Windows Explorer to open): %plesk_vhosts%.skel\0\httpdocs\ Create or modify the Virtual Host Template for a Reseller: Connect to the Plesk server via SSH/RDP In Windows, start a command prompt as an Administrator Extract the Reseller ID with the following command:
# plesk db ""select id, cname, pname from clients where type='reseller'"" Copy the default template folder with ID 0 with the Reseller ID. For example, if the Reseller ID is 2: On Linux: Copy /var/www/vhosts/.skel/0 folder to /var/www/vhosts/.skel/2 On Windows Server: Copy %plesk_vhosts%.skel\0 folder to %plesk_vhosts%.skel\2 Modify the Reseller template content inside the Reseller template directories. According to the example shown in step 4: On Linux: /var/www/vhosts/.skel/2/httpdocs/ On Windows Server (just paste this path in Windows Explorer to open): %plesk_vhosts%.skel\2\httpdocs\ Additional Information Plesk Administrator's Guide: Website Directory Structure
"
0,"How to add programs to a chrooted shell environment template
Applicable to: Plesk for Linux Question
How to add programs to a chrooted shell environment template
Answer
Chrooted access for domain owners is not intended to be the equivalent of full server access. Instead, it is designed to be a helpful tool to perform elementary operations like changing permissions, copying and moving files, and performing test searches on files. If you notice that you have to add more and more software into the chrooted environment template for a small number of customers, you may want to consider offering them an upgrade for their hosting to dedicated or virtual servers. Connect to the server via SSH Run the following commands to download and unpack the script:
# wget https://support.plesk.com/hc/en-us/article_attachments/360010348440/update_chroot.tar.gz # tar xf update_chroot.tar.gz Run the script with the --add flag and the executable path, or name:
# ./update_chroot.sh --add dash
Note: Not all software can operate in chroot environment. Refer to the corresponding software documentation to make sure that the program can be added to chroot environment. Propagate changes in the template to subscriptions that use chroot:
# ./update_chroot.sh --apply all
Note: For CloudLinux's CageFS it might be required to add program to CageFS instead through cagefsctl --addrpm package_name: CageFS Command-line Tools Additional examples
Note: Further examples require SSH Access to the server and the update_chroot.sh script to be downloaded and unpacked. Adding SSH Client To add an SSH command into the chrooted environment template, follow these steps: Add terminal device inside the chrooted environment template:
# ./update_chroot.sh --devices tty
Note: Without access to /dev/tty, SSH will not be able to work. Add the SSH executable file itself:
# ./update_chroot.sh --add ssh Apply changes to either of the selected domains (provided in the form of a space-separated list) or to all domains at once:
# ./update_chroot.sh --apply all Now it is possible to use SSH client while logged in as the domain's user. Adding OS-provided PHP Some programs require not only libraries with which the main binary is linked, but also configuration files and plugins. An example of such a program is PHP.
Note: Adding PHP to the chrooted environment will not benefit the security of PHP scripts on the website (as PHP scripts are executed in a non-chrooted context by web-server or by FPM process pool). Add the PHP binary:
# ./update_chroot.sh --add php Add timezone definitions:
# mkdir /var/www/vhosts/chroot/usr/share # cp -a /usr/share/zoneinfo /var/www/vhosts/chroot/usr/share/zoneinfo
Warning: Without them, PHP will produce the error whenever date/time functions are used: glibc detected php: free(): invalid pointer: 0x00007f11249fccd8 *** Add PHP extensions. They are not added on the first step because PHP binary does not depend on them:
# for i in /usr/lib64/php/modules/*.so ; do ./update_chroot.sh --add $i ; done
Note: The path to the modules directory differs between Linux distributions. To find out where PHP modules are stored on the server, run php -i | grep -E ""^extension_dir"" Copy the PHP configuration:
# cp -a /etc/php.ini /etc/php.d /var/www/vhosts/chroot/etc
Note: The path to the configuration files differs between Linux distributions. To find out where PHP configuration is stored run php -i | grep -E ""^Configuration File|^Scan this dir for additional"" Set up default timezone in the main configuration file:
# sed -i.bkp 's/;date.timezone =/date.timezone = Europe\/Zurich/' /var/www/vhosts/chroot/etc/php.ini
Note: By default the date.timezone variable is not set, which can result in some PHP scripts failing to parse the output of date(""r"") call, because it will return warning before returning date. Apply changes to either of the selected domains (provided in the form of a space-separated list) or to all domains at once:
# ./update_chroot.sh --apply all
Note: Changes will not be applied if the Access to the server over SSH value in Plesk > Domains > example.com > Web Hosting Access differs from /bin/bash (chrooted). Adding Plesk PHP Some programs require not only libraries with which the main binary is linked, but also configuration files and plugins. An example of such a program is PHP.
Note: Adding PHP to the chrooted environment will not benefit the security of PHP scripts on the website (as PHP scripts are executed in a non-chrooted context by web-server or by FPM process pool). Add the PHP binary:
# ./update_chroot.sh --add /opt/plesk/php/7.1/bin/php
Note: Here and forth Plesk PHP 7.1 will be used as an example. In order to use a different PHP version change 7.1 to the desired version, for example, 5.6 for Plesk PHP 5.6. Add timezone definitions:
# mkdir /var/www/vhosts/chroot/usr/share # cp -a /usr/share/zoneinfo /var/www/vhosts/chroot/usr/share/zoneinfo
Warning: Without them, PHP will produce the error whenever date/time functions are used: glibc detected php: free(): invalid pointer: 0x00007f11249fccd8 *** Add PHP extensions. They are not added on the first step because PHP binary does not depend on them.
# for i in /opt/plesk/php/7.1/lib64/php/modules/*.so; do ./update_chroot.sh --add $i; done Copy the PHP configuration:
# cp -a /opt/plesk/php/7.1/etc /var/www/vhosts/chroot/opt/plesk/php/7.1/ Set up default timezone:
# sed -i.bkp 's/;date.timezone =/date.timezone = Europe\/Zurich/' /var/www/vhosts/chroot/opt/plesk/php/7.1/etc/php.ini
Note: By default the date.timezone variable is not set, which can result in some PHP scripts failing to parse the output of date(""r"") call, because it will return warning before returning date. Apply changes to either of the selected domains (provided in the form of a space-separated list) or to all domains at once:
# ./update_chroot.sh --apply all
Note: Changes will not be applied if the Access to the server over SSH value in Plesk > Domains > example.com > Web Hosting Access differs from ""/bin/bash (chrooted)"".
Note: Use the full path to executable as user, e.g.:
# /opt/plesk/php/7.1/bin/php Adding ldconfig Note: ldconfig is automatically installed by update_chroot.sh 1.2 and newer when a new application is added to the template. Add required folders and files to the template:
# cp -a /etc/ld.so.conf* /var/www/vhosts/chroot/etc Add ldconfig to the template to rebuild paths:
# ./update_chroot.sh --add ldconfig Update the linker's configuration:
# chroot /var/www/vhosts/chroot /bin/sh -c ""ldconfig -v"" Apply changes to subscriptions:
# ./update_chroot.sh --apply all "
4,"How to uninstall Customer and Business Manager (CBM, formerly Plesk Billing) from a Plesk server Applicable to: Plesk for Linux
Plesk for Windows Question
How to remove Customer and Business Manager (CBM, formerly Plesk Billing) from a Plesk server?
Answer Table of Contents Uninstalling CBM on Linux
Uninstalling CBM on Windows Uninstalling CBM on Linux Connect to a Plesk server via SSH. Disable the Single Sign-On service:
# /usr/local/psa/bin/sso --disable Uninstall CBM packages: for CentOS/RHEL-based distributions:
# rpm -e sw-sso plesk-billing plesk-billing-plugins for Debian/Ubuntu-based distributions:
# dpkg -r sw-sso plesk-billing plesk-billing-plugins Remove CBM-related entries from a Plesk database:
4.1. Connect to the Plesk database:
# MYSQL_PWD=`cat /etc/psa/.psa.shadow` mysqldump -u admin psa > /root/psa_dump.sql
4.2. Delete the following records: for Plesk 11.0.9 and older:
MYSQL_LIN: mysql> BEGIN;mysql> DELETE FROM cl_param WHERE param='ppb-url';mysql> DELETE FROM smb_servicePermissions WHERE serviceInstanceId = (SELECT id FROM smb_serviceInstances WHERE description LIKE 'Parallels Billing Integration') AND serviceProviderId = (SELECT id FROM smb_serviceProviders WHERE classname LIKE 'Smb_Service_Provider_ParallelsBilling');mysql> COMMIT; for Plesk 11.5.30 and greater:
MYSQL_LIN: mysql> BEGIN;mysql> DELETE FROM ServiceNodeConfiguration WHERE section = 'Billing' and name = 'ppb-url';mysql> DELETE FROM smb_servicePermissions WHERE serviceInstanceId = (SELECT id FROM smb_serviceInstances WHERE description LIKE 'Parallels Billing Integration') AND serviceProviderId = (SELECT id FROM smb_serviceProviders WHERE classname LIKE 'Smb_Service_Provider_ParallelsBilling');mysql> COMMIT; Remove CBM-related files:
# rm -rf /var/lib/plesk-billing/local.db# rm -rf /var/lib/sso/sso.db Refresh server components by clicking the Refresh button at Tools & Settings > Server Components. Uninstalling CBM on Windows Connect to a Plesk server via RDP. Start a command prompt as an Administrator and disable the Single Sign-On service:
C:\> ""%plesk_dir%bin\sso"" --disable Uninstall CBM packages:
C:\> ""%plesk_bin%ai.exe"" --console --select-product-id panel --select-release-current --remove-component billing If uninstallation via Plesk Installer fails, start the Windows Registry and find entries for Plesk Billing Skins, Plesk Billing, Plesk Billing Plugins, Single Sign-On packages (in Plesk 11.5.30 and below, find CBM, Parallels Billing Plugins and SSO) at HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\CurrentVersion\Installer\UserData\S-1-5-18\Products and delete the packages. For example, Plesk Billing is located at the key HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\CurrentVersion\Installer\UserData\S-1-5-18\Products\681FD0781B20D47458F11F8CD90C7140\InstallProperties as a value of DisplayName. Double-click UninstallString > Copy the value under Value data > Paste this value in a command prompt > hit the Enter button to begin the uninstallation. Remove CBM-related entries from a Plesk database:
4.1. Connect to the Plesk database:
C:\> ""%plesk_dir%mysql\bin\mysqldump.exe"" -P8306 -uadmin -p<admin_password> psa > C:\psa_dump.sql
4.2. Delete the following records: for Plesk 11.0.9 and older:
MYSQL_WIN: mysql> BEGIN;mysql> DELETE FROM cl_param WHERE param='ppb-url';mysql> DELETE FROM smb_servicePermissions WHERE serviceInstanceId = (SELECT id FROM smb_serviceInstances WHERE description LIKE 'Parallels Billing Integration') AND serviceProviderId = (SELECT id FROM smb_serviceProviders WHERE classname LIKE 'Smb_Service_Provider_ParallelsBilling');mysql> COMMIT; for Plesk 11.5.30 and greater:
MYSQL_WIN: mysql> BEGIN;mysql> DELETE FROM ServiceNodeConfiguration WHERE section = 'Billing' and name = 'ppb-url';mysql> DELETE FROM smb_servicePermissions WHERE serviceInstanceId = (SELECT id FROM smb_serviceInstances WHERE description LIKE 'Parallels Billing Integration') AND serviceProviderId = (SELECT id FROM smb_serviceProviders WHERE classname LIKE 'Smb_Service_Provider_ParallelsBilling');mysql> COMMIT; Remove CBM-related files (just paste the path %plesk_dir%admin\db in Windows Explorer to open):
PLESK_INFO: %plesk_dir%admin\db\billing_local.db%plesk_dir%admin\db\sso.db Refresh server components by clicking the Refresh button at Tools & Settings > Server Components. "
6,"Is there root user in MySQL on Plesk server?
Applicable to: Plesk for Linux
Plesk for Windows Question
Is there a root user in MySQL on a Plesk server?
Answer
MySQL installed and configured with Plesk does not have a user with name root by default. It is renamed to admin and has access only to localhost. On Plesk for Linux, the password of the user admin is encrypted and stored in /etc/psa/.psa.shadow. On Windows, the password is stored in Windows Registry. Plesk for Windows has two different MySQL instances with different admin users. "
7,"How should hard drive be partitioned for Plesk Linux installation?
Applicable to: Plesk for Linux Question
How should hard drive be partitioned for Plesk Linux installation?
Answer
Plesk for Linux OS stores user data in the directory /var, by default, so the partitioning should be set up as follows:
CONFIG_TEXT: SWAP -> Refer to the OS vendor recommendation (usually at least the amount of RAM on the server times two). / -> 20GB minimum, 50GB recommended. This partition is used for the OS and Plesk updates. /tmp -> At least 3GB recommended. /var -> the rest of the space (domains, mail, backups, and databases are stored there)
Note: it may vary. The /usr/local/psa/tmp/ directory (for domains backups) as well as the /usr/local/psa/PMM/tmp/ one (for full server backups) are used as a temporary placeholder for backups. For instance, when downloading a backup file via Plesk GUI, a temporary file with the same size is created in those locations.
Directories, that usually contain large amounts of data, include: /var/www/vhosts - domains content /var/qmail - mail configuration/content /var/lib/mysql - MySQL databases /var/lib/psa/dumps - Plesk client/domain backups /var/lib/pgsql/data - PostgreSQL databases /var/lib/mailman - Mailman lists The file /etc/psa/psa.conf defines other directories used by Plesk.
On Debian and Ubuntu, Plesk files are located in /opt/psa directory.
More information about partitioning can be found through the following links: Debian-based OSes: https://askubuntu.com/questions/343268/how-to-use-manual-partitioning-during-installation RHEL-based Oses: https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/6/html/installation_guide/s2-diskpartrecommend-x86 "
7,"Unable to upgrade/install Plesk on Ubuntu/Debian: the following packages have unmet dependencies
Applicable to: Plesk Onyx for Linux
Plesk for Linux Symptoms
Plesk installation or upgrade on Ubuntu/Debian OS fails with the following error:
PLESK_ERROR: Some packages could not be installed. This may mean that you have requested an impossible situation or if you are using the unstable distribution that some required packages have not yet been created or been moved out of Incoming. The following packages have unmet dependencies: apache2 : Depends: apache2.2-common (= 2.2.22-13+deb7u3) but it is not going to be installed apache2-mpm-prefork : Depends: apache2.2-common (= 2.2.22-13+deb7u3) but it is not going to be installed Depends: apache2.2-bin (= 2.2.22-13+deb7u3) but it is not going to be installed mysql-server : Depends: mysql-server-5.5 but it is not going to be installed plesk-base : Depends: sw-engine (>= 2.13.8) but it is not going to be installed plesk-core : Depends: libcurl3 (>= 7.16.2) but it is not going to be installed awstats : Depends: perl:any libapache2-mod-bw : Depends: apache2-api-20120211 libapache2-mod-perl2 : Depends: apache2-api-20120211 Depends: libxslt1.1 (>= 1.1.25) but it is not installable Depends: libmyodbc but it is not installable Depends: xsltproc but it is not installable Depends: libtimedate-perl but it is not installable
or
PLESK_ERROR: The apg-get failed with the following message: Reading package lists... Building dependency tree... Reading state information... You might want to run 'apt-get -f install' to correct these: The following packages have unmet dependencies: apache2 : Depends: apache2-bin (= 2.4.18-2ubuntu3.9) but 2.4.18-2ubuntu3.8 is to be installed Depends: apache2-data (= 2.4.18-2ubuntu3.9) but 2.4.18-2ubuntu3.8 is to be installed linux-image-virtual: Depends: linux-image-4.4.0-128-generic but it is not going to be installed plesk-service-node-utilities: Depends: libidn2-0 (>= 0.6) but it is not going to be installed
Cause
Non-standard repositories enabled in /etc/apt/sources.list file that Plesk is not compatible with, so a system cannot resolve all the dependencies properly.
Resolution Connect to the server via SSH. Replace all contents of the file /etc/apt/sources.listwith the default content, like below:
Default sources.list for: Ubuntu 18.04 LTS: CONFIG_TEXT: deb http://archive.ubuntu.com/ubuntu bionic main restricted universe deb http://archive.ubuntu.com/ubuntu bionic-updates main restricted universe deb http://security.ubuntu.com/ubuntu bionic-security main restricted universe multiverse deb http://archive.canonical.com/ubuntu bionic partner Ubuntu 16.04 LTS: CONFIG_TEXT: deb http://archive.ubuntu.com/ubuntu xenial main restricted universe deb http://archive.ubuntu.com/ubuntu xenial-updates main restricted universe deb http://security.ubuntu.com/ubuntu xenial-security main restricted universe multiverse deb http://archive.canonical.com/ubuntu xenial partner Debian 9.x: CONFIG_TEXT: deb http://deb.debian.org/debian stretch main deb-src http://deb.debian.org/debian stretch main Update package lists and install missing dependencies:
# apt-get update # apt-get -f install Run Plesk installation / update / upgrade. "
5,"[FIXED BUG] Unable to manage, create ZIP or back up files uploaded by PHP scripts in Plesk: Unable to get the object security info: (5) Access is denied
Applicable to: Plesk 12.5 for Windows Plesk Onyx for Windows Plesk Obsidian for Windows Symptoms It is not possible to upload / edit / change permissions to files or rename them in Plesk at Domains > example.com > File Manager or download file by FTP under the user account. The following error appears:
PLESK_ERROR: Internal error: filemng failed: Unable to get the object (C:\Inetpub\vhosts\example.com\httpdocs\test.html) security info: (5) Access is denied. at execute ""C:\Program Files (x86)\Plesk\admin\bin\filemng.exe"" user --permissions --list-common ""--file=C:\Inetpub\vhosts\example.com\httpdocs\test.html"" ""--accounts=tmp54B2.tmp""(RunTime::RunAsUser::run line 221) (Error code 1) A backup of a website based on WordPress finishes with the warning:
CONFIG_TEXT: Warning: domain ""example.com"" Unable to get attributes of the file C:\Inetpub\vhosts\example.com\httpdocs\wp-content\uploads\2018\07\12.png: Access is denied. The file will not be archived. [:121566464] When trying to Add Files to Archive from Domains > example.com > File Manager, the following error is shown making reference to all the files that were uploaded via PHP:
PLESK_ERROR: Unable to create the archive: 7-zip 18.05 (x86): Copyright (c) 1999-2018 Igor Pavlov: 2018-04-30 Scanning the drive: 1913 folders, 10397 files, 258441467 bytes (247 MiB) Creating archive: C:\Inetpub\vhosts\example.com\httpdocs\backup.zip Add new data to archive: 1913 folders, 10397 files, 258441467 bytes (247 MiB) WARNING: Access is denied. wp-content\uploads\2019\04\01.png: Access is denied. ... Cause Product issues: #PPP-49179 ""The outdated PHP handlers (versions 5.6 and 7.0) no longer contain custom upload_tmp_dir as their values.""
Fixed in: Plesk Obsidian 23 June 2020 (Windows) #PPPM-4539 ""Files uploaded via WordPress are now assigned the correct file system permissions.""
Fixed in: Plesk Obsidian 21 January 2020 (Windows) Resolution
Please consider updating your server: How to upgrade Plesk to the next release Workaround Fixing permissions in order to access files via Plesk File Manager / FTP Connect to the server via RDP Start a command prompt as an Administrator Run the command:
C:\> plesk bin repair --repair-webspace-security -webspace-name example.com -all-filesystem-objects Fixing permissions before creating a manual server Plesk backup Connect to the server via RDP Start a command prompt as an Administrator Fix file permissions: For one domain
C:\> plesk bin repair --repair-webspace-security -webspace-name example.com -all-filesystem-objects For all domains
C:\> for /f %i in ('plesk bin subscription -l') do plesk bin repair --repair-webspace-security -webspace-name %i -all-filesystem-objects Create a full Plesk backup. Fixing permissions before creating scheduled server Plesk backups Warning: The following workaround must be applied every time after applying the changes at Tools & Settings > Backup Manager > Schedule, because the task is overwritten. Log in to Plesk GUI and schedule a full server backup:
1.1. Go to at Tools & Settings > Backup Manager > Schedule >
1.2. Enable Activate this backup task.
1.3. Disable Use incremental backup.
1.4. Click OK. Connect to the server via RDP Start a command prompt as an Administrator Run the following command to create a script that will automatically fix file permissions:
C:\> echo for /f %%i in ('plesk bin subscription -l') do plesk bin repair --repair-webspace-security -webspace-name %%i -all-filesystem-objects > C:\pleskrepair.cmd Create a new task:
5.1. Start Task Scheduler.
5.2. Expand Task Scheduler Library and select the task Plesk Scheduler Task #Domain Backup Scheduler 1.
5.3. Click Properties on the right. On the General tab, set Configure for to the latest task type available: Switch to the Actions tab and click New.... Configure the task:
8.1. Set Action as Start a program.
8.2. In the Program/script field, specify the location of the script created on step 4 - C:\pleskrepair.cmd.
8.3. Click OK. Increase the priority of the script task, so it will run before server backup task:
9.1. Select the new action.
9.2. Click the button.
9.3. Click OK. "
0," How to change virtual hosts location in Plesk for Linux?
Applicable to: Plesk for Linux Question
How to change virtual hosts locations in Plesk for Linux?
How to replicate website vhost and root document path during migration from a non-Plesk server?
Answer
Check the warnings before making any changes:
Warning: These actions may cause websites downtime depending on the number of domains and data to be copied to the new location. It is recommended to apply this during maintenance hours.
Warning: Changing vhosts directory with the SELinux enabled on Plesk Onyx will break websites. This is due to SELinux limitation: it stores absolute paths in its policies. As a workaround, set SELinux to permissive mode before applying steps below.After changing vhosts folder, SELinux should be kept in the permissive mode for correct websites working capacity. As an alternative workaround, mount new partition as /var/www/vhosts.
The location change can be done using transvhosts.pl utility:
# plesk bin transvhosts.pl --help
For example, to change virtual hosts location to /home directory:
# plesk bin transvhosts.pl --dest-dir /home --correct-scripts
All virtual host content will be automatically moved to the new location.
Changing virtual host location will not affect backup restoration functionality. Content from backups will be restored to new custom location."
3,"Website on Plesk shows: cURL error (77): Problem with the SSL CA cert Applicable to: Plesk for Windows Symptoms A website shows the following error:
CONFIG_TEXT: cURL error (77): Problem with the SSL CA cert (path? access rights?)cURL error (77): Problem with the SSL CA cert (path? access rights?)
OR
CONFIG_TEXT: Error : ""error setting certificate verify locations: CAfile: C:\Parallels\Plesk\Additional\PHPSettings\cacert.pem CApath: none"" Website's PHP scripts may fail with the same error. Extensions menu may show the following error when trying to open it:
PLESK_ERROR: error setting certificate verify locations: CAfile: C:\Program Files (x86)\Plesk\admin\conf\cacert.pem CApath: none Cause
PHP cURL uses an outdated set of root certificates to verify server certificates.
Resolution Solution 1 - Using Plesk GUI Log in to Plesk. Install Panel.ini Editor extension: Extensions > Server Tools section > Panel.ini Editor. Go to Extensions > My Extensions > Panel.ini Editor (Go To Extension) > Editor. Add records below to the editor and Save changes:
CONFIG_TEXT: [php] curlCertificatesUrl=""http://curl.haxx.se/ca/cacert.pem"" Wait until Daily task is executed (It is executed once a day). Go to Domains > example.com > PHP Settings and add the line below into to Additional configuration directives. Replace path to cacert.pem with your own path.
CONFIG_TEXT: curl.cainfo=""C:\Program Files (x86)\Plesk\Additional\PHPSettings\cacert.pem"" If it is required to apply the changes for all the domains using a particular PHP version go to Tools & Settings > PHP Settings> %php_version%, click on php.ini tab and add the aforementioned line: Solution 2 - Accessing the server Log in to the server via RDP. Open %plesk_dir%admin\conf\panel.ini file (create it if does not exist)
Note: %plesk_dir% by default is C:\Program Files (x86)\Plesk\ Add below directive to panel.ini.
CONFIG_TEXT: [php] curlCertificatesUrl=""http://curl.haxx.se/ca/cacert.pem Download the cacert.pem file from the main curl website http://curl.haxx.se/ca/cacert.pem. Place downloaded cacert.pem to %plesk_dir%Additional\PHPSettings\ directory. Wait until Daily task is executed (It is executed once a day). Additional information
Why cacert.pem file is being overwritten with old certificate permanently?"
5,"[BUG] Unable to create backup on FTP or scheduled backup rotation does not work: Unable to operate the storage: Transport error: unable to delete file Applicable to: Plesk for Linux Symptoms vsftpd FTP-server is used as a remote FTP server.
Plesk backup on the FTP storage fails with one of the following errors:
PLESK_ERROR: Error: Unable to operate the storage: Transport error: unable to delete file: Curl error: (18) Transferred a partial file: Last FTP request: NLST Last FTP response: 522 SSL connection failed; session reuse required: see require_ssl_reuse option in vsftpd.conf man page PLESK_ERROR: Error: FTP connection failed, please check your FTP settings. Repository error: Transport error: unable to list directory: Curl error: Login denied PLESK_ERROR: Repository error: Transport error: unable to list directory: Curl error: FTP: couldn't retrieve (RETR failed) the specified file Scheduled backup rotation does not work: previous backups are not removed.
The following error can be found in the log file /usr/local/psa/PMM/logs/backup-YYYY-MM-DD-HH-MM-NN-NNN/backup.log :
CONFIG_TEXT: Server response code: 522 [./transport.cpp:827] virtual void plesk::tRepositoryFtp::ListDir(const string&, std::vector<std::basic_string<char> >&) Cause
This is Plesk bug with ID PPPM-5226 which is planned to be fixed in future Plesk updates.
Resolution
Until the fix will be available the following workaround is applicable: Connect to the remote FTP server using SSH. Add the following line into /etc/vsftpd/vsftpd.conf
CONFIG_TEXT: require_ssl_reuse=NO Restart vsftpd service:
# service vsftpd restart Additional information regarding vsftpd configuration can be found here ."
8,"Outgoing Mail Control limits do not work on the whole server: [Errno 13] Permission denied
Applicable to: Plesk for Linux Symptoms Plesk Repair Kit error:
CONFIG_TEXT: There are incorrect permissions on some items: /dev/log Plesk Outgoing Mail Control does not block mail messages according to limits: it is possible to send more emails than is defined in Outgoing Mail Control limit Errors like the following can be found in /var/log/maillog:
CONFIG_TEXT: /usr/lib64/plesk-9.0/psa-pc-remote[2100]: handlers_stderr: self._connect_unixsocket(address)#012 File ""/usr/lib64/python2.7/logging/handlers.py"", line 789, in _connect_unixsocket#012 self.socket.connect(address)#012 File ""/usr/lib64/python2.7/socket.py"", line 224, in meth#012 return getattr(self._sock,name)(*args)#012socket.error: [Errno 13] Permission denied /usr/lib64/plesk-9.0/psa-pc-remote[2100]: handlers_stderr: return getattr(self._sock,name)(*args)#012socket.error: [Errno 13] Permission denied /dev/log permissions differ from the example below
# ls -la /dev/log srw-rw-rw- 1 root root 0 Jun 15 00:43 /dev/log Cause
Incorrect permissions and ownership for /dev/log socket file.
Resolution Connect to the server via SSH; Change the permissions and the ownership:
# chmod 666 /dev/log # chown root:root /dev/log If permissions are changed back to incorrect There are some 3rd-party firewall tools installed on a server.
For example, lfd (Login Failure Daemon) that works with csf (ConfigServer Firewall) can cause such behavior. There is parameter 'RESTRICT_SYSLOG' identified in the csf configuration file /etc/csf/csf.conf that is causing the issue:
CONFIG_TEXT: RESTRICT_SYSLOG = ""3""
To fix the issue in this case, either stop lfd service, or configure csf so that syslogd files are ignored. Then, change permissions to correct ones:
# service lfd stop # chmod 666 /dev/log # chown root:root /dev/log # ls -la /dev/log srw-rw-rw- 1 root root 0 Jun 15 00:43 /dev/log "
8,"Unable to send message from domain where mail hosted on Google: 550 Requested action not taken: mailbox unavailable or not local
Applicable to: Plesk for Windows Symptoms The following bounce message is received while sending a mail message to john.doe@example.com on Plesk server:
CONFIG_TEXT: Delivery to the following recipient failed permanently: john.doe@example.comTechnical details of permanent failure: Google tried to deliver your message, but it was rejected by the server for the recipient domain example.com by mail.example.com [203.0.113.2].
OR
CONFIG_TEXT: An error occurred while sending mail. 550 Requested action not taken: mailbox unavailable or not localPlease check the message recipient john.doe@example.com and try again. Mail for this Plesk domain is hosted on Google Services. Cause
Mail domain is present in MailEnable configuration.
Resolution Connect to the server via RDP.
Open MailEnable at Start > MailEnable Navigate to Messaging Manager > Post Offices > example.com > Domains: Double click on example.com to open Properties window: Enable Act as Smart Host option and add IP address in the bottom of the list: Download the following tool from MailEnable: MERoute Unpack the archive and execute MERoute.exe: In the new window select example.com and click on the OK button to save the change: "
9,"AWstats statistics pages are not updated: ""Unable to execute awstats_buildstaticpages.pl""
Applicable to: Plesk for Linux Symptoms AWstats pages are not updated for all domains on the server.
An attempt to manually execute statistics utility produces errors:
CONFIG_TEXT: `statistics_collector: Unable to execute /usr/share/awstats/awstats_buildstaticpages.pl -awstatsprog=/var/www/cgi-bin/awstats/awstats.pl -configdir=/usr/local/psa/etc/awstats -config=example.com-http -dir=/var/www/vhosts/example.com/statistics/webstat/current >/dev/null 2>&1` System error 2: No such file or directory Cause
The value of AWSTATS_TOOLS_D in /etc/psa/psa.conf is incorrect, or the AWstats installation is corrupted.
Resolution Connect to the server via SSH
Note: if direct SSH access to the server is not possible, contact server administrator for further assistance. Find the location, where awstats_buildstaticpages.pl script is installed, using one of the following commands: For CentOS/RHEL:
# rpm -ql awstats | grep buildstaticpages /usr/share/awstats/awstats_buildstaticpages.pl For Debian/Ubuntu:
# dpkg -L awstats | grep buildstaticpages /usr/share/awstats/tools/awstats_buildstaticpages.pl Check if the file returned by the command on the previous step exists on the server: For CentOS/RHEL:
# ls -l /usr/share/awstats/awstats_buildstaticpages.pl -rwxr-xr-x 1 root root 19768 Dec 24 08:06 /usr/share/awstats/awstats_buildstaticpages.pl For Debian/Ubuntu:
# ls -l /usr/share/awstats/tools/awstats_buildstaticpages.pl -rwxr-xr-x 1 root root 19670 Jan 8 2012 /usr/share/awstats/tools/awstats_buildstaticpages.pl If the file does not exist, reinstall AWstats using Tools & Setings > Updates & Upgrades menu in Plesk. If awstats_buildstaticpages.pl file exists: Open /etc/psa/psa.conf configuration file in text editor Set the value for AWSTATS_TOOLS_D parameter to point to the correct directory For CentOS/RHEL:
CONFIG_TEXT: AWSTATS_TOOLS_D /usr/share/awstats For Debian/Ubuntu:
CONFIG_TEXT: AWSTATS_TOOLS_D /usr/share/awstats/tools Note: To recalculate AWstats statistics for the missing days refer to the article How to recalculate AWStats statistics from logs for previous months"
2,"Plesk for Windows shows 500 Internal Server Error: 0x8007010b
Applicable to: Plesk for Windows Symptoms
Cannot login to Plesk:
CONFIG_TEXT: Detailed Error Information:Module FastCgiModule Notification ExecuteRequestHandler Handler PleskEngine-FastCGI-php Error Code 0x8007010b Physical Path C:\Program Files (x86)\Parallels\Plesk\admin\htdocs\index.php Logon Method Anonymous Logon User Anonymous
Cause
Plesk website is misconfigured.
Resolution Log in to Plesk server via RDP Remove Plesk site at IIS > Sites > PleskControlPanel Reconfigure the Plesk Services at Start > Plesk Reconfigurator > Repair Plesk installation > choose Plesk Services > Check. "
3,"nginx on Plesk for Linux server does not start automatically after reboot: 99: Cannot assign requested address
Applicable to: Plesk Onyx for Linux
Plesk Obsidian for Linux Symptoms After server reboot, nginx does not get started:
# systemctl --failed UNIT LOAD ACTIVE SUB DESCRIPTION ● nginx.service loaded failed failed Startup script for nginx service Domains are not working. OS with systemd is installed (Debian 8, CentOS 7 and etc.). In /var/log/nginx/error.log the following messages can be found:
CONFIG_TEXT: [emerg] 1140#0: bind() to [203.0.113.2]:80 failed (99: Cannot assign requested address) In journalctl the following entries can be found:
# journalctl -u network.service -u network.target -u nginx.service -b nginx[352]: nginx: [emerg] bind() to 203.0.113.2:80 failed (99: Cannot assign requested address) systemd[1]: Failed to start Startup script for nginx service. systemd[1]: Unit nginx.service entered failed state. network[268]: Bringing up interface eth0: dhclient[665]: DHCPREQUEST on eth0 to 255.255.255.255 port 67 (xid=0x4b684081) dhclient[665]: DHCPACK from 203.0.113.2 (xid=0x4b684081) network[268]: [ OK ] However, nginx can be started manually without any issues:
# systemctl start nginx.service Cause
Delay in assigning of IP address to a network interface. For example, because of delayed response from DHCP server.
Resolution Connect to the server using SSH. Make sure that network interfaces are enabled on system boot: for RHEL, CentOS, CloudLinux:
# grep -r ""ONBOOT"" /etc/sysconfig/network-scripts/ifcfg-* /etc/sysconfig/network-scripts/ifcfg-lo:ONBOOT=yes /etc/sysconfig/network-scripts/ifcfg-venet0:ONBOOT=yes /etc/sysconfig/network-scripts/ifcfg-venet0:0:ONBOOT=yes for Debian and Ubuntu:
# grep auto /etc/network/interfaces # This configuration file is auto-generated. auto lo auto venet0 auto venet0:0 Back up the nginx startup script /etc/systemd/system/multi-user.target.wants/nginx.service:
# cp /etc/systemd/system/multi-user.target.wants/nginx.service{,.bk} Make sure that the package systemd-networkd is installed on the server. Install it if it is not installed: for RHEL, CentOS, CloudLinux:
# yum install systemd-networkd for Debian and Ubuntu: Should be installed by default.
The service will ensure that network interfaces are up and have IP addresses bound. For additional details, refer to http://www.freedesktop.org/wiki/Software/systemd/NetworkTarget/ If Plesk 17.5 or older is used, proceed as follows to create the file /etc/systemd/system/nginx.service.d/override.conf with an nginx startup parameter to be executed only after the network is up and all IP addresses are assigned: Run the following command. It will open the default text editor on the server:
# systemctl edit nginx.service
Add the following line, save and exit the file:
CONFIG_TEXT: After=network-online.target remote-fs.target nss-lookup.target Reboot the server:
# reboot If it does not help, additional action is required: For SystemD add the following line in [Service] section in /etc/systemd/system/multi-user.target.wants/nginx.service file:
CONFIG_TEXT: ExecStartPre=/bin/sleep 10
Note: Increase timeout if needed. For OS without SystemD, edit /etc/init.d/nginx adding sleep command to the start, so it should look like:
# grep -i ""start()"" /etc/init.d/nginx start() { sleep 20 Reboot the server: # reboot "
3,"How to enable core dumps for Apache and trace Apache segmentation fault on a Linux server
Applicable to: Plesk for Linux Question
Apache segmentation fault is caused by an extension or interoperability with an OS module causes a crash. How to enable core dumps for Apache and trace Apache segmentation fault on a Linux server?
Apache crush may have the following symptoms that appear in the global Apache error log file - /var/log/httpd/error_log (CentOS/RHEL) or /var/log/apache2/error_log (Debian/Ubuntu): Web-pages return a 500 HTTP error. Segmentation fault"" error may appear:
CONFIG_TEXT: seg fault or similar nasty error detected in the parent process Answer
Enabling core dumps for Apache Connect to a Linux server via SSH. Find a partition that is having a free space (use 'df -h') enough to store memory dumps. In this example, we use /var directory on the root '/' partition.
Note: On CentOS 7, due to the PrivateTmp=true parameter in a systemd unit, it is not possible to use some directories inside /tmp/ as a directory for core dumps. Modify Apache startup script: For systemd systems, create a new unit file using the command: on CentOS/RHEL-based distributions
# systemctl edit httpd on Debian/Ubuntu-based distributions
# systemctl edit apache2 and add the following lines:
CONFIG_TEXT: [Service] LimitCORE=infinity For non-systemd CentOS/RHEL-based systems, add the DAEMON_COREFILE_LIMIT=unlimited line to the /etc/sysconfig/httpd file. For non-systemd Debian/Ubuntu-based systems, open the /etc/init.d/apache2 file and locate the do_start() section. Add the following line in this section:
CONFIG_TEXT: ulimit -c unlimited Create a folder where core dumps will be stored:
# mkdir -p /var/coredumps # chmod a+w /var/coredumps Specify the path and pattern for core dump files in the /proc/sys/kernel/core_pattern file:
# echo /var/coredumps/core-%e-%s-%u-%g-%p-%t > /proc/sys/kernel/core_pattern
If for some reason the core_pattern file cannot be modified, specify a CoreDumpDirectory location in /etc/httpd/conf/httpd.conf (CentOS/RHEL) or /etc/apache2/apache2.conf (Debian/Ubuntu):
# grep ""CoreDumpDirectory"" /etc/httpd/conf/httpd.conf CoreDumpDirectory /var/coredumps Restart Apache service: on CentOS/RHEL-based distributions
# service httpd restart on Debian/Ubuntu-based distributions
# service apache2 restart To be sure core dumps have been set up, perform the following test:
7.1. List Apache processes and their PIDs: on CentOS/RHEL-based distributions
# ps auxf | grep httpd | grep -v grep root 15654 1.4 0.7 372448 13840 ? Ssl 13:25 0:00 /usr/sbin/httpd -DFOREGROUND apache 15680 0.0 0.3 370944 6164 ? S 13:25 0:00 \_ /usr/sbin/httpd -DFOREGROUND on Debian/Ubuntu-based distributions
# ps auxf | grep apache2 | grep -v grep root 2410 0.2 1.5 292588 33036 ? Ssl 13:32 0:00 /usr/sbin/apache2 -k start www-data 2413 0.0 0.3 237808 6504 ? S 13:32 0:00 \_ /usr/sbin/apache2 -k start 7.2. Kill a main Apache process with SIGSEGV signal:
# kill -SIGSEGV <PID>
7.3. Check the folder with core dumps. The files will be named like: on CentOS/RHEL-based distributions
# ls /var/coredumps core-httpd-11-0-0-14750-1556864320 on Debian/Ubuntu-based distributions
# ls /var/coredumps core-!usr!sbin!apach-11-0-0-2410-1556865180 Note: If the abrtd daemon is running, it will prevent creation of core dump files. Reproduce the issue.
Once you finish with tracing, remove the changes in Apache startup script made on step 3 and restart Apache. Analyzing Apache core dumps Install the gdb utility: on CentOS/RHEL-based distributions
# yum install gdb# debuginfo-install httpd on Debian/Ubuntu-based distributions
# apt-get install gdb Replace the path to a core dump file in the command below and run it: on CentOS/RHEL-based distributions
# gdb /usr/sbin/httpd /var/coredumps/core-httpd-11-0-0-14750-1556864320 on Debian/Ubuntu-based distributions
If the core dump file contains '!' symbols in its name, put a backslash '\' before each '!' symbol like this:
# gdb /usr/sbin/apache2 /var/coredumps/core-\!usr\!sbin\!apach-11-0-0-2410-1556865180 Run the bt command in the gdb prompt to get a backtrace and analyse output:
CONFIG_TEXT: (gdb) bt full Additional Information Apache HTTPD Debugging Guide - The Apache HTTP Server Project
"
2,"[FIXED BUG] Unable to set quota for user, error when trying to delete domain or change quota settings in Plesk Applicable to: Plesk 12.0 for Linux Plesk 12.5 for Linux Plesk Onyx for Linux Symptoms The following error occurs in Plesk when trying to change domain physical quota settings, remove domain/subdomain or change hosting type to 'forwarding':
PLESK_ERROR: Error: Unable to execute usermng: usermng[1329]: pam_unix(passwd:chauthtok): password changed for jdoe usermng: /usr/sbin/setquota execution failed: setquota: Cannot find mountpoint for device /dev/ploop11111p1 setquota: No correct mountpoint specified. setquota: Cannot initialize mountpoint scan. usermng: Unable to set quota for user 'jdoe' When removing a domain from Plesk, its configuration files are not removed leading to a situation where Apache/nginx web-server fails to start:
# apache2ctl -t AH00526: Syntax error on line 48 of /etc/apache2/plesk.conf.d/vhosts/example.com.conf: SSLCertificateFile: file '/opt/psa/var/certificates/scf7Xe8F7' does not exist or is empty Action '-t' failed.
OR
# httpd -tAH00526: Syntax error on line 48 of /etc/httpd/conf/plesk.conf.d/vhosts/example.com.conf: SSLCertificateFile: file '/usr/local/psa/var/certificates/scf7Xe8F7' does not exist or is empty Action '-t' failed. Domains are not removed completely, no errors occurs in Plesk, files are still on the server, but domain can not be found in Plesk:
# ls -d /var/www/vhosts/system/example.com/ /var/www/vhosts/system/example.com/ The following can be found in the /var/log/plesk/panel.log:
CONFIG_TEXT: usermng: /usr/sbin/setquota execution failed: setquota: Cannot find mountpoint for device /dev/simfs setquota: No correct mountpoint specified. setquota: Cannot initialize mountpoint scan. usermng: Unable to set quota for user 'jdoe' Hard disk quota is disabled on the node:
# grep -i 'quot' /proc/mounts # Cause Product issue: #PPPM-7859 ""A subscription can now be fully removed if a hard disk quota is not synced.""Fixed in:
Plesk Obsidian 04 June 2019 (fixed as PPP-34711) Resolution
Please consider updating your server: How to install Plesk updates Workaround
If update is not possible for some reason, apply the following workaround: Temporary Solution As a workaround:
Go to Tools & Settings > Server Components and click Refresh.
If this does not help, follow the instruction below: Connect to the Plesk server via SSH. Check whether quota is enabled in /etc/mtab despite being missing from /proc/mounts:
# grep -i 'quot' /etc/mtab /dev/ploop15621p1 / ext4 rw,relatime,barrier=1,data=ordered,balloon_ino=12,jqfmt=vfsv0,usrjquota=aquota.user,grpjquota=aquota.group 0 0 Move /etc/mtab file away and create a symbolic link to /proc/mounts
# mv /etc/mtab /etc/mtab_old # ln -s /proc/mounts /etc/mtab Browse to Tools & Settings > Server Components and click Refresh. In order to find all domains that were not removed properly and remove them completely, use the attached script:
# wget https://support.plesk.com/hc/en-us/article_attachments/115005665694/domains_cleanup.sh.tar.gz # tar -xzvf domains_cleanup.sh.tar.gz # chmod +x domains_cleanup.sh # ./domains_cleanup.sh "
8,"Unable to send email in Plesk: mail transport unavailable
Applicable to: Plesk for Linux Symptoms There are lots of undelivered outgoing emails on the Plesk server. It is not possible to send mail and messages get stuck in the mail queue. The following errors are logged in /var/log/maillog:
CONFIG_TEXT: postfix/smtp[715642]: connect to example.com[203.0.113.2]:587: Invalid argument postfix/smtp[715642]: 8A0FA1D2090C: to=john.doe@example.com, relay=none, delay=470, delays=470/0.01/0.16/0, dsn=4.4.1, status=deferred (connect to example.com[203.0.113.2]:587: Invalid argument) CONFIG_TEXT: postfix/qmgr[14111]: warning: connect to transport private/203.0.113.2-: Connection refused postfix/error[21724]: 0A1322CF16C: to=john.doe@example.com, relay=none, delay=0.07, delays=0.03/0.01/0/0.02, dsn=4.3.0, status=deferred (mail transport unavailable) Cause
Postfix is misconfigured.
Resolution
Connect to the server via SSH.
If there are no custom settings in Postfix's configuration, execute mchk utility:
# plesk sbin mchk --without-spam
If there are some custom settings and the issue should be resolved more accurately, verify the following: Transport settings are set as below:
# postconf -n | grep -i transport sender_dependent_default_transport_maps = hash:/var/spool/postfix/plesk/sdd_transport_maps transport_maps = , hash:/var/spool/postfix/plesk/transport virtual_transport = plesk_virtual Transport may be defined in sender_dependent_default_transport_map if Send from domain IP addresses option is set in Tools & Settings > Mail Server Settings:
# postmap -s /var/spool/postfix/plesk/sdd_transport_maps @example.com plesk-203.0.113.2-: @example2.com plesk-203.0.113.3-:
Note: 203.0.113.x should be replaced with the server's IP addresses. If so, the entries from sdd_transport_maps are defined in the first column of smtp_bind_address option. smtp_bind_address is an optional numerical network address that the Postfix SMTP client should bind to when making an IPv4 connection.
# grep ""smtp_bind_address"" /etc/postfix/master.cf plesk-203.0.113.2- unix - n n - - smtp -o smtp_bind_address=203.0.113.2 -o smtp_bind_address6= -o smtp_address_preference=ipv4 plesk-203.0.113.3- unix - n n - - smtp -o smtp_bind_address=203.0.113.3 -o smtp_bind_address6= -o smtp_address_preference=ipv4 To be able to connect, smtp_bind_address needs to be defined as mentioned in the mynetworks section and the binding name should be the same as defined in sdd_transport_maps:
# postconf mynetworks mynetworks = 127.0.0.0/8 [::1]/128 203.0.113.2/32, 203.0.113.3/32
Starting from Plesk 12, it should be empty:
# postconf mynetworks mynetworks =
unless there are white-listed IP addresses in Plesk > Tools & Settings > Mail Server Settings > White List tab. If so, they will be added to mynetworks section. Restart the service:
# service postfix restart "
10,"How to restore a deleted Web Presence Builder site from a snapshot located in a domain folder?
Applicable to: Plesk for Linux
Plesk for Windows Question The site existed in Web Presence Builder and was published to the domain. The site was accidentally removed from Web Presence Builder (WPB) by clicking on either More > Start Over or More > Remove Site. Is it possible to restore the site from the domain example.com?
Answer
The site can be restored from a snapshot located in the /data/snapshots directory of the domain where it was published.
When a new site for the domain is created, old snapshots are not shown in Web Presence Builder, even if the files exist in the file system. This is because the name of the main XML file contains the ID of the old site. To show old snapshots for new sites, it is necessary to rename the XML file: For Linux: Connect to the server via SSH and check snapshot name:
# ls -la /var/www/vhosts/example.com/httpdocs/data/snapshots/ total 252 -rw-r--r-- 1 testcust psacln 223 Jul 1 13:34 03a21c5dbeaf22159bc109374638f61f_list.xml -rw-r--r-- 1 testcust psacln 250139 Jul 1 13:34 3b395edf0050931a8632de93a4d3085a.php
Here, 03a21c5dbeaf22159bc109374638f61f is the ID of the old site that was published to the domain example.com. Create a new instance of the WPB site for the domain example.com via Plesk in Domains > example.com > Edit in Web Presence Builder.
Warning: Do not publish the site yet. Find the Site ID by the name of the Plesk domain:
# plesk db mysql> select d.name as 'Plesk Domain', s.uuid as 'Site uuid', s.site_id as 'Site ID' from psa.domains d, psa.dom_param dp, sitebuilder5.site s where d.id=dp.dom_id and dp.param='site_builder_site_id' and s.uuid=dp.val and d.name='example.com'; +--------------+--------------------------------------+----------------------------------+ | Plesk Domain | Site uuid | Site ID | +--------------+--------------------------------------+----------------------------------+ | example.com | d116751c-458c-5179-3f57-142135a67b3c | 172bc09617fa3dcafded8e53377097d5 | +--------------+--------------------------------------+----------------------------------+ Rename the XML file to make it fit the new Site ID:
# mv /var/www/vhosts/example.mom/httpdocs/data/snapshots/03a21c5dbeaf22159bc109374638f61f_list.xml /var/www/vhosts/example.com/httpdocs/data/snapshots/172bc09617fa3dcafded8e53377097d5_list.xml Refresh the page with the new site instance. Snapshots should be shown on the ""Revert"" page. As soon as they are available in WPB, you can restore them by clicking Load. Note: After the snapshot is restored, there may be additional issues with site images because they have the old location paths in the WPB database. As a result, they may not be visible in the restored site. To solve this, re-upload the images or change the paths in the database:
# mysqldump --disable-extended-insert sitebuilder5 > sb_backup.sql # grep ""03a21c5dbeaf22159bc109374638f61f"" sb_backup.sql | grep widget_property INSERT INTO widget_property VALUES (570,462,'content','<p><img id=\""mce-548\"" style=\""float: left; margin-right: 20px;\"" title=\""helloworld\"" src=\""/sitebuilder/sites/03/03a21c5dbeaf22159bc109374638f61f/attachments/Image/helloworld.jpg\"" alt=\""helloworld\"" width=\""1631\"" height=\""743\"" /></p>');
Find the strings with the old paths and replace them with the new values. For example, change /sitebuilder/sites/03/03a21c5dbeaf22159bc109374638f61f/attachments/Image/helloworld.jpg to /sitebuilder/sites/17/172bc09617fa3dcafded8e53377097d5/attachments/Image/helloworld.jpg. For Windows: Connect to the server via RDP Check the snapshot name at %plesk_vhosts%example.com\httpdocs\data\snapshots, e.g. 03a21c5dbeaf22159bc109374638f61f_list.xml, where 03a21c5dbeaf22159bc109374638f61f is the ID of the old site that was published to the domain example.com Create a new instance of the WPB site for the domain example.com via Plesk in Domains > example.com > Edit in Web Presence Builder
Note: Do not publish the site yet. Find the Site ID by the name of the Plesk domain: to access sitebuilder5 database on Windows, execute the following command via the command line:
C:\> ""%plesk_dir%\MySQL\bin\mysql.exe"" -D sitebuilder5 -usitebuilder -p<sitebuilder_password> -P 3306
The sitebuilder_password is located in the %plesk_dir%\sb\config file. Execute the following command for example.com:
MYSQL_WIN: mysql> select uuid,site_id from site where site_publish_settings_id=(select id from site_publish_settings where url like ""%example.com%"") \G *************************** 1. row *************************** uuid: 39ce7af2-a526-42e6-e3f6-2b04377c47e7 site_id: afdef54d44d8be6d83df5bd6ab10a157
The site ID is afdef54d44d8be6d83df5bd6ab10a157 Rename the XML file from %plesk_vhosts%example.com\httpdocs\data\snapshots directory to make it fit the new Site ID Refresh the page with the new site instance. Snapshots should be shown on the ""Revert"" page. As soon as they are available in WPB, you can restore them by clicking Load. Note: After the snapshot is restored, there may be additional issues with site images because they have the old location paths in the WPB database. As a result, they may not be visible in the restored site. To solve this, re-upload the images or change the paths in the database: Create a sitebuider database dump:
C:\> ""%plesk_dir%\Mysql\bin\mysqldump.exe"" -usitebuilder -p<sitebuilder_password> -P 3306 sitebuilder5 > C:\FULL\PATH\TO\FILE_NAME.sql Open the dump in any text editor and change the old paths and replace them with the new values. For example, change /sitebuilder/sites/03/03a21c5dbeaf22159bc109374638f61f/attachments/Image/helloworld.jpg to /sitebuilder/sites/17/172bc09617fa3dcafded8e53377097d5/attachments/Image/helloworld.jpg. "
9,"Unable to open Plesk via a hostname: Server not found
Applicable to: Plesk for Linux
Plesk for Windows Symptoms Plesk is not accessible via a hostname (https://example.com:8443):
PLESK_INFO: Server not found Hostname is not resolved:
# nslookup example.com ** server can't find example.com: SERVFAIL
Or:
# nslookup example.com ** server cannot find example.com: NXDOMAIN Plesk is accessible via an IP address (https://203.0.113.2:8443).
Or:
The following error is displayed in a browser:
PLESK_INFO: IP address could not be found Cause
The hostname is resolved incorrectly on a registrar side or not registered.
Resolution
Contact a domain registrar for an assistance to make a domain name (hostname) resolving to the server IP address.
As a workaround, use the server IP address instead of the hostname: https://203.0.113.2:8443"
5,"High CPU wait, I/O and Load Average during backup or outbound migration on Plesk serverSymptoms High CPU wait, I/O and Load Average, while the backup is generated in Plesk or outbound migration, is performed.
Sites may show 504 Gateway Timeout error. Cause /usr/bin/pigz and/or /bin/tar consumes high CPU resource during the backup process as it is involved in the backup compress process.
Resolution
There are three possible solutions to reduce the server load during backup process, for that the following options can be enabled under Tools & Settings > Backup Manager > Settings: Run scheduled backup processes with low priority
Run all backup processes with low priority Do not compress backup files (this way the backup size will be larger, but load average will be less as pigz process that is involved in the backup compress process will be skipped). These options launch pigz and tar with nice.
Note: these options increase the backup time. Other server tasks will not be affected. If there is a highly-loaded domain on a server that takes a lot of server resources, re-schedule the time to start a backup to the night when the number of visitors to the site is less.
Additional Information
Global Backup Settings"
2,"Plesk login page is not accessible: Failed to decrypt attribute 'password' because the keyset does not exist Applicable to: Plesk for Windows Symptoms
Plesk login page shows one of the following error messages:
PLESK_INFO: HTTP Error 500.19 - Internal Server Error Error Code 0x8007000d Config Error Failed to decrypt attribute 'password' because the keyset does not exist
OR
PLESK_INFO: Keyset does not exist (Exception from HRESULT: 0x80090016)
Cause
Insufficient permissions on the files: %ALLUSERSPROFILE%\Microsoft\Crypto\RSA\MachineKeys\6de9cb26d2b98c01ec4e9e8b34824aa2_* %ALLUSERSPROFILE%\Microsoft\Crypto\RSA\MachineKeys\76944fb33636aeddb9590521c2e8815a_* Resolution Connect to the Plesk server via RDP. Open the folder %ALLUSERSPROFILE%\Microsoft\Crypto\RSA\MachineKeys.
Note: Displaying of hidden files and protected system files should be enabled in Windows Control Panel > Folder Options. Find files with the names that start with 6de9cb26d2b98c01ec4e9e8b34824aa2_ and 76944fb33636aeddb9590521c2e8815a_. Check access permissions on these files (right-click on a file > Properties > Security tab).
Here are the correct permissions: System, Administrators, TrustedInstaller - Full control IIS_IUSR, WMSVC - Read LOCAL SERVICE (if available) - Read If the issue still persists, apply the following steps: Start a comamnd prompt as an Administartor. Obtain a GUID:
C:\> reg query ""HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Cryptography"" | findstr MachineGuid Verify that the files have names 6de9cb26d2b98c01ec4e9e8b34824aa2_GUID and 76944fb33636aeddb9590521c2e8815a_GUID.
Example:
If a GUID is:
C:\> reg query ""HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Cryptography"" | findstr MachineGuid MachineGuid REG_SZ 40c6fa54-0d9a-45ae-91c5-e85eb36dcbd2
then files will have names: 6de9cb26d2b98c01ec4e9e8b34824aa2_40c6fa54-0d9a-45ae-91c5-e85eb36dcbd2 76944fb33636aeddb9590521c2e8815a_40c6fa54-0d9a-45ae-91c5-e85eb36dcbd2 Restart IIS using the following command in a command-prompt
C:\> iisreset "
8,"Mails from contact form or after scheduling tasks are not getting delivered: You are not allowed to use sendmail utility
Applicable to: Plesk for Linux Symptoms Mails from contact forms or after scheduling tasks are not getting delivered: You are not allowed to use sendmail utility. The following error messages appear in /var/log/maillog:
CONFIG_TEXT: journal: plesk sendmail[22347]: handlers_stderr: DATA REPLY:554:5.7.0 The message could not be sent. You are not allowed to use sendmail utility.#012REJECT journal: plesk sendmail[22347]: REJECT during call 'limit-out' handler The following error message appears in /var/log/messages:
CONFIG_TEXT: hostname crond: Mail handler 'limit-out' said: REPLY:554:5.7.0 The message could not be sent. You are not allowed to use sendmail utility. In case a scheduled task is used, the following message appears in /var/log/cron:
CONFIG_TEXT: hostname CROND[20426]: (user) MAIL (mailed 682 bytes of output but got status 0x0064#012) Cause
The sendmail utility is disabled.
Resolution
Enable the use of sendmail. For one subscription Go to Tools & Settings > Outgoing Mail Control> Subscription > example.com > Change Limit: Enable Allow using Sendmail for scripts and users on this subscription sendmail usage policy: Server-wide Go to Tools & Settings > Mail Server Settings > enable the Allow users and scripts to use Sendmail option. "
8,"MailEnable does not send auto-reply or notifications on Plesk Windows server
Applicable to: Plesk for Windows Symptoms MailEnable autoresponder does not send an autoreply. In MailEnable Management > Servers > localhost > Servers and Connectors > SMTP > Logs > Activity > SMTP-Activity-date.log following message can be found:
CONFIG_TEXT: 127.0.0.1 AUTH xxxxx 504 Invalid Username or Password 34 18 postmaster@localhost CONFIG_TEXT: AUTH xxxxxx 504 User Account has been disabled by the mail administrator 62 18 postmaster@localhost CONFIG_TEXT: SMTP-IN XXX.MAI 984 127.0.0.1 RCPT RCPT TO: john.doe@example.com 503 This mail server requires authentication when attempting to send to a non-local e-mail address. Please check your mail client settings or contact your administrator to verify that the domain or address is defined for this server. After enabling debug for Plesk backend utilities (How to enable/disable debug logging for Plesk backend utilities on Windows), lines below can be found in %plesk_dir%admin\logs\plesklog_debug<date>.log:
CONFIG_TEXT: 2019/05/23 17:36:14.024 1104 30216 Info: Create mail from='jane.doe@example.com', to='john.doe@example.net', subject='Re: Autoreply', body='Test auto-reply' 2019/05/23 17:36:14.025 1104 30216 Info: Send mail from '"""" <jane.doe@example.com>' to '"""" <john.doe@example.net>' 2019/05/23 17:36:14.038 1104 30216 Warning: SMTP Exception at sendMail(jane.doe@example.com, john.doe@example.net)(MessageProcessor::sendMail line 329) Cause
Account postmaster@localhost is missed or disabled in MailEnable Management or registry.
Resolution Connect to the server via RDP.
Note: if direct RDP access to the server is not possible, contact server administrator for further assistance. Go to MailEnable Management > Messaging Manager > Post Offices and check whether postmaster user exists under localhost domain. If postmaster user absent:
2.1. Delete localhost domain from MailEnable Management. 2.2. Disable and enable option Use the mail server installed with Plesk and the default mail account created by Plesk in Plesk > Tools & Settings > External SMTP Server.
Note: Domain with postmaster@localhost will be recreated by Plesk automatically. If for some reason use of postmaster@localhost is not suitable, then make sure that 127.0.0.1 is set in Host name or IP address in Plesk > Tools & Settings > External SMTP Server.
Additional Information
Auto-Reply option is not working in Plesk for Windows"
2,"Plesk for Windows login page shows: No connection could be made because the target machine actively refused it Applicable to: Plesk for Windows Symptoms Plesk login page is showing an error:
PLESK_INFO: ERROR: PleskMainDBException No connection could be made because the target machine actively refused it. 0: common_func.php3:637 reconnect() 1: common_func.php3:600 db_connect() 2: auth.php3:134 The following error appears:
PLESK_INFO: [panel]: Error during product key mode determination, details: No connection could be made because the target machine actively refused it. ; trace: #0 C:\\Program Files (x86)\\Parallels\\Plesk\\admin\\plib\\db.php(411): reconnect() #1 C:\\Program Files (x86)\\Parallels\\Plesk\\admin\\plib\\functions.php(2791): db_connect() #2 C:\\Program Files (x86)\\Parallels\\Plesk\\admin\\plib\\functions.php(2808): isPpaKeyRequired() #3 C:\\Program Files (x86)\\Parallels\\Plesk\\admin\\plib\\common_func.php3(7): require_once('C:\\Program File...') #4 C:\\Program Files (x86)\\Parallels\\Plesk\\admin\\plib\\auth.php(93): require_once('C:\\Program File...') #5 {main} ERR (3) [panel]: Unable to get key: error: C:\\Program Files (x86)\\Parallels\\Plesk\\admin\\repository\\lock\\repository: cannot create: Permission denied PHP Warning:mysqli::close(): Couldn't fetch mysqli in C:\\Program Files (x86)\\Parallels\\Plesk\\admin\\plib\\db.php on line 491 ERR (3) [panel]: No connection could be made because the target machine actively refused it. : 0: db.php:451 reconnect() 1: db.php:411 db_connect() 2: auth.php:140 PleskMainDBException: No connection could be made because the target machine actively refused it. file: C:\\Program Files (x86)\\Parallels\\Plesk\\admin\\plib\\db.php line: 451 code: Cause The Plesk MySQL server is stopped.
MySQL databases are corrupted.
Incorrect permissions on some Plesk directories (Read-only attribute).
Incorrect parameters in configuration file. Resolution
Note: To apply the solution from this article it is required to have RDP access to the server. Please contact your hosting provider support or server's administrator if you don't have RDP access or ask them to apply the solution. Make sure that the error is the same as in symptoms.
Connect to the server using RDP. Fix incorrect Plesk SQL Server service configuration or state.
3.1. Restart Plesk SQL Server service using Plesk Services Monitor. 3.2. Make sure that my.ini exists in "" %plesk_dir%\\MySQL\\Data\\ "" and that basedir and datadir parameters have the correct values:
C:\> findstr dir ""%plesk_dir%\\Mysql\\my.ini"" port=8306basedir=C:\\Program Files (x86)\\Parallels\\Plesk\\MySQL datadir=C:\\Program Files (x86)\\Parallels\\Plesk\\MySQL\\Data tmpdir=C:\\Program Files (x86)\\Parallels\\Plesk\\MySQL\\Data
3.3. Ensure that all options and extensions specified in my.ini are valid. If MySQL goes down, again, with error 1067 ""The process terminated unexpectedly"": Check the MySQL error logs in %plesk_dir%\\MySQL\\Data\\<computer_name>.err :
4.1. If the following error occurs:
CONFIG_TEXT: 130904 20:23:16 InnoDB: Database was not shut down normally! InnoDB: Starting crash recovery. InnoDB: Reading tablespace information from the .ibd files... InnoDB: Restoring possible half-written data pages from the doublewrite
This may mean that PSA or another database is broken, or there is inconsistent information in one of the databases. Please see the following articles: #213914385 MySQL service fails to start: Can't open and lock privilege tables: Incorrect file format 'host' #213902465 Plesk is not available: Got error -1 from storage engine
4.2. The other possible errors in the MySQL error log file:
CONFIG_TEXT: Version: '5.5.31' socket: '' port: 8306 MySQL Community Server (GPL) 1 1 1 IInnoDB: We intentionally generate a memory trap. InnoDB: Submit a detailed bug report to http://bugs.mysql.com. InnoDB: If you get repeated assertion failures or crashes, even InnoDB: immediately after the mysqld startup, there may be InnoDB: corruption in the InnoDB tablespace. Please refer to InnoDB: http://dev.mysql.com/doc/refman/5.5/en/forcing-innodb-recovery.html InnoDB: about forcing recovery.
Sometimes, it does not mean the database has been corrupted. Make sure that the files in %plesk_dir%\\MySQL\\Data\\ do not have ""Read-only"" attribute (sub-directories can have this attribute). If the files are read-only, it is needed to to right-click on %plesk_dir%\\Plesk\\MySQL\\Data , go to Properties , un-check ""Read-only"" attribute and click OK. Then, try to start ""Plesk SQL Server"" service again.
5.1 Check Event Viewer logs for errors in Application logs section.
5.2. In case of the following error, change the innodb_log_file_size value in %plesk_dir%\\MySQL\\Data\\my.ini according to the error. In this case, it is needed to specify the file size as 10M CONFIG_TEXT: InnoDB: Error: log file .\\ib_logfile0 is of different size 0 10485760 bytes InnoDB: than specified in the .cnf file 0 5242880 bytes! If Plesk shows an error like above in Case 2 : This means incorrect file permissions on some files are set in %plesk_dir%\\admin . It is possible to restore the default permissions using the Plesk Reconfigurator . Run the Plesk Reconfigurator as administrator: %plesk_bin%\\reconfigurator.exe Check component and folder permissions > Browse , select C:\\Program Files (x86)\\Parallels\\Plesk\\admin and press Check "
8,"What do notifications from ""SPF filter"" mean in Plesk?
Applicable to: Plesk Onyx for Linux
Plesk for Linux Question
SPF spam filter is enabled in server-wide mail preferences in Plesk > Tools and Settings > Mail Server Settings > Switch on SPF spam protection .
The following notifications are shown in /usr/local/psa/var/log/maillog :
CONFIG_TEXT: plesk spf filter[22147]: Starting spf filter... plesk spf filter[22147]: remote IP address does not correct plesk spf filter[22147]: Unable to get options for spf filter CONFIG_TEXT: plesk spf filter[22090]: Starting spf filter... plesk spf filter[22090]: Error code: (2) Could not find a valid SPF record plesk spf filter[22090]: Failed to query guess rules: Could not find a valid SPF record near 'a/24 mx/24 p' plesk spf filter[22090]: Failed to query MAIL-FROM: No DNS data for 'example.comd'.
What do they mean?
Answer
Each line of the aforementioned log is explained, as follows: ""Unable to get options for spf filter"" This line is an error that is caused by an incorrect header on the message that was sent. It may occur if the SMTP command HELO/EHLO is missing. The message is not checked by SPF.
If the error is seen when sending an email over the telnet command, verify that the message is formatted correctly.
For example:
# telnet localhost 25 Trying 127.0.0.1... Connected to localhost. Escape character is '^]'. 220 server.example.com ESMTP HELO server.example.com 250 server.example.com MAIL FROM: root@server.example.com 250 ok RCPT TO: jdoe@example.net 250 ok data 354 go ahead Subject: Test message for SPF spam protection From: root@server.example.com_ ""Could not find a valid SPF record near 'a/24 mx/24 p'"" This line appears if an incorrect guess rule is configured in SPF. Verify that the rule starts with ""v=spf1.""
The rule can be reconfigured in Plesk > Tools and Settings > Mail Server Settings > Switch on SPF spam protection > SPF guess rules or manually in the file /etc/psa-spf/spfguess.
For example:
# cat /etc/psa-spf/spfguess v=spf1 a/24 mx/24 ptr ""Error code: (2) Could not find a valid SPF record"" and ""Failed to query MAIL-FROM: No DNS data for 'example.com'"": These notifications occur if the domain example.com does not have a valid SPF record in the DNS. In this case, SPF local rules are not applied.
The message is processed according to SPF checking mode set in server-wide mail preferences at Plesk >Tools and Settings > Mail Server Settings > Switch on SPF spam protection > SPF checking mode.
To resolve the problem, configure SPF records in the DNS zone of the domain that sends mail (as in MAIL FROM.) "
2,"How to change IP address for multiple subscriptions in Plesk for Windows
Applicable to: Plesk for Windows Question
There are a lot of subscriptions assigned to an IP address in Plesk for Windows. How to switch all subscriptions to a different IP address on Windows?
Note: For Plesk for Linux, refer to the article How to replace IP address for domains/clients/resellers in Plesk for Linux.
Answer
Use Plesk Reconfigurator to re-assign all subscriptions to a different IP address. Login to Plesk. Go to Tools & Settings > IP Addresses and remove the new IP (IP to move subscriptions to), if it already exists in Plesk.
To move subscriptions to a different IP using Plesk Reconfigurator, IP should be added on a server directly and should not exist in Plesk. Connect to the server using RDP. Re-add new IP address in Control Panel > Network and Internet > Network and Sharing Center > Change adapter settings > right mouse click on a network interface > Properties > Internet Protocol Version 4 (TCP/IPv4) > Properties > Advanced > Add. Go to Start > All Programs > Plesk Reconfigurator. Select the option Change server IP addresses. The window IP Addresses Reconfiguring will be opened. In the section Select the IP addresses to be changed, select IP addresses which are to be replaced. Map each selected IP to a new IP address:
8.1. To map a selected address, click on the address entry. The entry will be highlighted.
8.2. Select the address to map to: To map to an existing IP address, use the section Existing Address. To map to a new IP address that will be created during mapping, use the section Create New IP Address. Click Next. Plesk installation will be reconfigured to use the newly specified IP addresses in place of the old ones. All related records in the database will be updated, network adapter settings will be changed (the old IP addresses are removed), FTP and web servers will be reconfigured, and DNS records will be updated accordingly.
If the changing fails during execution, all the changes are rolled back.
Note: When connected to the server through the Remote Desktop connection, a change the server IP address will terminate the session.
More details can be found in Plesk Onyx Administrator's Guide."
3," How to enable/disable Apache graceful restart in Plesk
Applicable to: Plesk for Linux Question
Apache restarts every time when hosting settings are changed via Plesk interface. It leads to a short downtime of the websites hosted on this server. How to enable/disable graceful restart for Apache in Plesk? How to make Apache reload instead of restarting when applying settings in Plesk? Answer
Note: Graceful restart for Apache is enabled by default on all new Plesk Obsidian installations. Enabling/disabling graceful restart for Apache in Plesk Obsidian In Plesk, go to Tools & Settings > Apache Web Server. Enable/disable the Apache graceful restart option and apply the changes. Enabling/disabling graceful restart for Apache in Plesk Onyx To enable Apache graceful restart, set the restart_apache_gracefully parameter to true in the psa.misc table: Connect to the Plesk server via SSH. For security reasons, create a dump of the Plesk database:
# plesk db dump psa > psa_backup.$(date +%F_%R).sql Run the following command: To enable Apache graceful restart
# plesk db ""INSERT INTO psa.misc VALUES ('restart_apache_gracefully', 'true')"" If restart_apache_gracefully already exists (the command above fails with ""Duplicate entry"") in the psa.misc table, run:
# plesk db ""UPDATE psa.misc SET val='true' WHERE param = 'restart_apache_gracefully'"" To disable Apache graceful restart
# plesk db ""UPDATE psa.misc SET val='false' WHERE param = 'restart_apache_gracefully'"" Check Apache graceful restart status with the command:
# plesk db ""select * from psa.misc WHERE param = 'restart_apache_gracefully'""
where true - Apache graceful restart is enabled, false - disabled. Additional Information Graceful Restart - Stopping and Restarting Apache HTTP Server - Apache HTTP Server Version 2.4
Graceful Restart - Stopping and Restarting - Apache HTTP Server Version 2.2
"
9,"How to change the priority for MX record in Plesk?
Applicable to: Plesk for Linux
Plesk for Windows Question
How to change the priority for MX record in Plesk?
Answer Log into Plesk. Go to Domains > example.com > DNS Settings. Find and click on the MX record: Select the required MX priority from the drop-down menu Specify the priority of the mail exchange server: Press the OK button to apply the changes.
"
2,"How to uninstall Plesk for Linux
Applicable to: Plesk 12.0 for Linux
Plesk 12.5 for Linux
Plesk Onyx for Linux Question
How to uninstall Plesk for Linux?
Answer
Warning: After Plesk uninstallation, some system services may stop working due to their close integration with Plesk. Before removing Plesk for Linux, it is recommended to create a server snapshot to have a system restore point.
Note: Due to a Plesk Installer bug with ID PI-498, it is not possible to remove Plesk installed on Debian/Ubuntu-based distributions: - Debian 9 - Debian 8 - Ubuntu 18.04 - Ubuntu 16.04 As a workaround, we recommend to deploy a server from scratch.
To remove Plesk from CentOS/RHEL-based distributions, follow these steps: Connect to a Plesk server via SSH. Run the following command to remove Plesk and all its components:
# plesk installer --remove-everything "
8,"Auto-Reply is not working in Plesk for Windows Server with MailEnable Applicable to: Plesk for Windows Symptoms The auto-reply feature is enabled at Domains > example.com > Email Addresses > john.doe@example.com > Auto-Reply > Switch on auto-reply, but automatic responses are not sent. The following error message appears in the logfile C:\Program Files (x86)\Mail Enable\Logging\SMTP\SMTP-Activity-YYMMDD.log (%plesk_dir%Mail Servers\Mail Enable\Logging\SMTP\SMTP-Activity-YYMMDD.log in older Plesk versions):
CONFIG_TEXT: SMTP-IN 858D3A9A5EB14332B693B6AD45676AF2.MAI 996 127.0.0.1 MAIL MAIL FROM: <john.doe@example.com> 551 Sender address is not valid for your login. Check your email program settings. 84 33 postmaster@localhost MailEnable built-in autoresponder works properly. Cause
MailEnable mail server configuration conflicts with Plesk:
Plesk Auto-Reply feature does not work together with the option Authenticated senders must use address from their postoffice (or Authenticated senders must use valid sender address). As workaround, enable the option and use autoresponder of MailEnable.
Resolution Connect to a Plesk server via RDP. Launch MailEnable Management console at Windows Start > All Programs > Mail Enable. In MailEnable Management console, expand Servers > localhost > Services and Connectors > right-click on SMTP and open its Properties. In SMTP Properties window, switch to the Security tab and disable the options Disable all catchalls and Authenticated senders must use address from their postoffice (or Authenticated senders must use valid sender address). Click the Apply button. Switch to the Relay tab > Privileged IPs... and select Denied relay rights.
To allow sending emails through the server from a web server or web page, add the IP addresses of those users who are able to send email out through the server: Click Add, enter the IP address and click Close. Click OK to apply the changes. Restart the MailEnable SMTP Connector service:
6.1. In MailEnable Management console, go to Servers > localhost > System > Services Status.
6.2. Select MailEnable SMTP Connector.
6.3. Click Restart in the right pane. Note: If the number of the failed sent attempts is more than the number set in Domains > example.com > Email Addresses > john.doe@example.com > Auto-Reply > Send an automatic response to a unique email address no more than (times a day), then auto-reply will not be sent. Increase the mentioned parameter to make the auto-reply functioning."
8,"Plesk email notifications are not sent to external email addresses in Plesk for Windows Server with MailEnable: Sender address is not valid for your login.
Applicable to: Plesk for Windows Symptoms
Plesk email notifications configured at Tools & Settings > Notifications are not sent to external email addresses. MailEnable mail server is installed.
One of the following errors may appear: In %plesk_dir%\admin\logs\php_error.log:
CONFIG_TEXT: ERR [panel] Sender address is not valid for your login. Check your email program settings. In C:\Program Files (x86)\Mail Enable\Logging\SMTP\SMTP-Activity-YYMMDD.log (%plesk_dir%Mail Servers\Mail Enable\Logging\SMTP\SMTP-Activity-YYMMDD.log in older Plesk versions):
CONFIG_TEXT: SMTP-IN 70B2743EE7C843B7B27BCD4CEEB24FB7.MAI 1808 127.0.0.1 MAIL MAIL FROM:<user@sender.tld> 551 Sender address is not valid for your login. Check your email program settings. 84 33 postmaster@localhost
CONFIG_TEXT: 05536E3B2E4D59.MAI 1268 127.0.0.1 MAIL MAIL FROM:<user@sender.tld> 250 Requested mail action okay, completed 43 31 SMTP-IN 7F87DB65F5EA4569B105536E3B2E4D59.MAI 1268 127.0.0.1 RCPT RCPT TO:<user@recipient.tld>503 This mail server requires authentication when attempting to send to a non-local e-mail address. Please check your mail client settings or contact your administrator to verify that the domain or address is defined for this server.235 Failed to meet all relay criteria. Attempt to relay to [SMTP:user@receiver.tld] was denied for requesting IP Address 127.0.0.1
CONFIG_TEXT: 503 Bad sequence of commands. Could not process RCPT command when in this state 81 32 user@sender.tld In Windows Event Viewer:
PLESK_INFO: SMTP Exceptionat Unable to execute event(runtask::start line 210)Execute file name: C:\Program Files (x86)\Parallels\Plesk\admin\bin\runtask.exe In %plesk_dir%\admin\logs\health-alarm.log:
CONFIG_TEXT: Unable to send e-mail notification: Could not read from <domainname> Cause
MailEnable mail server configuration conflicts with Plesk:
Plesk email notifications cannot be sent when the option Authenticated senders must use address from their postoffice (or Authenticated senders must use valid sender address) is enabled in MailEnable.
Resolution Connect to a Plesk server via RDP. Launch MailEnable Management console at Windows Start > All Programs > Mail Enable. In MailEnable Management console, expand Servers > localhost > Services and Connectors > right-click on SMTP and open its Properties. In SMTP Properties window, switch to the Security tab and disable the option Authenticated senders must use address from their postoffice (or Authenticated senders must use valid sender address). Apply the changes. Restart the MailEnable SMTP Connector service:
5.1. In MailEnable Management console, go to Servers > localhost > System > Services Status.
5.2. Select MailEnable SMTP Connector.
5.3. Click Restart in the right pane. Cause Auto-Reply is not working in Plesk for Windows with MailEnable "
5,"MySQL reports the error on a Linux server: Cannot load from mysql.. The table is probably corrupted Applicable to: Plesk for Linux Symptoms
One of the following MySQL errors appear during a Plesk upgrade or after a Plesk migration/backup process:
CONFIG_TEXT: Cannot load from mysql.proc. The table is probably corrupted
OR
CONFIG_TEXT: Cannot load from mysql.user. The table is probably corrupted
OR
CONFIG_TEXT: ERROR 1146 (42S02) at line 22: Table 'mysql.proc' doesn't exist Possible consequences Plesk upgrade fails/completes with the following message:
CONFIG_TEXT: ERROR while trying to upgrade APSC SQL database from 11.1.0 Check the error reason(see log file: /var/log/plesk/install/plesk_17.5.3_installation.log), fix and try again
In the mentioned above error logfile, the following error message appears:
CONFIG_TEXT: ERROR 1548 (HY000) at line 67: Cannot load from mysql.proc. The table is probably corrupted ... mysqldump: Couldn't execute 'SHOW VARIABLES LIKE 'gtid\_mode'': Native table 'performance_schema'.'session_variables' has the wrong structure (1682) Migration completes with the following warning:
PLESK_INFO: [Migration] Failed to copy content of database 'DB_NAME' Migration tools tried to perform operation in 3 attempts: Command execution failed on the source server 'source' (203.0.113.2) with non-zero exit code. command: MYSQL_PWD=""$(cat)"" mysqldump -h localhost -P 3306 -uadmin --quick --quote-names --add-drop-table --default-character-set=utf8 --set-charset --routines hardcore > /tmp/db-dumps/DB_NAME.sql exit code: 2 stdout: stderr: mysqldump: Couldn't execute 'SHOW FUNCTION STATUS WHERE Db = 'DB_NAME'': Cannot load from mysql.proc. The table is probably corrupted (1548) Backup completes with the following warning:
PLESK_INFO: Warning : mysql ""Database"" Not all the data was backed up into /var/lib/psa/dumps/..../databases/Database successfully. mysqldump: Couldn't execute 'SHOW FUNCTION STATUS WHERE Db = 'Database'': Cannot load from mysql.proc. The table is probably corrupted (1548) Operations on databases in phpMyAdmin fails with:
PLESK_INFO: Errors occurred while executing: mysqldump: Couldn't execute 'SHOW FUNCTION STATUS WHERE Db = 'db_name'': Cannot load from mysql.proc. The table is probably corrupted (1548) The following error message appears in Plesk at Tools & Settings > Database Servers:
PLESK_ERROR: Error: Cannot load from mysql.user. The table is probably corrupted
and the MySQL (localhost) status icon is grayed out. The following errors might appear in /var/log/mysqld.log:
CONFIG_TEXT: [ERROR] Missing system table mysql.proxies_priv; please run mysql_upgrade to create it ... [ERROR] Native table 'performance_schema'.'events_waits_current' has the wrong structure [ERROR] Native table 'performance_schema'.'events_waits_history' has the wrong structure ... [ERROR] Incorrect definition of table mysql.proc: expected column 'comment' at position 15 to have type text, found type char(64). Cause
The mysql.<table_name> table is broken or the structure of a column in the table is incorrect.
Resolution Connect to the Plesk server via SSH. Repair the broken table: If mysql.proc is corrupted
# MYSQL_PWD=`cat /etc/psa/.psa.shadow` mysql -uadmin mysql -Ne""REPAIR TABLE mysql.proc"" +------------+--------+--------+----+ | mysql.proc | repair | status | OK | +------------+--------+--------+----+ If mysql.user is corrupted:
# MYSQL_PWD=`cat /etc/psa/.psa.shadow` mysql -uadmin mysql -Ne""REPAIR TABLE mysql.user"" +------------+--------+--------+----+ | mysql.user | repair | status | OK | +------------+--------+--------+----+ Upgrade MySQL system tables:
# MYSQL_PWD=`cat /etc/psa/.psa.shadow` /usr/bin/mysql_upgrade --force -uadmin --upgrade-system-tables Restart the MySQL service. The command depends on installed MySQL server and operating system:
# service mysql restart # service mysqld restart # service mariadb restart Related Articles Plesk Upgrade fails: ERROR while trying to upgrade APSC SQL database from 11.1.0
"
9,"Website statistics (Webalizer) does not show relevant data
Applicable to: Plesk for Linux Symptoms
Website statistics (Webalizer) does not show relevant data.
Cause
Webalizer configuration file for the domain is incorrect or lost.
Resolution
Connect to the server via SSH and rebuild 'webalizer' configuration file for domain and recalculate statistics:
# /usr/local/psa/admin/sbin/webstatmng --set-configs --stat-prog=webalizer --domain-name=example.com# /usr/local/psa/admin/sbin/webstatmng --calculate-rotated-statistics --stat-prog=webalizer --domain-name=example.com# /usr/local/psa/admin/bin/statistics --generate-domain-webstat --domain-name=example.com"
0,"How to rerun daily maintenance tasks separately on Plesk for Windows? Applicable to: Plesk Onyx for Windows Plesk 11.x for Windows Plesk 12.0 for Windows Plesk 12.5 for Windows Information
Sometimes you may need to run daily maintenance tasks separately or to run just one of them. You may see the list of all daily tasks with the command:
C:\> ""%plesk_dir%\admin\bin\php.exe"" -dauto_prepend_file="""" -ddisplay_errors=on ""%plesk_dir%\admin\plib\DailyMaintainance\\script.php"" -l CheckForUpdates InstallUpdates UpdateKeys PleskUsage Sitebuilder MailUsage ExecuteStatistics ProcessAutoreports OptimizeStatistics AnalyseDomainStatistics AnalyseClientStatistics ExecuteSpamtrain RemoveSpamTempFiles LoadCustomizations UpdateApsCache UpdateApsApplications Filesharing UpgradePanel
For example to update Plesk license keys, only run the following command:
C:\> ""%plesk_bin%\php.exe"" -dauto_prepend_file= ""%plesk_dir%\admin\plib\DailyMaintainance\task-script.php"" UpdateKeys ""--period=daily""
The task "" AnalyseDomainStatistics "" may be performed for the particular domain. For example, to analyze statistics only for one example.com domain (e.g. with id=1), run the following command:
C:\> ""%plesk_bin%\php.exe"" -dauto_prepend_file= ""%plesk_dir%\admin\plib\DailyMaintainance\task-script.php"" AnalyseDomainStatistics ""--period=daily"" ""--process-domain-ids=1""
Domain's id could be found using the following command:
C:\> plesk db ""select id from domains where name='example.com'
Additional information
How to rerun daily maintenance tasks separately for Plesk on Linux?"
7,"Plesk installation or update fails: ERROR while trying to check the hostname
Applicable to:
Plesk for Linux
Symptoms
Plesk installation or update fails with the following error message:
CONFIG_TEXT: ... Trying to resolve hostname ‘localhost.localdomain’ and validate its IP address… Unable to resolve host name. Please specify the host name in the /etc/hosts file or specify DNS configuration in the /etc/resolv.conf on your system. ERROR while trying to check the hostname ....
Cause
Misconfiguration of the /etc/hosts file or invalid PTR record.
Resolution Connect to the server via SSH Back up the current /etc/hosts file:
# cp -a /etc/hosts{,.backup} Edit the /etc/hosts file as follows:
Note: The second line starting with ::1 should be added only if the system has IPv6. This can be verified with the following command: ip -6 a
CONFIG_TEXT: 127.0.0.1 localhost localhost.localdomain localhost4 localhost4.localdomain4 ::1 localhost localhost.localdomain localhost6 localhost6.localdomain6 203.0.113.2 plesk.example.com host
Where:
- 203.0.113.2 is the main IP address- plesk.example.com is the hostname: How to change or get the server hostname on Plesk server Make sure that the main IP address has a valid PTR record resolving to a valid FQDN hostname:
# dig +short -x 203.0.113.2plesk.example.com. "
7,"Is it possible to change the default language in Plesk?
Applicable to: Plesk for Linux
Plesk for Windows Question
Is it possible to change the default language in Plesk?
Resolution
Using Plesk interface:
To change a default language, perform the following: Go to Plesk > Tools&Settings > Plesk Appearance > Languages > Available languages . Select needed language and then click Make Default button. Log out from Plesk. Log in to Plesk. Using SSH/RDP connection
Linux: # plesk bin locales --set-default es-ES
Windows:
C:\> plesk bin locales --set-default es-ES
Note: es-ES is given as an example.
"
8,"Scheduled notifications are not sent to email indicated in the task settings
Applicable to: Plesk for Linux Symptoms
Option Send to the default email or Send to the email I specify is set in Scheduled Tasks, but notifications were not sent.
Cause
Plesk uses cron daemon to perform scheduled tasks and, by default, cron daemon does not send an e-mail if the task does not return any output to STDOUT or STRERR streams. For example:
# /bin/echo ""Hello world"" > /dev/null #
As it is stated in descriptions: notifications with Errors only status will be sent if there is the standard error stream of the command only. If the stream is empty, no notification will be sent.
notifications with Every time status will be sent if there is any output of the command. If the output is empty, no notification will be sent Resolution
Consider to modify the scheduled task, so that it generates any output. For example:
<scheduled_command> | echo ""Scheduled task executed successfully"" This way, after its execution, ""Scheduled task executed successfully"" text will be propagated to STDOUT and an e-mail notification will be sent.
Note: option Run Now is intended for test purposes and does not send a notification, even if there is output. An email is sent when the task is executed automatically only."
5,"How to restore a website file from a Plesk backup
Applicable to: Plesk Onyx
Plesk for Linux Question
How to restore a website file from a Plesk backup?
Answer
Users can select single objects to restore from a backup. This enables users to restore only what they need to restore, without overwriting other objects and risking damaging their configuration or data. For example, if a user wants to restore only a DNS zone of one domain, example.com, there is no need to restore configurations of all other domains.
Note: The restoration of selected objects is possible only from backups created in Plesk 12.0 or later. Log in to Plesk. Open the Backup Manager: Server-wide backups:
Go to Tools & Settings > Backup manager Subscription backup:
Go to Websites & Domains > example.com > Backup Manager Follow the instructions from videos: "
3,"Plesk and websites shows 503 Service Unavailable: The process exit code was 0xc0000022
Applicable to: Plesk 12.5 for Windows
Plesk Onyx for Windows Symptoms Plesk and websites show the following error:
CONFIG_TEXT: 503 Service Unavailable. The following can be found in Event Viewer > System :
CONFIG_TEXT: Application pool 'AppPoolName' is being automatically disabled due to a series of failures in the process(es) serving that application pool.
And the message with the following error code:
CONFIG_TEXT: AppPool(name) terminated unexpectedly. (process ID). The process exit code was 0xc0000022 Application pools for these websites crashes only if Enable 32-Bit Applications in Advanced Settings is set as True Cause
Incorrect system permissions.
Resolution
Check permissions for C:\\Windows or C:\\Program Files (x86)\\IIS directory: Open Windows Explorer Go to C:\\Windows or C:\Program Files (x86)\IIS\. Right click on Windows folder and go to Properties > Security Check that Users (domain\Users) group exists with correct permissions like on the screenshot: Also, check that there are no Deny rules for psaadm , psacln , psaserv users. If the issue persists, Use Process Monitor utility with filter by Access Denied. Permissions can be given to psaadm, psaacln and psaaserv to the entire C:\\Windows directory with the following commands:
C:\> cacls C:\Windows\*.* /E /T /C /R ""psacln"" cacls C:\Windows\*.* /E /T /C /R ""psaadm"" cacls C:\Windows\*.* /E /T /C /R ""psaserv""
Replace drive C:\\ with drive name in question.
Contact Plesk technical support if it did not help."
8,"Cannot send email using Outlook: 554 5.7.1: Client host rejected: Access denied Applicable to: Plesk Onyx for Linux Symptoms In an attempt to send an email to some external domains (hotmail.com, gmail.com, etc) using Outlook, the following bounce message is returned:
CONFIG_TEXT: Server error: '454 4.7.1 jdoe@example.com: Relay access denied'
Or:
CONFIG_TEXT: Client host rejected: Access denied: 554 5.7.1 <example.com[203.0.113.2]>: Client host rejected: Access denied The following message can be found in /var/log/maillog :
CONFIG_TEXT: postfix/smtpd[8688]: NOQUEUE: reject: RCPT from example.net[203.0.113.2]: 554 5.7.1 jdoe@example.com: Relay access denied;
Or:
CONFIG_TEXT: postfix/smtpd[21167]: NOQUEUE: reject: RCPT from unknown[203.0.113.2]: 454 4.7.1 jdoe@example.com: Relay access denied; Other mail clients (Opera Mail, Mozilla Thunderbird) are able to send messages. Cause
Too restrictive Outlook configuration.
Resolution
Note: This article may require additional administrative knowledge to apply. If any help required, contact server’s administrator or hosting support.
Note: If you are a mailbox owner, contact your service provider for assistance. Connect to the server via SSH. Create a backup of the main Postfix configuration file:
# cp /etc/postfix/main.cf /etc/postfix/main.cf.back Open file /etc/postfix/main.cf using a text editor. Make sure that the row presents in the /etc/postfix/main.cf or add the row it is is missing:
CONFIG_TEXT: smtpd_relay_restrictions = permit_mynetworks, permit_sasl_authenticated, defer_unauth_destination Delete or comment (add ""#"" symbol in the beginning) the below line in the same file: CONFIG_TEXT: #smtpd_sasl_security_options = noplaintext Allow non-secure access by adding the below line:
CONFIG_TEXT: smtpd_tls_auth_only = no Reload Postfix with the command:
# service postfix reload Make sure that Outlook has got the following configuration in Outlook > File > Account Settings > Account Settings > jdoe@example.com > Change.. > More Settings: Additional Information Postfix Configuration Parameters "
2,"Unable to upload files more than 2GB in Plesk File Manager or Backup Manager: 404.13 Not Found Applicable to: Plesk for Windows Symptoms
Cannot upload large file using Backup Manager or File Manager:
CONFIG_TEXT: HTTP Error 404.13 - Not Found The request filtering module is configured to deny a request that exceeds the request content length.
Cause
Content-Length header of the request is larger than the value specified for this header in maxAllowedContentLengthproperty in ApplicationHost.config.
By default, maxAllowedContentLength value in Plesk is 30000000.
Resolution
Note: if you don't have administrative access to Plesk server via RDP, contact your hosting provider regarding the issue Login to Plesk server via RDP Increase maxAllowedContentLength value:
C:\> %windir%\system32\inetsrv\appcmd set config ""PleskControlPanel/"" -section:requestFiltering -requestLimits.maxAllowedContentLength:4294967295
maxAllowedContentLength will be set to 4GB. This is the maximum file size which can be uploaded through IIS. For files more than 4GB
Upload them using the other service (for example, FTP).
Local backup files can be imported to Plesk backup repository like this:
C:\> ""%plesk_bin%\pmm-ras.exe"" --import-file-as-dump --dump-file-specification=""C:\backup.file"""
10,"How to migrate sites from Plesk SiteBuilder 4.5 to Web Presence Builder? Applicable to: Web Presence Builder Plesk Sitebuilder Question
Is it possible to migrate sites from old Plesk Sitebuilder 4.5.9 to Web Presence Builder?
Answer
There are two ways of migrating sites from Plesk Sitebuilder 4.5 to WPB: Static content from a Sitebuilder site can be imported to WPB by using the ""Import Site from Sitebuilder 4.5"" feature.
Open the WPB editor and, on the topic selection screen, click Import Site from Sitebuilder 4.5: For more details, refer to the next article:
Importing Sites from Sitebuilder 4.5.
These instructions are applicable to WPB 12:
Importing Sites from Sitebuilder 4.5 All sites from Plesk Sitebuilder 4.5 can be migrated to WPB using the Migration tool .
After website owners log in to Sitebuilder 4.5 wizard on the source server, they will be redirected to a new Web Presence Builder editor, and their website content will be moved to the destination server along with hosting publishing settings.
Note: The import of sites from earlier versions of Sitebuilder or other content management systems is not supported. Before starting the migration, verify that the Plesk Sitebuilder 4.5 implementation you are migrating from is up-to-date. Before importing a site, please perform the below steps: * Upgrade Plesk Sitebuilder to the latest version (4.5.5 for Windows or 4.5.9 for Linux). * Install all updates and update Design Templates. * Republish all content on the site you want to import/migrate. "
6," Microsoft SQL Server is shown as disconnected in Plesk: Unable to determine the TCP port number used by Microsoft SQL server
Applicable to: Plesk for Windows Symptoms Microsoft SQL server is shown as disconnected in Tools & Settings > Database Servers (there is no green checkmark next to the server name) PLESK_WARN: Warning: Unable to determine the TCP port number used by Microsoft SQL server '.\\MSSQLSERVER2014': TCP/IP protocol is not enabled in the server network configuration or the server is configured to use dynamic TCP ports. To allow your customers to automatically configure firewall for remote database access, manually configure the SQL server to listen on a specific fixed TCP port. Error in Event Viewer > Plesk:
CONFIG_TEXT: SQL Server Network Interfaces: Error Locating Server/Instance Specified [xFFFFFFFF]. A network-related or instance-specific error has occurred while establishing a connection to SQL Server. Server is not found or not accessible. Check if instance name is correct and if SQL Server is configured to allow remote connections. For more information see SQL Server Books Online. Login timeout expired at (VADOConnection::open line 48) Cannot change the password for sa user in Tools & Settings > Database Servers:
PLESK_ERROR: Error: The test connection to the database server has failed because of network problems: Try to establish connection failed Cause
MS SQL Server is not configured to use static ports.
Resolution
Note: if Microsoft SQL server is shown as connected, the warning can be ignored. However, it is still better to define exact port, to avoid connection issues in future.
Connect to the server using RDP and follow video tutorial: Text instructions Go to Start > SQL Server XXXX Configuration Manager (where XXXX is a version of MS SQL Server). Follow the steps from the Microsoft documentation article Configure a Server to Listen on a Specific TCP Port to configure MS SQL Server instance to use static ports:
- remove the values (including zeroes) from the TCP Dynamic Ports of IPv4 address and ""IPv4""
- remove the value (including zeroe) from the TCP Dynamic Ports of IPAll section
- set specific port for the TCP Dynamic Ports of IPAll section: Log in to Plesk. Go to Tools & Settings > Database Servers > MS_SQL_Server_name > Settings and click OK to re-apply them. "
0,"How to change the log rotation settings for Plesk Action Log via a command-line interface
Applicable to: Plesk for Linux Question
How to change the log rotation settings for Plesk Action log at Tools & Settings > Action Log via a command-line interface? Answer
Log rotation settings for Plesk Action log can be changed in the Plesk system database. Connect to a Plesk server via SSH; Create a backup of Plesk database; Access the Plesk database:
# plesk db Run the following to store records in the database for 10 days:
MYSQL_LIN: mysql> replace into misc (param, val) values('actionlog_rot_type', 'by_period');
MYSQL_LIN: mysql> replace into misc (param, val) values('actionlog_rot_period', 'day');
MYSQL_LIN: mysql> replace into misc (param, val) values('actionlog_rot_num_periods', '10'); to store records in the database for 2 weeks:
MYSQL_LIN: mysql> replace into misc (param, val) values('actionlog_rot_type', 'by_period');
MYSQL_LIN: mysql> replace into misc (param, val) values('actionlog_rot_period', 'week');
MYSQL_LIN: mysql> replace into misc (param, val) values('actionlog_rot_num_periods', '2'); to store records in the database for 2 month:
MYSQL_LIN: mysql> replace into misc (param, val) values('actionlog_rot_type', 'by_period');
MYSQL_LIN: mysql> replace into misc (param, val) values('actionlog_rot_period', 'month');
MYSQL_LIN: mysql> replace into misc (param, val) values('actionlog_rot_num_periods', '2'); to store 2000 entries in database:
MYSQL_LIN: mysql> replace into misc (param, val) values('actionlog_rot_type', 'by_number');
MYSQL_LIN: mysql> replace into misc (param, val) values('actionlog_rot_period', '');
MYSQL_LIN: mysql> replace into misc (param, val) values('actionlog_rot_num_periods', '');
MYSQL_LIN: mysql> replace into misc (param, val) values('actionlog_rot_num_records', '2000'); to keep records forever:
MYSQL_LIN: mysql> replace into misc (param, val) values('actionlog_rot_type', 'forever');
MYSQL_LIN: mysql> replace into misc (param, val) values('actionlog_rot_period', '');
MYSQL_LIN: mysql> replace into misc (param, val) values('actionlog_rot_num_periods', '');
MYSQL_LIN: mysql> replace into misc (param, val) values('actionlog_rot_num_records', ''); Additional information How to get the list of actions that have been done in Plesk
"
2,"Unable to log in to Plesk as a Plesk administrator: Access for administrator from address 203.0.113.2 is restricted in accordance with IP Access restriction policy currently applied
Applicable to: Plesk for Linux
Plesk for Windows Symptoms
It is not possible to log in to Plesk as a Plesk administrator with the following message:
PLESK_ERROR: Access for administrator from address 203.0.113.2 is restricted in accordance with IP Access restriction policy currently applied.
Cause
The current Plesk IP access policy does not allow to log in from a particular IP address.
This setting is configured in Plesk at Tools & Settings > Restrict Administrative Access.
Resolution
Apply one of the following solutions: Add your IP address to the list of allowed IP addresses Connect to the Plesk server via SSH (Plesk on Linux)/RDP (Plesk for Windows Server). Access the Plesk database (on Windows Server use command prompt as an Administrator):
# plesk db ""INSERT INTO cp_access (type, netaddr, netmask) VALUES ('deny' , '203.0.113.2', '255.255.255.255')"" where 203.0.113.2 - the IP address of a device from which you are accessing Plesk Disable the IP Restriction Policy For Plesk on Linux Connect to the Plesk server via SSH. For security reasons, create a dump of the Plesk database. Clear the access policy settings:
3.1. Remove all records from the ""cp_access"" table:
# plesk db ""DELETE FROM cp_access""
3.2. Set the policy to allow:
# plesk db ""UPDATE misc SET val='allow' WHERE param='access_policy'"" For Plesk on Windows Connect to the Plesk server via RDP and start a command prompt as an Administrator. For security reasons, create a dump of the Plesk database. Clear the access policy settings:
3.1. Remove all records from the ""cp_access"" table:
C:\> plesk db ""DELETE FROM cp_access""
3.2. Set the policy to allow:
C:\> plesk db ""UPDATE misc SET val='allow' WHERE param='access_policy'"" Related Articles How to restrict Administrator access by IP address to Plesk
"
8,"fail2ban failed to start: ERROR Error in action definition sendmail-whois
Applicable to: Plesk for Linux Symptoms Fail2ban fails to start with the following error in /var/log/fail2ban.log:
CONFIG_TEXT: ERROR Found no accessible config files for 'action.d/sendmail-whois' under /etc/fail2ban ERROR Error in action definition sendmail-whois[name=SSH, dest=johndoe@example.com, sender=fail2ban@example.com, sendername=""Fail2Ban""] ERROR Errors in jail 'ssh-iptables'. Skipping... sendmail-whois.conf is missing in /etc/fail2ban/action.d/:
# ls -l /etc/fail2ban/action.d/ | grep sendmail-whois.conf Cause
sendmail-whois.conf is missing from /etc/fail2ban/action.d
Resolution Connect to the server via SSH. Restore the configuration: For RPM-based distros (CentOS/RHEL): # rpm -ql fail2ban | grep sendmail-whois.conf| xargs -i cp {} /etc/fail2ban/action.d For Deb-based distro (Ubuntu/Debian): # dpkg -L fail2ban| grep sendmail-whois.conf | xargs -i cp {} /etc/fail2ban/action.d "
8,"Unable to open Mail Server Settings on Plesk for Windows server when SmarterMail is used: The system cannot find the file specified
Applicable to:
Plesk for Windows
Symptoms On a Plesk server, SmarterMail is selected as the mail server in Tools & Settings > Server Components. Opening Tools & Settings > Mail Server Settings fails:
PLESK_ERROR: The system cannot find the file specified. (Error code 2) at lookup subKey=SOFTWARE\\Mail Enable\\Mail Enable\\Connectors\\SMTP\\Extensions\\DATA value=Data with type 1 at (registry::getstr line 660) at execute console command --get-max-letter-size(vconsoleapp::start line 97) at execute ""C:\\Program Files (x86)\\Plesk\\admin\\bin\\mailmng.exe"" --get-max-letter-size(vconsoleapp::run line 107) (Error code 1) The parameter MAIL_PROVIDERW_DLL in the registry key HKEY_LOCAL_MACHINE\SOFTWARE\Wow6432Node\PLESK\PSA Config\Config MAIL_PROVIDERW_DLL is set to the MailEnable DLL:
C:\> REG QUERY ""HKLM\SOFTWARE\Wow6432Node\PLESK\PSA Config\Config"" | findstr MAIL_PROVIDERW_DLL MAIL_PROVIDERW_DLL REG_SZ C:\Program Files (x86)\Parallels\Plesk\admin\bin\mailenableproviderw.dll Cause
Incorrect DLL is specified in the parameter MAIL_PROVIDERW_DLL in the registry.
Resolution Connect to the server using RDP. Create a file with the extension .reg and put the following content into it:
CONFIG_TEXT: Windows Registry Editor Version 5.00 [HKEY_LOCAL_MACHINE\SOFTWARE\Wow6432Node\PLESK\PSA Config\Config] ""MAIL_PROVIDERW_DLL""=""C:\\Program Files (x86)\\Parallels\\Plesk\\admin\\bin\\smartermailprovider.dll"" Propagate the changes to the registry by using one of the methods: Double-click on the file and click Yes in the warning window.
Execute the command reg import file.reg in the Command Prompt or PowerShell. "
2,"Not possible to change handler in Plesk: Cannot add duplicate collection entry of type with unique key attribute set to ...
Applicable to: Plesk for Windows Symptoms
Changing the handler (ASP status, PHP version, etc.) in the domain settings Home > Domains > example.com fails with the following error message:
PLESK_ERROR: Error: Cannot add duplicate collection entry of type 'add' with unique key attribute 'name' set to 'ASPClassic'
or
Unable to access IIS settings for domain in Home > Domains > example.com. It's getting failed with the error message below:
PLESK_ERROR: Internal error: Filename: \\?\C:\Windows\system32\inetsrv\config\applicationHost.config Line number: 182673 Error: Cannot add duplicate collection entry of type 'mimeMap' with unique key attribute 'fileExtension' set to '.woff' In module Exception type:System.Runtime.InteropServices.COMException at Microsoft.Web.Administration.Interop.AppHostWritableAdminManager.GetAdminSection(String bstrSectionName, String bstrSectionPath) at ... at execute ""C:\Program Files (x86)\Parallels\Plesk\admin\bin64\websrvmng.exe"" --get-mime-types ""--vhost-name=example.com"" ""--vdir-name=/""(vconsoleapp::run line 117) Error code 1)
or
CONFIG_TEXT: Error Code 0x800700b7 Config Error Cannot add duplicate collection entry of type
Cause
IIS detects a duplicate entry for the same setting at a higher level in the configuration. Check the following Microsoft TechNet article for additional details
Resolution Log in to the server via RDP Open IIS Manager and remove the domain IIS > Sites > example.com Note: It will delete only IIS configuration of the website and left web content intact Re-create website configuration in IIS by runnig the following command in Command Prompt (cmd.exe):
C:\> %plesk_dir%\bin\repair.exe --reconfigure-web-site -web-site-name example.com If the steps above do not help, check domain's web.config file in %plesk_vhosts%\example.com\httpdocs folder and remove duplicate entry of the directive from the error message.
If the issue still persist, review IIS configuration file %windir%\system32\inetsrv\config\applicationHost.config and remove duplicate directives from the error for the domain as below: Back up the current IIS configuration using the following command in cmd.exe :
C:\> %windir%\system32\inetsrv\appcmd.exe add backup ""My Backup Name"" Open the file %windir%\system32\inetsrv\config\applicationHost.config in a text editor and find the section containing the website configuration:
CONFIG_TEXT: <location path=""example.com""> Under this section, find <handlers> and remove the string starting with the collection entry name shown in the error ( ASPClassic ):
CONFIG_TEXT: <add name=""ASPClassic"" path=""*.asp"" verb=""GET,HEAD,POST,TRACE"" modules=""IsapiModule"" scriptProcessor=""C:\Windows\System32\inetsrv\asp.dll"" resourceType=""Either"" /> Save the changes made in the %windir%\system32\inetsrv\config\applicationHost.config file and try to perform the failed action again.
Note: If the error occurs again with another attribute 'name' , delete it from the <handlers> section using the steps described above. "
2,"Unable to access Plesk on Linux after manually changing the MySQL ""admin"" password: Access denied for user 'admin'@'localhost' (using password: YES)
Applicable to: Plesk Onyx for Linux
Plesk for Linux Symptoms Plesk interface is inaccessible. One of the following error messages is shown in a web-browser:
PLESK_INFO: ERROR: Zend_Db_Adapter_Exception: SQLSTATE[HY000] [1045] Access denied for user 'admin'@'localhost' (using password: YES)
OR
PLESK_INFO: PleskDBException: Unable to connect to database: mysql_connect(): Access denied for user 'admin'@'localhost' (using password: YES) (Error code: 1045) (Abstract.php:69)
OR
PLESK_INFO: ERROR: PleskFatalException Unable to connect to database: saved admin password is incorrect. 0: common_func.php3:93 psaerror(string 'Unable to connect to database: saved admin password is incorrect.') 1: auth.php3:127 Additionally, an exception has occurred while trying to report this error: Zend_Exception No entry is registered for key &;translate&; (Abstract.php:144) When creating a manual database backup, the process fails with the following error message:
# MYSQL_PWD=`cat /etc/psa/.psa.shadow` mysqldump -uadmin psa > /tmp/psa.`date +%F_%H.%M`.sql mysqldump: Got error: 1045: Access denied for user 'admin'@'localhost' (using password: YES) when trying to connect The plesk db command returns the following error message:
CONFIG_TEXT: ERROR 1045 (28000): Access denied for user 'admin'@'localhost' (using password: YES) Cause
The hashed password in the file /etc/psa/.psa.shadow, that is used to access Plesk database, does not match the admin password in the 'mysql' database.
Resolution
Note: This solution is not valid for Plesk Obsidian. Proceed to the manual solution if Plesk Obsidian is used.
Automated solution Connect to the Plesk server via SSH. Download the script for automated MySQL admin restoration:
# curl -LO https://plesk.zendesk.com/hc/article_attachments/360042955514/213364309-restore-admin-user.php.tar.gz Unpack it:
# tar xf 213364309-restore-admin-user.php.tar.gz Run the script:
# plesk php 213364309-restore-admin-user.php Try to access Plesk again. If the automated solution did not help, apply the manual solution. Manual solution Manual solution Connect to the Plesk server via SSH. With the command below, check if the directive old-passwords exist in the MySQL configuration file my.cnf (no output means it does not exist):
# grep -ir old-passwords /etc/my* If it exists, remove it using a text editor. Get a hashed password of the MySQL admin user and copy it to clipboard:
Note: Make sure there is only one password specified in the file.
# grep AES /etc/psa/.psa.shadow
Here is an example of a hashed password:
PLESK_INFO: $AES-128-CBC$ZmY/EEpy1+TwCNq5kalqSA==$Pd02kf4TTlpXdi/qyeo92w== Modify the my.cnf file:
4.1. Open the my.cnf file in a text editor. In this example, we are using the vi editor: on CentOS/RHEL-based distributions
# vi /etc/my.cnf on Debian/Ubuntu-based distributions
# vi /etc/mysql/my.cnf 4.2. Add the skip-grant-tables line under the [mysqld] section:
CONFIG_TEXT: [mysqld] skip-grant-tables <...>
4.3. Save the changes and close the file. Restart MySQL. The command depends on MySQL version and operating system:
# service mariadb restart# service mysql restart# service mysqld restart Connect to MySQL:
# plesk db Switch to the mysql database:
MYSQL_LIN: mysql> use mysql; Find the version of MySQL:
MYSQL_LIN: mysql> SELECT VERSION(); Reload the ACL tables cache:
MYSQL_LIN: mysql> FLUSH PRIVILEGES;
Note: Once the command above is executed, do not exit the current MySQL session as this command loads grant tables back. Restore the MySQL admin user: For MySQL 5.1 up to 5.6 and MariaDB 5.5 up to 10.4 Drop the current admin user:
MYSQL_LIN: mysql> DROP USER 'admin'@'localhost'; Create a new admin user with the hashed password from step 3:
MYSQL_LIN: mysql> CREATE USER 'admin'@'localhost' IDENTIFIED BY 'HASHED_PASSWORD_FROM_STEP_3'; Grant all permissions to the admin user:
MYSQL_LIN: mysql> GRANT ALL ON *.* TO 'admin'@'localhost' WITH GRANT OPTION; Exit MySQL:
MYSQL_LIN: mysql> exit For MySQL 5.7 up to 8.0 Drop the current admin user:
MYSQL_LIN: mysql> DROP USER 'admin'@'localhost'; Create a new admin user with the hashed password from step 3:
MYSQL_LIN: mysql> CREATE USER 'admin'@'localhost' IDENTIFIED WITH 'mysql_native_password' BY 'HASHED_PASSWORD_FROM_STEP_3'; Grant all permissions to the admin user:
MYSQL_LIN: mysql> GRANT ALL ON *.* TO 'admin'@'localhost' WITH GRANT OPTION; Exit MySQL:
MYSQL_LIN: mysql> exit Remove the skip-grant-tables line from the my.cnf file (step 4). Restart MySQL:
# service mariadb restart # service mysql restart # service mysqld restart "
2,"Unable to create a new subscription or load a new SSL certificate: The process cannot access the file because it is being used by another process
Applicable to:
Plesk for Windows
Symptoms When trying to create or activate a subscription in Plesk > Subscriptions, the following error is shown:
PLESK_ERROR: Error: The process cannot access the file because it is being used by another process. (Exception from HRESULT: 0x80070020) In Microsoft.Web.Administration module Exception type: System.IO.FileLoadException at Microsoft.Web.Administration.Interop.IAppHostMethodInstance.Execute() at Microsoft.Web.Administration.Site.Start() at IISWebSite.startStop(IISWebSite* , Boolean start) at IISWebSite.start(IISWebSite* ) at configHosting(test.tst)(WebServerAdapter::configHosting line 408) at configHosting(test.tst)(WebServerManager::configHosting line 3011) at execute console command --install-vhost(vconsoleapp::start line 100) at execute ""C:\Program Files (x86)\Parallels\Plesk\admin\bin64\websrvmng.exe"" --install-vhost ""--vhost-config=tmpECEB.tmp""(vconsoleapp::run line 116) (Error code 1) Going to IIS > Sites > example.com > Manage Website (Right-sidebar) > Start, fails with the following error message:
CONFIG_TEXT: The process cannot access the file because it is being used by another process. (exception from HRESULT: 0x80070020) Website doesn't load the new SSL certificate selected in Domains > example.com > Hosting Settings The following errors might be found in %plesk_dir%\admin\logs\php_error.log:
CONFIG_TEXT: ERR [panel] Could not open socket
CONFIG_TEXT: ERR [1] C:\Parallels\Plesk\admin\bin64\websrvmng --reconfigure-vhost ""--vhost-config=ich6CDF.tmp"" ""--config="" failed with code 1. stdout: The process cannot access the file because it is being used by another process. (Exception from HRESULT: 0x80070020) ... at IISWebSite.start(IISWebSite* ) at setServerState(example.com, true, true)(WebServerAdapter::setServerState line 2321) at configHosting(example.com)(WebServerAdapter::configHosting line 493) at configHosting(example.com)(WebServerManager::configHosting line 2954) at execute console command --reconfigure-vhost(vconsoleapp::start line 93) at execute C:\Parallels\Plesk\admin\bin64\websrvmng --reconfigure-vhost ""--vhost-config=ich6CDF.tmp"" ""--config=""(vconsoleapp::run line 110) stderr: Cause
Another service is listening to TCP port 80 or 443, for example, an Apache process.
Resolution Connect to the server via RDP Find the process ID from the service listening to ports 80 or 443:
C:\> netstat -aon | findstr -i "":80 :443"" | find ""LISTENING"" TCP 0.0.0.0:80 0.0.0.0:0 LISTENING 2476 TCP 0.0.0.0:443 0.0.0.0:0 LISTENING 2476 Obtain more details with the PID:
C:\> tasklist /fi ""PID eq 2476"" Image Name PID Session Name Session# Mem Usage ========================= ======== ================ =========== ============ httpd.exe 2476 Services 0 16.708 K Kill the process:
C:\> taskkill /F /PID 2476 Restart IIS:
C:\> iisreset Repair web configuration:
C:\> plesk repair web -y "
8,"Unable to start the Qmail service: cannot start: unable to open mutex Applicable to: Plesk Onyx for Linux Symptoms Unable to start Qmail service :
# service qmail start Starting qmail: failed The following error can be found in /var/log/maillog file:
CONFIG_TEXT: cannot start: unable to open mutex The /var/qmail/queue/lock/sendmutex file is absent on the sever. Cause
Missing /var/qmail/queue/lock/sendmutex file.
Resolution Log into the server via SSH. Create the /var/qmail/queue/lock/sendmutex file with the command:
# touch /var/qmail/queue/lock/sendmutex Set the correct permissions for the created /var/qmail/queue/lock/sendmutex file:
# chown qmails:qmail /var/qmail/queue/lock/sendmutex Restart the Qmail service:
# service qmail start "
3,"How to configure global default document settings in Plesk
Applicable to:
Plesk Onyx for Windows
Answer
How to configure global default document settings for newly created domains in Plesk?
Question Connect to the server via RDP. Navigate to %plesk_vhosts%.skel\0\httpdocs Create a web.config file with the content alike one listed below. That web.config file will be used to set a default document set, or list of default documents for newly created websites.
<?xml version=""1.0"" encoding=""UTF-8""?><configuration> <system.webServer> <defaultDocument> <files> <clear /> <add value=""Index.php"" /> <add value=""Index.html"" /> <add value=""Index.htm"" /> <add value=""Index.cfm"" /> <add value=""Index.shtml"" /> <add value=""Index.shtm"" /> <add value=""Index.stm"" /> <add value=""Index.php3"" /> <add value=""Index.asp"" /> <add value=""Index.aspx"" /> <add value=""Default.htm"" /> <add value=""Default.asp"" /> <add value=""Default.aspx"" /> </files> </defaultDocument> </system.webServer></configuration> Additional info
Adjusting IIS Web Server Settings"
3,"Website shows Plesk default page in a Plesk server behind NAT
Applicable to: Plesk for Linux
Plesk for Windows Symptoms Domain example.com shows Plesk Default Page or Default Apache Page (Default Webserver Page) Plesk server is behind NAT, configured with internal IP addresses. Going to Tools & Settings > IP Addresses, the internal IP addresses don't have a public IP address assigned. Domain example.com resolves to a public IP address:
# dig +short example.com 203.0.113.2 In Linux, running tcpdump utility in Plesk server shows that domain's traffic goes to internal IP 192.0.2.2 with the following command:
Note: IP 203.0.113.5 represents the public IP address where the website is requested from.
# tcpdump -n ""dst port 80 and src host 203.0.113.5"" ... 05:22:50.870868 IP 203.0.113.5.57486 > 192.0.2.2.http: Flags [F.], seq 1635309888, ack 2130394795, win 16425, length 0 ... In Windows, Plesk may not be accessible:
CONFIG_TEXT: This site can't be reached Cause
Incorrect IP address mapping is configured in Plesk.
Resolution Log in to Plesk GUI
Note: If Plesk is inaccessible, the same steps can be applied in Plesk for Windows via RDP Map external IP address 203.0.113.2 as Public IP address in Tools & Settings > IP Addresses > 192.0.2.2 > OK: Go to Domains > example.com > Web Hosting Access and ensure that the domain's IP address shows the domain's public IP address. If the issue persists and the changes are not reflecting on the website, contact a network administrator to ensure that NAT translation for the domain is properly configured in the external firewall. "
9,"[FIXED BUG] ISC BIND service cannot be started on Windows: ERROR 1067: The process terminated unexpectedly
Applicable to: Plesk for Windows Symptoms ISC BIND is used as DNS server in Tools & Settings > Services Management Going to Domains > example.com > DNS settings > Zone Transfers, there is a single IP address with a subnet mask, which is considered an incorrect syntax in ISC BIND. For example: 203.0.113.2/24 ISC BIND service cannot be started, by logging server via RDP in Services, it fails with the following error message:
CONFIG_TEXT: The process terminated unexpectedly. (Error code 1067) at Start service named One of the following errors might be shown in Event Viewer > Windows Logs > Application:
CONFIG_TEXT: C:\Program Files (x86)\Parallels\Plesk\dns\etc\named.conf:835: '203.0.113.2/24': address/prefix length mismatch
CONFIG_TEXT: C:\Program Files (x86)\Parallels\Plesk\dns\etc\named.conf:835: expected IP match list element near ';' Click here to see how to apply filters in Event Viewer to find the error message Configure filter as shown the image below: Cause Product issues: #PPPM-10874 ""It is now possible to add only IP addresses (without a mask) in Domains > domain > DNS Settings > Zone Transfers.""
Fixed in: Plesk Obsidian 23 June 2020 #PPPM-10403 ""Plesk now prevents users from creating invalid DNS records that could cause the BIND service to crash.""
Fixed in: Plesk Onyx 17.8 24 June 2019 (Windows) Plesk Obsidian 08 May 2019 (fixed as PPP-41780, Windows) Resolution
Please consider updating your server: How to install Plesk updates Workaround
If update is not possible for some reason you may try the following
temporary solution As a workaround: Connect to the server via RDP Start CMD as Administrator Back up Plesk database:
C:\> plesk db dump psa > psa.backup.sql Fix the database values:
C:\> plesk db ""update dns_recs set opt='' where type='AXFR' and val='203.0.113.2' and opt='24'""
* Where 203.0.113.2 is the IP address and 24 is the subnet shown in the error message from the symptoms section. Propagate the changes to %plesk_dir%dns\etc\named.conf config file running plesk repair dns command:
C:\> plesk repair dns -y Additional information
Unable to add an IP address without a subnet mask in Zone Transfers of a domain when BIND DNS Server is used
"
2,"Unable to create a new domain or save hosting settings in Plesk: Unable to turn on ASP.NET version 4.x because it is not installed Applicable to: Plesk for Windows Symptoms
When creating a new domain or updating domain's hosting settings, the operation fails with:
PLESK_ERROR: Error: Unable to turn on ASP.NET version 4.x because it is not installed.
Cause
ASP.NET 4.x version is not listed in Plesk components. This error may occur when a higher version of ASP.NET was installed previously, but was removed later.
Resolution Log in to Plesk GUI Go to Tools & Settings > Server Components > Click on Refresh "
8,"How to switch the webmail for a subscription?
Applicable to: Plesk Question
How to change webmail for a subscription?
Answer
Before changing webmail make sure additional webmail component in installed and enabled in Home > Tools & Settings > Webmail. If it is not, install it in Tools & Settings > Updates & Upgrades.
To change webmail to another one, follow instructions: Log into Plesk. Go to Home > Subscriptions > example.com > Mail Settings. Find the Webmail parameter and select the webmail from the list. Use the following article to change webmail for all domains at once in Plesk for Windows:How to switch all domains webmails to MailEnable WebMail or Horde using command line
Warning: When switching from Horde to MailEnable Webmail, Contacts are going to be lost, because they are stored in different formats. In Horde contacts are stored in Horde's database, and MailEnable Webmail stores contacts in the %plesk_dir%\Mail Servers\Mail Enable\Postoffices\example.com\MAILROOT\johndoe\Contacts. So if it is required to transfer contacts, transfer them manually through the MailEnable Webmail client interface. "
5,"Local backup structure in Plesk for Linux
Applicable to: Plesk for Linux
Plesk for Windows Information
Note: This structure is valid for Plesk 12.x and Onyx.
Each backup consists of <info>.xml (backup metadata files), <backup>.<zip|tar> (archived backup files which include website content, databases, etc.) and the directory .discovered , which contains backup technical information.
The backup is identified by the data number, and the list of all files included in the backup can be found with the command find .
For example, to find all the files for backup 0812121508:
Note: where as 0812121508 08 - Year12 - Month12 - Day15 - Hour08 - Minute Click here to see the snippet # find $(awk '$1==""DUMP_D""{print$2}' /etc/psa/psa.conf) -name '*0812121508*'/var/lib/psa/dumps/clients/mydomains/converted_mydomains_info_0812121508.xml /var/lib/psa/dumps/clients/mydomains/domains/myDomain.com/phosting/converted_webstat_0812121508.tgz /var/lib/psa/dumps/clients/mydomains/domains/example.com/phosting/converted_docroot_ssl_0812121508.tgz /var/lib/psa/dumps/clients/mydomains/domains/example.com/phosting/converted_logs_0812121508.tgz /var/lib/psa/dumps/clients/mydomains/domains/example.com/phosting/converted_ftp_stat_0812121508.tgz /var/lib/psa/dumps/clients/mydomains/domains/example.com/phosting/converted_error_docs_0812121508.tgz /var/lib/psa/dumps/clients/mydomains/domains/example.com/phosting/converted_info_0812121508.xml /var/lib/psa/dumps/clients/mydomains/domains/example.com/phosting/.discovered/converted_info_0812121508 /var/lib/psa/dumps/clients/mydomains/domains/example.com/phosting/converted_webstat_ssl_0812121508.tgz /var/lib/psa/dumps/clients/mydomains/domains/example.com/phosting/converted_webuser_home_0812121508.tgz /var/lib/psa/dumps/clients/mydomains/domains/example.com/phosting/converted_private_0812121508.tgz /var/lib/psa/dumps/clients/mydomains/domains/example.com/phosting/converted_anon_ftpstat_0812121508.tgz /var/lib/psa/dumps/clients/mydomains/domains/example.com/phosting/converted_docroot_0812121508.tgz /var/lib/psa/dumps/clients/mydomains/domains/example.com/phosting/converted_cgi_0812121508.tgz /var/lib/psa/dumps/clients/mydomains/domains/example.com/mailnames/john.doe@example.com/converted_john.doe@example.com_attaches_0812121508.tgz /var/lib/psa/dumps/clients/mydomains/domains/example.com/mailnames/john.doe@example.com/converted_john.doe@example.com_mailbox_0812121508.tgz /var/lib/psa/dumps/clients/mydomains/domains/example.com/mailnames/john.doe@example.com/converted_john.doe@example.com_info_0812121508.xml /var/lib/psa/dumps/clients/mydomains/domains/example.com/mailnames/john.doe@example.com/.discovered/converted_john.doe@example.com_info_0812121508 /var/lib/psa/dumps/clients/mydomains/domains/example.com/.discovered/converted_example.com_info_0812121508 /var/lib/psa/dumps/clients/mydomains/domains/example.com/converted_example.com.com_info_0812121508.xml /var/lib/psa/dumps/clients/mydomains/.discovered/converted_mydomains_info_0812121508 From the output above it is seen that this is a backup of a client with the login mydomains which owns the domain example.com with the mail account john.doe@example.com . The backup of this client includes the backup of the domain it owns.
Warning: Modifying Plesk backup is not recommended.
The Plesk backup repository is $DUMP_D (the default location is /var/lib/psa/dumps ).
Below are the descriptions of directories corresponding to personal backup repositories accessible through Plesk. Root backup directory where server backups and subdirectories with backups of resellers, clients, and domains are stored.
CONFIG_TEXT: /var/lib/psa/dumps/ /var/lib/psa/dumps/.discovered
In Plesk, this directory is accessible through Home > Backup Manager . The required auxiliary subdirectory .discovered is where technical backup information is stored. The directory is not visible in Plesk: Subdirectory where backups of domains owned by the administrator are stored.
CONFIG_TEXT: var/lib/psa/dumps/domains /var/lib/psa/dumps/domains/<domain.name> /var/lib/psa/dumps/domains/<domain.name>/.discovered
The repositories are identified by the domain name and accessible via Domains > example.com > Backup Manager: Subdirectory where backups of clients and their domains are stored. The repositories are identified by client login and domain name.
CONFIG_TEXT: /var/lib/psa/dumps/clients /var/lib/psa/dumps/clients/<client.login> /var/lib/psa/dumps/clients/<client.login>/.discovered /var/lib/psa/dumps/clients/<client.login>/<domain.name> /var/lib/psa/dumps/clients/<client.login>/<domain.name>/.discovered
They are accessible via: Clients > client_name > Backup Manager Clients > client_name > Domains > example.com > Backup Manager . Subdirectory where backups of resellers, their clients and domains are stored.
CONFIG_TEXT: /var/lib/psa/dumps/resellers /var/lib/psa/dumps/resellers/<reseller.login> /var/lib/psa/dumps/resellers/<reseller.login>/.discovered /var/lib/psa/dumps/resellers/<reseller.login>/<cient.login> /var/lib/psa/dumps/resellers/<reseller.login>/<cient.login>/.discovered /var/lib/psa/dumps/resellers/<reseller.login>/<cient.login>/<domain.name> /var/lib/psa/dumps/resellers/<reseller.login>/<cient.login>/<domain.name>/.discovered
The repositories are identified by reseller login, client login and domain name. They are accessible via: Resellers > reseller_name > Backup Manager Resellers > reseller_name > Client Accounts > client_name > Backup Manager Resellers > reseller_name > Client Accounts > client_name > Domains > example.com > Backup Manager . If there is a plan to migrate objects to a new server, move the root backup directory as a whole.
Foreign files located in the backup repository are not visible through Plesk.
Technical details of Plesk backup are stored in the .discovered directory ( .discovered/converted\_mydomains\_info_0812121508 ). For example:
# ls -l /var/lib/psa/dumps/clients/mydomains/.discovered/converted_mydomains_info_0812121508 -rw-r----- 1 root root 0 Feb 26 14:09 GUID_6ef49c73-4806-48ca-908e-a6674b83d80e -rw-r----- 1 root root 0 Feb 26 14:09 objectid_mydomains -rw-r----- 1 root root 0 Feb 26 14:09 owner_6706c956-3955-41f4-8ff0-f3b993999a12 -rw-r----- 1 root root 0 Feb 26 14:09 ownertype_server -rw-r----- 1 root root 0 Feb 26 14:09 size_1149879 -rw-r--r-- 1 root root 0 Feb 26 14:09 status_OK
Where GUID_6ef49c73-4806-48ca-908e-a6674b83d80e indicates the GUID of the object which is being backed up; objectid_mydomains is the name of the object which is being backed up. (It may be DOMAIN.NAME, CLIENT.LOGIN, RESELLER.LOGIN or admin); owner_6706c956-3955-41f4-8ff0-f3b993999a12 indicates the GUID of the owner of the object which is being backed up; size_1149879 indicates the backup size which is shown in Plesk on the page {Backup Manager}; status_OK indicates the status of the backup. Backup status may be: status_OK to indicate a valid backup (marked with green in Plesk); status_WRONG-FORMAT for an invalid backup (marked with red in Plesk); status_SIGN-ERROR for a modified backup in which the backup signature does not match the backup content. This notification is shown in Plesk when you click on the backup: ""Warning: This backup was created on another server or modified after creation."" Note: The status backup file is kind of like a cache. You need to remove it to allow Plesk Backup Manager to generate a new status file."
8,"How do different outgoing mail modes work on Plesk server?
Applicable to: Plesk for Linux Question
How do different outgoing mail modes under Tools & Settings > Mail Server Settings work?
Answer Send from domain IP addresses
By default, mail from each domain is sent from the domain's IP address. The host name used in the SMTP greeting is the Plesk server host name specified in Tools & Settings > Server Settings. Selecting this option may result in mail sent from some or all domains being marked as spam if the Plesk server host name fails to resolve properly, or if the domain's IP is different from the one to which the Plesk server host name resolves. This option works best if it is required to have a single IP address on the Plesk server. Send from domain IP addresses and use domain names in SMTP greeting
If selected, Plesk changes the mail server configuration so that the SMTP greeting contains the name of the domain from which the email message is sent.
Warning: Selecting this option may result in mail sent from some or all domains being marked as spam if the destination mail server uses cbl and more than one domain on the Plesk server uses the same IP address.
In addition, selecting this option on Plesk servers hosting a large (more than 100) number of domains will likely result in significantly increased server load.
This option works best if there is allocated a dedicated IP address to every domain hosted on the Plesk server, and the number of domains hosted on the server is not very large. Send from the specified IP address
In case if it is required to use certain IPv4 and IPv6 addresses for all outgoing mail. Sending all mail from the specified address might be useful, for example, if the IP address of the mail server was added to a public black list, such as the Spamhaus or OpenBL lists.
If None is selected, outgoing mail will not be sent. "
5,"How to migrate from cPanel to Plesk using Plesk Migrator?
Applicable to: Plesk Onyx for Linux Question
How to migrate from cPanel to Plesk using Plesk Migrator?
Answer
Either one of the following methods can be used:
Click on a section to expand Migration from UI Migration from UI (Plesk web interface) is the most simple way to migrate from cPanel: Log in to Plesk Install Plesk Migrator: go to Extensions > open Plesk Migrator under Server Tools or use search bar to find the extension > click Install: When it is installed, go to Extensions > My Extensions > click Go to Extension next to Plesk Migrator
Click Start a New Migration Switch to cPanel and enter the source server's IP address (replace the example below with the real source server IP), specify the SSH port as well (22 by default), the login and password of a root user on the source server: Click Prepare Migration. Read about further steps in Plesk Migration Guide. Migration via CLI through SSH To migrate from cPanel via command line use steps below: Log in to Plesk Install Plesk Migrator: go to Extensions > open Plesk Migrator under Server Tools or use search bar to find the extension > click Install: Connect to the server via SSH Create conf directory if it does not exist:
# mkdir /usr/local/psa/var/modules/panel-migrator/conf Change the working directory:
# cd /usr/local/psa/var/modules/panel-migrator/conf/ Create configuration file config.ini in the current directory with content:
# cat /usr/local/psa/var/modules/panel-migrator/conf/config.ini [GLOBAL] source-type: cpanel source-servers: cpanel target-type: plesk [plesk] ip: <destination_server_IP_address> os: unix [cpanel] ip: <source_server_IP_address> os: unix ssh-password: <source_server_root_password> # Uncomment ssh-port string below if the SSH port is not 22 # ssh-port: <replace_with_ssh_port_number>
Note: If any PostgreSQL databases from cPanel server should be migrated, make sure to specify the PostgreSQL administrator password in the config.ini file:
CONFIG_TEXT: [optional] postgres-password: <password> Generate the migration list file:
# /usr/local/psa/admin/sbin/modules/panel-migrator/plesk-migrator generate-migration-list
It can be edited to remove domains that should not be migrated, and assign domains to service plans:
# vi /usr/local/psa/var/modules/panel-migrator/sessions/migration-session/migration-list Start the migration:
# /usr/local/psa/admin/sbin/modules/panel-migrator/plesk-migrator transfer-accounts Once the transfer is done, run the command below to resynchronize the content:
# /usr/local/psa/admin/sbin/modules/panel-migrator/plesk-migrator copy-content
This will perform a rsync which will ignore files which have already been copied and not modified.
See How to sync content between source and destination servers after migration? for more details. After the migration is finished, run the following command to check the operability of the migrated objects on the destination server:
# /usr/local/psa/admin/sbin/modules/panel-migrator/plesk-migrator test-all For additional information check Migrating via the Command Line section of Migration Guide.
If it's required to let Plesk professionals handle the migration or upgrade job, check out Plesk professional services options at: Professional Services Migration without cPanel SSH access for a root user If there is no SSH access to the cPanel server as root, then the migration of websites and mail is also possible, but using a different method: Website Migration feature of the Plesk Migrator Extension
Importing Mail with Site Import "
2," How to move domains between subscriptions in Plesk
Applicable to: Plesk for Linux
Plesk for Windows Question How to move domains between subscriptions (change a subscriber for a domain) or merge subscriptions? How to to change the subscriber (move subscription to another owner) for a subdomain? Answer
Note: This feature is available starting from Plesk Obsidian. Update to the latest version to get this feature. The following scenarios are supported: Main domain (with its subdomains) can be moved to another subscription, becoming an additional domain on the target subscription. This is only possible if there are no additional domains on the subscription from which the main domain is moved. The original subscription will be removed, since it will have no domains/subdomains left in it. Additional domain (with its subdomains) can be moved to another subscription, becoming an additional domain on the target subscription. The target subscription must have enough resources to accommodate the moved objects. Additional domain (with its subdomains) can be moved to a new subscription, becoming the main domain on the new subscription. The new subscription will be created on the same service plan as the source subscription, from which the domain was moved. Moving a domain via Plesk In Plesk, go to Subscriptions > example.com and click Move domain.
Note: If the Move domain button is grayed out, point the mouse to this button to find out why. Select an existing subscription from the list or create a new subscription for this domain. Click Move.
Note: Service plans of both the source and target subscriptions must allow the customer to manage all types of objects on the moved domain. For example, if the domain has a subdomain, then both the source and target subscriptions must allow the customer to manage domains and subdomains. Otherwise, the Move link will not be available. Moving a domain via a command-line interface Connect to the Plesk server via SSH and use the 'plesk bin subscription' utility: to move main domain from one subscription to another.
# plesk bin subscription --merge source-example.com -webspace-name target-example.com to move additional domain to another subscription:
# plesk bin site --move addon.domain -webspace-name example.net to create a new subscription from an additional domain:
# plesk bin site --move addon.domain -login addon_user -passwd <password> Additional Information Workaround for Plesk Onyx The following workaround can be used to move a website to the other domain of the same subscription:
Let us assume we are moving a subdomain.example.com to a separate subscription. In Plesk, Create a new subscription example2.com in Subscriptions > Add Subscription.
Note: in Web Admin Edition to create a new subscription go under Plesk > Websites & Domains > Add Domain > Location of the website's files > Create a new webspace: Copy your original website subdomain.example.com into example2.com subscription via Domains > example.com > Website Copying. Test the website on its new location by adding example2.com into hosts file on the local computer. Install the extension Site Import (If not installed yet) through Plesk > Extensions > search Site Import > Click Install Go to Domains > example2.com > Mail Importing and then click Import mail messages Migrate all mailboxes If domain subdomain.example.com is protected by Lets Encrypt SSL certificate do the following: Open certificates Domains > subdomain.example.com > SSL/TLS Certificates. Remove SSL/TLS certificate by checking certificate with name ""Lets Encrypt subdomain.example.com"" and pressing Remove button. Remove the original website via Domains > subdomain.example.com > Remove subdomain. Rename example2.com into example.com in Domains > example2.com > Hosting Settings. If it is required - secure domain example.com with Let's Encrypt certificate or 3rd party SSL/TLS certificate using this guide. Related Articles Is it possible to change the main website on a subscription in Plesk
"
5,"Uploading a backup file via Plesk Backup Manager times out: client intended to send too large body
Applicable to: Plesk for Linux Symptoms Uploading a backup file via the Backup Manager times out. In the logfile /var/log/sw-cp-server/error_log the following error message appears:
CONFIG_TEXT: [error] 25312#0: *59 client intended to send too large body: 1200002689 bytes, client: 203.0.113.2, server: , request: ""POST /plesk/server/backup/local-repository/upload/ HTTP/1.1"", host: ""203.0.113.2:8443"", referrer: ""https://203.0.113.2:8443/plesk/server/backup/local-repository/upload/"" CONFIG_TEXT: [error] 11445#0: *36 upstream timed out (110: Connection timed out) while reading response header from upstream, client: 203.0.113.2, server: , request: ""POST /admin/backup/copy-to-server/?dumpId=backup_1812061555_1812100010.tar&type=foreign-ftp HTTP/1.1"", upstream: ""fastcgi://unix:/var/run/sw-engine.sock"", host: ""203.0.113.2:8443"", referrer: ""https://203.0.113.2:8443/admin/backup/copy-to-server/?dumpId=backup_1812061555_1812100010.tar&type=foreign-ftp"" Cause
The maximum size of an uploaded backup file is limited to 2Gb.
OR
The maximum allowed upload size is less than backup file size.
Resolution
Upload this backup file using the command-line instructions from the article How to upload a Plesk xml.tar/xml.zip backup file to the Backup Manager.
Alternatively, increase web server limits:
Click on a section to expand For Linux Connect to the Plesk server via SSH.
Note: If direct SSH access to the server is not possible, contact server administrator for further assistance. Modify the /etc/sw-cp-server/config file:
2.1. Open the file in a text editor. In this example we use the vi editor:
# vi /etc/sw-cp-server/config
2.2. Increase the value of: client_max_body_size to 2048m:
CONFIG_TEXT: client_max_body_size 2048m; fastcgi_read_timeout and fastcgi_send_timeout to 1200:
CONFIG_TEXT: fastcgi_read_timeout 1200 fastcgi_send_timeout 1200 2.3. Save the changes and close the file. Modify the /usr/local/psa/admin/conf/php.ini file:
3.1. Open the file in a text editor:
# vi /usr/local/psa/admin/conf/php.ini
3.2. Increase the max_execution_time value:
# max_execution_time
3.3. Save the changes and close the file. Restart the Plesk services:
# service sw-cp-server restart # service sw-engine restart Upload the backup file again. Click on a section to expand For Windows Connect to the server via RDP.
Note: If direct RDP access to the server is not possible, contact server administrator for further assistance. Edit the %plesk_dir%\admin\conf\php.ini file and increase the max_execution_time value. Open the command prompt and run the commands one by one:
C:\> net stop ""Plesk PopPass Service"" net stop ""Plesk Management Service"" net start ""Plesk Management Service"" Upload the backup file again. "
2,"Plesk login page displays error: DB query failed: Unknown error
Applicable to: Plesk for Windows Symptoms
Plesk login page shows one of the following error: PLESK_INFO: ERROR: PleskMainDBException DB query failed: Unknown error PLESK_INFO: ERROR: Exception: Unable to get administrator password: Can't decrypt data PLESK_INFO: ERROR: Exception: Unable to get administrator password: The system cannot find the file specified. (Error code 2) CONFIG_TEXT: ERROR: Zend_Db_Adapter_Exception: SQLSTATE[HY000] [1045] Access denied for user 'admin'@'localhost' (using password: YES) Cause
Plesk administrator password in the Windows registry and/or Plesk SQL Server administrator password in the mysql database are corrupted/incorrect.
Resolution Plesk 17.8 and Plesk Obsidian Automatic Solution (Recommended) Download the PowerShell script to a Windows server. Unzip the file. Right-click on the file ""plesk178-admin-pass-reset.ps1"" and click ""Run with PowerShell"" to run the script. Manual Solution Create the psa_root user with a random password to perform further operations. Normally, this step is not necessary, since it is supposed to be executed during Plesk installation:
C:\> plesk sbin mysqlmng_adm --inject-root Remove existing admin user from Plesk SQL:
C:\> plesk sbin mysqlmng_adm --del-user --user-login=admin Create new admin user with random password:
C:\> plesk sbin mysqlmng_adm --add-super-user --login=admin --password=%ADMIN_PASS% --allowed-host=localhost Update admin's password in Windows registry:
C:\> plesk sbin psadb -u --password=%ADMIN_PASS% Plesk 17.5 and older Solution I First, reset Plesk administrator password in the Windows registry, then Plesk SQL Server administrator password in the mysql database Add the line ""skip-grant-tables"" under the [PleskSQLServer] section in the file %plesk_dir%mysql\my.ini (or %plesk_dir%mysql\data\my.ini). Start a command prompt as an Administrator and run the command below to restart the Plesk SQL Server service:
C:\> net stop plesksqlserver && net start plesksqlserver Set new password for Plesk administrator in the Windows registry:
C:\> ""%plesk_bin%\plesksrvclient.exe"" -set NEW_PASSWORD Set new password for Plesk SQL Server administrator in the mysql database:
C:\> ""%plesk_bin%\plesksrvclient.exe"" -set NEW_PASSWORD true
The command above will reset both passwords - in the Windows registry and in the mysql database, but it will not work if password in the registry is still corrupted. Remove the line ""skip-grant-tables"" from %plesk_dir%mysql\my.ini (or %plesk_dir%mysql\data\my.ini). Restart the Plesk SQL Server service. Solution II First, reset Plesk SQL Server administrator password in the mysql database, then Plesk administrator password in the Windows registry Add the line ""skip-grant-tables"" under the [PleskSQLServer] section in the file %plesk_dir%mysql\my.ini (or %plesk_dir%mysql\data\my.ini). Start a command prompt as an Administrator and run the command below to restart the Plesk SQL Server service: Find a username of the Plesk SQL Server administrator in the PLESK_DATABASE_LOGIN value in the Windows registry:
C:\> reg query ""HKLM\SOFTWARE\Wow6432Node\Plesk\PSA Config\Config"" /v PLESK_DATABASE_LOGIN HKEY_LOCAL_MACHINE\SOFTWARE\Wow6432Node\Plesk\PSA Config\Config PLESK_DATABASE_LOGIN REG_SZ admin
By default it is set to admin. Log in to the mysql database on the port 8306:
C:\> ""%plesk_dir%\MySQL\bin\mysql.exe"" -P8306 -Dmysql Update the password of the Plesk SQL administrator (replace NEW_PASSWORD and admin with proper values):
C:\> UPDATE user SET Password = password('NEW_PASSWORD') WHERE User = 'admin'; Remove the line ""skip-grant-tables"" from %plesk_dir%mysql\my.ini (or %plesk_dir%mysql\data\my.ini). Restart the Plesk SQL Server service. Set the same password as on step 5 for the Plesk administrator in the Windows registry:
C:\> ""%plesk_bin%\plesksrvclient.exe"" -set NEW_PASSWORD
OR:
C:\> ""%plesk_cli%\init_conf.exe"" --set-admin-password -passwd NEW_PASSWORD
OR:
C:\> ""%plesk_cli%\admin.exe"" --set-password -passwd NEW_PASSWORD "
2,"The message is shown in Plesk: The repair operation is in progress. You will be redirected to the login page when it completes
Applicable to: Plesk for Linux Symptoms The following message is present at Plesk Home page:
CONFIG_TEXT: The repair operation is in progress. You will be redirected to the login page when it completes. Following warning can be found in the Plesk:
PLESK_WARN: Upgrade failed. To remove this notice, remove the file /var/lock/parallels-panel-upgrade-failure.flag from the server Plesk installation or repair locks are present:
# ls /var/lock/parallels* parallels-panel-bootstrapper-running.lock parallels-panel-maintenance-mode.flag parallels-panel-upgrade-failure.flag Cause
The last Plesk update/upgrade is marked as failed.
Resolution Connect to the server via SSH;
Note: if direct SSH access to the server is not possible, contact server administrator for further assistance. Reinstall microupdates according to the article How to reinstall Plesk micro-updates (MU) Move the locks to a different directory:
# mkdir /root/locks/ # mv /var/lock/parallels-panel-* /root/locks/ "
5," How to create a backup in Plesk Applicable to: Plesk for Linux Plesk for Windows Question
How to create a Plesk backup?
Answer Creating a backup via Plesk A server-wide backup includes all data: resellers, customers, all subscriptions, databases and mail.
To create a server-wide backup: In Plesk, go to to Tools & Settings > Backup Manager and click Back Up. Specify backup settings and click OK. A subscription backup includes website data, databases and mail.
To create a subscription backup: In Plesk, go to Subscriptions > example.com > Backup Manager and click Back Up. Specify backup settings and click OK. A reseller's backup includes all reseller's and his customers' subscriptions.
To create a backup of a reseller: In Plesk, go to Resellers > Login as Reseller > Tools & Utilities > Backup Manager > Back Up. Specify backup settings and click OK. A customer's backup includes all customer's domains including website data, databases and mail.
To create a backup of a customer: In Plesk, go to Customers > Login as Customer > Backup Manager > Back Up. Specify backup settings and click OK. To download a backup to your PC, go to Backup Manager and click next to a backup name. Creating a backup via a command-line interface Connect to a Plesk server via SSH/RDP. Use the pleskbackup utility to create Plesk backups. To learn more about this utility and its options, refer to Plesk command-line documentation: For Plesk on Linux: pleskbackup: Backing Up Content and Configuration For Plesk on Windows Server: pleskbackup.exe: Backing Up Content and Configuration Examples Back up a whole Plesk server with the command: for Plesk on Linux
# plesk bin pleskbackup server --description=""Server-wide backup"" for Plesk on Windows Server
C:\> plesk bin pleskbackup.exe --server --description=""Server-wide backup"" Back up a domain and store its backup in a specific location, run: for Plesk on Linux
# plesk bin pleskbackup --domains-name example.com --output-file=""/root/example.com.zip"" -v for Plesk on Windows Server
C:\> plesk bin pleskbackup.exe --domains-name example.com --output-file=""C:\example.com.zip"" -v Additional Information Plesk Administrator's Guide: Backing Up and Recovering Websites Related Articles How to create hourly backups in Plesk
What Plesk backup cloud solutions are available in Plesk and how to use them
How to restore a backup on another Plesk server
How to download a huge backup file from Plesk
"
0,"I registered a domain with Plesk reseller, who is unresponsive to my requests. How do I get control of my domain? Applicable to: Plesk Plesk provide domain registration services as a partner of eNom. If your domain was registered with a reseller of Plesk, but the reseller does not respond to your inquiries and you need to control your domain name, please follow the steps below: Check WHOIS details for your domain name. To have any domain moved, you or your company MUST be listed in the WHOIS contact information as the registrant. If you are not, there is nothing we can do to change it. To check the WHOIS information, go to eNom’s WHOIS tool and insert your domain name: http://www.enom.com/whois/default.aspx In cases when Registrant information is invalid or unavailable, we have to treat the domain as if it does not have a Registrant. For example:
Registrant Name: NARegistrant Organization: NARegistrant Email: NA
In such situations, we refer to the Administrative contact to identify domain ownership.
If you are not the registrant of the domain name in question, you might want to contact ICANN to dispute domain ownership and correct WHOIS details: http://www.icann.org/en/contact/ If you or your company is listed as the registrant of domain name in question, please submit a request for Plesk: https://www.plesk.com/contact-us
Please make sure that the following information in included into your request: your domain name or website URL;
your contact details including your name, company name, email address and phone number;
information about who your reseller is, how you have attempted to reach your reseller,
the domain purchase date and the website where you bought the domain, if you have this information. Depending on whether the registrant is an individual or a company, you will also need to provide one of the following documents for domain ownership verification: for individuals: a color digital copy of a government issued photo ID (driver's license, passport, military ID, birth certificate);
for companies: a digital copy of a Business License or an Article of Incorporation. There are two major solutions: A. Push to another account Your domain can be pushed to your own retail account with Plesk. The procedure is free-of-charge. In the account you will be able to renew the domain, change DNS settings and WHOIS contact information, you will also have access to other settings and services.
Before your domain is moved to the retail account, please make sure you are aware of the pricing for domain registration/renewal/transfer:
http://pleskdomains.com/pricing.aspx > Domain Pricing
In order to create a retail account with Plesk please go to:
http://www.pleskdomains.com/
Click on New Account. Fill in your information. Note that you do not need to fill in the credit card information. Once you have created your account, provide Plesk support with your account login ID. B. Transfer to another registrar We can unlock your domain and provide EPP/Authorization code, so you will be able to transfer your domain to a different registrar. EPP code can only be sent to the registrant's email address, please make sure that this mailbox is active and you have access to it."
5,"Migration of the subscription fails: Unable to read configuration file
Applicable to: Plesk for Windows Symptoms Migration of the subscription fails with the following error in Plesk:
PLESK_ERROR: Failed to perform an action on subscription 'example.com': Transfer custom error documents of site 'example.org' and its virtual directories Exception message: Command execution failed on the source server 'source' (203.0.113.2) with non-zero exit code. command: ""C:\Program Files (x86)\Parallels\Plesk\admin\bin64\websrvmng"" --get-error-docs --vhost-name=example.org exit code: 1 stdout: File name: ?\C:\Inetpub\vhosts\example.com\example.org\web.config Error: Unable to read configuration file The example.org domain from the error message does NOT exist physically on the source server in the %plesk_vhosts% folder. Cause
The affected domain was not removed correctly previously.
Resolution Log in to Plesk on the source server. Go to Domains and remove the affected domain. Log in to Plesk on the destination server. Go to Subscriptions and remove the affected subscription. Navigate to Tools & Settings > Migration and Transfer Manager > 203.0.113.2 and click the Reload source data button. Migrate the affected subscription again. Additional information
How to remove a domain or domain alias from Plesk?"
6,"MyLittleAdmin on Plesk server does not show databases list: URL that was requested does not exist
Applicable to: Plesk Onyx for Windows
Plesk for Windows Symptoms MyLittleAdmin does not show databases list:
CONFIG_TEXT: URL that was requested does not exist. The page isn't redirecting properly.
OR
CONFIG_TEXT: Timeout expired. The timeout period elapsed prior to completion of the operation or the server is not responding. An attempt to get the User Databases menu stuck at:
CONFIG_TEXT: Retrieving data... Cannot open the User Databases menu on new browser tab:
CONFIG_TEXT: Server error 404 - File or directory not found. The resource you are looking for might have been removed, had its name changed, or is temporarily unavailable. Cause
The cause is on MyLittleAdmin side: it fails to handle database connections when there are a lot of databases.
Resolution
Get more detailed error message using the steps below and contact MyLittleAdmin support for assistance: Connect to the server via RDP. Enable debug mode in the %plesk_dir%MyLittleAdmin\config.xml:
CONFIG_TEXT: <debug value=""true""/> Change the httpRuntime maxRequestLength value in%plesk_dir%MyLittleAdmin\web.config:
CONFIG_TEXT: <httpRuntime maxRequestLength=""204800"" maxQueryStringLength=""2097151"" /> Comment out the httpErrors block in%plesk_dir%MyLittleAdmin\web.config:
CONFIG_TEXT: <!-- <httpErrors errorMode=""DetailedLocalOnly"" defaultPath=""./error/404.html"" defaultResponseMode=""ExecuteURL""> <remove statusCode=""404"" subStatusCode=""-1"" /> <error statusCode=""404"" prefixLanguageFilePath="""" path=""./error/404.html"" responseMode=""ExecuteURL"" /> </httpErrors> --> Right-click the User Databases menu in myLittleAdmin and press the Open in New Tab button to get the detailed error output: The output of the error may be listed on the page in plain text (the output may be formatted differently, so use URL decoder to get human-readable text):
CONFIG_TEXT: HTTP Error 404.15 - Not Found The request filtering module is configured to deny a request where the query string is too long. Detailed Error Information: Module RequestFilteringModule Notification BeginRequest Handler PageHandlerFactory-Integrated-4.0 Error Code 0x00000000 Source: .Net SqlClient Data Provider Message: Timeout expired. The timeout period elapsed prior to completion of the operation or the server is not responding. Stack trace: at System.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection) at System.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection) at System.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj)
OR
CONFIG_TEXT: Offending URL: .Net SqlClient Data Provider<br /><br /><strong>Message:</strong> Execution Timeout Expired. The timeout period elapsed prior to completion of the operation or the server is not responding.<br /><br /><strong>Stack trace:</strong> at System.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction) If there is a simple 404 error:
CONFIG_TEXT: 404 - File or directory not found.
then copy the URL of that page and decode it using URL decoder. It will display similar content regarding .Net SqlClient Data Provider. "
3,"Logs are not being rotated for a domain in Plesk
Applicable to: Plesk Onyx for Linux Symptoms
Logs are not being rotated for domain example.com.
Cause
The /usr/local/psa/var/logrotate.status file got corrupted.
That file is where logrotate stores information about when it last rotated each log file.
Resolution Move /usr/local/psa/var/logrotate.status file and run daily maintenance script:
# mv /usr/local/psa/var/logrotate.status /usr/local/psa/var/logrotate.status_old # /usr/local/psa/bin/sw-engine-pleskrun /usr/local/psa/admin/plib/DailyMaintainance/script.php Execute logrotate task for one domain:
# /usr/local/psa/logrotate/sbin/logrotate -v -f /usr/local/psa/etc/logrotate.d/example.com Check if proper 'logrotate.status' is created:
# grep example.com /usr/local/psa/var/logrotate.status ""/var/www/vhosts/system/example.com/logs/access_log.processed"" 2014-10-13 ""/var/www/vhosts/system/example.com/logs/xferlog_regular.processed"" 2014-10-13 ""/var/www/vhosts/system/example.com/logs/error_log"" 2014-10-13 ""/var/www/vhosts/system/example.com/logs/access_ssl_log.processed"" 2014-10-13 When extra domains are added to the subscription, configure them by following the article How to configure log rotation for domain? "
5," How to change the location for Plesk backup files on a Linux server
Applicable to: Plesk for Linux Question
How to change the location for Plesk backup files in Linux?
Answer
By default, all backup data is stored in the directory /var/lib/psa/dumps.
To change the default backup location, follow these steps: Connect to a Plesk server via SSH. Create a new directory for backups. In these example, we are using /plesk_backups:
# mkdir /plesk_backups Set necessary ownership for the created directory:
# chown psaadm:psaadm /plesk_backups# chmod 750 /plesk_backups Modify the backup location in the Plesk configuration file /etc/psa/psa.conf:
4.1. Open the file /etc/psa/psa.conf in a text editor (for example, vi editor).
4.2. Change the value of DUMP_D to the created directory from step 2:
CONFIG_TEXT: # Backups directoryDUMP_D /plesk_backups
4.3. Save the changes and close the file.
4.4. Verify that the directory has been changed:
# cat /etc/psa/psa.conf | grep -w DUMP_DDUMP_D /plesk_backups Move all backup data and the hidden .discovered directory from the old location to new:
# mv /var/lib/psa/dumps/* /plesk_backups/# mv /var/lib/psa/dumps/.discovered/ /plesk_backups/ Restart the ""sw-cp-server"" service:
# service sw-cp-server restart
Now all backup files will be stored in the directory /plesk_backups. Related Articles How to change virtual hosts location in Plesk for Linux How to change the default location for mailboxes in Plesk for Linux How to change default location for temporary backup files on Linux How to change the location for Plesk backup files on Windows Server "
3,"Web server reconfiguration error: Destination directory /etc/nginx/plesk.conf.d/vhosts not exist
Applicable to: Plesk 12.5 for Linux
Plesk Onyx for Linux Symptoms The following error message is shown on the Home page in Plesk:
PLESK_ERROR: New configuration files for the Apache web server were not created due to the errors in configuration templates: Destination directory '/etc/nginx/plesk.conf.d/vhosts' not exist . Detailed error descriptions were sent to you by email. Please resolve the issues and click here to generate broken configuration files once again or here to generate all configuration files. See the details in Configuration Troubleshooter Missing nginx directories are shown in /var/log/plesk/panel.log:
CONFIG_TEXT: [2015-11-10 11:27:03] ERR [panel] Apache config (14471506850.04034900) generation failed: Template_Exception: Destination directory '/etc/nginx/plesk.conf.d/vhosts' not exist file: /opt/psa/admin/plib/Template/Writer/Webserver/Abstract.php line: 75 code: 0 Destination directory '/etc/nginx/plesk.conf.d/vhosts' not exist [2015-11-10 11:50:04] ERR [panel] Apache config (14471525560.08224600) generation failed: Template_Exception: Destination directory '/etc/nginx/plesk.conf.d/wildcards' not exist file: /opt/psa/admin/plib/Template/Writer/Webserver/Abstract.php line: 75 code: 0 [2015-11-10 11:50:04] ERR [1] Destination directory '/etc/nginx/plesk.conf.d/wildcards' not exist stdout: websrvmng: Unable to chdir to /etc/nginx/plesk.conf.d: No such file or directory System error 2: No such file or directory Cause
nginx misconfiguration: the required directories are missing.
Resolution Connect to the server via SSH; Recreate the missing directories:
# mkdir -p /etc/nginx/plesk.conf.d/vhosts # mkdir -p /etc/nginx/plesk.conf.d/wildcards Disable nginx:
# /usr/local/psa/admin/sbin/nginxmng -d Enable nginx back if required:
# /usr/local/psa/admin/sbin/nginxmng -e "
8,"Sent attachments are not shown in Horde webmail
Applicable to: Plesk Onyx for Linux
Plesk Onyx for Windows Symptoms
Sent attachments are not shown in Horde webmail.
Cause
Saving attachment option is disabled in mailbox.
Resolution
Enable save attachment feature in Horde > Settings > Preferences > Mail > Sent Mail > Save attachments in the sent-mail message? > Save attachments. "
8,"Emails with valid archived files in attachement are blocked by `drwebd` service
Applicable to: Plesk for Linux Symptoms Emails with valid archived files in attachments are blocked by drwebd service. A similar message can be found in the antivirus report and in the sender's mailbox:
CONFIG_TEXT: --- Antivirus report --- Detailed report: 127.0.0.1 [26365] drweb.tmp.g2tuDx - archive MAIL 127.0.0.1 [26365] >drweb.tmp.g2tuDx/4.part - Ok 127.0.0.1 [26365] >drweb.tmp.g2tuDx/6.part - archive RAR 127.0.0.1 [26365] >>drweb.tmp.g2tuDx/6.part/16-12-2015 Acc+Green\acc hrms bk 16-12-2015.bak - Ok 127.0.0.1 [26365] >>drweb.tmp.g2tuDx/6.part/16-12-2015 Acc+Green\erp 16-12-2015.bak - Ok 127.0.0.1 [26365] >>drweb.tmp.g2tuDx/6.part/16-12-2015 Acc+Green\Hrms-Green 16-12-2015.bak - Ok 127.0.0.1 [26365] >drweb.tmp.g2tuDx/6.part - Ok 127.0.0.1 [26365] >drweb.tmp.g2tuDx/7.part - archive RAR 127.0.0.1 [26365] >>drweb.tmp.g2tuDx/7.part/16-12-2015 Meps\16-12-2015ece.bak - Ok 127.0.0.1 [26365] >>drweb.tmp.g2tuDx/7.part/16-12-2015 Meps\16-12-2015erp.bak - Ok 127.0.0.1 [26365] >>drweb.tmp.g2tuDx/7.part/16-12-2015 Meps\16-12-2015hrms.bak - file too large skipped 127.0.0.1 [26365] >>drweb.tmp.g2tuDx/7.part/16-12-2015 Meps\16-12-2015ies.bak - Ok 127.0.0.1 [26365] >drweb.tmp.g2tuDx/7.part - Ok 127.0.0.1 [26365] >drweb.tmp.g2tuDx/8.part - Ok 127.0.0.1 [26365] >drweb.tmp.g2tuDx/9.reexport - Ok 127.0.0.1 [26365] drweb.tmp.g2tuDx - Ok Scanning statistic: Archive restriction : 1 The Switch on antivirus protection for this email address option is enabled and Check for viruses is set to Incoming and outgoing mail in Domains > example.com > Email Addresses > user@example.com > Antivirus. A similar error is present in /var/log/messages:
CONFIG_TEXT: drwebd.real: 127.0.0.1 [18812] >>>/var/spool/drweb/spool/drweb.tmp.qFHUZK/4.part/file.exe - - timeout! Cause
The issue caused by insufficient values of MaxFileSizeToExtract and FileTimeout parameters of Plesk Premium Antivirus package.
Resolution Increase maximum archive sizes and timeouts:
Note: Too high values might cause Denial of Service (DoS) attacks possible by consuming too much server resources. Connect to the server via SSH Edit file /etc/drweb/drweb_handler.conf by setting ArchiveRestriction as follows:
CONFIG_TEXT: ArchiveRestriction = pass Edit file /etc/drweb/drweb32.ini and increase the value for the parameters FileTimeout and MaxFileSizeToExtract:
CONFIG_TEXT: FileTimeout = 60 MaxFileSizeToExtract = 100000
Note: Value of the MaxFileSizeToExtract variable can be changed as desired Restart Plesk Premium Antivirus in Tools & Settings > Services Management to apply changes. Disable antivirus notifications completely: Connect to the server via SSH Edit file /etc/drweb/drweb_handler.conf and disable SenderNotify and AdminNotify for ArchiveRestrictionNotifications:
CONFIG_TEXT: [ArchiveRestrictionNotifications] SenderNotify = no AdminNotify = no Restart Plesk Premium Antivirus and SMTP Server in Tools & Settings > Services Management to apply changes. "
8,"MailEnable problem: Unable to load DLL 'MEAISO.DLL': The specified module could not be found. (Exception from HRESULT: 0x8007007E)"" Applicable to: Plesk for Windows Symptoms
MailEnable webmail shows one of the following error messages:
Unable to load DLL 'MEAISO.DLL': The specified module could not be found. (Exception from HRESULT: 0x8007007E)""
OR
CONFIG_TEXT: Unable to find an entry point named 'GeoIPValidate' in DLL 'MEAISO.DLL'.
Cause
MailEnable could not read the MEAISO.DLL file due to invalid file permissions.
Resolution Connect to the Plesk server via RDP. Start meinstaller.exe in Mail Enable bin installation directory. Select Common Installation (File Permissions) and click Execute. Wait for the task to complete. After the task is finished, click View Log.. to check if there were any errors during update. If there are any errors in the log, look for the solution in MailEnable Knowledge Base. Open MailEnable webmail. If the same issue persists, start the meinstaller.exe utility again and select the option Web application reconfigure and click Execute. Wait for the task to complete. Open MailEnable webmail again. If this does not help, please contact MailEnable Support for further troubleshooting. Additional Information MEInstaller - MailEnable Professional Guide "
4,"APS application installation fails: There is not enough space on the disk Applicable to: Plesk Onyx for Windows Symptoms Unable to install APS Application (e.g. WordPress) at Domains > example.com > Applications Installation fails with error:
PLESK_ERROR: Error: Installation of WordPress at http://domain.tld/wordpress failed. Non-zero exit status returned by script. Output stream: 'PHP Warning: require(C:\\inetpub\\sites\\domain.tld\\httpdocs\\wordpress/wp-includes/version.php): failed to open stream: No such file or directory in C:\\inetpub\\sites\\domain.tld\\httpdocs\\wordpress\\wp-settings.php on line 30 In %plesk_dir%\\admin\\logs\\php_error.log there is an additional error:
PLESK_ERROR: ERR (3) [panel]: Application deployment failed: Unable to copy (C:\\Program Files (x86)\\Parallels\\Plesk\\var\\apspackages\\apsC464.tmp.zip713d4563-8785-9b91-1c\\cache\\htdocs\\wp-includes\\post.php) to (C:\\inetpub\\sites\\domain.tld\\httpdocs\\wordpress\\wp-includes\\post.php): (112) There is not enough space on the disk. (Error code 1) WordPress Toolkit scanning fails with the following error message in Plesk:
PLESK_ERROR: Scanning for WordPress installations finished with errors: filemng failed: Unable to create file 'C:\Program Files (x86)\Parallels\Plesk\tmp\{5506a36e-17c5-11e8-9c3a-00155d030308}': (112) There is not enough space on the disk. at execute ""C:\Program Files (x86)\Parallels\Plesk\admin\bin\filemng"" jdoe --temp-file ""--destination=C:\Program Files (x86)\Parallels\Plesk\tmp""(RunTime::RunAsUser::run line 221) (Error code 1) Not possible to create, edit or upload files in File Manager:
PLESK_ERROR: filemng failed: Unable to create file 'C:\Program Files (x86)\Parallels\Plesk\tmp\{5506a36e-17c5-11e8-9c3a-00155d030308}': (112) There is not enough space on the disk. at execute ""C:\Program Files (x86)\Parallels\Plesk\admin\bin\filemng"" jdoe --temp-file ""--destination=C:\Program Files (x86)\Parallels\Plesk\tmp""(RunTime::RunAsUser::run line 221) (Error code 1) Cause
Disk quota is reached by FTP user of subscription.
Resolution Log into Plesk Go to Domains > example.com > Web Hosting Access and increase Hard quota on disk space value. "
2,"Resource usage notifications are sent despite the fact subscription limits are not exceeded
Applicable to: Plesk Onyx for Linux
Plesk Onyx for Windows Symptoms A subscription user or Plesk administrator gets e-mail notifications that limits are exceeding despite the fact the limits are unlimited or not exceeded yet:
CONFIG_TEXT: The 'example.com' subscription, owned by user 'Customer Name', is approaching or already exceeded the resource usage limits:Disk Space: 15 GB limit / 2902 MB (19%) used / 12458 MB (81%) remaining"" Value Notify when disk space usage reaches is specified in a subscription properties in Subscriptions > example.com > Customize > Resources Cause
Notify me by email in cases of overuse option notifies users as soon as disk space or traffic usage exceeds the specified limit. If this limit is set to a small value, notification will be sent despite the fact actual limits are not exceeded.
Resolution
Increase or delete value Notify when disk space usage reaches: Login to Plesk For Service Plan:
Go to Plesk > Service Plans > plan_name > Resources For locked subscription:
Go to Plesk > Subscriptions > example.com > Customize > Resources "
6,"How to enable remote access to MySQL server in Plesk?
Applicable to: Plesk for Linux
Plesk for Windows Question
How to enable remote access to a MySQL database server in Plesk?
Answer
Warning: after enabling the access, all MySQL connections will be unencrypted. To make them encrypted, an SSL certificate is required. For that and additional steps check this link: https://dev.mysql.com/doc/refman/5.7/en/using-encrypted-connections.html#using-encrypted-connections-server-side-configuration
Note: make sure that MySQL port is not blocked by a firewall. #115002633594
By default, Plesk administrator does not have remote access. It is recommended to create a new user that will be used for the remote connection. Though the 'admin' can be used, too.
In order to enable remote access to a MySQL server, connect to the server via SSH or RDP and follow instructions below: Automatic Solution for Plesk Onyx on Linux (Recommended) Download, unzip, and run the automatic script.
# wget https://support.plesk.com/hc/en-us/article_attachments/360017905094/remotemysql.zip # unzip remotemysql.zip # chmod +x remotemysql.sh # ./remotemysql.sh
Note: The remote access will be granted to 'admin' user. If it is required to give access to another user, follow also step 6 from section ""Manual solution for Plesk 12.* and Plesk Onyx"" below. Video instruction for Linux Manual solution for Plesk Onyx and Plesk Obsidian Log in to Plesk and make sure the option Allow remote connections from any host is enabled at Tools & Settings > Database Servers > Settings. Connect to a Plesk server via SSH/RDP and open the MySQL configuration file in any text editor. Location of this file is: For Linux: for CentOS/RHEL-based distributions: /etc/my.cnf for Debian/Ubuntu-based distributions:
/etc/mysql/my.cnf For Windows: %plesk_dir%Databases\MySQL\my.ini Change bind-address parameter to:
CONFIG_TEXT: bind-address = 0.0.0.0
Note: 0.0.0.0 means every IP address on the server. If it is required to bind to specific IP address, specify this particular IP instead of 0.0.0.0
Also, make sure that skip-networking parameter is not defined. After that, restart MySQL server:
For Linux: for CentOS/RHEL-based distributions:
# service mariadb restart for Debian/Ubuntu-based distributions:
# service mysql restart Login to MySQL server.
Note: For the access to client's MySQL server on Windows, use PHPMyAdmin: Plesk > Tools & Settings > Database Servers - MySQL DB Admin. Grant access to remote IP address and login to MySQL. For example, if it's required to allow access to the database called database for user user with password password and remote IP address 203.0.113.2:
CONFIG_TEXT: GRANT ALL ON database.* TO user@'203.0.113.2' IDENTIFIED BY 'password'; CONFIG_TEXT: FLUSH PRIVILEGES;
To create a user that has access to all databases, execute the following query:
CONFIG_TEXT: GRANT ALL PRIVILEGES ON *.* TO 'user'@'203.0.113.2' IDENTIFIED BY 'password' REQUIRE NONE WITH GRANT OPTION MAX_QUERIES_PER_HOUR 0 MAX_CONNECTIONS_PER_HOUR 0 MAX_UPDATES_PER_HOUR 0 MAX_USER_CONNECTIONS 0; CONFIG_TEXT: FLUSH PRIVILEGES;
Note: to allow connections from any IP address use ' % ' character. Make sure that MySQL server is listening on the correct IP address.
For Windows:
C:\> netstat -anp tcp | findstr 8306 TCP 0.0.0.0:8306 0.0.0.0:0 LISTENING
C:\> netstat -anp tcp | findstr 3306 TCP 0.0.0.0:3306 0.0.0.0:0 LISTENING
For Linux:
# netstat -anp | grep :3306 tcp 0 0 203.0.113.10:3306 0.0.0.0:* LISTEN 13151/mysqld If Plesk firewall is used on the server, allow remote connection to MySQL in Tools & Settings > Firewall. If another firewall solution is used, ensure that access to port 3306 is allowed. Login from the remote server via CLI:
CONFIG_TEXT: mysql -u someuser -p ""password"" -h example.com
Or using MySQL Workbench. Allow remote access to MySQL database server in Plesk for a specific user Go to Plesk > Subscriptions > example.com > Databases > User Management > example_db_user; Make sure that Access control is set to Allow remote connections from any host or to Allow remote connections from: Connect to a Plesk server via SSH/RDP and open the MySQL configuration file in any text editor. Location of this file is: For Linux: for CentOS/RHEL-based distributions: /etc/my.cnf for Debian/Ubuntu-based distributions:
/etc/mysql/my.cnf For Windows: %plesk_dir%Databases\MySQL\my.ini Change bind-address parameter to:
CONFIG_TEXT: bind-address = 0.0.0.0
Note: 0.0.0.0 means every IP address on the server. If it is required to bind to specific IP address, specify this particular IP instead of 0.0.0.0
Also, make sure that skip-networking parameter is not defined. After that, restart MySQL server:
For Linux: for CentOS/RHEL-based distributions:
# service mariadb restart for Debian/Ubuntu-based distributions:
# service mysql restart Note: To verify connectivity, log in from the remote server using MySQL Workbench or via CLI by executing the following command:
# mysql -u""example_db_user"" -p""password"" -h""example.com""
Note: If the remote connection cannot be established check firewall settings - the required port possibly is blocked. "
6," How to back up/restore Plesk system databases
Applicable to: Plesk for Linux
Plesk for Windows Question
How to create a dump of system databases in Plesk?
How to restore system databases from a database dump?
Answer
Plesk interacts with the following databases: psa - Plesk system database apsc - Plesk application database mysql - MySQL system database roundcubemail - Roundcube database, if installed horde - Horde database, if installed atmail - atmail database, if installed sitebuilder5 - Web Presence Builder, if installed phpmyadmin_* - phpMyAdmin database, if installed To back up/restore these databases, connect to a Plesk server via SSH (Linux)/RDP (Windows Server) and follow the instructions below: Plesk for Linux Backing up/restoring system databases manually Creating a manual database dump Plesk Onyx
# plesk db dump <database_name> > /path/to/<dump_name>.sql Plesk 12.5 and previous releases
# MYSQL_PWD=`cat /etc/psa/.psa.shadow` mysqldump -uadmin <database_name> > /path/to/<dump_name>.sql Example The following command creates a database dump of the Plesk 'psa' database in the /root directory with today's timestamp: For Plesk Onyx
# plesk db dump psa > /root/psa_dump.sql For Plesk 12.5 and previous releases
# MYSQL_PWD=`cat /etc/psa/.psa.shadow` mysqldump -uadmin psa > /root/psa_dump.sql The following database dump will be created:
# ls /root/psa_dump.sql psa_dump.sql Restoring a database from a manual database dump Plesk Onyx
# plesk db < /path/to/<dump_name>.sql Plesk 12.5 and previous releases
# MYSQL_PWD=`cat /etc/psa/.psa.shadow` mysql -uadmin < /root/<dump_name>.sql Example The following command for Plesk Onyx restores the Plesk psa database from the database dump 'psa_dump.sql' located in the /root directory:
# plesk db < /root/psa_dump.sql Restoring system databases from a Plesk daily/pre-upgrade dump If some of system databases got corrupted, but there are no manually created backups available, use Plesk daily/pre-upgrade dumps for restoration. To learn more about Plesk daily/pre-upgrade dumps, see the Additional Information section. Restoring from a Plesk daily dump Switch to the directory with daily dumps:
# cd /var/lib/psa/dumps List all available Plesk daily dumps:
# ls -l mysql.daily* -rw------- 1 root root 236253 Feb 3 01:51 mysql.daily.dump.0.gz -rw------- 1 root root 229653 Feb 2 01:48 mysql.daily.dump.1.gz -rw------- 1 root root 222485 Feb 1 01:56 mysql.daily.dump.2.gz
where mysql.daily.dump.0.gz is the most recent daily dump. Example 1: Restoring a single system databaseThe following command for Plesk Onyx restores the Plesk 'psa' database from the latest available daily dump mysql.daily.dump.0.gz:
Note: To restore another system database, replace psa with a database name you want to restore.
# zcat mysql.daily.dump.0.gz | sed -n '/-- Current Database: `psa`/,/-- Current Database:*/p' | plesk db Example 2: Restoring a single tableThe following command for Plesk Onyx restores the Plesk log_actions table from the latest available daily dump mysql.daily.dump.0.gz:
# zcat mysql.daily.dump.0.gz | sed -n '/-- Table structure for table `log_actions`/,/-- Table*/p' | plesk db Example 3: Restoring all system databasesThe following command for Plesk Onyx restores all system databases from the latest available daily dump mysql.daily.dump.0.gz:
# zcat mysql.daily.dump.0.gz | plesk db Restoring from a Plesk pre-upgrade dump Pre-upgrade dumps are used to restore the system to previous state if Plesk/MySQL upgrade has failed. Switch to the directory with pre-upgrade dumps:
# cd /var/lib/psa/dumps List all available pre-upgrade dumps:
# ls -l mysql.preupgrade* -rw------- 1 root root 212341 Feb 1 05:18 mysql.preupgrade.12.5.30-12.5.30.20190214-051821.dump.gz -rw------- 1 root root 213230 Feb 1 13:50 mysql.preupgrade.12.5.30-17.8.11.20190214-135000.dump.gz
In the example below, we are restoring all system databases from a dump file that was created before an upgrade from Plesk 12.5 to Plesk Onyx 17.8. Restore system databases:
# zcat mysql.preupgrade.17.8.11-17.8.11.20180902-224319.dump.gz | MYSQL_PWD=`cat /etc/psa/.psa.shadow` mysql -uadmin Plesk for Windows Server Backing up/restoring system databases manually Creating a manual database dump Plesk Onyx
C:\> plesk db dump <database_name> > C:/path/to/<dump_name>.sql Plesk 12.5 and previous releases
Note: MySQL admin password is required for this operation.
C:\> ""%plesk_dir%""\Mysql\bin\mysqldump.exe -uadmin -p -P8306 <database_name> > C:/path/to/<dump_name>.sql Example The following command for Plesk Onyx creates a database dump of the Plesk 'psa' database on C:\ drive:
C:\> plesk db dump psa > C:\psa_dump.sql Restoring a database from a manual database dump Plesk Onyx
C:\> plesk db < C:/path/to/<dump_name>.sql Plesk 12.5 and previous releases
Note: MySQL admin password is required for this operation.
C:\> ""%plesk_dir%\Mysql\bin\mysql.exe"" -uadmin -p -P8306 psa < C:\<dump_name>.sql Example The following command for Plesk Onyx restores the Plesk 'psa' database from the database dump psa_dump.sql located on C:\ drive:
C:\> plesk db < C:\psa_dump.sql Restoring system databases from a Plesk daily dump If some of Plesk system databases got corrupted, but there are no manually created backups available, use Plesk daily dumps for restoration. To learn more about Plesk daily dumps, see the Additional Information section. Switch to the directory with daily dumps:
C:\> cd %plesk_dir%Mysql\Backup List all available Plesk daily dumps sorted by date (newest first):
C:\> dir /O:-D Directory of C:\Program Files (x86)\Plesk\MySQL\Backup 10/18/2018 02:07 AM 106,128 horde-20181018020721.sql 10/18/2018 02:07 AM 122,124 config-20181018020721.reg 10/18/2018 02:07 AM 28,707 apsc-20181018020721.sql 10/18/2018 02:07 AM 389,032 psa-20181018020721.sql Restore a system database: Example 1: For Plesk Onyx The following command restores the Plesk psa database from the latest available daily dump psa-20181018020721.sql:
C:\> plesk db < psa-20181018020721.sql Example 2: For Plesk 12.5 and previous releases The following command restores the Plesk psa database from the latest available daily dump psa-20181018020721.sql:
Note: MySQL admin password is required for this operation.
C:\> ""%plesk_dir%\Mysql\bin\mysql.exe"" -uadmin -p -P8306 psa < psa-20181018020721.sql Additional Information About Plesk daily/pre-upgrade dumps
For security reasons, Plesk automatically creates dump files that include system databases. Linux
On Linux servers, Plesk creates two types of dump files - Plesk daily dump and Plesk pre-upgrade dump.
By default, these dump files are located in /var/lib/psa/dumps/ (The directory is defined by the DUMP_D variable in the file /etc/psa/psa.conf). To list these database dumps, run the command:
# ls -l /var/lib/psa/dumps/mysql* Plesk daily dumps
Every night Plesk automatically creates a daily dump of system databases in scope of the Plesk daily task /etc/cron.daily/50plesk-daily.
A daily dump file has the name mysql.daily.dump.X.gz, where X is a number starting from 0 (0 means latest). The following databases are included in it (in order of appearance): psa
mysql
horde
atmail
sitebuilder5
apsc
roundcubemail phpmyadmin_* Plesk pre-upgrade dumps
Before upgrading Plesk or installing important MySQL updates, Plesk Installer creates a pre-upgrade dump of system databases. Pre-upgrade dumps are used to restore the system to previous state if Plesk upgrade/update has failed.
This dump file has the name mysql.preupgrade.PLESK_VER_BEFORE-PLESK_VER_AFTER.DATE_CREATED.dump.gz. The following databases are included in it (in order of appearance): mysql - MySQL system database psa - Plesk system database apsc - Plesk application database horde - Horde database, if installed Windows Server
On Windows servers, every night Plesk automatically creates a daily dump of system databases in scope of the scheduled task Backup of vital Plesk settings in Windows Task Scheduler (command C:\Program Files (x86)\Plesk\admin\bin\sshost.exe --settings-backup).
These dump files are located in %plesk_dir%Mysql\Backup. The following Plesk databases are backed up: psa - Plesk system database apsc - Plesk application database horde - Horde database, if installed Related Articles How to back up all MySQL databases in Plesk for Linux
How to access the Plesk psa database in MySQL
"
3,"Websites and Plesk are down: IIS service is unable to write in its configuration files Applicable to: Plesk Onyx for Windows Symptoms The Plesk and all websites are down. In an attempt to open some menus in Start > Windows System > Administrative Tools > Internet Information Services (IIS) Manager, the error below is shown:
CONFIG_TEXT: Filename: \\\\?\\C:\\Windows\\System32\\inetsrv\\config\\applicationHost.config Error: Cannot write configuration file CONFIG_TEXT: There was an error while performing this operation. Details: Filename: \\\\?\\C:\\Windows\\system32\\inetsrv\\config\\applicationHost.config Line number: 1517 Error: Configuration file is not well-formed XML The Plesk can be innaccessible with the same error as above. Cause
The IIS service is unable to write in its configuration files because the server does not have available disk space.
Resolution Log into the server via RDP.
Free up or allocate additional disk space.
Reboot the server and check the availability of the websites. In case the issue still persists, press here to get further instructions Open the command prompt as an Administrator.
Execute the following command to list all IIS configuration backups:
C:\> cd %windir%\System32\inetsrv & appcmd list backup BACKUP ""CFGHISTORY_0000000054"" BACKUP ""CFGHISTORY_0000000055"" … BACKUP ""CFGHISTORY_0000000062"" Restore the latest available IIS configuration backup:
C:\> cd %windir%\System32\inetsrv & appcmd restore backup CFGHISTORY_0000000062 Note: in case the backup restoration fails with the error below, disable the Read-only attribute for the C:\Windows\System32\inetsrv\config\schema\rewrite_schema file:
CONFIG_TEXT: ERROR ( hresult:80070005, message:Command execution failed. Access is denied.) Restart the IIS service:
C:\> iisreset /restart "
2,"Unable to remove an IP address in Plesk: The IP address is already used for hosting
Applicable to: Plesk for Windows
Plesk for Linux Symptoms
1. An attempt to delete old IP address from Tools & Settings > IP Addresses fails:
CONFIG_TEXT: Error: The IP address `<ip_address>` is already used for hosting.
2. One of the following symptoms may take place in Tools & Settings > IP Addresses: no sites are assigned to the old IP address;
after switching the domains to a new IP, some of them are still shown as assigned to the old address. Cause
Plesk database inconsistency. The psa.IpAddressesCollections table was not correctly updated when IP addresses were changed for domains.
Resolution Login to Plesk via SSH or RDP.
Back up Plesk database.
Login to MySQL server.
Find out which ""id"" is assigned to the IP address in question, and find any (sub)domains that have this IP address assigned:
MYSQL_LIN: mysql> select @ip_id := id from IP_Addresses where ip_address='203.0.113.2'; mysql> SELECT d.name, d.webspace_id, ipac.ipCollectionId,ds.type,ip.ip_address FROM DomainServices ds INNER JOIN IpAddressesCollections ipac ON ds.ipCollectionId = ipac.ipCollectionId INNER JOIN domains d ON d.id = ds.dom_id JOIN IP_Addresses ip on ipac.ipaddressid=ip.id WHERE (ds.type = 'web' OR ds.type = 'mail') and ipac.ipAddressId = @ip_id; Replace the 203.0.113.2 with actual IP address to be deleted.
Find records in the IpAddressesCollections table that correspond to the IP address in question:
MYSQL_LIN: mysql> select * from IpAddressesCollections where ipaddressid=@ip_id; Find out which id is assigned to the IP address that should be used for the (sub)domains from the previous output, then update the corresponding records of the IpAddressesCollections table. For example, the address 203.0.113.3 should be assigned to example.com :
MYSQL_LIN: mysql> set @domain_name := 'example.com'; mysql> select @ip_id_new := id from IP_Addresses where ip_address='203.0.113.3'; mysql> update IpAddressesCollections ipac INNER JOIN DomainServices ds ON ds.ipCollectionId = ipac.ipCollectionId INNER JOIN domains d ON d.id = ds.dom_id JOIN IP_Addresses ip on ipac.ipaddressid=ip.id set ipac.ipAddressId=@ip_id_new WHERE (ds.type = 'web' OR ds.type = 'mail') and ipac.ipAddressId = @ip_id and d.name=@domain_name; "
9,"Unable to start bind on Plesk server: undefined ACL 'common-allow-transfer'
Applicable to: Plesk for Linux Symptoms
After adding Plesk DNS extension settings into /etc/named.conf file, named serivce does not start with the following records:
CONFIG_TEXT: named[24687]: loading configuration from '/etc/named.conf'named[24687]: /etc/named.conf:78: undefined ACL 'common-allow-transfer' named[24687]: loading configuration: failure named[24687]: exiting (due to fatal error)
Cause
ACL is not defined in named configuration file.
Resolution
Note: if direct SSH access to the server is not possible, contact server administrator for further assistance. Log in the server via SSH. Backup original /etc/named.conf file
# cp /etc/named.conf /etc/named.conf_back Edit /etc/named.conf file and put the following in the end of the file:
CONFIG_TEXT: acl common-allow-transfer { none; }; Start named service:
# service named start Update DNS zones in Plesk if it is required under Plesk > Subscriptions > example.com > DNS Settings > click on some record > Ok > Update . "
3,"Plesk Webserver Configuration Troubleshooter Applicable to: Plesk for Linux Contents Problem
Solution
Installing the extension
Using the extension
Using the command-line utility to check for known issues Problem
Web-server configuration fails for websites and Plesk repair tools do not help. The reason for the failure is unclear. Solution
To find out why a web-server configuration failed, use the Webserver Configurations Troubleshooter extension which, when installed, is available from Plesk.
Webserver Configurations Troubleshooter is intended to assist Plesk administrators with troubleshooting. Installing the extension
First, check if Webserver Configurations Troubleshooter is already installed. Find it in the Extensions menu in Plesk.
If Webserver Configurations Troubleshooter is not there, install it using any of the following ways: via Plesk interface Go to, Tools & Settings > Updates & Upgrades (Plesk) > Updates and Upgrades > Add/Remove Components. On the Add/Remove Components page, expand Plesk extensions and select Plesk Web Server Configuration Troubleshooter for installation. via a command-line interface
Connect to your Plesk server via SSH and run the following command in the console:
# plesk installer --select-release-current --install-component config-troubleshooter Using the extension
Use this extension when you encounter the following errors in Plesk:
PLESK_ERROR: New configuration files for the Apache web server were not created due to the errors in configuration templates ...
To begin, open Web Server Configurations Troubleshooter. On the main page appears the list of all configuration files generated by Plesk. The green mark indicates that configuration file is successful and the red mark indicates an error. To check whether there are known issues related to the generation of web-server configuration files, click Check configuration.
This button starts a script that detects the most frequent issues related to the regeneration of web-server configuration files. For every detected issue, the script shows a link to the KB article that describes how to solve the issue. Visit the suggested articles and try applying their solutions. Filter out faulty configurations by clicking on the button, then setting Status to ""Error"" from the drop-down menu. This will help you determine the websites for which configuration file generation failed.
Here, you also can go to the corresponding subscription using the links in the Related Domain column. Select all, then click Rebuild > Broken.
Webserver Configurations Troubleshooter will try to regenerate broken configuration files. If any issues to be encountered, a message will appear indicating the exact error.
If an error was found, try determining the cause by looking at the error message or search for a KB article in the Plesk Help Center using the error. You also can search for the problem description and solution on the Plesk Forum or using your favorite search engine. If you did not find any errors, try finding error messages indicating the reasons for failure. Search for error messages in Plesk and web servers logs. To do this, click Log search. For example, you can search for the most common errors by typing any of these words: fail
denied
No such
error Searching by these words also is performed in the Plesk log files. For this reason, a huge number of search results may be displayed, and the results might not be related to the issues with regenerating web-server configuration files. However, by performing such a search, you can reveal issues with additional malformed configuration directives for custom per-site PHP settings. For example:
PLESK_INFO: ERR (3): phpinimng failed: Cannot parse php.ini: (<class 'ConfigParser.ParsingError'>, File contains parsing errors: <stdin> [line 11]: 'mbstring.substitute_character """"\') Using the command-line utility to check for known issues
In addition to the extension available in the user interface, there is a command-line tool called webserver_configuration_checker.php.
This script performs the same operations as the ""Check configuration"" button of the Webserver Configurations Troubleshooter, but can be downloaded and run from the console using the following commands:
# wget https://support.plesk.com/hc/article_attachments/115004544209/webserver_configuration_checker.php # /usr/local/psa/bin/sw-engine-pleskrun webserver_configuration_checker.php Related Articles Webserver Configuration Troubleshooter detects extra configuration or shows a false positive report on the Home page
"
2,"502 Bad Gateway error is shown after login to Plesk or performing any actions: Connection reset by peer
Applicable to: Plesk Onyx for Linux
Plesk for Linux Symptoms While accessing Plesk or performing any actions the following error is shown:
CONFIG_TEXT: 502 Bad Gateway The following error message appears in /var/log/sw-cp-server/error_log:
CONFIG_TEXT: recv() failed (104: Connection reset by peer) while reading response header from upstream, client: 203.0.113.2, server: , request: ""POST <some url>
OR
CONFIG_TEXT: [error] 17434#0: *4954 upstream sent too big header while reading response header from upstream, client: 203.0.113.2, server: , request: ""GET /modules/xovi/index.php/log-analyzer/index/id/2 HTTP/1.1"", upstream: ""fastcgi://unix:/var/run/sw-engine.sock:"", host: ""example.com:8443"", referrer: ""https://example.com:8443/"" Cause
Low FastCGI buffer limits.
Resolution Connect to the server via SSH. Open /etc/sw-cp-server/config with a text editor:
# vi /etc/sw-cp-server/config Increase FastCGI buffer limits using the editor:
CONFIG_TEXT: fastcgi_buffers 32 32k; fastcgi_buffer_size 64k; Restart sw-cp-server and sw-engine services:
# service sw-cp-server restart && service sw-engine restart "
2,"Unable to setup the Hard Disk quota for a domain: field is greyed-out, hard disk quota is not supported due to configuration of server file system
Applicable to: Plesk for Linux Symptoms The Hard quota on disk space is not available for editing at Domains > example.com > Web Hosting Access page:
CONFIG_TEXT: Unlimited. Hard disk quota is not supported due to the configuration of the server file system Migration of a subscription that uses hard disk quota fails:
PLESK_INFO: Failed to synchronize subscription with plan Migration tools tried to perform operation in 3 attempts: Plesk error [1023]: quota - Description: hard disk quota is not supported due to configuration of server file system. Requested: 1073741824. Allowed: 0 Subscription cannot be synchronized with the corresponding service plan due to the following error:
PLESK_INFO: Syncing the subscription with its service plan failed because some of the services or resources defined in the plan cannot be actually provisioned with the subscription.
PLESK_INFO: ""Information: Properties of the subscription example.com were set to correspond with the actual system state, they are still unsynced with the plan""
Available value indicates the actual state of a resource or a service in the system. Clicking OK will initiate setting the subscription values according to the available values. OR:
PLESK_ERROR: ERR [panel] Unable to apply plan changes to domain. Error: The plan was not applied because of problems with the following functionality: hard disk quota is not supported due to configuration of server file system Cause
Unconfigured disk quota in an operating system.
Resolution
Warning: configuring of the disk quota on the operating system is an administrative task and is not supported by Plesk. All actions below are the common steps and performed at own risk.
Note: hard disk quota setup depends on the filesystem. In the example below, the steps are performed for ext3 filesystem, while on another filesystem, e.g. xfs, actions will be others.
Note: for Plesk Plesk Multi Server hard disk quota must be configured on both management and service nodes. For a usual server Connect to the server via SSH. Make sure that the quota is supported by the kernel. It should be compiled into the kernel or loaded as a module.
To check if the quota is configured properly use this command:
# /usr/local/psa/admin/sbin/usermng --isquotable
Normally, it should return the ""0"" value.
If the utility returns the following error message:
CONFIG_TEXT: usermng: Unable to turn on user quota. User quota not supported on device '/dev/sda3' System error 3: No such process
OR
CONFIG_TEXT: usermng: Userquota is not enabled on device: /dev/mapper/centos-root
Then enable quota in the /etc/fstab file for the partitions on which Plesk stores data on, e.g. as follows:
CONFIG_TEXT: /dev/hda1 / ext3 defaults,usrquota 1 1 Remount the partition:
# mount -o remount / Create, check and repair quota files:
# /sbin/quotacheck -cfmvF vfsv0 /
Note: If the command is unknown, install quota package. Update the user quota with this command line:
# quotaon /dev/hda1 Make sure that the aquota format is used.
There should be an aquota.user file in the root of every partition where the quota is enabled.
If there is the quota.user file remove it and create correct one:
Note: change the ""/dev/hda1"" device in commands below to the correct one.
# rm -f quota.user # touch aquota.user # /sbin/quotacheck -fmv /dev/hda1 Go to the Plesk > Tools & Settings > Server Components page and click the Refresh button to update information about quota.
Note: A separate component will not appear, but Plesk components cache will be updated to include new information and isHardQuotaEnabled will be true in psa database: # plesk db ""select * from ServiceNodeEnvironment where name='isHardQuotaEnabled'"" +---------------+---------+--------------------+-------+ | serviceNodeId | section | name | value | +---------------+---------+--------------------+-------+ | 1 | os | isHardQuotaEnabled | true | +---------------+---------+--------------------+-------+ For a Virtuozzo Container Make sure that the quotaugidlimit parameter is not set to zero and that it is greater than the number of users and groups in the CT. This limit can be adjusted from the Hardware Node with the following:
# vzctl set CTID --quotaugidlimit 500 --save # vzctl stop CTID # vzctl start CTID
Where CTID is the ID of the Virtuozzo container with Plesk. Execute the packagemng utility to recreate the backend cache in Plesk:
# /usr/local/psa/admin/sbin/packagemng --set-dirty-flag
OR Go to the Plesk > Tools & Settings > Server Components page and click the Refresh button to update information about quota.
Note: A separate component will not appear, but Plesk components cache will be updated to include new information and isHardQuotaEnabled will be true in psa database: # plesk db ""select * from ServiceNodeEnvironment where name='isHardQuotaEnabled'"" +---------------+---------+--------------------+-------+ | serviceNodeId | section | name | value | +---------------+---------+--------------------+-------+ | 1 | os | isHardQuotaEnabled | true | +---------------+---------+--------------------+-------+ "
7,"Upgrade or update of Plesk in Virtuozzo container fails with error
Applicable to: Plesk for Linux Symptoms Plesk is running inside Virtuozzo container. Plesk is inaccessible with 500 Internal Error Plesk update/upgrade fails with one of the following errors in /var/log/plesk/panel.log:
CONFIG_TEXT: error: unpacking of archive failed on file /var/lib/psa/dumps: cpio: mkdir failed - No such file or directory error: unpacking of archive failed on file /usr/local/psa/admin/htdocs/domains/databases/phpMyAdmin/libraries/phpseclib: cpio: mkdir failed - No such file or directory
CONFIG_TEXT: Installing packagessh: /usr/local/psa/bootstrapper/pp17.8.11-bootstrapper/bootstrapper.sh: Input/output error The following error is shown in upgrade log /var/log/plesk/install/autoinstaller3.log:
CONFIG_TEXT: error: unpacking of archive failed on file /usr/local/psa/admin/plib/backup/Conflicts/Log: cpio: mkdir failed - No such file or directory Listing on directory /usr/local/psa/admin/plib/backup/Conflicts/ fails:
# ls -la /usr/local/psa/admin/plib/backup/Conflicts/ ls: cannot access /usr/local/psa/admin/plib/backup/Conflicts/Log: No such file or directory (...) d????????? ? ? ? ? ? Log Cause
Broken links in Virtuozzo containers.
Resolution
Contact Virtuozzo Support Team to fix the issue."
5,"How to restore corrupted Plesk permissions and ownership on RedHat based systems
Applicable to: Plesk for Linux Question
How to restore the permissions and ownerships of Plesk installation directory to the default ones?
Answer
Warning: This guide is applicable only for RHEL/CentOS/CloudLinux systems.
Connect to the server using SSH. Permissions and ownerships can be reset to their default settings using the following commands:
# for p in $(rpm -qa | egrep ""psa|plesk""); do rpm --setugids $p; done# for p in $(rpm -qa | egrep ""psa|plesk""); do rpm --setperms $p; done# chown root.psaadm /usr/local/psa/admin/sbin/mod_wrapper# chmod 4510 /usr/local/psa/admin/sbin/mod_wrapper
Note: The order in which you execute the commands is important. When changing permissions and ownerships on files, always change the ownerships first, and then the permissions. Otherwise, if the files have a SUID bit set, for example, it (the bit set) may get cleared.
Additional Information
Sometimes Mailman still fails to work after applying the above solution. The following messages can be found in the /var/log/maillog:
CONFIG_TEXT: qmail: 1342049843.229677 delivery 3: deferral: Uh-oh:_.qmail_file_is_writable._(#4.7.0)/qmail: 1342049843.229737 status: local 4/10 remote 1/20
There are 3 possible ways of resolving it: Run following set of commands:
# rpm --setugids mailman-<INSTALLED_VERSION># rpm --setperms mailman-<INSTALLED_VERSION>
Replace <INSTALLED_VERSION> with the actual version of Mailman package installed on your server. Try switching mail provider to Postfix and check if the behavior changes. Try uninstalling Mailman (Warning, this will lead to loss of all configuration), install it back and configure it anew.
In case all those action do not help, make sure that Plesk installation is up-to-date. Update it if necessary. "
2,"Plesk is not accessible: 500.19 - Internal server error Module DynamicCompressionModule
Applicable to: Plesk for Windows Symptoms
Plesk is not accessible on localhost with the following error:
PLESK_INFO: HTTP Error 500.19 - Internal Server Error The requested page cannot be accessed because the related configuration data for the page is invalid. Module DynamicCompressionModule Notification SendResponse Handler StaticFile Error Code 0x8007007e Requested URL https://localhost:8443/ Physical Path C:\inetpub\wwwroot Logon Method Anonymous Logon User Anonymous
OR
PLESK_INFO: HTTP Error 500.19 - Internal Server Error The requested page cannot be accessed because the related configuration data for the page is invalid. Detailed Error Information Module DynamicCompressionModule Notification SendResponse Handler StaticFile Error Code 0x8007007e Requested URL https://localhost:8443/ Physical Path C:\Program Files (x86)\Plesk\admin\htdocs
Failed request tracing shows:
CONFIG_TEXT: ModuleName DynamicCompressionModule Notification 536870912 HttpStatus 500 HttpReason Internal Server Error HttpSubStatus 19 ErrorCode 2147942526 ConfigExceptionInfo Notification SEND_RESPONSE ErrorCode The specified module could not be found. (0x8007007e)
There are no additional errors in php_error.log or in Event Viewer.
Cause
Error Code 0x8007007e means ERROR_MOD_NOT_FOUND - The specified module could not be found.
This problem occurs because the %windir%\system32\inetsrv\config\ApplicationHost.config file references a module that is invalid or that does not exist.
Resolution
Note: All commands have to be executed as administrator Connect to the server via RDP. Open Command Prompt under Administrator and run the following command to locate the module reference or the DLL reference that is invalid and ensure that the file exists and all required permissions are granted:
C:\> %windir%\system32\inetsrv\appcmd.exe list config -section:system.webServer/httpCompression | findstr ""dll"" <scheme name=""gzip"" dll=""%Windir%\system32\inetsrv\gzip.dll"" /> <scheme name=""xpress"" doStaticCompression=""false"" doDynamicCompression=""true"" dll=""C:\Program Files\WSUS\Services\WebServices\suscomp.dll"" staticCompressionLevel=""10"" dynamicCompressionLevel=""0"" /> Remove or disable the XPress compression scheme from the configuration using the command below:
C:\> %windir%\system32\inetsrv\appcmd.exe set config -section:system.webServer/httpCompression /-[name='xpress'] Create a IIS configuration backup:
C:\> %windir%\system32\inetsrv\appcmd.exe add backup BeforeEditBackup Stop IIS service in Plesk Services Monitor. Edit file %windir%system32\inetsrv\config\ApplicationHost.config and remove the line like the following:
CONFIG_TEXT: xpress scheme <scheme name=""xpress"" doStaticCompression=... /> Start IIS service in Plesk Services Monitor. "
0,"What are %plesk_dir%, %plesk_bin% and %plesk_vhosts% ?
Applicable to: Plesk for Windows Question
What are %plesk_dir%, %plesk_bin% and %plesk_vhosts% variables that are specified in Plesk commands?
Answer
These are the names of system environment variables that Plesk sets up on Windows to simplify access to its directories for administrators and scripts.
Variables exported by Plesk include the following: %plesk_dir% -- path to Plesk installation directory (e.g., C:\Program Files (x86)\Parallels\Plesk ) %plesk_cli% -- path to directory with Plesk command-line utilities (e.g., C:\Program Files (x86)\Parallels\Plesk\bin ) %plesk_bin% -- path to directory with Plesk backend utilities (e.g., C:\Program Files (x86)\Parallels\Plesk\admin\bin ) %plesk_vhosts% -- path to directory with virtual hosts (e.g., C:\Inetpub\vhosts ) These shorthand paths are used in Plesk Knowledgebase articles and can also be used for quick access to Plesk directories in command prompt, Windows Explorer, or the Run dialog. For example:
C:\> cd ""%plesk_dir%"" C:\Program Files (x86)\Parallels\Plesk
Always include paths in double quotes. If the variable value is file system path containing a space in its name, commands that use such a variable without quotes will fail, e.g:
C:\> %plesk_cli%\pleskbackup --help 'C:\Program' is not recognized as an internal or external command, operable program or batch file."
5,"Where Plesk migration session logs are located
Applicable to: Plesk Onyx for Linux
Plesk Onyx for Windows Question
Where are migration logs located? Where to check migration session status?
Answer
Migration logs are located on destination server. The migration task status logs are located in migration session directory. The session directory is located on the target server within: for Linux: /usr/local/psa/var/modules/panel-migrator/sessions/%session_id%/ for Windows: %plesk_dir%\var\modules\panel-migrator\sessions\%session_id%/ The <session-id> points to the date and time when the migration is started. Here are the most important log files:
info.log - Here you can find almost all necessary information about the migration, in brief.
debug.log - You may refer to this log file to get very detailed information about the migration.
progress - This file represents the current migration progress in a table view. For migration on the “restore” step, actual data is written to migration.log in /usr/local/psa/PMM/rsessions/%PMM_SESSION_ID%/directory on the target server. The YYYY-mm-dd-HH-MM-SS is the date and time when the restoration process was started, and nnn is a random number. There will be a separate restore session for each subscription.
To check migration status, find instructions here."
3,"How to update the ""Additional nginx directives"" field for all/several domains in Plesk
Applicable to: Plesk for Linux Question
How to update the ""Additional nginx directives"" field for all/several domains?
Answer
For security reasons, it is possible to adjust additional nginx directives only for new domains by means of service plan settings (Service Plans > plan_name > Web Server > Additional nginx directives). Otherwise, new directives can overwrite existing configuration and break websites' functionality.
Additional nginx directives for existing domains can be adjusted via a command-line interface.
Domain's additional nginx directives are saved in the vhost_nginx.conf configuration file which is located in /var/www/vhosts/system/example.com/conf. To update additional nginx directives for all/several domains, apply the following steps: Connect to a Plesk server via SSH. Create a list of domains, nginx directives of which should be updated:
Warning: All existing nginx directives will be overwritten for these domains by the script. Make sure existing nginx directives can be safely overwritten.
2.1. Create a new file with the name domains_list:
# touch domains_list
2.2. Add required domains to the created file. Each domain should be listed on a new line:
CONFIG_TEXT: example.com example.net example.org
To add a list of all hosted domains to the file, run this command:
# plesk bin site -l > domains_list Create a file with nginx directives that should be added to the domains from step 2:
3.1. Create a new file with the name directive_template:
# touch directive_template
3.2. Add required nginx directives to the file. For example:
Note: Make sure new additional nginx directives will not break nginx configuration. Before adding, test additional nginx directives on one domain in Plesk at Domains > example.com > Apache & nginx Settings.
CONFIG_TEXT: proxy_send_timeout 1200s; proxy_read_timeout 1200s; fastcgi_send_timeout 1200s; fastcgi_read_timeout 1200s; proxy_buffers 8 16k; proxy_buffer_size 32k; fastcgi_buffers 8 16k; fastcgi_buffer_size 32k; Run the command below to apply the changes:
# while read -r domain; do install directive_template -o root -g nginx -m 600 ""/var/www/vhosts/system/${domain}/conf/vhost_nginx.conf""; plesk sbin httpdmng --reconfigure-domain ""${domain}"" -no-restart; done < domains_list && service nginx reload Alternative solutions Set these directives in the custom nginx configuration file according to this Plesk Documentation page. Add required nginx directives to the global nginx configuration file according to this KB article. "
7," Plesk available editions and difference between them
Applicable to: Plesk 12.0 for Linux
Plesk 12.0 for Windows
Plesk 12.5 for Linux
Plesk 12.5 for Windows
Plesk Obsidian
Plesk Onyx
Plesk Onyx for Linux
Plesk Onyx for Windows Question
What are Plesk editions and the difference between them?
Answer
Starting with Plesk 12.x licenses are shipped in four editions optimized for specific needs: Plesk Web Admin Edition for Web Admins, who manage sites for an employer, a business, or for themselves. They want simple website and domain management without all of the service provider overhead, like management of customers, resellers or subscriptions. Plesk Web Pro Edition for Web Professionals, who design, develop, and deploy their websites. They want a simple way to manage their customers' websites, including their growing use of WordPress as a CMS platform. Plesk Web Host Edition for ""Traditional"" Web Hosters, who allow their customers to use their shared account in almost any configuration they want. They want secure WordPress and domain management tools to support their multi-tenant, ""install anything"" customers. Plesk Web Admin SE - Similar to standard Web Admin Edition but available only on some Clouds. Each edition has features that are in demand by a particular group and is defined by license key. Please refer to the article How to upgrade or downgrade a license between Plesk editions for information about available upgrades between Plesk editions.
Note: Web Admin Edition/SE enables 'Power User' view only. Licenses for Web Pro Edition and Web Host Edition enable both 'Power User' and 'Service Provider' views. License types are based on the operating environment in which Plesk will be running: VPS - fits different virtualization platforms: Virtuozzo (Virtual Private Server (VPS) Containers and VMs), VMware, Xen, Hyper-V, OpenVZ. See the full list of supported virtualization solutions in Plesk Obsidian Release Notes. Dedicated - can be installed on either a VPS or on a dedicated server. Since Plesk 12, there are no longer any ""Plesk for Windows"" and ""Plesk for Linux"" licenses. Now, you can install the same license on either a Windows or Linux server.
IMPORTANT: ColdFusion is not supported since Plesk 12.5, see this article for more details. ModSecurity is supported in both Plesk for Linux and for Windows. It works as a web server (Apache or IIS) module. DNSSEC is an extension for Plesk Onyx and Obsidian, see for more details: https://www.plesk.com/extensions/dnssec-manager/. Since November 7, 2016, free DNSSEC is included inWeb Pro and Web Host editions for free. SE Only - Limited Features Edition "
6,"How to remove a prefix from a database name, when creating a new database in Plesk
Applicable to: Plesk 12.5 for Linux Question
How to remove a prefix from a database name, when creating a new database in Plesk? Answer
Note: If you are a domain owner, contact your service provider for assistance.
In Plesk go to Tools & Settings > Database Hosting Preferences and change the value of the setting Add prefix and underscore to the beginning of database names to None. Apply the changes.
"
6,"Error adding an external database server: Host is not allowed to connect to this MySQL server
Applicable to:
Plesk for Linux Symptoms While adding external database server, the following error is received:
PLESK_ERROR: Host 'server IP address' is not allowed to connect to this MySQL server
OR
PLESK_ERROR: Error: Access denied for user 'admin'@'mysql server IP' to database Cause
Connection to MySQL is allowed from localhost by default. If Plesk should be connected to a remote MySQL server, it is needed to grant MySQL admin user privileges to manage a database from specific IP address (from Plesk IP address).
Resolution Log in to MySQL database on the external database server using CLI:
# mysql -uroot -p -h 203.0.113.2 Check whether the admin user exists on the server:
MYSQL_LIN: mysql> select * from user where User='admin'; If such user exists, skip this step. If such user does not exist, create it:
MYSQL_LIN: mysql> CREATE USER 'admin'@'plesk_server_IP' IDENTIFIED BY 'password'; Run the following queries:
MYSQL_LIN: mysql> GRANT all ON . TO admin@'plesk_server_IP'; mysql> FLUSH PRIVILEGES;
Note: replace the username and password with the actual admin credentials and plesk_server_IP with actual Plesk IP address. Make sure that port 3306 is opened on the server that is running MySQL Server. "
6,"Unable to start MySQL: Access denied for user 'debian-sys-maint'@'localhost' (using password: YES)
Applicable to: Plesk 12.5 for Linux Symptoms
While trying to start MySQL service, the following error can be found in /var/log/mariadb/mariadb.log or /var/log/mysql/error.log error log:
CONFIG_TEXT: Version check failed. Got the following error when calling the 'mysql' command line clientERROR 1045 (28000): Access denied for user 'debian-sys-maint'@'localhost' (using password: YES)FATAL ERROR: Upgrade failed
Cause
MySQL upgrade was started and not completed successfully. Defined password in MySQL database is incorrect.
Resolution Login to the server via SSH. Find password for debian-sys-maint user in /etc/mysql/debian.cnf :
# grep 'password' /etc/mysql/debian.cnfpassword = PASSWORDpassword = PASSWORD Stop MySQL:
# service mysql stop Add skip-grant-tables option into /etc/mysql/my.cnf in [mysqld] section. Start MySQL:
# service mysql start Login in MySQL:
# plesk db
MYSQL_LIN: > use mysql Update the password which is defined in /etc/mysql/debian.cnf :
MYSQL_LIN: > UPDATE mysql.user SET Password = password('PASSWORD') WHERE User = 'debian-sys-maint'; Remove skip-grant-tables option in /etc/mysql/my.cnf : Restart mysql
# service mysql start "
8,"How to restore mail accounts from a full domain backup to Plesk?
Applicable to: Plesk for Linux Question
How to restore mail accounts from a full domain backup to Plesk?
Answer Option 1. Restore mail account using Plesk GUI: Log into Plesk;
Go to Domains > example.com > Backup Manager;
Select the latest available backup or backup for the required date;
Select Selected objects, set the type of object Mail account;
Select required mail account from the list and click on it to move mail account to the selected list (to the right-hand side): Click OK. Option 2. Restore mail account using the command line interface: Connect to the server via SSH; Run the pleskrestore command, for example:
# /usr/local/psa/bin/pleskrestore --restore /var/lib/psa/dumps/dump.gz -only-mailnames list:john@example.com,annaroe@example.com
For more options about the pleskrestore utility, refer to command below:
# /usr/local/psa/bin/pleskrestore --help "
8,"Webmail/domain is unavailable: Server not found
Applicable to: Plesk for Linux
Plesk for Windows Symptoms When opening webmail/domain in a browser, it returns one of the following errors: Firefox:
CONFIG_TEXT: ""Server not found. Firefox can't find the server at webmail.example.com"" IE:
CONFIG_TEXT: ""Internet Explorer cannot display the webpage"" Chrome:
CONFIG_TEXT: ""Oops! Google Chrome could not find webmail.example.com""
OR
CONFIG_TEXT: ""ERR_NAME_NOT_RESOLVED""
OR
CONFIG_TEXT: ""404 not found"" Let's Encrypt cannot be issued on the domain:
CONFIG_TEXT: Error: Could not issue a Let's Encrypt SSL/TLS certificate for example.com. Authorization for the domain failed. <...> Details: Type: urn:acme:error:connection Status: 400 Detail: Fetching http://example.com/.well-known/acme-challenge/cCMl-4ZDqnWT-DEADBEEFl0sl_z9KVN_Ghkc1f1pMpQ: Timeout during connect (likely firewall problem) Cause
Webmail/domain does not resolve correctly in global DNS system because Plesk server is not set up to manage DNS.
Resolution
To verify the root cause, run the following commands in a command-line interface:
Note: the commands are identical on Windows, Linux and MacOS. The commands below are valid for webmail as well First, test if domain can be resolved to an IP address in general:
C:\> nslookup example.com Server: mydns.server.com Address: 203.0.113.2 Non-authoritative answer: Name: example.com Address: 203.0.115.20
Output explanation: Server and Address represent hostname and address of the server that provides response for the query sent by command nslookup; Name and Address(es) are the domain name which IP address is being queried and the IP address that was provided by the server as a response. However, if the following output is seen instead, it means that the domain does not resolve properly:
C:\> nslookup webmail.example.com Server: mydns.server.com Address: 203.0.113.2 *** UnKnown can't find example.com: No response from server Next, check if DNS service on the server with Plesk contains proper record for the domain:
C:\> nslookup webmail.example.com 203.0.115.20 <---- IP address of the server with Plesk Server: UnKnown Address: 203.0.115.20 Name: webmail.example.com Address: 203.0.115.20 If the first command does not return anything or returns a wrong IP address, and the second command returns valid records, then Plesk server is not serving the DNS zone for a domain.
There are two options to resolve the issue: Set Plesk server to be nameserver of the domain: How to use DNS with a Plesk server; Add a respective A-record on a registrar/3rd-party DNS side. Note: a similar issue can be observed for other DNS records like TXT, MX, CNAME and etc."
6,"What are limits for database name, user name and password?
Applicable to: Plesk for Linux Question
What are the limits for database name, database user name and password when adding a new database at
Home > Subscriptions > example.com > Websites & Domains > Databases > Add New Database
Answer
Limits are following: Database name - up to 63 alphanumeric characters. Database name prefixes(Username or External ID of a subscription) are allowed but must be enabled first.
Database user - up to 16 alphanumeric characters. Underscore and dash are allowed.
Password length and allowed characters depend on the server Security Policy set at Tools & Settings > Security Policy > Password strength "
2,"Unable to apply subscription settings: ""User 'john_doe' doesn't exist"" or ""URL '/plesk-stat' is not protected""
Applicable to: Plesk for Windows Symptoms When applying subscription settings (e.g. in Hosting Settings, PHP Settings, etc.), operation fails with:
PLESK_ERROR: Error: ProtDirUser_IIS::update() failed: Update Protected Directory #5 user failed: User 'john_doe' doesn't exist. (Error code 1)
OR
PLESK_ERROR: Error: ProtDirUser_IIS::update() failed: Update Protected Directory #5 user failed: URL '/plesk-stat' is not protected In IIS7NativeProvider module
OR
PLESK_ERROR: Error: ProtDirUser_IIS::update() failed: Add Protected Directory user failed: Url 'plesk-stat' is not protected. A backup restoration finishes with the warning:
PLESK_INFO: Warning: Restore domain ""example.com"" Execution of ""C:\Program Files (x86)\Parallels\Plesk\bin\domain.exe"" --update example.com -guid 957E312F-AFF5-4D89-A6BE-4CDC43FB4013 -creation-date 2015-01-01 -description """" -hosting true -hst_type phys -do-not-apply-skeleton -ip 203.0.113.2 -www-root httpdocs -login urallarotary -passwd """" -passwd_type sym -shell ""Login Disabled"" -ignore-nonexistent-options failed with return code 1. Stderr is An error occurred during domain update: An error occurred during changing of hosting settings: ProtDirUser_IIS::update() failed: Update Protected Directory #401 user failed: URL '/plesk-stat' is not protected In IIS7NativeProvider module Exception type: System.Exception at ProtectedUrls.get(ProtectedUrls* , unique_ptr* , basic_string* path) at updateProtectedUrlUser(urallarotary.org.au, /plesk-stat, urallarotary, )(WebServerManager::updateProtectedUrlUser line 792) at execute console command --update-protected-url-user(vconsoleapp::start line 122) at execute ""C:\Program Files (x86)\Parallels\Plesk\admin\bin64\websrvmng"" --update-protected-url-user ""--vhost-name=example.com"" ""--path=/plesk-stat"" ""--login=example"" ""--new-password=*""(vconsoleapp::run line 139) (Error code 1) Cause
Database of protected directories is corrupted.
Resolution Connect to the Plesk server via RDP. Start a command prompt as an Administrator. Synchronize password-protected directories data:
C:\> ""%plesk_cli%\repair.exe"" --synchronize-protected-directories-storage Retry to save subscription settings or restore a backup. If the operation fails with the same error message, recreate password-protected directories for the faulty domains: In Plesk, got to Domians > example.com > Password-protected directories. Select a password-protected directory and click Remove Protection. Once removed, click Add Protected Directory and add the removed directory back. "
0,"What do the domain status codes in Plesk mean? Applicable to: Plesk for Linux Plesk for Windows Question
While checking the status of the domain in Plesk database or by API apart from default 0 ""Active"" there could be other codes such as 1,2,4 or even 272 and 288, in Panel all of them are shown as ""Suspended"". What do these status codes mean?
Answer
Here is the table of status codes might be returned by Plesk and their meanings:
status value value binary desсriptionSTATUS_ACTIVE 0 00000000 activeSTATUS_STATUS 1 00000001 suspendedSTATUS_WITH_PARENT 2 00000010 suspended because of parent objectSTATUS_BACKUP_RESTORE 4 00000100 suspended because of backup/restoreSTATUS_WEB_SERVICE 8 00001000 service is temporarily off for webSTATUS_ADMIN 16 00010000 suspended by administratorSTATUS_RESELLER 32 00100000 suspended by resellerSTATUS_CLIENT 64 01000000 suspended by clientSTATUS_EXPIRED 256 100000000 suspended due to expiration
There is also a bitmask combination rule, which may combine the different statuses into one by summing up codes. E.g. 272 is a combination of statuses 256 and 16, which means that domain was suspended by the administrator and reached an expiration date."
0,"How to verify that the server is not acting as an open relay on Plesk?
Applicable to: Plesk for Linux
Plesk for Windows Question
Everyone can send mail from the server without authorization.
How to stop it?
Answer
If you find that your server is acting as an open relay, please check the following: Log into Plesk Go to Tools & Settings > Mail Server Settings and check the relaying setting in the server-wide mail preferences:
It should be set as authorization is required. On the same page check the white list and make sure that there are no unwanted IPs/networks.
By default, the list should contain only 127.0.0.1/8 or 127.0.0.1/32 or ::1/128.
This record means that authorization is required for all IPs except 127.0.0.1 and ::1/128.
That allows mail to be sent via Webmail. Additional information
To check if the server is really acting as an open relay, connect to the server via SSH or RDP try to connect to it from another server and send a message to an external email address:
# telnet <YOUR_SERVER_IP> 25 Trying <YOUR_SERVER_IP>... Connected to <YOUR_SERVER_IP>. Escape character is '^]'. 220 hostname ESMTP Postfix mail from: john.doe@example.com 250 2.1.0 Ok rcpt to: john.doe@example2.com 554 5.7.1 <john.doe@example2.com>: Relay access denied
If you see an output similar to the one shown above, your server is not an open relay. Otherwise, if you see a reply like 250 2.1.5 Ok, then the server, indeed, is acting as an open relay.
Note: When sending messages to an email address hosted on the same server authorization is usually not required, and such behavior is not considered as an open relay. The same applies to send messages locally from the server."
3,"Apache configuration shows error after removing a domain from Plesk: httpd: bad user name
Applicable to: Plesk for Linux Symptoms Apache configuration shows error: On CentOS/RHEL-based distributions:
# httpd -t AH00543: httpd: bad user name john_doe On Debian/Ubuntu-based distributions:
# apache2 -t AH00543: apache2: bad user name john_doe The user ""john_doe"" does not exist on the system:
# grep john_doe /etc/passwd # There is an Apache configuration file that contains this user: On CentOS/RHEL-based distributions:
# grep -r john_doe /etc/httpd/conf/plesk.conf.d/vhosts/* /etc/httpd/conf/plesk.conf.d/vhosts/example.com.conf: SuexecUserGroup ""john_doe"" ""psacln"" /etc/httpd/conf/plesk.conf.d/vhosts/example.com.conf: SuexecUserGroup ""john_doe"" ""psacln"" On Debian/Ubuntu-based distributions:
# grep -r john_doe /etc/apache2/plesk.conf.d/vhosts/* /etc/apache2/plesk.conf.d/vhosts/example.com.conf: SuexecUserGroup ""john_doe"" ""psacln"" /etc/apache2/plesk.conf.d/vhosts/example.com.conf: SuexecUserGroup ""john_doe"" ""psacln"" The domain in the file name (In this example, example.com) does not appear on the Domains page in Plesk and in the Plesk database:
# plesk db ""select id,name from domains where name='example.com'"" # The following warning might appear on the Home page in Plesk:
PLESK_ERROR: New configuration files for the Apache web server were not created due to the errors in configuration templates: AH00112: Warning: DocumentRoot [/var/www/*****(domain that was deleted long ago)] does not exist AH00543: apache2: bad user name example. Cause
Some of the Plesk objects (subscriptions/domains) were not properly removed.
Resolution Connect to a Plesk server via SSH. Find all orphaned files that belong to a nonexistent user: on CentOS/RHEL-based distributions:
# grep -r john_doe /etc/httpd/conf/plesk.conf.d/vhosts/* /etc/httpd/conf/plesk.conf.d/vhosts/example.com.conf: SuexecUserGroup ""john_doe"" ""psacln"" /etc/httpd/conf/plesk.conf.d/vhosts/example.com.conf: SuexecUserGroup ""john_doe"" ""psacln"" on Debian/Ubuntu-based distributions:
# grep -r john_doe /etc/apache2/plesk.conf.d/vhosts/* /etc/apache2/plesk.conf.d/vhosts/example.com.conf: SuexecUserGroup ""john_doe"" ""psacln"" /etc/apache2/plesk.conf.d/vhosts/example.com.conf: SuexecUserGroup ""john_doe"" ""psacln"" Remove these files: on CentOS/RHEL-based distributions:
# rm -rf /etc/httpd/conf/plesk.conf.d/vhosts/example.com.conf on Debian/Ubuntu-based distributions:
# rm -rf /etc/apache2/plesk.conf.d/vhosts/example.com.conf Regenerate web-server configuration files for all domains:
Note: If there are +300 domains on the server, run this command during server maintenance time.
# plesk repair web -y "
0,"How to create custom error page for suspended domain in Plesk? Applicable to: Plesk for Linux Question
""503 Service Temporarily Unavailable"" page is shown if domain is suspended in Plesk.
How to create a custom error page for the domain in Suspended status to hide this error?
Answer Log into Plesk; Customize the error page using the link Edit error page in Websites & Domains > example.com. Note: The link Edit error page is displayed only if hosting plan provides the option to customize web server error documents (the Custom error documents is On in the domain settings in Websites & Domains > example.com > Hosting Settings).
Additional Information
To customize other error pages, follow this article."
2,"Unable to change mailbox password or create an Acronis Backup: Unable create account with ID ""xxx"" hasPlainPassword() on boolean
Applicable to:
Plesk for Linux
Symptoms Attempt to change a mailbox password fails with the following error message:
CONFIG_TEXT: Unable to set password: Unable create account with ID ""XXX"". Going to Domains > example.com > Mail Accounts, the quick Webmail access icon might be missing An XML API call retrieving Mail account details returns the following error message:
CONFIG_TEXT: <result> <status>ok</status> <mailname> <id>632</id> <name>info</name> <mailbox> <enabled>false</enabled> <quota>-1</quota> </mailbox> <status>error</status> <errcode>1002</errcode> <errtext>Call to a member function hasPlainPassword() on boolean</errtext> </mailname> </result> An Acronis Backup fails to be created with the following error message in the Plesk log file /var/log/plesk/panel.log:
CONFIG_TEXT: ERR [1] Call to a member function hasPlainPassword() on boolean ERR [extension/acronis-backup] Execution of /opt/psa/admin/plib/modules/acronis-backup/scripts/create-meta.php failed with exit code 1 and the output: ... 11: /opt/psa/admin/plib/pm/ApiRpc.php:113 pm_ApiRpc->_call(string '<?xml version=""1.0""?> <mail><get_info><filter><site-id>28</site-id></filter><mailbox/><mailbox-usage/></get_info></mail> ') Cause
Database inconsistency: A record is missing in the accounts table for the corresponding email address
Resolution Connect to the server via SSH Back up the Plesk database:
# plesk db dump psa > psa.backup.sql Get a list with all the affected mailboxes:
# plesk db ""SELECT CONCAT(m.mail_name,'@',d.name) AS 'Email' FROM domains d, mail m WHERE d.id=m.dom_id AND m.account_id NOT IN (SELECT id FROM accounts)"" Fix all the affected mailboxes by adding the missing record in the database and creating a random 32 character password:
# plesk db -Ne ""SELECT CONCAT(m.mail_name,'@',d.name), m.account_id FROM domains d, mail m WHERE d.id=m.dom_id AND m.account_id NOT IN (SELECT id FROM accounts)"" | while read email accountId; do date; echo -e ""Email affected: $email""; echo -e ""Creating missing record...""; plesk db ""INSERT accounts VALUES ($accountId, 'plain','')""; RANDOMPASS=''; RANDOMPASS=$(cat /dev/urandom | tr -dc 'a-zA-Z0-9' | fold -w 32 | head -n 1); echo -e ""Adding 32 AlphaNumeric random password...""; plesk bin mail -u $email -passwd ""$RANDOMPASS""; echo -e ""Email fixed: $email\n""; done If necessary, assign a new password to the email addresses shown in the list retrieved in the Step 3
"
8,"How to enable Aspell spell cheking in Roundcube on Plesk?
Applicable to: Plesk for Linux Question
How to enable Aspell spell checking in Roundcube on Plesk?
Answer
Note: if you don't have root access to Plesk via SSH, contact your hosting provider regarding the issue
By default, Roundcube uses public web service for spell checking email contents.
To enable Aspell: Login to Plesk server via SSH Install necessaery packages:
# yum install aspell aspell-en php54w-pspell php-pspell Edit /usr/share/psa-roundcube/config/config.inc.php as below:
CONFIG_TEXT: $config['spellcheck_engine'] = 'pspell';$config['spellcheck_languages'] = array('en' => 'English'); Restart Apache:
# service httpd restart "
8,"Mail tester reports the warning: We didn't find a mail server (A Record) behind your hostname Applicable to: Plesk for Windows Symptoms Mail tester at https://www.mail-tester.com reports the following messages:
PLESK_INFO: We didn't find a mail server (A Record) behind your hostname WIN-J51J3J2OCOU.home Cause
Mail Server requires a Fully Qualified Domain Name (FQDN).
Resolution
Apply the solution from the KB article: For Linux
For Windows with MailEnable installed
"
2,"Plesk login page is not shown: Got error -1 from storage engine
Applicable to: Plesk for Linux
Plesk for Windows Symptoms Plesk interface is not accessible with one of the errors:
CONFIG_TEXT: ERROR: Zend_Db_Statement_Exception SQLSTATE[HY000]: General error: 1030 Got error -1 from storage engine
OR
CONFIG_TEXT: Error: Failed to connect to MySQL: ERROR 2002 (HY000): Can't connect to local MySQL server through socket '/var/lib/mysql/mysql.sock' (2)
OR
CONFIG_TEXT: Server Error 500 Plesk\Exception\Database DB query failed: SQLSTATE[HY000]: General error: 1881 Operation not allowed when innodb_forced_recovery > 0., query was: INSERT INTO sessions (sess_id, type, login, ip_address, login_time, modified, lifetime) VALUES (?, ?, ?, ?, ?, ?, ?)
OR
CONFIG_TEXT: Server Error 500 Plesk\Exception\Database DB query failed: SQLSTATE[HY000]: General error: 1036 Table 'sessions' is read only, query was: INSERT INTO `sessions` (`sess_id`, `type`, `login`, `ip_address`, `login_time`, `modified`, `lifetime`) VALUES (?, ?, ?, ?, ?, ?, ?) In the MySQL configuration file (/etc/my.cnf or /etc/mysql/my.cnf on Plesk for Linux, %plesk_dir%MySQL\my.ini on Plesk for Windows), the parameter innodb_force_recovery is set to the value more than 0:
# grep innodb_force_recovery /etc/my.cnf innodb_force_recovery=4 Restoration of the database from Plesk backup fails:
PLESK_ERROR: Stderr is ERROR 1881 (HY000) at line 48 in file: 'C:\Program Files (x86)\Parallels\Plesk\PrivateTemp\pmm-ru-udb-dump-01d4f884b411e470\pmm-mysdp-dd-dump-e7566891d2ba42a4a9306c12c48e53dc': Operation not allowed when innodb_forced_recovery > 0. WordPress login page redirects to https://example.com/wp-login.php?redirect_to=https%3A%2F%2Fexample.com%2Fwp-admin%2F&reauth=1 after enteting login and password. With WordPress debug enabled, the following message is logged:
CONFIG_TEXT: [Operation not allowed when innodb_forced_recovery > 0.] Cause
The option innodb_force_recovery is enabled and prevents MySQL from functioning properly.
Resolution
Note: This article is intended for use by server administrators. In case there is no administrative SSH or RDP access to the server, contact the server administrator or server provider. Connect to the server using SSH or RDP. Disable the option innodb_force_recovery in the MySQL configuration: Plesk for Linux Open the file /etc/my.cnf (/etc/mysql/my.cnf on Debian and Ubuntu) for editing. Remove the line which contains the option innodb_force_recovery and save the file. Restart MySQL service to apply the change (depending on the operating system, service can be called mysql or mariadb):
# service mysqld restart Plesk for Windows Open the file %plesk_dir%MySQL\my.ini in any text editor. Remove the line which contains the option innodb_force_recovery and save the file. Open the Services snap-in: in Windows Server 2008 and 2008 R2: go to Start > Administrative Tools > Services.
in Windows Server 2012 and newer: go to Start > Server Manager > Tools > Services. Select Plesk SQL Server and click Restart. Note: If after removing the line with the option innodb_force_recovery MySQL service still fails to start, it is required to fix InnoDB corruption. Depending on used operating system, follow one of the articles below for doing that: How to fix InnoDB corruption cases for the MySQL databases on Plesk for Linux? How to fix InnoDB corruption cases for the MySQL databases on Plesk for Windows?"
3,"Websites show 502 Bad Gateway: no resolver defined to resolve example.com
Applicable to: Plesk for Linux Symptoms Websites show the ""502 Bad Gateway"" error. The following error message appears in /var/log/nginx/error.log:
CONFIG_TEXT: [error] 20109#0: *945 no resolver defined to resolve example.com, client: 192.168.0.1, server: , request: ""GET / HTTP/1.1"", host: ""example.com"" ""$host"" is used instead of a server IP address as a ""proxy_pass"" value under ""location /"" in the file /etc/nginx/plesk.conf.d/server.conf:
CONFIG_TEXT: location / { proxy_pass http://$host:7080; proxy_set_header Host $host; proxy_set_header X-Real-IP $remote_addr; proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
Check it with the command:
# grep proxy_pass /etc/nginx/plesk.conf.d/server.conf Cause
nginx misconfiguration: There is no resolver specified in the nginx configuration.
Resolution Connect to the Plesk server via SSH. Open the file /etc/nginx/nginx.conf in any text editor. In this example we are using the vi editor:
# vi /etc/nginx/nginx.conf Add resolver under the http section:
CONFIG_TEXT: http { resolver 127.0.0.1; include mime.types; default_type application/octet-stream; Save the changes and close the file. Restart nginx:
# service nginx restart "
8,"How to verify POP3/IMAP traffic statistics for subscription in Plesk?
Applicable to: Plesk for Linux Question
In the menu Subscriptions > example.com > Statistics (or just Statistics in Power User view), a big amount of POP3/IMAP traffic is shown.
Although, only one mail account is configured in the domains which belong to this subscription.
How to verify POP3/IMAP traffic statistics manually?
Answer
Note: the script takes mail statistics from /var/log/maillog* files. To make it showing statistics for the last month, adjust maillog rotation in /usr/local/psa/etc/logrotate.conf
If Dovecot is used as POP3/IMAP Connect to the server using SSH. Check if the utility bc is installed on the server:
# command -V bc bc is /bin/bc
If the following output is returned, bc should be installed as per the following steps:
# command -V bc /bin/command: line 2: command: bc: not found For RHEL-based operating systems (CentOS, RHEL, CloudLinux):
# yum install bc For Debian and Ubuntu:
# apt install bc Download the script and unpack it:
# wget https://support.plesk.com/hc/en-us/article_attachments/360010836453/verify_pop3_imap_stats.tar.gz # tar -zxvf verify_pop3_imap_stats.tar.gz Click here to see the content of the script CONFIG_TEXT: echo -e ""Please specify the name of the subscription: "" read SUBSCRIPTION MAILLOGS=`echo $(find /var/log/maillog.processed* -maxdepth 0 -type f)`; \ SUBSCRIPTIONID=`plesk db -Ne ""select domains.id from domains where domains.name='$SUBSCRIPTION'""`; \ MONTH=`plesk db -Ne ""select date_format(max(date), '%b') from DomainsTraffic""`; \ for EMAIL in `plesk db -Ne ""SELECT CONCAT(mail_name,'@',name) FROM mail,domains WHERE domains.id=mail.dom_id and domains.id IN (select domains.id from domains where domains.id = '$SUBSCRIPTIONID' or domains.parentDomainId='$SUBSCRIPTIONID' or domains.webspace_id='$SUBSCRIPTIONID')""`; do \ RCVD=0; \ SENT=0; \ DATA_ROW=$(zgrep --no-filename $EMAIL $MAILLOGS | egrep ""$MONTH"" | egrep ""service=pop3|service=imap"" | egrep -v 127.0.0. | sed -n -e 's/.*rcvd=//; s/,.*sent=/ /p;' | cut -d ',' -f1); \ RCVD=$(echo ""$DATA_ROW"" | awk '\ { SUM += $1} END \ { print SUM }'); \ SENT=$(echo ""$DATA_ROW"" | awk '\ { SUM += $2} END \ { print SUM }'); \ if [ ""$RCVD"" -eq ""0"" ]; then \ echo -e ""\nThere aren't POP3/IMAP stats for $EMAIL\n""; \ else \ echo -e ""\nPOP3/IMAP stats for $EMAIL\n""; \ echo -e ""Bytes:\nSENT=$SENT\nRCVD=$RCVD\n""; \ RCVD1=`echo ""scale=3; $RCVD/1024+0.005""|bc -l`; \ SENT1=`echo ""scale=3; $SENT/1024+0.005""|bc -l`; \ RCVD1=`echo ""scale=2; $RCVD1/1""|bc -l`; \ SENT1=`echo ""scale=2; $SENT1/1""|bc -l`; \ echo -e ""KiloBytes:\nSENT=$SENT1\nRCVD=$RCVD1\n""; \ RCVD1=`echo ""scale=3; $RCVD/1024/1024+0.005""|bc -l`; \ SENT1=`echo ""scale=3; $SENT/1024/1024+0.005""|bc -l`; \ RCVD1=`echo ""scale=2; $RCVD1/1""|bc -l`; \ SENT1=`echo ""scale=2; $SENT1/1""|bc -l`; \ echo -e ""MegaBytes:\nSENT=$SENT1\nRCVD=$RCVD1\n""; \ RCVD1=`echo ""scale=3; $RCVD/1024/1024/1024+0.005""|bc -l`; \ SENT1=`echo ""scale=3; $SENT/1024/1024/1024+0.005""|bc -l`; \ RCVD1=`echo ""scale=2; $RCVD1/1""|bc -l`; \ SENT1=`echo ""scale=2; $SENT1/1""|bc -l`; \ echo -e ""GigaBytes:\nSENT=$SENT1\nRCVD=$RCVD1\n""; \ fi ; \ done Execute the script:
# ./verify_pop3_imap_stats.sh For Courier is used as POP3/IMAP server Connect to the server via SSH. Download the script and unpack it:
# wget https://plesk.zendesk.com/hc/article_attachments/360011194774/courier_traffic.tar.gz # tar xf courier_traffic.tar.gz Run the script with desired start and end dates and a domain name, if required
# ./courier_traffic.py --start 15-08 --end 22-08 --domain example.com --unit MB /var/log/maillog Note: To see all available options run the script with -h option: ./courier_traffic.py -h "
5," How to configure the passive ports range for ProFTPd on a server behind a firewall
Applicable to: Plesk for Linux Question
How to configure the passive ports range for ProFTPd on a server behind a firewall?
Answer
Note: When configuring the passive port range, a selected port range must be in the non-privileged range (e.g., greater than or equal to 1024). It is strongly recommended that the chosen range should be large enough to handle many simultaneous passive connections. The default passive port range is 49152-65535 (the IANA registered ephemeral port range). Connect to a server via SSH. Run the command below to check if the passive port range is configured in the FTP server:
# sed -n '/\<Global/,/\/Global/p' /etc/proftpd.conf /etc/proftpd.d/* | grep PassivePorts
If the command returns the same output as below, the passive port range is set up in ProFTPd configuration. Continue to step 3.
CONFIG_TEXT: PassivePorts 49152 65535
If no output is returned, configure the passive port range:
2.1. Create the /etc/proftpd.d/55-passive-ports.conf file using the following command:
# touch /etc/proftpd.d/55-passive-ports.conf
2.2. Open the /etc/proftpd.d/55-passive-ports.conf file in a text editor. In this example, we use the vi editor:
# vi /etc/proftpd.d/55-passive-ports.conf
2.3. Paste the content below in the file:
CONFIG_TEXT: <Global> PassivePorts 49152 65535 </Global>
2.4. Save the changes and close the file. Enable the kernel modules in the system:
Note: Actions that involves kernel modules configuration should be performed on a physical or a virtual machine with full hardware emulation. If a VZ container is used, the same actions should be performed on a hardware node where this VZ container is running.
3.1. Enable the nf_conntrack_ftp module:
# /sbin/modprobe nf_conntrack_ftp
3.2. If the server is behind the NAT (private IP address is configured in the system), enable the kernel nf_nat_ftp module as well:
# /sbin/modprobe nf_nat_ftp
3.3. Verify the changes:
# lsmod | grep nf_nat_ftpnf_nat_ftp 16384 0nf_conntrack_ftp 20480 1 nf_nat_ftpnf_nat 32768 1 nf_nat_ftpnf_conntrack 131072 3 nf_conntrack_ftp,nf_nat_ftp,nf_nat
3.4. To keep the changes after a system reboot, apply these steps: Add the modules to the /etc/modules-load.d/modules.conf file with these commands:
# echo nf_nat_ftp >> /etc/modules-load.d/modules.conf # echo nf_conntrack_ftp >> /etc/modules-load.d/modules.conf On CentOS/RHEL-based distributions, add the modules to the IPTABLES_MODULES line in the /etc/sysconfig/iptables-config file as follows:
# cat /etc/sysconfig/iptables-config | grep IPTABLES_MODULES IPTABLES_MODULES=""nf_conntrack_ftp ip_nat_ftp"" Restart the xinetd service to apply changes:
# service xinetd restart Open the passive port range in a firewall:
Note: If there is an intermediate firewall between a Plesk server and the Internet, make sure that the passive port range is allowed in its configuration as well. Contact your Internet Service Provider for assistance.
To open the ports in a local firewall, follow these steps: Manually
# iptables -A INPUT -m state --state RELATED,ESTABLISHED -j ACCEPT # iptables -I INPUT 2 -p tcp --match multiport --dports 49152:65535 -j ACCEPT # service iptables save Using Plesk Firewall (Recommended)
Note: If Plesk Firewall is not installed, use this installation guide. Opening the passive port range using Plesk Firewall In Plesk, go to Tools & Settings > Firewall and click Enable Firewall Rules Management. Once Firewall Rules Management is enabled, Look for the FTP server passive ports rule. If the rule exists, you are ready to go.
Note: In Plesk Onyx 17.8 which was not upgraded from previous versions, the FTP server passive ports rule is already installed. Just make sure this rule is enabled. If the rule does not exist, create it:
2.1. Click Modify Plesk Firewall Rules. 2.2. Click Add Custom Rule. 2.2. Configure the rule: Rule name: FTP server passive ports Match direction: Incoming Action: Allow In the Add port or port range field, specify the configured passive port range 49152-65535 and select the TCP option. 2.3. Click OK to create the rule.
2.4. Next, click Apply Changes. Additional Information PassivePorts - ProFTPd Related Articles How to manage firewall rules on a Plesk for Linux server
"
8,"Unable to start postfix on Plesk for Linux server: Address already in use
Applicable to:
Plesk for Linux
Symptoms Unable to start postfix, it fails with the error below in /var/log/maillog log file:
CONFIG_TEXT: postfix/postfix-script[9889]: starting the Postfix mail system postfix/master[9890]: fatal: bind 0.0.0.0 port 25: Address already in use Manual start for smtp service fails:
# plesk bin service --start smtp ERR [util_exec] proc_close() failed ['/opt/psa/admin/bin/mailmng-service' '--start-service' '--mail-component=mta'] with exit code [1] mailmng-service failed: exit status 1 Cause
Wrong configuration entries in /etc/postfix/master.cf , duplicate entries exist.
Resolution Connect to the server via SSH Verify that another application is not using port 25 (output should be empty):
# netstat -ntpl | grep 25 # If output is not empty and a 3rd-party service is running, kill the process:
# kill -9 <id> Edit file /etc/postfix/master.cf and comment out all duplicate lines in the configuration, for example:
CONFIG_TEXT: 203.0.113.2- unix - n n - - smtp -o smtp_bind_address=203.0.113.2 -o smtp_bind_address6= -o smtp_address_preference=ipv4
Note: The line with the IP address should exist only once in the /etc/postfix/master.cf configuration file. "
3,"How to manage and monitor CPU/RAM usage per domains in Plesk for Windows Server
Applicable to: Plesk for Windows Question
How to manage and monitor CPU/RAM usage per domains in Plesk for Windows?
Answer Managing CPU/RAM usage in Plesk To restrict CPU/RAM overload for any domain that has a dedicated IIS application pool, in Plesk go to:
Note: Switch on a dedicated IIS application pool to be able to manage these settings. for a domain:
Domains > example.com > Dedicated IIS Application Pool for Websites > Maximum CPU usage (%) for all new domains, that will be created under a Service Plan:
Service Plans > Example Plan > Performance > Maximum CPU usage (%). Managing CPU Uncheck Unlimited next to the option Maximum CPU usage (%) and specify your custom value. Set up an action, which will be taken, when CPU limit is exceeded (Limit action): Log Only: No action is taken when the CPU limit is exceeded. Only a warning will be written to the Windows Event Viewer (Custom Views > Administrative Events). Shut Down: The process that exceeds its CPU limit will be forced to shut down. New process will be spawned. Throttle: Reduce the CPU consumption to the value set for limit. It cannot be exceeded. Throttle Under Load: Reduce the CPU consumption to the value set for the limit, but only if there are other processes that demand CPU time. Specify the time, the reset interval for monitoring of CPU usage by worker processes (Limit Interval). Managing RAM Uncheck Unlimited next to the option Recycling when the maximum amount of private memory is used and specify your custom value. Monitoring CPU/RAM usage in IIS Manager CPU/RAM usage of every application pool can be tracked in IIS Manager: Connect to a Plesk server via RDP. Start Internet Information Services (IIS) Manager at Windows Start > All Programs > Windows Administrative Tools. In IIS Manager, click SERVER NAME > Worker Processes (IIS section). Additional Information CPU Settings for an Application Pool <cpu> | Microsoft Docs
"
8,"How to protect a Plesk server from spam using SpamAssassin
Applicable to: Plesk for Linux
Plesk for Windows Question
How to protect a Plesk server from spam using SpamAssassin?
Answer Log in to Plesk. Enable SpamAssassin spam filter in Tools & Settings > Spam Filter.
Note: If Plesk Email Security extension is installed, SpamAssassin is enabled by default. Test SpamAssassin using the instructions from this KB article. For further spam filter accuracy improving, it needs to be trained: Access mailbox using webmail or mail client. Move all spam messages to the ""Spam"" folder. This will make the SpamAssassin spam filter recognize spam more efficiently.
Note: Spam filter system is not activated until a certain number of ham (non-spam) and spam have been learned. The default is 200 of each ham and spam messages. Change this value with the help of this KB article. Detailed information about spam filter configuration and improving spam filter accuracy is available in Customer's Guide.
Information about all available anti-spam tools is available in Administrator's Guide. Additional Information
To better protect the server from incoming spam, refer to this KB article."
0,"How to change the subject of the Plesk notification emails?
Applicable to:
Plesk Onyx for Linux
Question
How to change the subject of the Plesk notification emails?
Answer Plesk Obsidian Log into Plesk. Go to Tools & Settings > Notifications. Find a notification whose text and/or subject you want to edit and then click the edit icon on the corresponding line. Change the notification text and/or subject. Plesk Onyx and below Connect to the server using SSH Create a database backup before any updates:
# MYSQL_PWD=`cat /etc/psa/.psa.shadow` mysqldump -u admin psa > /root/psa`date +%F_%H.%M`.sql Check notification subjects:
# mysql -uadmin -p`cat /etc/psa/.psa.shadow ` psa -Ne ""SELECT id, subj FROM Notifications;"" +----+------------------------------------------------------------------------------+ | 1 | Notification of the customer creation. | | 2 | Notification of the site creation. | | 3 | Notification: Resource usage by subscription has exceeded the allotments. | | 6 | Subscription event notification: The subscription term has expired. | | 7 | Subscription event notification: The subscription term is about to expire. | | 12 | Application Manager Error notification. | | 13 | Notification of the reseller creation. | | 16 | Notification: Resource limits exceeded by reseller account. | | 18 | Notification: Subscription was suspended due to resource overuse. | | 20 | Notification: Reseller account has exceeded its limits and was suspended. | | 22 | Notification: Resources overuse blocked for reseller account. | | 23 | Application Updates. | | 24 | Application Updates. | | 25 | Application Updates. | | 26 | Attempts to exceed outgoing limits for domains, mailboxes and subscriptions. | | 27 | Package Update Manager notification | | 28 | Notification: Resource usage by subscription has exceeded the allotments | +----+------------------------------------------------------------------------------+ Update the desired subject (use the id field for selecting desired event notification).
For example, if you want to change event notification subject for Notification of the customer creation run the following:
# MYSQL_PWD=`cat /etc/psa/.psa.shadow` mysql -u admin psa -e""update Notifications set subj='Changed - Notification of the customer creation' where id=1"" Note: the event notification subject also contains the hostname of the Plesk server, so the subject looks like:
CONFIG_TEXT: <example.com> Changed - Notification of the customer creation
Value example.com cannot be changed within notification subject. "
9,"How to recalculate AWStats web-statistics using domain logs for previous months in Plesk
Applicable to: Plesk Onyx for Linux Question
How to recalculate AWStats web-statistics using domain logs for previous months?
Answer
There are two techniques to recalculate/regenerate AWStats statistic files: From AWStats txt files, which are still within the AWStat directory: Instructions to check Connect to the server via SSH. Check the directory:
# ls -lahn /var/www/vhosts/system/example.com/statistics/webstat-ssl/ | grep awstats | awk '{print $9}' awstats082018.example.com-https.txt awstats092018.example.com-https.txt awstats102018.example.com-https.txt awstats112018.example.com-https.txt awstats122018.example.com-https.txt Note: In this case the months 08(August), 09(Semptember), 10(November), 11(October), 12(December) can be retrieved for the year 2018. From the old logs, which are present on the server. Note: In both, old logs and AWStats txt file, are deleted, the recalculation will not be possible.
Installation How to install the tool Connect to a Plesk server via SSH. Download and unpack the script:
# wget https://support.plesk.com/hc/en-us/article_attachments/360040067853/rebuild_awstatsv2.tar.gz # tar -xzvf rebuild_awstatsv2.tar.gz For Ubuntu 14.04, a symbolic link should be created:
# ln -s /usr/lib/plesk-9.0/logresolvemerge /usr/share/doc/awstats/examples/logresolvemerge.pl Run this command to show help message:
# ./rebuild_awstats.sh Rebuild AWstats static pages from available log files. Usage: ./rebuild_awstats.sh [options] [<domains...>] Options: -A --all-domains Process all domains. If this option is not specified, then list of domains to process must be provided. -F --from-scratch Remove contents of webstat/ and webstat-ssl/ directories before rebuilding statistics pages (originals are saved with numeric suffix). Statistics will be rebuilt from logs only, only for period covered by log files. If this parameter is not used, then statistics is recalculated beginning on the month on which log files start (if log starts in the middle of the month, then statistics for first half of the month will not be present.) -R --rebuild Rebuilds the HTML files for AWStats. -h --help This message. Click on a section to expand How script works General Functionality For each specified domain (or all domains, if the -A option is used), the script will memorize the log file's start date. Then, it will remove AWStats data files for the months covered by the log files and rebuild them with corresponding information. Finally, the script will build static pages with statistics summary for each month covered by the log files. -F If the -F option is used, all AWStats data will be removed and new files will be generated using only the information stored in the log files. -R if the -R option is used, the script will gather all data of the mentioned domain and will generate all months, where the AWStats txt data is existing. Merging Web-Statistics
In order to merge web-statistics which was created from scratch with AWStats statistics from another directory, the corresponding .txt file should be copied from the webstat directory. For example, statistics of a domain for December were created from scratch. In this case, the following files should be copied from /var/www/vhosts/system/example.com/statistics/webstat/: A .txt file dated by December 2018: awstats122018.example.com-http.txt At the end it required to run the script with -R to build the HMTL files:
# ./rebuild_awstats.sh -R example.com Click on a section to expand Output example For every processed domain, the script will report this message:
CONFIG_TEXT: === example.com Saving: webstat* --> webstat*.3 Logs begin on Apr 18 2018 access_log* (new/old/corrupted): 9/0/0 access_ssl_log* (new/old/corrupted): 71/0/0 Rebuilding static pages: 2018-04 2018-05 2018-06 2018-07
The message ""_Saving: webstat* --> webstat*.3 _"" in the output above shows that the original directories are saved with a numeric suffix (the suffix is increased if the destination directory already exists). This makes it possible to roll-back to old AWStats statistics if needed.
In case the script was launched to recalculate statistics from scratch (with -F flag), which removes old web-statistics that is not stored in log files, it is possible to restore it from the backup that was created by the script. "
8,"Sending messages from webmail fails: SMTP Error (250): Authentication failed
Applicable to: Plesk for Linux Symptoms Rouncube shows error:
CONFIG_TEXT: SMTP Error (250): Authentication failed Checking server externally with telnet is not showing the AUTH option at all to the EHLO command:
# telnet 203.0.113.2 25 Trying 203.0.113.2... Connected to 203.0.113.2. Escape character is '^]'. 220 203.0.113.2 ESMTP Postfix EHLO example 250-203.0.113.2 250-PIPELINING 250-SIZE 51200000 250-ETRN 250-STARTTLS 250-ENHANCEDSTATUSCODES 250-8BITMIME 250 DSN In the /var/log/plesk-roundcube/errors the following error may be shown:
CONFIG_TEXT: SMTP Error: Authentication failure: SMTP server does not support authentication (Code: ) in /usr/share/psa-roundcube/program/lib/Roundcube/rcube.php on line 1667 (POST /?_task=mail&_unlock=loading1554712039855&_lang=en_US&_framed=1&_action=send) Cause
Postfix misconfiguration.
Resolution Connect to the server via SSH; Check that smtpd_tls_protocols, smtpd_tls_ciphers and smtpd_tls_security_level, smtpd_sasl_auth_enable are set as below using the following command:
# grep -E ""smtpd_tls_protocols|smtpd_tls_security_level|smtpd_tls_ciphers|smtpd_use_tls|smtpd_sasl_auth_enable"" /etc/postfix/main.cf smtpd_use_tls = yes smtpd_tls_security_level = may smtpd_tls_ciphers = medium smtpd_tls_protocols = TLSv1 TLSv1.1 TLSv1.2 smtpd_sasl_auth_enable = yes Make sure that smtpd_tls_exclude_ciphers, smtpd_sasl_security_options, smtpd_tls_auth_only and tls_ssl_options are not defined in /etc/postfix/main.cf file (the output of the command below should be empty):
# grep -E ""smtpd_tls_exclude_ciphers|smtpd_sasl_security_options|smtpd_tls_auth_only|tls_ssl_options"" /etc/postfix/main.cf Reload postfix if any changes were made:
# service postfix reload Additional Information
[Troubleshooting] Cannot configure Plesk e-mail account with the mail client (Outlook, Thunderbird, Apple Mail): Authentication methods aren't supported by server. "
3,"How to configure PEAR in PHP on Plesk for Windows?
Applicable to: Plesk 12.0 for Windows
Plesk 12.5 for Windows
Plesk Onyx for Windows Warning: the official statement from http://pear.php.net/ dated 24th of January 2019:If you have downloaded this go-pear.phar in the past six months, you should get a new copy of the same release version from GitHub (pear/pearweb_phars) and compare file hashes. If different, you may have the infected file.If you have used the resolution from this article in the past 6 months, check the downloaded file.
Question
How to configure PEAR in PHP on Plesk for Windows?
Resolution
To configure PEAR with PHP on a Plesk Server, it is required to download it from pear.php.net, place it to the PHP directory and perform the installation: Log into the server via RDP. Open the pear.php.net via the browser, download the page and save it to the directory with PHP, for example for PHP 5.6 it will be %plesk_dir%\additional\PleskPHP56: Note: the end file should have .phar extension, in case it was saved as .txt, rename it to be .phar. Open the Command Line and change the current directory to the directory where go-pear.phar was saved:
C:\> cd ""%plesk_dir%\additional\PleskPHP56"" Start pear installation with the following command:
C:\> php go-pear.phar
Note: It is possible to leave all settings as default during the process of installation and just agree with installer on every request. Add the path to pear.bat to Path environment variable. For that, open This Computed > Properties > Advanced System settings > Environment Variables... , add path to pear.bat to Path: Reboot the server to apply the changes. These actions will install the ""pear"" command, including basic PEAR packages. Use the ""pear"" command from the Windows command prompt to manage PEAR packages:
C:\> pear versionPEAR Version: 1.10.5PHP Version: 5.6.34Zend Engine Version: 2.4.0Running on: Windows NT WIN-KVET51JS51V 6.3 build 9200 (Windows Server 2012 R2 Datacenter Edition) i586
Visit https://pear.php.net/ for more detailed information on configuring and using PEAR packages.
Additional InformationAlso see https://pear.php.net/manual/en/installation.getting.php ."
7," How to install / uninstall Plesk components?
Applicable to: Plesk for Windows
Plesk for Linux Question
How to install/remove Plesk additional components (like PHP, Spam Assassin, Fail2Ban, Kaspersky AntiVirus, Plesk Premium antivirus etc.)?
Answer
Note: not all components can be uninstalled.
Note: TCP port 8447 should be opened on the server. via Plesk interface Log in to Plesk. Go to Plesk > Tools & Settings > Updates and Upgrades > Add/Remove components:
Note: since Plesk Obsidian Plesk > Tools & Settings > Updates > Add/Remove components Mark the required components for the installation/removing by pressing the icon opposite the corresponding component and clicking the Install/Remove button: Click the Continue button to install/remove Plesk additional components. via Command Line Interface (CLI) for Linux Connect to the server via SSH. Launch Plesk Installer:
# plesk installer Follow instructions on the screen. via Command Line Interface (CLI) for Windows Connect to the server via RDP. Open Command Prompt. Launch Plesk Installer in the console:
C:\> plesk installer --console Follow instructions on the screen. "
2,"Plesk is not accessible with error 502 and sw-engine fails to start: failed to open error_log (/var/log/sw-cp-server/sw-engine.log): No such file or directory (2)
Applicable to:
Plesk for Linux
Symptoms Plesk is not accessible:
CONFIG_TEXT: 502 Bad Gateway The service sw-engine is down:
# systemctl status sw-engine -l..........plesk.example.com systemd[1]: Starting Startup script for Panel sw-engine...plesk.example.com sw-engine-fpm[17102]: ERROR: failed to open error_log (/var/log/sw-cp-server/sw-engine.log): No such file or directory (2)plesk.example.com sw-engine-fpm[17102]: ERROR: failed to post process the configurationplesk.example.com sw-engine-fpm[17102]: ERROR: FPM initialization failedplesk.example.com systemd[1]: sw-engine.service: main process exited, code=exited, status=78/n/aplesk.example.com systemd[1]: sw-engine.service stop-sigterm timed out. Killing.plesk.example.com systemd[1]: Failed to start Startup script for Panel sw-engine.plesk.example.com systemd[1]: Unit sw-engine.service entered failed state.plesk.example.com systemd[1]: sw-engine.service failed. Cause
The log file /var/log/sw-cp-server/sw-engine.log does not exist on the server.
Resolution Connect to the server using SSH. Re-create the log directory if it does not exist:
# if [ ! -d ""/var/log/sw-cp-server"" ]; then mkdir /var/log/sw-cp-server && chmod 750 /var/log/sw-cp-server; fi Re-create the missing log file:
# touch /var/log/sw-cp-server/sw-engine.log && chmod 600 /var/log/sw-cp-server/sw-engine.log Start sw-engine:
# service sw-engine start "
6,"Website hosted on Plesk is not working: Microsoft OLE DB Provider for SQL Server error '80004005'
Applicable to: Plesk for Windows Symptoms Unable to browse website hosted on Plesk. The following is shown instead of content: PLESK_INFO: Microsoft OLE DB Provider for SQL Server error '80004005' Warning: Fatal error 9001 occurred at Dec 4 2017 2:41PM. Note the error and time, and contact your system administrator. /Default.asp, line 67 Cannot suspend Plesk reseller:
C:\> C:\Program Files (x86)\Parallels\Plesk\admin\bin>reseller --off resellernameDisable database user failed: mssqlmng failed: The log for database 'example.com_data' is not available. Check the event log for related error messages. Resolve any errors and restart the database. Unable to add database user for the database dbname in Domains > example.com > Databases > User Management > Add Database User:
PLESK_ERROR: Error: Connection to the database server has failed: The log for database 'dbname' is not available. Check the event log for related error messages. Resolve any errors and restart the database. (Error code 1) Unable to export database dump in Domains > example.com > Databases > dbname > Export Dump:
PLESK_ERROR: Source: System.Data Message: ExecuteNonQuery requires an open and available Connection. The connection's current state is closed. dbbackup.DbBackupException: Unable to backup database 'ARC_PIS' ---> System.Data.SqlClient.SqlException: Warning: Fatal error 9001 occurred at Dec 4 2017 2:41PM. Note the error and time, and contact your system administrator. BACKUP DATABASE is terminating abnormally. Cause
Corrupted log file %plesk_dir%Databases\MSSQL\MSSQLXX.MSSQLSERVERXXXX\MSSQL\DATA\dbname.ldf.
Note: XX and XXXX correspond to the SQL Server version.
Resolution Connect to the server using RDP Determine SQL Server service name:
C:\> sc query | findstr MSSQL | findstr SERVICE_NAMESERVICE_NAME: MSSQL$MSSQLSERVER2017SERVICE_NAME: MSSQLFDLauncher$MSSQLSERVER2017SERVICE_NAME: SQLTELEMETRY$MSSQLSERVER2017 Stop SQL service:
C:\> net stop MSSQL$MSSQLSERVER2017 Rename log file %plesk_dir%Databases\MSSQL\MSSQLXX.MSSQLSERVERXXXX\MSSQL\DATA\dbname.ldf:
C:\> move %plesk_dir%Databases\MSSQL\MSSQLXX.MSSQLSERVERXXXX\MSSQL\DATA\dbname.ldf %plesk_dir%Databases\MSSQL\MSSQLXX.MSSQLSERVERXXXX\MSSQL\DATA\dbname.ldf.bkp Start SQL Server:
C:\> net start MSSQL$MSSQLSERVER2017
Note: In order to find the root cause why the database log file got corrupted, contact Microsoft support. In case the issue persists, re-enable the database Connect to the server via RDP Open Microsoft SQL Server Management Studio and log into affected SQL Server instance as Windows Administrator Execute the following queries through New Query:
MYSQL_WIN: USE master GO ALTER DATABASE dbname SET OFFLINE WITH ROLLBACK IMMEDIATE GO USE MASTER GO ALTER DATABASE dbname SET ONLINE GO "
5,"Unable to start a Plesk migration: /root/.ssh/authorized_keys: Permission denied
Applicable to: Plesk for Linux Symptoms Unable to start a Plesk migration. The following error message can be found in the downloaded debug logfile:
CONFIG_TEXT: [ERROR] Failed to fetch basic information about resellers, clients and domains data from source servers Cause: The command ""authorized_keys_dir=""`dirname ~/.ssh/authorized_keys`""; if [ ! -d ""$authorized_keys_dir"" ]; then mkdir -p ""$authorized_keys_dir""; fi; ........... executed at the source server 'source' (203.0.113.2) returned a non-zero exit code. Stderr: bash: line 8: /root/.ssh/authorized_keys: Permission denied The /root/.ssh directory has immutable bit:
# lsattr -a /root/.ssh ----i-------- /root/.ssh/. Cause
Plesk is not able to create an authorized_keys file, because the /root/.ssh directory is immutable.
Resolution Connect to the source Plesk server via SSH. Remove the immutable bit attribute:
# chattr -i /root/.ssh Restart the Plesk migration. "
3," Websites periodically are not available: scoreboard is full, not at MaxRequestWorkers
Applicable to: Plesk 12.5 for Linux
Plesk Onyx for Linux Symptoms Websites periodically are not available with one of the errors below:
CONFIG_TEXT: 502 Bad gateway
CONFIG_TEXT: 504 Gateway Time-out (nginx) The following error can be found in Apache Web Server log files (/var/log/apache2/error.log on Debian and Ubuntu, /var/log/httpd/error.log on RHEL, CentOS and CloudLinux):
CONFIG_TEXT: [mpm_event:error] [pid 22565:tid 140163371042688] AH00485: scoreboard is full, not at MaxRequestWorkers MPM mode is set to Event in Tools & Settings > Apache Web Server. Cause
Apache bug with ID #53555.
Resolution
As a workaround, the following steps can be performed: Switch to MPM Prefork Log into Plesk. Open Tools & Settings > Apache Web Server. Change MPM mode to Prefork or Worker, if it is available. Configure logrotate to restart Apache instead of reloading Note: This workaround might not resolve the issue Connect to the server via SSH. Open logrotate configuration for Apache Web Server using a text editor:
for CentOS/RHEL-based distributions: /etc/logrotate.d/httpd
for Debian/Ubuntu-based distributions: /etc/logrotate.d/apache2 Change ""reload"" action to ""restart"":
FROM
CONFIG_TEXT: /bin/systemctl reload httpd.service > /dev/null 2>/dev/null || true
TO
CONFIG_TEXT: /bin/systemctl restart httpd.service > /dev/null 2>/dev/null || true Increase MaxRequestWorker settings. "
8,"[BUG] Cannot repair mail service for a domain: Invalid or unsupported Unicode character or escape sequence found in string
Applicable to: Plesk Onyx for Linux Symptoms plesk repair mail command fails with the following error:
# plesk repair mail example.com Repairing the mail server configuration Reconfiguring the settings of domains: example.com ........ [OK] Reconfiguring the mailboxes ..................................... [2016-09-13 15:56:14] ERR [util_exec] proc_close() failed ['/usr/local/psa/admin/bin/mailname_repair'] with exit code [1] [FAILED] - mailname_repair failed: Input parse error: Invalid or unsupported Unicode character or escape sequence found in string. UTF8 encoded characters and '\\u' escape sequences are not supported. Error occured at offset 2124, character '\\'. Worker /usr/local/psa/admin/sbin/mailname_repair.worker failed with exit status 1 Error messages: 0; Warnings: 0; Errors resolved: 0 exit status 1 In Domains > Email Addresses > test@example.com > Auto-Reply contains text in Japanese/French/German or other languages considered as NON-ASCII. Cause
NON-ASCII symbols in Auto-Reply in one or several mailboxes. This is Plesk bug with ID #PPPM-4946 , that will be fixed in future Plesk updates.
Resolution
Until fix available, proceed with the following: Log in to Plesk; Open Home > Domains > example.com > Mail and find all mailboxes with auto-reply enabled. Alternatively, it is possible to locate all mailboxes with enabled auto-reply option on a server directly: connect to the server via SSH and execute the command:
# MYSQL_PWD=`cat /etc/psa/.psa.shadow` mysql -u admin psa -Ne ""select m.mail_name, d.name AS domain from domains d, mail m where m.dom_id = d.id and m.autoresponder='true'""+-----------+----------+ | test | example.com | | test2| example.com | +-----------+----------+
In this output, emails with enabled auto-reply option are test@example.com and test2@example.com Temporary disable Auto-Reply for each mailbox via Domains > example.com > Email address > test@example.com > Auto-reply; Connect to the server via SSH and run the command:
# plesk repair mail Turn on Auto-Reply back for mailboxes, if needed in Domains > example.com > Email address > test@example.com. "
3,"Cannot log in to Plesk as a system user: Authentication failed: invalid username or password specified Applicable to: Plesk Symptoms
Cannot log in to Plesk as a user to manage all my subscriptions: The issue still persists even after resetting the password for this user in Domains > example.com > Web Hosting Access > System user Cause
The system user is not allowed to log in to Plesk. Customers obtain their system users' access credentials from their service providers and use these credentials for connecting to the server through FTP, SSH, and so on. In addition, all operations with files and directories in Plesk are performed on behalf of system users. For example, when a customer adds a new file in File Manager, the subscription's system user becomes the owner of the file.
Resolution
Only the following types of accounts are allowed to log in to Plesk: Plesk administrator account or Power user Additional administrator account Types of Plesk users' accounts Make sure that one of the above user accounts is used for logging in (not system user). Also, check the username. Sometimes, it is needed to specify a full name like ""johndoe@example.com"" "
8,"How to enable and check that domain on Plesk has a correct SPF record Applicable to: Plesk for Linux Question
How to check that domain on Plesk has a correct SPF record?
Answer Using online services The most simple solution is to use online tools like the following below: http://mxtoolbox.com/spf.aspx http://www.kitterman.com/spf/validate.html http://www.openspf.org/Tools
If there is no SPF DNS record found after test, do the following: Make sure that SPF, DKIM, DMARC (for Plesk Onyx 17.0 and higher) are enabled in Tools & Settings > Mail Server settings Make sure that DKIM signing is enabled in Domains > example.com > Mail Settings - Use DKIM spam protection system to sign outgoing email messages (optional, if required)
Make sure that Domains > example.com > DNS Settings contains similar records Wait 24-32 hours for DNS propagation and check again. Manually via SSH Connect to the Linux server or use Terminal (How to connect to a server using SSH/RDP ): Try to query with a command provided by libspf2 library like as below:
# /usr/bin/spfquery_static -ip 10.20.30.40 -sender from@example.com -rcpt-to to@example.com A correctly set domain will print like this (using Google as an example):
# /usr/bin/spfquery_static -ip 66.102.13.18 -sender from@gmail.com -rcpt-to to@gmail.com pass spfquery: domain of gmail.com designates 66.102.13.18 as permitted sender Received-SPF: pass (spfquery: domain of gmail.com designates 66.102.13.18 as permitted sender) client-ip=66.102.13.18; envelope-from=from@gmail.com; A problematic domain looks more like this:
# /usr/bin/spfquery_static -ip 11.22.33.44 -sender from@example.com -rcpt-to to@gmail.com StartError Context: Failed to query MAIL-FROM ErrorCode: (26) DNS lookup failure Error: Temporary DNS failure for 'example.com'. EndError (invalid)neutral Please see http://www.openspf.org/Why?id=from%40example.com&ip=11.22.33.44&receiver=spfquery : Reason: default spfquery: 11.22.33.44 is neither permitted nor denied by domain of example.com Received-SPF: neutral (spfquery: 11.22.33.44 is neither permitted nor denied by domain of example.com) client-ip=11.22.33.44; envelope-from=from@example.com; To check that DNS server has information about SPF for domain example.com , use the dig utility:
# dig -t TXT +short example.com @13.23.33.43 ""v=spf1 +a +mx -all +a:server.hostname.tld""
where 13.23.33.43 IP address of the server.hostname.tld where DNS server is running. Information Note that the SPF information can be written in either TXT format or as a dedicated SPF record. The latter is also sometimes referred to as a ""type99"" record. The SPF information needs to be in at least one of these formats. If both are used, these records must be exact copies of each other. These records are served by the same DNS server that serves example.com domain name.
Library libspf2 performs an SPF check in the following order: - First, it queries the DNS server for an SPF record. - If it is not defined, it tries to query for TXT. - If both attempts fail, it means there is no SPF for this domain.
For more information check Plesk Documentation and Help Portal - Sender Policy Framework System (Linux) "
0,"How to enable/disable SSL support for Subscription on Plesk for Linux
Applicable to: Plesk for Linux Symptoms
How to enable/disable SSL support for a Subscription via CLI?
Resolution
via Plesk GUI Log in to Plesk
Go to Domains > example.com > Hosting Settings and enable/disable SSL/TLS support option. via CLI Connect to the server using SSH;
To disable SSL support for subscription:
# /usr/local/psa/bin/subscription -u example.com -ssl false
To enable SSL support for subscription:
# /usr/local/psa/bin/subscription -u example.com -ssl true Note: this utility only enables/disables the SSL support for a subscription. To assign a certificate for a domain, check this article."
9,"How to remove domain DNS record in Plesk?
Applicable to: Plesk for Windows
Plesk for Linux Question
How to remove domain DNS record?
Answer
DNS records can be removed via Plesk panel (Linux and Windows) or command line interface (Linux only).
Click on a section to expand Via Plesk UI 1. Go to Domains > example.com > DNS settings, choose required DNS record and click Remove;
2. Click Update button in the pop-up warning to apply changes Via CLI for Linux Only Get DNS zone records list:
# plesk bin dns --info example.com
Examples of deleting records:
# plesk bin dns -d example.com -nameserver ns2.example.com. -ns """"
# plesk bin dns -d example.com -a ns2 -ip 203.0.113.2 Additional information
For more information, refer to Plesk documentation: DNS Zones on Domains"
